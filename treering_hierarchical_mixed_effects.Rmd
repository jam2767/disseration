Tree ring bayesian hierarchical mixed effects model
========================================================

The tree ring analysis to-date has included a hierarchical structure to include individuals, subplots, plots and sites and some individual effects like species. I am now adding year x plot and year x site interactions to see how much variance is explained by climate at each site and within a site.

You can embed an R code chunk like this:

```{r}
#Required Packages
library(lme4)
library(rjags)
library(data.table)
library(mcmcplots)
library(ggplot2)
library(plyr)
library(multcompView)

#helper functions
#function to find last value of vector
last <- function(x) { return( x[length(x)] ) }

#give sample size on boxplot for ggplot
give.n <- function(x){
  return(c(y = mean(x), label = length(x)))
}

#color-blind-friendly palettes
cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

#Source required PEcAn scripts for reading and matching treerings and plot data
source("/Users/Josh/Documents/Research/pecan/modules/data.land/R/Read_Tuscon.R")
source("/Users/Josh/Documents/Research/pecan/modules/data.land/R/matchInventoryRings.R")
```

Using most up-to-date version of adult census data for treering matching. Includes 2015 census data, but not boolean damage column. All other columns should be the same as analysis done for AGU and EE seminar.

```{r}
#read Tucson format ringwidth files
trees.diss <- read.csv("/Users/josh/Dropbox/Dissertation/CH1_Treerings/Data/Adult_Field_Data_JAM_MCD.csv")
rings.diss <- Read_Tucson("/Users/josh/Dropbox/Dissertation/CH1_Treerings/Data/Windendro_Dissertation")

#Match Tucson ringwidth files and adult census data for 50yrs of growth
combined.diss <- matchInventoryRings(trees=trees.diss,rings.diss,nyears=60)
combined.diss <- data.frame(combined.diss)
#write.csv(combined.diss, file="/Users/josh/Dropbox/Dissertation/CH1_Treerings/Data/combined.diss.new2.csv")
write.csv(combined.diss, file="/Users/josh/Dropbox/Dissertation/CH1_Treerings/Data/combined.diss.new3.csv")
#manually added site average temp and precip
#combined.diss.clim <- read.csv("/Users/josh/Dropbox/Dissertation/CH1_Treerings/Data/combined.diss.clim.csv")
combined.diss.clim <- read.csv("/Users/josh/Dropbox/Dissertation/CH1_Treerings/Data/combined.diss.clim2.csv")
combined.diss.clim <- combined.diss.clim[,2:156]
#remove X before years
colnames.yrs <- c("1957","1958","1959","1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016")

colnames(combined.diss.clim)[93:152] <- colnames.yrs#colnames(combined.dmg.clean) #get rid of stupid "x" before year

#TODO correct cores with known suspiciously large growth increment
#cores ID'd in /Users/josh/Dropbox/Dissertation/CH1_Treerings/Data/qc_removed_cores.xlsx

#write file to check which cores still need to be analyzed
#common sample ID to match with
# combined.diss$sampleID <- mapply(combined.diss$SITE, combined.diss$PLOT, combined.diss$SUB, combined.diss$TAG, FUN = paste0)
# 
# trees.diss$sampleID <- mapply(trees.diss$Site, trees.diss$Plot, trees.diss$Sub, trees.diss$Tag, FUN = paste0)
# 
# analyzed.trees.growth <- merge(combined.diss, trees.diss, by = "sampleID", all.x = TRUE, all.y = TRUE)
# check.growth.analyzed <- cbind(analyzed.trees.growth[,1:9],analyzed.trees.growth[,131:139],analyzed.trees.growth[,144:151],analyzed.trees.growth[,208],analyzed.trees.growth[,223])
# names(check.growth.analyzed)[27] <- "DBH14"
# names(check.growth.analyzed)[28] <- "DBH15"
# write.csv(check.growth.analyzed, file = "alltrees_growth_analyzed_tracking_CDincluded.csv")

```
Reformat combined census and treering data dataframe to comply with format required for including time explicitly, which includes year by site and year by plot interaction terms.
```{r}
####didn't need to do all of this####
# #recreate data frame to be compliant with structure needed to include time as a variable (50 years)
# ids.rep.new.diss <- data.frame(matrix(NA,nrow=1,ncol=92))                    
# colnames(ids.rep.new.diss) <- colnames(combined.diss[1:92])
# for(i in 1:nrow(combined.diss)){
#   ids.rep.diss <- combined.diss[rep(i,times=50),1:92]
#   ids.rep.new.diss <- rbind(ids.rep.new.diss,ids.rep.diss)
# }
# #remove row of NAs
# combined.ids.diss <- ids.rep.new.diss[2:nrow(ids.rep.new.diss),]
# 
# #transpose and concatenate increments for all trees
# inc.new.diss <- vector("numeric",length=0)
# for(i in 1:nrow(combined.diss)){
#   inc.diss <- as.matrix(combined.diss[i,93:142])
#   inc.new.diss <- as.numeric(c(inc.new.diss,inc.diss))
# }
# 
# #add ring increments
# combined.ids.incs.diss <- cbind(combined.ids.diss,inc.new.diss)
# 
# #rename inc variable
# setnames(combined.ids.incs.diss,old='inc.new.diss',new='INCREMENT')
# 
# YEAR <- seq(1964,2013,1)
# YEAR <- rep(YEAR,1415)
# 
# #final version with 50yrs of growth
# combined.all.diss <- cbind(combined.ids.incs.diss,YEAR)
```

```{r}
# #spots with 2 ## were commented out before I stopped using bayes for the chapter
# #JAGS Bayesian Hierarchical linear model 
# #Hierarchical terms for JAGS
# ringwidths <- combined.diss.clim[97:136]
# s<-as.numeric(as.factor(as.character(combined.diss.clim$SITE)))
# p<-as.numeric(as.factor(paste0(as.character(combined.diss.clim$SITE),
#                                as.character(combined.diss.clim$PLOT))))
# sp <- as.numeric(as.factor(paste0(as.character(combined.diss.clim$SITE),
#                                   as.character(combined.diss.clim$PLOT),
#                                   as.character(combined.diss.clim$SUB))))
# #creating interaction terms for JAGS
# #Site by Year interaction, n = 400, 8 sites, 50 years each
# #sy <- as.numeric(as.factor(paste0(as.character(combined.diss.clim$SITE),
#                                   #colnames(combined.diss.clim[93:142]))))
# # #Plot by Year interaction, n = 2600, 8 sites, 6-7 plots each
# # spy <- as.numeric(as.factor(paste0(as.character(combined.diss.clim$SITE),
# #                                   as.character(combined.diss.clim$PLOT),
# #                                   colnames(combined.diss.clim[93:142]))))
# 
# #x = 1/var(combined.diss.clim$INCREMENT,na.rm=TRUE) #precision on all years
# #y = mean(combined.diss.clim$INCREMENT,na.rm=TRUE) #mean all years
# x = 1/var(as.vector(as.matrix(ringwidths)),na.rm=TRUE)
# y = mean(as.matrix(ringwidths),na.rm=TRUE) ## overall mean growth rate
# mean40yr = rowMeans(ringwidths,na.rm=TRUE) #means by individual
# column.means = colMeans(ringwidths,na.rm=TRUE) #means by year
# us = tapply(X=mean40yr,INDEX=list(s),FUN=mean,na.rm=TRUE)
# up = tapply(X=mean40yr,INDEX=list(p),FUN=mean,na.rm=TRUE)
# usp = tapply(X=mean40yr,INDEX=list(sp),FUN=mean,na.rm=TRUE)
# #usy = tapply(X=mean50yr,INDEX=list(sy),FUN=mean,na.rm=TRUE)
# usy = apply(ringwidths,2,function(x1){tapply(x1,s,FUN=mean,na.rm=TRUE)})
# usy[is.nan(usy)] = 0
# ty = 1/var(column.means)
# ts = 1/var(us)
# tp= 1/var(up)
# tsp= 1/var(usp)
# tsy= mean(1/var(usy))
# as = us - mean(us)
# ap = up - mean(up) 
# asp= usp - mean(usp)
# ai = mean40yr - mean(y)
# ay = column.means - mean(column.means)
# 
# data2 = list(x=as.matrix(combined.diss.clim[,97:136]), nyear=40, 
#              nrep = 1626,s=s,p=p,sp=sp,ns=max(s),np = max(p),nsp=max(sp))
# 
# asy = apply(data2$x,2,function(x){tapply(x,s,function(w){mean(w-y,na.rm=TRUE)})})
# asy[is.nan(asy)]  = 0
# 
# init = list(mu = y,prec = x,tau.y = ty,tau.s = ts,tau.p = tp,tau.sp = tsp,
#             tau.sy = tsy,tau.ind = x,alpha.site = as,alpha.plot = ap,
#             alpha.sub = asp,alpha.siteyear = asy,alpha.ind = ai,alpha.y = ay)
# 
# FitRand.SiteYear = "
# model {
# mu ~ dnorm(0,0.001)
# prec ~ dgamma(0.1,0.1)
# tau.y ~ dgamma(0.1,0.1)  #prior year-effect
# tau.s ~ dgamma(0.1,0.1)  #prior site
# tau.p ~ dgamma(0.1,0.1)  #prior plot
# tau.sp ~ dgamma(0.1,0.1) #prior subplot
# tau.ind ~ dgamma(0.1,0.1) #prior individual
# tau.sy ~ dgamma(0.1,0.1) #prior site x year effect
# #tau.spy ~ dgamma(0.1,0.1) #prior plot x year effect
# 
# for(s in 1:ns){
#   alpha.site[s] ~ dnorm(0,tau.s)
#   for(y in 1:nyear){
#     alpha.siteyear[s,y] ~ dnorm(0,tau.sy)
#   }
# }
# for(p in 1:np){
# alpha.plot[p] ~ dnorm(0,tau.p)
# }
# for(sp in 1:nsp){
# alpha.sub[sp] ~ dnorm(0,tau.sp)
# }
# for(i in 1:nrep){
# alpha.ind[i] ~ dnorm(0,tau.ind)
# }
# 
# for(y in 1:nyear){
# alpha.y[y] ~dnorm(0,tau.y)
# for(i in 1:nrep){
# Ex[i,y] <- mu + alpha.y[y]  + alpha.site[s[i]] + alpha.plot[p[i]] + alpha.sub[sp[i]] + alpha.ind[i] + alpha.siteyear[s[i],y]
# 
# x[i,y] ~dnorm(Ex[i,y],prec)
# }
# }
# }"
# 
# ## compile JAGS model
# j.model   <- jags.model (file = textConnection(FitRand.SiteYear),
#                          data = data2,
#                          inits = init,
#                          n.chains = 3)
# ## burn-in
# b   <- coda.samples (model = j.model,
#                       variable.names = c("mu","prec","tau.y","tau.s","tau.p","tau.sp","tau.ind","tau.sy"),
#                       n.iter = 1000,
#                       thin = 2)
# 
# # bt   <- coda.samples (model = j.model,
# #                      variable.names = c("mu","prec","tau.y","tau.s","tau.p","tau.sp","tau.ind"),
# #                      n.iter = 5000)
# 
# update.jags<-function(model,previous.coda,variable.names,iter){
#   samp <- coda.samples (model = model,
#                         variable.names = variable.names,
#                         n.iter = iter,
#                         thin=2)
#   new.list <- list()
#   for(i in 1:length(samp)){
#     new.list[[i]] = as.mcmc(rbind(previous.coda[[i]],samp[[i]]))
#   }
#   bmcmc <<- mcmc.list(new.list)
#   #return(bmcmc)
# }
# 
# update.jags(j.model,b,c("mu","prec","tau.y","tau.s","tau.p","tau.sp","tau.ind","tau.sy"),500)
# b.out<-b
# bmcmc1<-bmcmc
# 
# update.jags(j.model,bmcmc1,c("mu","prec","tau.y","tau.s","tau.p","tau.sp","tau.ind","tau.sy"),1000)
# bmcmc2<-bmcmc
# 
# update.jags(j.model,bmcmc2,c("mu","prec","tau.y","tau.s","tau.p","tau.sp","tau.ind","tau.sy"),2000)
# bmcmc3<-bmcmc
# 
# update.jags(j.model,bmcmc3,c("mu","prec","tau.y","tau.s","tau.p","tau.sp","tau.ind","tau.sy"),2000)
# bmcmc4<-bmcmc
# 
# update.jags(j.model,bmcmc4,c("mu","prec","tau.y","tau.s","tau.p","tau.sp","tau.ind","tau.sy"),5000)
# bmcmc5<-bmcmc
# 
# update.jags(j.model,bmcmc5,c("mu","prec","tau.y","tau.s","tau.p","tau.sp","tau.ind","tau.sy"),5000)
# bmcmc6<-bmcmc
# 
# # update.jags(j.model,bmcmc6,c("mu","prec","tau.y","tau.s","tau.p","tau.sp","tau.ind"),20000)
# # bmcmc7<-bmcmc
# # update.jags(j.model,bmcmc7,c("mu","prec","tau.y","tau.s","tau.p","tau.sp","tau.ind"),10000)
# # bmcmc8<-bmcmc
# # update.jags(j.model,bmcmc8,c("mu","prec","tau.y","tau.s","tau.p","tau.sp","tau.ind"),20000)
# # bmcmc9<-bmcmc
# 
# #transform posteriors to standard deviations
# test.sd2 <- list()
# test.sd2 <- for(i in 1:3){
#   test.sd2[[i]]<-as.mcmc(sqrt(1/bmcmc1[[i]]))
# 
#   test.SD <- mcmc.list(test.sd2)
# }
# 
# for(i in 1:8){
#   plot(test.SD[,i],cex.lab=1.8,xlim=c(0,1.25))
# }
# 
# 
# str(summary(bmcmc1))
# #for(i in 1:7){
#   summary(bmcmc1)#[,i])    ## summary table
# #}
# 
# for(i in 1:8){
#   plot(b.out[,i])
#   #plot(sqrt(1/(bmcmc9[,i]))) ## mcmc trace and density plots
# }
# 
# # for(i in 1:7){
# #   plot(bmcmc7[,i]) ## mcmc trace and density plots
# # }
# # 
# # for(i in 1:7){
# #   plot(bmcmc6[,i]) ## mcmc trace and density plots
# # }
# # 
# # for(i in 1:7){
# #   plot(bmcmc5[,i]) ## mcmc trace and density plots
# # }
# # for(i in 1:7){
# #   plot(bmcmc3[,i]) ## mcmc trace and density plots
# # }
# # #bmcmc is new output
# # for(i in 1:7){
# #   plot(bmcmc2[,i]) ## mcmc trace and density plots
# # }
# # for(i in 1:7){
# #   plot(b.out[,i]) ## mcmc trace and density plots
# # }
# for(i in 1:8){
# autocorr.plot(b.out[,i]) ## autocorrelation
# }
# for(i in 1:8){
# cumuplot(b.out[,i]) ## quantile plot
# }
# for(i in 1:8){
# gelman.plot(b.out[,i])      ## GRB statistic
# }
# for(i in 1:8){
# summary(b.out[,i])    ## summary table
# }
# 
#   ####plot of all individuals####
# denplot(test.SD[,2:7],collapse=TRUE,xlim=c(0,1.25),main=c("Residual",
#                                                           "Individual",
#                                                           "Landscape",
#                                                           "Region",
#                                                           "Microsite",
#                                                           "Year"))
# 
# ##summary stats for making barplot of median variance explained
# summary.all <- summary(test.SD) 
# var.all<-summary.all$quantiles[2:8,3]
# #proportion of variance explained
# proportion.var.all<- var.all/sum(var.all)
# 
# ##### done visualizing outputs #####
# 
# update.jags<-function(model,previous.coda,variable.names,iter){
#   samp <- coda.samples (model = model,
#                 variable.names = variable.names,
#                 n.iter = iter)
#   bmcmc <<- mcmc(do.call(rbind,c(previous.coda,samp)))
#   #return(bmcmc)
# }
# 
# update.jags(j.model,b,c("mu","prec","tau.y","tau.s","tau.p","tau.sp","tau.ind"),100)
# # b3 <- coda.samples (model = j.model,
# #                     variable.names = c("mu","prec"),#,"alpha.y","alpha.site","alpha.plot","alpha.sub"),#,"alpha.ind"),
# #                     n.iter = 500)#,
# # update.jags(model=j.model,previous.coda=b3,variable.names=c("mu","prec"),iter=500)
# 
# # bmcmc3 = b3
# # plot(bmcmc3)
# 
# 
# 
# mu2 = as.data.frame(as.matrix(bmcmc2))$mu
# quantile(mu2,c(0.025,0.5,0.975))
# 
# 
# 
# 
# 
# 
# 
# # #just look at AGU code for example of how to make unique IDs
# # #Example creating interaction term
# # Y = seq(1,10)
# # L = as.vector(x=c("A","B","C"))
# # YL = expand.grid(Y,L) #creates matrix of all combinations as characters
# # YL.vector = as.vector(paste0(YL$Var1,YL$Var2)) #vector of all combinations as characters
# # #Can now use this to create interaction term for years x plot and years x site

```

```{r}
#Add covariates to data

count(combined.diss.clim$SPP)
#remove spp with very low sample size, setting cutoff below 5 because
#of an arbitrary reason, need to do an actual power analysis

abba <- which(combined.diss.clim$SPP == "ABBA")
#acne2 <- which(combined.diss.clim$SPP == "ACNE2")
acru <- which(combined.diss.clim$SPP == "ACRU")
acsa3 <- which(combined.diss.clim$SPP == "ACSA3")
beal2 <- which(combined.diss.clim$SPP == "BEAL2")
bele <- which(combined.diss.clim$SPP == "BELE")
bepa <- which(combined.diss.clim$SPP == "BEPA")
#caco15 <- which(combined.diss.clim$SPP == "CACO15")
cagl8 <- which(combined.diss.clim$SPP == "CAGL8")
#caov2 <- which(combined.diss.clim$SPP == "CAOV2")
cato6 <- which(combined.diss.clim$SPP == "CATO6")
fagr <- which(combined.diss.clim$SPP == "FAGR")
fram2 <- which(combined.diss.clim$SPP == "FRAM2")
frni <- which(combined.diss.clim$SPP == "FRNI")
#juni <- which(combined.diss.clim$SPP == "JUNI")
juvi <- which(combined.diss.clim$SPP == "JUVI")
#list2 <- which(combined.diss.clim$SPP == "LIST2")
litu <- which(combined.diss.clim$SPP == "LITU")
mavi2 <- which(combined.diss.clim$SPP == "MAVI2")
nysy <- which(combined.diss.clim$SPP == "NYSY")
oxar <- which(combined.diss.clim$SPP == "OXAR")
pima <- which(combined.diss.clim$SPP == "PIMA")
pipa2 <- which(combined.diss.clim$SPP == "PIPA2")
#piri <- which(combined.diss.clim$SPP == "PIRI")
piru <- which(combined.diss.clim$SPP == "PIRU")
pist <- which(combined.diss.clim$SPP == "PIST")
pita <- which(combined.diss.clim$SPP == "PITA")
pogr4 <- which(combined.diss.clim$SPP == "POGR4")
potr5 <- which(combined.diss.clim$SPP == "POTR5")
prse2 <- which(combined.diss.clim$SPP == "PRSE2")
qual <- which(combined.diss.clim$SPP == "QUAL")
quco2 <- which(combined.diss.clim$SPP == "QUCO2")
qula2 <- which(combined.diss.clim$SPP == "QULA2")
qula3 <- which(combined.diss.clim$SPP == "QULA3")
qumo4 <- which(combined.diss.clim$SPP == "QUMO4")
qumu <- which(combined.diss.clim$SPP == "QUMU")
quni <- which(combined.diss.clim$SPP == "QUNI")
#quph <- which(combined.diss.clim$SPP == "QUPH")
quru <- which(combined.diss.clim$SPP == "QURU")
quve <- which(combined.diss.clim$SPP == "QUVE")
#quvi <- which(combined.diss.clim$SPP == "QUVI")
saal5 <- which(combined.diss.clim$SPP == "SAAL5")
thoc2 <- which(combined.diss.clim$SPP == "THOC2")
#tiam <- which(combined.diss.clim$SPP == "TIAM")
tsca <- which(combined.diss.clim$SPP == "TSCA")
ulam <- which(combined.diss.clim$SPP == "ULAM")

combined.diss.clim.common <- rbind(
                             combined.diss.clim[abba,],
                             combined.diss.clim[acru,],
                             combined.diss.clim[acsa3,],
                             combined.diss.clim[beal2,],
                             combined.diss.clim[bele,],
                             combined.diss.clim[bepa,],
                             combined.diss.clim[cagl8,],
                             combined.diss.clim[cato6,],
                             combined.diss.clim[fagr,],
                             combined.diss.clim[fram2,],
                             combined.diss.clim[frni,],
                             combined.diss.clim[juvi,],
                             combined.diss.clim[litu,],
                             combined.diss.clim[mavi2,],
                             combined.diss.clim[nysy,],
                             combined.diss.clim[oxar,],
                             combined.diss.clim[pima,],
                             combined.diss.clim[pipa2,],
                             combined.diss.clim[piru,],
                             combined.diss.clim[pist,],
                             combined.diss.clim[pita,],
                             combined.diss.clim[pogr4,],
                             combined.diss.clim[potr5,],
                             combined.diss.clim[prse2,],
                             combined.diss.clim[quco2,],
                             combined.diss.clim[qual,],
                             combined.diss.clim[qula2,],
                             combined.diss.clim[qula3,],
                             combined.diss.clim[qumo4,],
                             combined.diss.clim[qumu,],
                             combined.diss.clim[quni,],
                             combined.diss.clim[quru,],
                             combined.diss.clim[quve,],
                             combined.diss.clim[saal5,],
                             combined.diss.clim[thoc2,],
                             combined.diss.clim[tsca,],
                             combined.diss.clim[ulam,])
### Adding PFT and Wood Anatomy covariates ###

##adding PFTs
###Reference: http://plants.usda.gov/java/
### Also USFS silvics manual: https://www.na.fs.fed.us/spfo/pubs/silvics_manual/table_of_contents.htm

# Hardwoods
Early.Hardwood <- c(
                    which(combined.diss.clim.common$SPP == "ACPE"),#
                    which(combined.diss.clim.common$SPP == "AIAL"),#
                    which(combined.diss.clim.common$SPP == "BEAL2"),#
                    which(combined.diss.clim.common$SPP == "BELE"),#
                    which(combined.diss.clim.common$SPP == "BEPA"),#
                    which(combined.diss.clim.common$SPP == "BETUL"),#
                    which(combined.diss.clim.common$SPP == "COFL2"),#
                    which(combined.diss.clim.common$SPP == "JUCI"),#
                    which(combined.diss.clim.common$SPP == "JUNI"),#
                    which(combined.diss.clim.common$SPP == "LIST2"),#
                    which(combined.diss.clim.common$SPP == "LITU"),#
                    which(combined.diss.clim.common$SPP == "POGR4"),#
                    which(combined.diss.clim.common$SPP == "POTR5"),#
                    which(combined.diss.clim.common$SPP == "PRSE2"),#
                    which(combined.diss.clim.common$SPP == "ROPS"),#
                    which(combined.diss.clim.common$SPP == "SAAL5")#
                    ) #16 Spp

Mid.Hardwood <- c(
                  which(combined.diss.clim.common$SPP == "FRAM2"),#
                  which(combined.diss.clim.common$SPP == "FRNI"),#
                  which(combined.diss.clim.common$SPP == "FRQU"),#
                  which(combined.diss.clim.common$SPP == "ACNE2"),#
                  which(combined.diss.clim.common$SPP == "ACRU"),#
                  which(combined.diss.clim.common$SPP == "CACA18"),#
                  which(combined.diss.clim.common$SPP == "CACO15"),#
                  which(combined.diss.clim.common$SPP == "CAGL8"),#
                  which(combined.diss.clim.common$SPP == "CALA21"),#
                  which(combined.diss.clim.common$SPP == "CAOV2"),#
                  which(combined.diss.clim.common$SPP == "CATO6"),#
                  which(combined.diss.clim.common$SPP == "CECA4"),#
                  which(combined.diss.clim.common$SPP == "MAAC"),#
                  which(combined.diss.clim.common$SPP == "MAFR"),#
                  which(combined.diss.clim.common$SPP == "MAVI2"),#
                  which(combined.diss.clim.common$SPP == "PLOC"),#
                  which(combined.diss.clim.common$SPP == "QUAL"),#
                  which(combined.diss.clim.common$SPP == "QUCO2"),#
                  which(combined.diss.clim.common$SPP == "QUERC"),#
                  which(combined.diss.clim.common$SPP == "QUIM"),#
                  which(combined.diss.clim.common$SPP == "QULA2"),#
                  which(combined.diss.clim.common$SPP == "QULA3"),#
                  which(combined.diss.clim.common$SPP == "QUMO4"),#
                  which(combined.diss.clim.common$SPP == "QUMU"),#
                  which(combined.diss.clim.common$SPP == "QUNI"),#
                  which(combined.diss.clim.common$SPP == "QUPH"),#
                  which(combined.diss.clim.common$SPP == "QURU"),#
                  which(combined.diss.clim.common$SPP == "QUST"),#
                  which(combined.diss.clim.common$SPP == "QUVE"),#
                  which(combined.diss.clim.common$SPP == "QUVI"),#
                  which(combined.diss.clim.common$SPP == "ULAM"),
                  which(combined.diss.clim.common$SPP == "ULAL")#
                  ) #32 Spp

Late.Hardwood <- c(
                  which(combined.diss.clim.common$SPP == "ACFL"),#
                  which(combined.diss.clim.common$SPP == "ACSA3"),#
                  which(combined.diss.clim.common$SPP == "AEGL"),#
                  which(combined.diss.clim.common$SPP == "DIVI5"),#
                  which(combined.diss.clim.common$SPP == "FAGR"),#
                  which(combined.diss.clim.common$SPP == "MAGR4"),#
                  which(combined.diss.clim.common$SPP == "NYSY"),#
                  which(combined.diss.clim.common$SPP == "OXAR"),#
                  which(combined.diss.clim.common$SPP == "TIAM")#
                  ) #9 Spp

# set PFTs
combined.diss.clim.common$PFT <- NA
combined.diss.clim.common$PFT[Early.Hardwood] <- "Early.Hardwood"
combined.diss.clim.common$PFT[Mid.Hardwood] <- "Mid.Hardwood"
combined.diss.clim.common$PFT[Late.Hardwood] <- "Late.Hardwood"

# Conifers
Early.Conifer <- c(
                  which(combined.diss.clim.common$SPP == "ABBA"),#
                  which(combined.diss.clim.common$SPP == "JUVI"),#
                  which(combined.diss.clim.common$SPP == "PIPA2"),#
                  which(combined.diss.clim.common$SPP == "PIST"),#
                  which(combined.diss.clim.common$SPP == "PIVI2"),#
                  which(combined.diss.clim.common$SPP == "PIRE"),#
                  which(combined.diss.clim.common$SPP == "PIRI"),#
                  which(combined.diss.clim.common$SPP == "PITA")#
                  ) #8 Spp

Late.Conifer <- c(
                  which(combined.diss.clim.common$SPP == "LALA"),#
                  which(combined.diss.clim.common$SPP == "PIGL"),#
                  which(combined.diss.clim.common$SPP == "PIMA"),#
                  which(combined.diss.clim.common$SPP == "PIRU"),#
                  which(combined.diss.clim.common$SPP == "THOC2"),#
                  which(combined.diss.clim.common$SPP == "TSCA")#
                  ) #6 Spp

combined.diss.clim.common$PFT[Early.Conifer] <- "Early.Conifer"
combined.diss.clim.common$PFT[Late.Conifer] <- "Late.Conifer"

# adding wood anatomy
###Reference http://www.wood-database.com/
###Disagree with reference for hickory classification - put all as semi-ring porous. conferred with Christy

large.resin <- c(
                which(combined.diss.clim.common$SPP == "PIPA2"),
                which(combined.diss.clim.common$SPP == "PIST"),
                which(combined.diss.clim.common$SPP == "PIVI2"),
                which(combined.diss.clim.common$SPP == "PIRE"),
                which(combined.diss.clim.common$SPP == "PIRI"),
                which(combined.diss.clim.common$SPP == "PITA")
                )

small.resin <- c(
                which(combined.diss.clim.common$SPP == "LALA"),
                which(combined.diss.clim.common$SPP == "PIGL"),
                which(combined.diss.clim.common$SPP == "PIMA"),
                which(combined.diss.clim.common$SPP == "PIRU")
                )

no.resin <- c(
              which(combined.diss.clim.common$SPP == "ABBA"),
              which(combined.diss.clim.common$SPP == "JUVI"),
              which(combined.diss.clim.common$SPP == "THOC2"),
              which(combined.diss.clim.common$SPP == "TSCA")
              )

ring.porous <- c(
                which(combined.diss.clim.common$SPP == "AIAL"),              
                which(combined.diss.clim.common$SPP == "FRAM2"),
                which(combined.diss.clim.common$SPP == "FRNI"),
                which(combined.diss.clim.common$SPP == "FRQU"),
                which(combined.diss.clim.common$SPP == "QUAL"),
                which(combined.diss.clim.common$SPP == "QUCO2"),
                which(combined.diss.clim.common$SPP == "QUERC"),
                which(combined.diss.clim.common$SPP == "QUIM"),
                which(combined.diss.clim.common$SPP == "QULA2"),
                which(combined.diss.clim.common$SPP == "QULA3"),
                which(combined.diss.clim.common$SPP == "QUMO4"),
                which(combined.diss.clim.common$SPP == "QUMU"),
                which(combined.diss.clim.common$SPP == "QUNI"),
                which(combined.diss.clim.common$SPP == "QUPH"),
                which(combined.diss.clim.common$SPP == "QURU"),
                which(combined.diss.clim.common$SPP == "QUST"),
                which(combined.diss.clim.common$SPP == "QUVE"),
                which(combined.diss.clim.common$SPP == "QUVI"),
                which(combined.diss.clim.common$SPP == "ROPS"),
                which(combined.diss.clim.common$SPP == "SAAL5")
                )

diffuse.porous <- c(
                    which(combined.diss.clim.common$SPP == "ACNE2"),
                    which(combined.diss.clim.common$SPP == "ACPE"),
                    which(combined.diss.clim.common$SPP == "ACRU"),
                    which(combined.diss.clim.common$SPP == "ACSA3"),
                    which(combined.diss.clim.common$SPP == "AEGL"),
                    which(combined.diss.clim.common$SPP == "BEAL2"),
                    which(combined.diss.clim.common$SPP == "BELE"),
                    which(combined.diss.clim.common$SPP == "BEPA"),
                    which(combined.diss.clim.common$SPP == "BETUL"),
                    which(combined.diss.clim.common$SPP == "CACA18"),
                    which(combined.diss.clim.common$SPP == "COFL2"),
                    which(combined.diss.clim.common$SPP == "LIST2"),
                    which(combined.diss.clim.common$SPP == "LITU"),
                    which(combined.diss.clim.common$SPP == "MAAC"),
                    which(combined.diss.clim.common$SPP == "MAFR"),
                    which(combined.diss.clim.common$SPP == "MAVI2"),                  
                    which(combined.diss.clim.common$SPP == "PLOC"),
                    which(combined.diss.clim.common$SPP == "FAGR"),
                    which(combined.diss.clim.common$SPP == "MAGR4"),
                    which(combined.diss.clim.common$SPP == "NYSY"),
                    which(combined.diss.clim.common$SPP == "OXAR"),
                    which(combined.diss.clim.common$SPP == "TIAM"),
                    which(combined.diss.clim.common$SPP == "POGR4"),
                    which(combined.diss.clim.common$SPP == "POTR5"),
                    which(combined.diss.clim.common$SPP == "PRSE2")               
                    )

semiring.porous <- c(
                    which(combined.diss.clim.common$SPP == "CACO15"),
                    which(combined.diss.clim.common$SPP == "CAGL8"),
                    which(combined.diss.clim.common$SPP == "CALA21"),
                    which(combined.diss.clim.common$SPP == "CAOV2"),
                    which(combined.diss.clim.common$SPP == "CATO6"),
                    which(combined.diss.clim.common$SPP == "CECA4"),
                    which(combined.diss.clim.common$SPP == "DIVI5"), #bordering diffuse porous
                    which(combined.diss.clim.common$SPP == "JUCI"),
                    which(combined.diss.clim.common$SPP == "JUNI"),
                    which(combined.diss.clim.common$SPP == "ULAM"),
                    which(combined.diss.clim.common$SPP == "ULAL")
                    )

#set anatomy
combined.diss.clim.common$WOOD <- NA
combined.diss.clim.common$WOOD[large.resin] <- "large.resin"
combined.diss.clim.common$WOOD[small.resin] <- "small.resin"
combined.diss.clim.common$WOOD[no.resin] <- "no.resin"
combined.diss.clim.common$WOOD[ring.porous] <- "ring.porous"
combined.diss.clim.common$WOOD[diffuse.porous] <- "diffuse.porous"
combined.diss.clim.common$WOOD[semiring.porous] <- "semiring.porous"

#Relevel Factors
combined.diss.clim.common$WOOD <- factor(combined.diss.clim.common$WOOD, 
                                    levels = c("large.resin","small.resin","no.resin",
                                               "ring.porous","semiring.porous",
                                               "diffuse.porous"), ordered = TRUE)

# #write file to see if missing any species
# write.csv(combined.diss.clim.common, file="/Users/josh/Dropbox/Dissertation/CH1_Treerings/Data/combined.diss.clim.common.wood.csv")

#write file to see if missing any species
write.csv(combined.diss.clim.common, file="/Users/josh/Dropbox/Dissertation/CH1_Treerings/Data/combined.diss.clim.common.wood2.csv")

################## Haven't added species and other phylogeny yet 3/30/2017 ####################
###############################################################################################
###Reference: http://plants.usda.gov/java/
# adding species string
    alba <- which(combined.diss.clim.common$SPP == "QUAL")
    coccinea <- which(combined.diss.clim.common$SPP == "QUCO2")
    none <- c(which(combined.diss.clim.common$SPP == "QUERC"),
              which(combined.diss.clim.common$SPP == "BETUL"))
    imbricaria <- which(combined.diss.clim.common$SPP == "QUIM")
    laevis <- which(combined.diss.clim.common$SPP == "QULA2")
    laurifolia <- which(combined.diss.clim.common$SPP == "QULA3")
    montana <- which(combined.diss.clim.common$SPP == "QUMO4")
    muehlenbergii <- which(combined.diss.clim.common$SPP == "QUMU")
    nigra <- c(which(combined.diss.clim.common$SPP == "QUNI"),
               which(combined.diss.clim.common$SPP == "FRNI"),
               which(combined.diss.clim.common$SPP == "JUNI"))
    phellos <- which(combined.diss.clim.common$SPP == "QUPH")
    rubra <- which(combined.diss.clim.common$SPP == "QURU")
    stellata <- which(combined.diss.clim.common$SPP == "QUST")
    velutina <- which(combined.diss.clim.common$SPP == "QUVE")
    virginiana <- c(which(combined.diss.clim.common$SPP == "QUVI"),
                  which(combined.diss.clim.common$SPP == "MAVI2"),
                  which(combined.diss.clim.common$SPP == "DIVI5"),
                  which(combined.diss.clim.common$SPP == "PIVI2"),
                  which(combined.diss.clim.common$SPP == "JUVI"))
    americana <- c(which(combined.diss.clim.common$SPP == "FRAM2"),
                   which(combined.diss.clim.common$SPP == "TIAM"),
                   which(combined.diss.clim.common$SPP == "ULAM"))
    quadrangulata <- which(combined.diss.clim.common$SPP == "FRQU")
    altissima <- which(combined.diss.clim.common$SPP == "AIAL")
    pseudoacacia <- which(combined.diss.clim.common$SPP == "ROPS")
    albidum <- which(combined.diss.clim.common$SPP == "SAAL5")
    negundo <- which(combined.diss.clim.common$SPP == "ACNE2")
    pensylvanicum <- which(combined.diss.clim.common$SPP == "ACPE")
    rubrum <- which(combined.diss.clim.common$SPP == "ACRU")
    saccharum <- which(combined.diss.clim.common$SPP == "ACSA3")
    glabra <- c(which(combined.diss.clim.common$SPP == "AEGL"),
                which(combined.diss.clim.common$SPP == "CAGL8"))
    alleghaniensis <- which(combined.diss.clim.common$SPP == "BEAL2")
    lenta <- which(combined.diss.clim.common$SPP == "BELE")
    papyrifera <- which(combined.diss.clim.common$SPP == "BEPA")
    caroliniana <- which(combined.diss.clim.common$SPP == "CACA18")
    florida <- which(combined.diss.clim.common$SPP == "COFL2")
    styraciflua <- which(combined.diss.clim.common$SPP == "LIST2")
    tulipifera <- which(combined.diss.clim.common$SPP == "LITU")
    acuminata <- which(combined.diss.clim.common$SPP == "MAAC")
    fraseri <- which(combined.diss.clim.common$SPP == "MAFR")
    grandiflora <- which(combined.diss.clim.common$SPP == "MAGR4")
    occidentalis <- which(combined.diss.clim.common$SPP == "PLOC")
    grandifolia <- which(combined.diss.clim.common$SPP == "FAGR")
    sylvatica <- which(combined.diss.clim.common$SPP == "NYSY")
    arboreum <- which(combined.diss.clim.common$SPP == "OXAR")
    grandidentata <- which(combined.diss.clim.common$SPP == "POGR4")
    tremuloides <- which(combined.diss.clim.common$SPP == "POTR5")
    serotina <- which(combined.diss.clim.common$SPP == "PRSE2")
    cordiformis <- which(combined.diss.clim.common$SPP == "CACO15")
    laciniosa <- which(combined.diss.clim.common$SPP == "CALA21")
    ovata <- which(combined.diss.clim.common$SPP == "CAOV2")
    tomentosa <- which(combined.diss.clim.common$SPP == "CATO6")
    canadensis <- c(which(combined.diss.clim.common$SPP == "CECA4"),
                    which(combined.diss.clim.common$SPP == "TSCA"))
    cinerea <- which(combined.diss.clim.common$SPP == "JUCI")
    palustris <- which(combined.diss.clim.common$SPP == "PIPA2")
    strobus <- which(combined.diss.clim.common$SPP == "PIST")
    resinosa <- which(combined.diss.clim.common$SPP == "PIRE")
    rigida <- which(combined.diss.clim.common$SPP == "PIRI")
    taeda <- which(combined.diss.clim.common$SPP == "PITA")
    laricina <- which(combined.diss.clim.common$SPP == "LALA")
    glauca <- which(combined.diss.clim.common$SPP == "PIGL")
    mariana <- which(combined.diss.clim.common$SPP == "PIMA")
    rubens <- which(combined.diss.clim.common$SPP == "PIRU")
    balsamea <- which(combined.diss.clim.common$SPP == "ABBA")
    occidentalis <- which(combined.diss.clim.common$SPP == "THOC2")
    
    ### Set total dataframe for species
    
    combined.diss.clim.common$species <- NA
    combined.diss.clim.common$species[alba] <- "alba"
    combined.diss.clim.common$species[coccinea] <- "coccinea"
    combined.diss.clim.common$species[none] <- "none"
    combined.diss.clim.common$species[imbricaria] <- "imbricaria"
    combined.diss.clim.common$species[laevis] <- "laevis"
    combined.diss.clim.common$species[laurifolia] <- "laurifolia"
    combined.diss.clim.common$species[montana] <- "montana"
    combined.diss.clim.common$species[muehlenbergii] <- "muehlenbergii"
    combined.diss.clim.common$species[nigra] <- "nigra"
    combined.diss.clim.common$species[phellos] <- "phellos"
    combined.diss.clim.common$species[rubra] <- "rubra"
    combined.diss.clim.common$species[stellata] <- "stellata"
    combined.diss.clim.common$species[velutina] <- "velutina"
    combined.diss.clim.common$species[virginiana] <- "virginiana"
    combined.diss.clim.common$species[americana] <- "americana"
    combined.diss.clim.common$species[quadrangulata] <- "quadrangulata"
    combined.diss.clim.common$species[altissima] <- "altissima"
    combined.diss.clim.common$species[pseudoacacia] <- "pseudoacacia"
    combined.diss.clim.common$species[albidum] <- "albidum"
    combined.diss.clim.common$species[negundo] <- "negundo"
    combined.diss.clim.common$species[pensylvanicum] <- "pensylvanicum"
    combined.diss.clim.common$species[rubrum] <- "rubrum"
    combined.diss.clim.common$species[saccharum] <- "saccharum"
    combined.diss.clim.common$species[glabra] <- "glabra"
    combined.diss.clim.common$species[alleghaniensis] <- "alleghaniensis"
    combined.diss.clim.common$species[lenta] <- "lenta"
    combined.diss.clim.common$species[papyrifera] <- "papyrifera"
    combined.diss.clim.common$species[caroliniana] <- "caroliniana"
    combined.diss.clim.common$species[florida] <- "florida"
    combined.diss.clim.common$species[styraciflua] <- "styraciflua"
    combined.diss.clim.common$species[tulipifera] <- "tulipifera"
    combined.diss.clim.common$species[acuminata] <- "acuminata"
    combined.diss.clim.common$species[fraseri] <- "fraseri"
    combined.diss.clim.common$species[grandiflora] <- "grandiflora"
    combined.diss.clim.common$species[occidentalis] <- "occidentalis"
    combined.diss.clim.common$species[grandifolia] <- "grandifolia"
    combined.diss.clim.common$species[sylvatica] <- "sylvatica"
    combined.diss.clim.common$species[arboreum] <- "arboreum"
    combined.diss.clim.common$species[grandidentata] <- "grandidentata"
    combined.diss.clim.common$species[tremuloides] <- "tremuloides"
    combined.diss.clim.common$species[serotina] <- "serotina"
    combined.diss.clim.common$species[cordiformis] <- "cordiformis"
    combined.diss.clim.common$species[laciniosa] <- "laciniosa"
    combined.diss.clim.common$species[ovata] <- "ovata"
    combined.diss.clim.common$species[tomentosa] <- "tomentosa"
    combined.diss.clim.common$species[canadensis] <- "canadensis"
    combined.diss.clim.common$species[cinerea] <- "cinerea"
    combined.diss.clim.common$species[palustris] <- "palustris"
    combined.diss.clim.common$species[strobus] <- "strobus"
    combined.diss.clim.common$species[resinosa] <- "resinosa"
    combined.diss.clim.common$species[rigida] <- "rigida"
    combined.diss.clim.common$species[taeda] <- "taeda"
    combined.diss.clim.common$species[laricina] <- "laricina"
    combined.diss.clim.common$species[glauca] <- "glauca"
    combined.diss.clim.common$species[mariana] <- "mariana"
    combined.diss.clim.common$species[rubens] <- "rubens"
    combined.diss.clim.common$species[balsamea] <- "balsamea"
    combined.diss.clim.common$species[occidentalis] <- "occidentalis"

# adding genus and family
  ### Hardwoods

    Quercus <- c(                
                which(combined.diss.clim.common$SPP == "QUAL"),
                which(combined.diss.clim.common$SPP == "QUCO2"),
                which(combined.diss.clim.common$SPP == "QUERC"),
                which(combined.diss.clim.common$SPP == "QUIM"),
                which(combined.diss.clim.common$SPP == "QULA2"),
                which(combined.diss.clim.common$SPP == "QULA3"),
                which(combined.diss.clim.common$SPP == "QUMO4"),
                which(combined.diss.clim.common$SPP == "QUMU"),
                which(combined.diss.clim.common$SPP == "QUNI"),
                which(combined.diss.clim.common$SPP == "QUPH"),
                which(combined.diss.clim.common$SPP == "QURU"),
                which(combined.diss.clim.common$SPP == "QUST"),
                which(combined.diss.clim.common$SPP == "QUVE"),
                which(combined.diss.clim.common$SPP == "QUVI")
                )
    
   Fraxinus <- c(
                which(combined.diss.clim.common$SPP == "FRAM2"),
                which(combined.diss.clim.common$SPP == "FRNI"),
                which(combined.diss.clim.common$SPP == "FRQU")
                )
   
  Ailanthus <- c(
                which(combined.diss.clim.common$SPP == "AIAL")
                )
   
    Robinia <- c(
                which(combined.diss.clim.common$SPP == "ROPS")
                )
    
  Sassafras <- c(
                which(combined.diss.clim.common$SPP == "SAAL5")
                )
  
      Acer <- c(
                which(combined.diss.clim.common$SPP == "ACNE2"),
                which(combined.diss.clim.common$SPP == "ACPE"),
                which(combined.diss.clim.common$SPP == "ACRU"),
                which(combined.diss.clim.common$SPP == "ACSA3")
                )
      
  Aesculus <- c(
                which(combined.diss.clim.common$SPP == "AEGL")
                )
  
    Betula <- c(
                which(combined.diss.clim.common$SPP == "BEAL2"),
                which(combined.diss.clim.common$SPP == "BELE"),
                which(combined.diss.clim.common$SPP == "BEPA"),
                which(combined.diss.clim.common$SPP == "BETUL")
                )
    
  Carpinus <- c(
                which(combined.diss.clim.common$SPP == "CACA18")
                )
    
    Cornus <- c(
                which(combined.diss.clim.common$SPP == "COFL2")
                )
    
Liquidambar <- c(
                which(combined.diss.clim.common$SPP == "LIST2")
                )

Liriodendron <- c(
                which(combined.diss.clim.common$SPP == "LITU")
                )

    Magnolia <- c(
                which(combined.diss.clim.common$SPP == "MAAC"),
                which(combined.diss.clim.common$SPP == "MAFR"),
                which(combined.diss.clim.common$SPP == "MAVI2"),
                which(combined.diss.clim.common$SPP == "MAGR4")
                )
    
    Platanus <- c(
                which(combined.diss.clim.common$SPP == "PLOC")
                )
    
       Fagus <- c(
                which(combined.diss.clim.common$SPP == "FAGR")
                )
       
       Nyssa <- c(
                which(combined.diss.clim.common$SPP == "NYSY")
                )
       
       Oxydendrum <- c(
                which(combined.diss.clim.common$SPP == "OXAR")
                )
       
       Tilia <- c(
                which(combined.diss.clim.common$SPP == "TIAM")
                )
    
     Populus <- c(
                which(combined.diss.clim.common$SPP == "POGR4"),
                which(combined.diss.clim.common$SPP == "POTR5")
                )
       
     Prunus <- c(
                which(combined.diss.clim.common$SPP == "PRSE2")
                )

       Carya <- c(
                which(combined.diss.clim.common$SPP == "CACO15"),
                which(combined.diss.clim.common$SPP == "CAGL8"),
                which(combined.diss.clim.common$SPP == "CALA21"),
                which(combined.diss.clim.common$SPP == "CAOV2"),
                which(combined.diss.clim.common$SPP == "CATO6")
                )
       
     Cercis <- c(
                which(combined.diss.clim.common$SPP == "CECA4")
                )
     
  Diospyros <- c(
                which(combined.diss.clim.common$SPP == "DIVI5")
                )
  
    Juglans <- c(
                which(combined.diss.clim.common$SPP == "JUCI"),
                which(combined.diss.clim.common$SPP == "JUNI")
                )
    
      Ulmus <- c(
                which(combined.diss.clim.common$SPP == "ULAM")
                )

  ### Conifers
      Pinus <- c(
                which(combined.diss.clim.common$SPP == "PIPA2"),
                which(combined.diss.clim.common$SPP == "PIST"),
                which(combined.diss.clim.common$SPP == "PIVI2"),
                which(combined.diss.clim.common$SPP == "PIRE"),
                which(combined.diss.clim.common$SPP == "PIRI"),
                which(combined.diss.clim.common$SPP == "PITA")
                )
      
      Larix <- c(
                which(combined.diss.clim.common$SPP == "LALA")
                )
      
      Picea <- c(
                which(combined.diss.clim.common$SPP == "PIGL"),
                which(combined.diss.clim.common$SPP == "PIMA"),
                which(combined.diss.clim.common$SPP == "PIRU")
                )

      Abies <- c(
              which(combined.diss.clim.common$SPP == "ABBA")
              )
      
Juniperus <- c(
              which(combined.diss.clim.common$SPP == "JUVI")
              )

    Thuja <- c(
              which(combined.diss.clim.common$SPP == "THOC2")
              )
    
    Tsuga <- c(
              which(combined.diss.clim.common$SPP == "TSCA")
              )
    
    
    
    ### Set total dataframe for Genus
    
    combined.diss.clim.common$genus <- NA
    combined.diss.clim.common$genus[Pinus] <- "Pinus"
    combined.diss.clim.common$genus[Larix] <- "Larix"
    combined.diss.clim.common$genus[Picea] <- "Picea"
    combined.diss.clim.common$genus[Abies] <- "Abies"
    combined.diss.clim.common$genus[Thuja] <- "Thuja"
    combined.diss.clim.common$genus[Tsuga] <- "Tsuga"
    combined.diss.clim.common$genus[Juniperus] <- "Juniperus"
    combined.diss.clim.common$genus[Quercus] <- "Quercus"
    combined.diss.clim.common$genus[Fraxinus] <- "Fraxinus"
    combined.diss.clim.common$genus[Ailanthus] <- "Ailanthus"
    combined.diss.clim.common$genus[Robinia] <- "Robinia"
    combined.diss.clim.common$genus[Sassafras] <- "Sassafras"
    combined.diss.clim.common$genus[Acer] <- "Acer"
    combined.diss.clim.common$genus[Aesculus] <- "Aesculus"
    combined.diss.clim.common$genus[Betula] <- "Betula"
    combined.diss.clim.common$genus[Carpinus] <- "Carpinus"
    combined.diss.clim.common$genus[Cornus] <- "Cornus"
    combined.diss.clim.common$genus[Liquidambar] <- "Liquidambar"
    combined.diss.clim.common$genus[Liriodendron] <- "Liriodendron"
    combined.diss.clim.common$genus[Magnolia] <- "Magnolia"
    combined.diss.clim.common$genus[Platanus] <- "Platanus"
    combined.diss.clim.common$genus[Fagus] <- "Fagus"
    combined.diss.clim.common$genus[Nyssa] <- "Nyssa"
    combined.diss.clim.common$genus[Oxydendrum] <- "Oxydendrum"
    combined.diss.clim.common$genus[Tilia] <- "Tilia"
    combined.diss.clim.common$genus[Populus] <- "Populus"
    combined.diss.clim.common$genus[Prunus] <- "Prunus"
    combined.diss.clim.common$genus[Carya] <- "Carya"
    combined.diss.clim.common$genus[Cercis] <- "Cercis"
    combined.diss.clim.common$genus[Diospyros] <- "Diospyros"
    combined.diss.clim.common$genus[Juglans] <- "Juglans"
    combined.diss.clim.common$genus[Ulmus] <- "Ulmus"
    
  ###Add Family
  Aceraceae <- c(
              which(combined.diss.clim.common$genus == "Acer")
              )
  
  Betulaceae <- c(
                which(combined.diss.clim.common$genus == "Betula"),
                which(combined.diss.clim.common$genus == "Carpinus")
                )
  
  Cornaceae <- c(which(combined.diss.clim.common$genus == "Cornus"),
                 which(combined.diss.clim.common$genus == "Nyssa"))
  
  Cupressaceae <- c(which(combined.diss.clim.common$genus == "Thuja"),
                    which(combined.diss.clim.common$genus == "Juniperus"))
  
  Ebenaceae <- c(which(combined.diss.clim.common$genus == "Diospyros"))
  
  Ericaceae <- c(which(combined.diss.clim.common$genus == "Oxydendrum"))
  
  Fabaceae <- c(which(combined.diss.clim.common$genus == "Robinia"),
                    which(combined.diss.clim.common$genus == "Cercis"))
  
  Fagaceae <- c(which(combined.diss.clim.common$genus == "Quercus"),
                which(combined.diss.clim.common$genus == "Fagus"))
  
  Hamamelidaceae <- c(which(combined.diss.clim.common$genus == "Liquidambar"))
  
  Hippocastanaceae <- c(which(combined.diss.clim.common$genus == "Aesculus"))
  
  Juglandaceae <- c(which(combined.diss.clim.common$genus == "Carya"),
                    which(combined.diss.clim.common$genus == "Juglans"))
  
  Lauraceae <- c(which(combined.diss.clim.common$genus == "Sassafras"))
  
  Magnoliaceae <- c(which(combined.diss.clim.common$genus == "Liriodendron"),
                    which(combined.diss.clim.common$genus == "Magnolia"))
  
  Oleaceae <- c(which(combined.diss.clim.common$genus == "Fraxinus"))
  
  Pinaceae <- c(which(combined.diss.clim.common$genus == "Pinus"),
                which(combined.diss.clim.common$genus == "Larix"),
                which(combined.diss.clim.common$genus == "Picea"),
                which(combined.diss.clim.common$genus == "Abies"),
                which(combined.diss.clim.common$genus == "Tsuga")
                )
  
  Platanaceae <- c(which(combined.diss.clim.common$genus == "Platanus"))
  
  Rosaceae <- c(which(combined.diss.clim.common$genus == "Prunus"))
  
  Salicaceae <- c(which(combined.diss.clim.common$genus == "Populus"))
  
  Simaroubaceae <- c(which(combined.diss.clim.common$genus == "Ailanthus"))
  
  Tiliaceae <- c(which(combined.diss.clim.common$genus == "Tilia"))
  
  Ulmaceae <- c(which(combined.diss.clim.common$genus == "Ulmus"))
  
  #Make single genus-species column
    combined.diss.clim.common$GenusSpecies <- NA
    combined.diss.clim.common$GenusSpecies <- with(combined.diss.clim.common, paste(genus, species))
  
  #Set total dataframe for Family
  combined.diss.clim.common$family <- NA
    combined.diss.clim.common$family[Aceraceae] <- "Aceraceae"
    combined.diss.clim.common$family[Betulaceae] <- "Betulaceae"       
    combined.diss.clim.common$family[Cornaceae] <- "Cornaceae"
    combined.diss.clim.common$family[Cupressaceae] <- "Cupressaceae"
    combined.diss.clim.common$family[Ebenaceae] <- "Ebenaceae"
    combined.diss.clim.common$family[Ericaceae] <- "Ericaceae"
    combined.diss.clim.common$family[Fabaceae] <- "Fabaceae"
    combined.diss.clim.common$family[Fagaceae] <- "Fagaceae"
    combined.diss.clim.common$family[Hamamelidaceae] <- "Hamamelidaceae"
    combined.diss.clim.common$family[Hippocastanaceae] <- "Hippocastanaceae"
    combined.diss.clim.common$family[Juglandaceae] <- "Juglandaceae"
    combined.diss.clim.common$family[Sassafras] <- "Lauraceae"
    combined.diss.clim.common$family[Magnoliaceae] <- "Magnoliaceae"
    combined.diss.clim.common$family[Oleaceae] <- "Oleaceae"   
    combined.diss.clim.common$family[Pinaceae] <- "Pinaceae"
    combined.diss.clim.common$family[Platanaceae] <- "Platanaceae"
    combined.diss.clim.common$family[Rosaceae] <- "Rosaceae"
    combined.diss.clim.common$family[Salicaceae] <- "Salicaceae"
    combined.diss.clim.common$family[Simaroubaceae] <- "Simaroubaceae"
    combined.diss.clim.common$family[Tiliaceae] <- "Tiliaceae"
    combined.diss.clim.common$family[Ulmaceae] <- "Ulmaceae"

    #Order
    Sapindales <- c(which(combined.diss.clim.common$family == "Aceraceae"),
                    which(combined.diss.clim.common$family == "Hippocastanaceae"),
                    which(combined.diss.clim.common$family == "Simaroubaceae"))
    
    Fagales <- c(which(combined.diss.clim.common$family == "Betulaceae"),
                 which(combined.diss.clim.common$family == "Fagaceae"))
    
    Cornales <- c(which(combined.diss.clim.common$family == "Cornaceae"))
    
    Pinales <- c(which(combined.diss.clim.common$family == "Cupressaceae"),
                 which(combined.diss.clim.common$family == "Pinaceae"))
    
    Ebenales <- c(which(combined.diss.clim.common$family == "Ebenaceae"))
    Ericales <- c(which(combined.diss.clim.common$family == "Ericaceae"))
    Fabales <- c(which(combined.diss.clim.common$family == "Fabaceae"))
    
    Hamamelidales <- c(which(combined.diss.clim.common$family == "Hamamelidaceae"),
                       which(combined.diss.clim.common$family == "Platanaceae"))
    
    Juglandales <- c(which(combined.diss.clim.common$family == "Juglandaceae"))
    Laurales <- c(which(combined.diss.clim.common$family == "Lauraceae"))
    Magnoliales <- c(which(combined.diss.clim.common$family == "Magnoliaceae"))
    Scrophulariales <- c(which(combined.diss.clim.common$family == "Oleaceae"))
    Rosales <- c(which(combined.diss.clim.common$family == "Rosaceae"))
    Salicales <- c(which(combined.diss.clim.common$family == "Salicaceae"))
    Malvales <- c(which(combined.diss.clim.common$family == "Tiliaceae"))
    Urticales <- c(which(combined.diss.clim.common$family == "Ulmaceae"))
    
    #Set total dataframe for order
    combined.diss.clim.common$order <- NA
    combined.diss.clim.common$order[Sapindales] <- "Sapindales"
    combined.diss.clim.common$order[Fagales] <- "Fagales"       
    combined.diss.clim.common$order[Cornales] <- "Cornales"
    combined.diss.clim.common$order[Pinales] <- "Pinales"
    combined.diss.clim.common$order[Ebenales] <- "Ebenales"
    combined.diss.clim.common$order[Ericales] <- "Ericales"
    combined.diss.clim.common$order[Fabales] <- "Fabales"
    combined.diss.clim.common$order[Hamamelidales] <- "Hamamelidales"
    combined.diss.clim.common$order[Juglandales] <- "Juglandales"
    combined.diss.clim.common$order[Laurales] <- "Laurales"
    combined.diss.clim.common$order[Magnoliales] <- "Magnoliales"
    combined.diss.clim.common$order[Scrophulariales] <- "Scrophulariales"
    combined.diss.clim.common$order[Rosales] <- "Rosales"
    combined.diss.clim.common$order[Salicales] <- "Salicales"   
    combined.diss.clim.common$order[Malvales] <- "Malvales"
    combined.diss.clim.common$order[Urticales] <- "Urticales"

    #Subclass
    Rosidae <- c(which(combined.diss.clim.common$order == "Sapindales"),
                 which(combined.diss.clim.common$order == "Cornales"),
                 which(combined.diss.clim.common$order == "Fabales"),
                 which(combined.diss.clim.common$order == "Rosales"))
    
    Hamamelididae <- c(which(combined.diss.clim.common$order == "Fagales"),
                       which(combined.diss.clim.common$order == "Hamamelidales"),
                       which(combined.diss.clim.common$order == "Juglandales"),
                       which(combined.diss.clim.common$order == "Urticales"))
    
    Pinopsida <- c(which(combined.diss.clim.common$order == "Pinales"))
    
    Dilleniidae <- c(which(combined.diss.clim.common$order == "Ebenales"),
                     which(combined.diss.clim.common$order == "Ericales"),
                     which(combined.diss.clim.common$order == "Salicales"),
                     which(combined.diss.clim.common$order == "Malvales"))
    
    Magnoliidae <- c(which(combined.diss.clim.common$order == "Magnoliales"),
                     which(combined.diss.clim.common$order == "Laurales"))
    
    Asteridae <- c(which(combined.diss.clim.common$order == "Scrophulariales"))
    
        #Set total dataframe for Subclass
    combined.diss.clim.common$subclass <- NA
    combined.diss.clim.common$subclass[Rosidae] <- "Rosidae"
    combined.diss.clim.common$subclass[Hamamelididae] <- "Hamamelididae"       
    combined.diss.clim.common$subclass[Pinopsida] <- "Pinopsida"
    combined.diss.clim.common$subclass[Dilleniidae] <- "Dilleniidae"
    combined.diss.clim.common$subclass[Magnoliidae] <- "Magnoliidae"
    combined.diss.clim.common$subclass[Asteridae] <- "Asteridae"


combined.diss.clim.common$GenusSpecies <- factor(combined.diss.clim.common$GenusSpecies, 
                  levels = c("Juniperus virginiana","Thuja occidentalis","Abies balsamea","Tsuga canadensis","Picea mariana", "Picea rubens","Pinus strobus","Pinus palustris","Pinus taeda","Pinus rigida","Sassafras albidum","Magnolia virginiana","Liriodendron tulipifera","Liquidambar styraciflua","Oxydendrum arboreum","Nyssa sylvatica","Fraxinus americana","Fraxinus nigra","Tilia americana","Acer rubrum","Acer saccharum","Acer negundo","Populus grandidentata","Populus tremuloides","Prunus serotina","Ulmus americana","Betula lenta","Betula papyrifera","Betula alleghaniensis","Juglans nigra","Carya glabra","Carya cordiformis","Carya ovata","Carya tomentosa","Fagus grandifolia","Quercus laurifolia","Quercus alba","Quercus velutina","Quercus nigra","Quercus laevis","Quercus montana","Quercus rubra","Quercus virginiana","Quercus coccinea","Quercus muehlenbergii","Quercus phellos"), ordered = TRUE) #Quercus coccinea added after tree made need to figure out where it actually belongs

combined.diss.clim.common$WOOD <- factor(combined.diss.clim.common$WOOD, levels = c("large.resin","small.resin", "no.resin","ring.porous","semiring.porous","diffuse.porous"), ordered = TRUE)

combined.diss.clim.common$PFT <- factor(combined.diss.clim.common$PFT, levels = c("Early.Conifer","Late.Conifer","Early.Hardwood","Mid.Hardwood","Late.Hardwood"), ordered = TRUE)

#write.csv(x = combined.diss.clim.common, file = "/Users/josh/Dropbox/Dissertation/CH1_Treerings/Data/combined.diss.clim.common.wood.phyl.csv")

write.csv(x = combined.diss.clim.common, file = "/Users/josh/Dropbox/Dissertation/CH1_Treerings/Data/combined.diss.clim.common.wood.phyl2.csv")

# #manually moved columns to before increment years
# combined.diss.clim.common.order <- read.csv("/Users/josh/Dropbox/Dissertation/CH1_Treerings/Data/combined.diss.clim.common.wood.phyl.csv")

#manually moved columns to before increment years
combined.diss.clim.common.order <- read.csv("/Users/josh/Dropbox/Dissertation/CH1_Treerings/Data/combined.diss.clim.common.wood.phyl2.csv")

combined.diss.clim.common.order <- combined.diss.clim.common.order[,2:164]
colnames(combined.diss.clim.common.order)[104:163] <- colnames.yrs#colnames(combined.dmg.clean) #get rid of stupid "x" before year

#only cores with 30yrs of growth 2010 - 1981, n = 1389
combined.diss.clim.common.order.complete.30 <- combined.diss.clim.common.order[complete.cases(combined.diss.clim.common.order[,128:157]),]
####################
#################### Come back to decide which cores to use
####################

#####reformat for all cores, including partial 50yr records####
#Reformat data so I can do linear models for more detailed analysis
# #recreate data frame to be compliant with structure needed to include time as a variable (50 years)
ids.rep.new.diss.common.order <- data.frame(matrix(NA,nrow=1,ncol=103))
colnames(ids.rep.new.diss.common.order) <- colnames(combined.diss.clim.common.order[1:103])
for(i in 1:nrow(combined.diss.clim.common.order)){
  ids.rep.diss.common.order <- combined.diss.clim.common.order[rep(i,times=50),1:103]
  ids.rep.new.diss.common.order <- rbind(ids.rep.new.diss.common.order,ids.rep.diss.common.order)
}
#remove row of NAs
combined.ids.diss.common.order <- ids.rep.new.diss.common.order[2:nrow(ids.rep.new.diss.common.order),]

#transpose and concatenate increments for all trees
inc.new.diss.common.order <- vector("numeric",length=0)
for(i in 1:nrow(combined.diss.clim.common.order)){
  inc.diss.common.order <- as.matrix(combined.diss.clim.common.order[i,108:157])
  inc.new.diss.common.order <- as.numeric(c(inc.new.diss.common.order,inc.diss.common.order))
}

#add ring increments
combined.ids.incs.diss <- cbind(combined.ids.diss.common.order,inc.new.diss.common.order)

#rename inc variable
setnames(combined.ids.incs.diss,old='inc.new.diss.common.order',new='INCREMENT')

YEAR <- seq(1961,2010,1)
YEAR <- rep(YEAR,1568)

#final version with 50yrs of growth
combined.all.diss.common <- cbind(combined.ids.incs.diss,YEAR)
#### includes cores with only partial record of 50 years ####


# #Simplest ANOVAs to start with - single variable mostly#
# 
# #similar to NSC figure, show mean growth rate by species and color by PFT#
# #just growth years 1961 - 2010
# growth.50yr <- combined.diss.clim.common.order[,108:157]
# mean.growth.50yr <- rowMeans(growth.50yr, na.rm = TRUE)
# mean.growth.fig.data <- cbind(combined.diss.clim.common.order, mean.growth.50yr)
# 
# #Relevel Factors, PFT
# mean.growth.fig.data$PFT <- factor(mean.growth.fig.data$PFT, 
#                                     levels = c("Early.Conifer","Late.Conifer","Early.Hardwood",
#                                                "Mid.Hardwood","Late.Hardwood"
#                                                ), ordered = TRUE)
# 
# #tree: http://itol.embl.de/tree/2131659112772721492482874
# mean.growth.fig.data$GenusSpecies <- factor(mean.growth.fig.data$GenusSpecies, 
#                   levels = c("Juniperus virginiana","Thuja occidentalis","Abies balsamea","Tsuga canadensis","Picea mariana", "Picea rubens","Pinus strobus","Pinus taeda","Pinus palustris","Sassafras albidum","Magnolia virginiana","Liriodendron tulipifera","Oxydendrum arboreum","Nyssa sylvatica","Fraxinus nigra","Fraxinus americana","Acer rubrum","Acer saccharum","Prunus serotina","Ulmus americana","Populus grandidentata","Populus tremuloides","Carya glabra","Carya tomentosa","Betula lenta","Betula alleghaniensis","Betula papyrifera","Fagus grandifolia","Quercus alba","Quercus laevis","Quercus velutina","Quercus rubra","Quercus laurifolia","Quercus coccinea","Quercus nigra","Quercus montana","Quercus virginiana","Quercus muehlenbergii"), ordered = TRUE)
# 
# #boxplot
# growth.spp.plot <- ggplot(mean.growth.fig.data, aes(x = GenusSpecies, y = mean.growth.50yr, fill = PFT)) + 
#   geom_boxplot() + theme(axis.text.x = element_text(angle=90,hjust=1,vjust=.5,size=10)) +
#   theme(axis.text.y = element_text(size=12)) +
#   #theme(axis.title.x = element_text(size=16)) +
#   theme(axis.title.y = element_text(size=14)) +
#   theme(legend.text = element_text(size=10)) + 
#   theme(legend.title = element_text(size = 14)) +
#   theme(legend.key.size = unit(.4, "cm")) +
#   labs(fill = "PFT") +
#   stat_summary(fun.data = give.n, geom= "text", size = 2.5, aes(y= 7.7)) + 
#   ylab(expression(paste("Mean Ring Width mm yr"^"-1"))) + xlab("") + ggtitle("All Species") +
#   scale_fill_manual(values=rev(cbPalette), labels = c("Early.Conifer","Late.Conifer","Early.Hardwood",
#                                                       "Mid.Hardwood","Late.Hardwood"))
# 
# #Associated Phylogenetic Tree is phylogeny.png
# 
# ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH1_Treerings//Figures/Growth.AllCommonSpp.png", plot = growth.spp.plot, dpi = 600, width = 10, height = 4.75, units = "in")
# 
# #year
# lm.year <- lm(INCREMENT ~ YEAR, data = combined.all.diss.common)
# summary(lm.year)
# 
# #space
# lm.space.simp <- lm(INCREMENT ~ SITE/PLOT/SUB/TAG, data = combined.all.diss.common)
# summary(lm.space.simp)
# 
# #wood
# lm.wood.simp <- lm(INCREMENT ~ WOOD, data = combined.all.diss.common)
# summary(lm.wood.simp)
# 
# #canopy
# lm.canopy.simp <- lm(INCREMENT ~ CANOPY15, data = combined.all.diss.common)
# summary(lm.canopy.simp)
# 
# #pft
# lm.pft.simp <- lm(INCREMENT ~ PFT, data = combined.all.diss.common)
# summary(lm.pft.simp)
# 
# #DBH
# lm.size.simp <- lm(INCREMENT ~ DBH14, data = combined.all.diss.common)
# summary(lm.size.simp)
# 
# #species
# lm.spp.simp <- lm(INCREMENT ~ GenusSpecies, data = combined.all.diss.common)
# summary(lm.spp.simp)
# 
# #genus/species
# lm.genus.simp <- lm(INCREMENT ~ genus/GenusSpecies, data = combined.all.diss.common)
# summary(lm.genus.simp)
# 
# #taxonomy
# #crashes R don't use
# # lm.tax.simp <- lm(INCREMENT ~ subclass/order/family/genus/GenusSpecies, data = combined.all.diss.common)
# # summary(lm.tax.simp)
# 
# #Won't run. R crashes
# # lm.phylo.simp <- lm(INCREMENT ~ subclass/order/family/genus/GenusSpecies, data = combined.all.diss.common)
# # summary(lm.phylo.simp)
# 
# #temperature
# lm.temp.simp <- lm(INCREMENT ~ TEMP_C, data = combined.all.diss.common)
# summary(lm.temp.simp)
# 
# #precipitation
# lm.precip.simp <- lm(INCREMENT ~ PRECIP, data = combined.all.diss.common)
# summary(lm.precip.simp)
# 
# #Multi-variable linear models
# #space only, fixed effect for year
# lmer.space <- lmer(INCREMENT ~ YEAR + (1|SITE/PLOT/SUB/TAG), data = combined.all.diss.common)
# summary(lm.space)
# 
# #Phylogeny only
# lm.phylo <- lmer(INCREMENT ~ YEAR + (1|subclass/order/family/genus/GenusSpecies), data = combined.all.diss.common)
# summary(lm.phylo)
# 
# lmer.space <- lmer(INCREMENT ~ YEAR + (1|SITE/PLOT/SUB/TAG), data = combined.all.diss.common)
# summary(lmer.space)
# 
# lm.pft.size <- lm(INCREMENT ~ PFT + DBH14 +I(DBH14^2), data = combined.all.diss.common)
# summary(lm.pft.size)
# 
# #Crashes R, don't use
# # lm.phylo <- lm(INCREMENT ~ family/genus/GenusSpecies, data = combined.all.diss.common)
# # summary(lm.phylo)
# 
# # lm.trait <- lm(INCREMENT ~ WOOD + PFT, data = combined.all.diss.common)
# # summary(lm.trait)
# 
# #space only, size fixed effect, random year effect
# lm.space.year <- lmer(INCREMENT ~ DBH14 + (1|YEAR) + (1|SITE/PLOT/SUB/TAG), data = combined.all.diss.common)
# summary(lm.space.year)
# 
# #space, size and canopy fixed, random year
# lm.space.year.f <- lmer(INCREMENT ~ DBH14 + CANOPY15 + (1|YEAR) + (1|SITE:YEAR) + (1|SITE/PLOT/SUB/TAG), data = combined.all.diss.common)
# summary(lm.space.year.f)
# 
# lm.space.year.sy <- lmer(INCREMENT ~ DBH14 + CANOPY15 + YEAR + (1|SITE:YEAR) + (1|SITE/PLOT/SUB/TAG), data = combined.all.diss.common)
# summary(lm.space.year.sy)
# 
# #space and regional climate
# ####highlight this one - reasoning for not using annually resolved met####
# lm.clim <- lmer(INCREMENT ~ YEAR + (1|SITE:YEAR) + (1|SITE/PLOT/SUB/TAG) + (1|TEMP_C) + (1|PRECIP) , data = combined.all.diss.common)
# summary(lm.clim)
# 
# #space, climate, and species
# lm.clim.spp <- lmer(INCREMENT ~ YEAR + (1|SITE/PLOT/SUB/TAG) + (1|TEMP_C) + (1|PRECIP) + (1|GenusSpecies), data = combined.all.diss.common)
# summary(lm.clim.spp)
# 
# #space and species
# lm.spp <- lmer(INCREMENT ~ YEAR + (1|SITE/PLOT/SUB/TAG) +  (1|GenusSpecies), data = combined.all.diss.common)
# summary(lm.spp)
# 
# #space, climate, species, and species:site interaction
# lm.clim.spp.int <- lmer(INCREMENT ~ YEAR + (1|SITE/PLOT/SUB/TAG) + (1|TEMP_C) + (1|PRECIP) + (1|GenusSpecies) + (1|GenusSpecies:SITE) , data = combined.all.diss.common)
# summary(lm.clim.spp.int)
# 
# #space, climate, traits, and phylogeny
# lm.clim.trait.spp <- lmer(INCREMENT ~ YEAR + (1|SITE/PLOT/SUB/TAG) + (1|TEMP_C) +(1|PRECIP) + (1|GenusSpecies) + (1|GenusSpecies:SITE) + (1|PFT) + (1|WOOD), data = combined.all.diss.common)
# summary(lm.clim.trait.spp)
# 
# #space, climte, traits, DBH and phylogeny
# lm.kitchen <- lmer(INCREMENT ~ YEAR + (1|SITE/PLOT/SUB/TAG) + (1|TEMP_C) +(1|PRECIP) + (1|GenusSpecies) + (1|GenusSpecies:SITE) + (1|PFT) + (1|WOOD) + DBH14, data = combined.all.diss.common)
# summary(lm.kitchen)
```

```{r}
################################### cores with full 50yrs of data #####################################
################################### Used for analysis in chapter  #####################################

#only cores with 50yrs of growth 2010 - 1961, n = 1193
combined.diss.clim.common.order.50 <- combined.diss.clim.common.order[complete.cases(combined.diss.clim.common.order[,108:157]),]

write.csv(x = combined.diss.clim.common.order.50, file = "/Users/josh/Dropbox/Dissertation/CH1_Treerings/Data/combined.diss.clim.common.wood.phyl3.csv")

#removed suspiciously large increments <1.5cm by hand
combined.diss.clim.common.order.50.QC <- read.csv("/Users/josh/Dropbox/Dissertation/CH1_Treerings/Data/combined.diss.clim.common.wood.phyl3.QC.csv")

combined.diss.clim.common.order.50.QC <- combined.diss.clim.common.order.50.QC[,2:164]
colnames(combined.diss.clim.common.order.50.QC)[104:163] <- colnames.yrs#colnames(combined.dmg.clean) #get rid of stupid "x" before year

#remove spp that don't meet threshold anymore#
count(combined.diss.clim.common.order.50.QC$SPP)
#remove spp with very low sample size, setting cutoff below 5 because
#of an arbitrary reason, need to do an actual power analysis

abba <- which(combined.diss.clim.common.order.50.QC$SPP == "ABBA")
#acne2 <- which(combined.diss.clim.common.order.50.QC$SPP == "ACNE2")
acru <- which(combined.diss.clim.common.order.50.QC$SPP == "ACRU")
acsa3 <- which(combined.diss.clim.common.order.50.QC$SPP == "ACSA3")
beal2 <- which(combined.diss.clim.common.order.50.QC$SPP == "BEAL2")
bele <- which(combined.diss.clim.common.order.50.QC$SPP == "BELE")
bepa <- which(combined.diss.clim.common.order.50.QC$SPP == "BEPA")
#caco15 <- which(combined.diss.clim.common.order.50.QC$SPP == "CACO15")
cagl8 <- which(combined.diss.clim.common.order.50.QC$SPP == "CAGL8")
#caov2 <- which(combined.diss.clim.common.order.50.QC$SPP == "CAOV2")
cato6 <- which(combined.diss.clim.common.order.50.QC$SPP == "CATO6")
fagr <- which(combined.diss.clim.common.order.50.QC$SPP == "FAGR")
fram2 <- which(combined.diss.clim.common.order.50.QC$SPP == "FRAM2")
frni <- which(combined.diss.clim.common.order.50.QC$SPP == "FRNI")
#juni <- which(combined.diss.clim.common.order.50.QC$SPP == "JUNI")
juvi <- which(combined.diss.clim.common.order.50.QC$SPP == "JUVI")
#list2 <- which(combined.diss.clim.common.order.50.QC$SPP == "LIST2")
litu <- which(combined.diss.clim.common.order.50.QC$SPP == "LITU")
#mavi2 <- which(combined.diss.clim.common.order.50.QC$SPP == "MAVI2")
#nysy <- which(combined.diss.clim.common.order.50.QC$SPP == "NYSY")
oxar <- which(combined.diss.clim.common.order.50.QC$SPP == "OXAR")
pima <- which(combined.diss.clim.common.order.50.QC$SPP == "PIMA")
pipa2 <- which(combined.diss.clim.common.order.50.QC$SPP == "PIPA2")
#piri <- which(combined.diss.clim.common.order.50.QC$SPP == "PIRI")
piru <- which(combined.diss.clim.common.order.50.QC$SPP == "PIRU")
pist <- which(combined.diss.clim.common.order.50.QC$SPP == "PIST")
pita <- which(combined.diss.clim.common.order.50.QC$SPP == "PITA")
pogr4 <- which(combined.diss.clim.common.order.50.QC$SPP == "POGR4")
potr5 <- which(combined.diss.clim.common.order.50.QC$SPP == "POTR5")
prse2 <- which(combined.diss.clim.common.order.50.QC$SPP == "PRSE2")
qual <- which(combined.diss.clim.common.order.50.QC$SPP == "QUAL")
quco2 <- which(combined.diss.clim.common.order.50.QC$SPP == "QUCO2")
qula2 <- which(combined.diss.clim.common.order.50.QC$SPP == "QULA2")
#qula3 <- which(combined.diss.clim.common.order.50.QC$SPP == "QULA3")
qumo4 <- which(combined.diss.clim.common.order.50.QC$SPP == "QUMO4")
qumu <- which(combined.diss.clim.common.order.50.QC$SPP == "QUMU")
quni <- which(combined.diss.clim.common.order.50.QC$SPP == "QUNI")
#quph <- which(combined.diss.clim.common.order.50.QC$SPP == "QUPH")
quru <- which(combined.diss.clim.common.order.50.QC$SPP == "QURU")
quve <- which(combined.diss.clim.common.order.50.QC$SPP == "QUVE")
#quvi <- which(combined.diss.clim.common.order.50.QC$SPP == "QUVI")
#saal5 <- which(combined.diss.clim.common.order.50.QC$SPP == "SAAL5")
thoc2 <- which(combined.diss.clim.common.order.50.QC$SPP == "THOC2")
#tiam <- which(combined.diss.clim.common.order.50.QC$SPP == "TIAM")
tsca <- which(combined.diss.clim.common.order.50.QC$SPP == "TSCA")
ulam <- which(combined.diss.clim.common.order.50.QC$SPP == "ULAM")

####This is the dataset to use for average figures and to convert into increment dataset####
growth.50yr.QC.final <- rbind(
                             combined.diss.clim.common.order.50.QC[abba,],
                             combined.diss.clim.common.order.50.QC[acru,],
                             combined.diss.clim.common.order.50.QC[acsa3,],
                             combined.diss.clim.common.order.50.QC[beal2,],
                             combined.diss.clim.common.order.50.QC[bele,],
                             combined.diss.clim.common.order.50.QC[bepa,],
                             combined.diss.clim.common.order.50.QC[cagl8,],
                             combined.diss.clim.common.order.50.QC[cato6,],
                             combined.diss.clim.common.order.50.QC[fagr,],
                             combined.diss.clim.common.order.50.QC[fram2,],
                             combined.diss.clim.common.order.50.QC[frni,],
                             combined.diss.clim.common.order.50.QC[juvi,],
                             combined.diss.clim.common.order.50.QC[litu,],
                             combined.diss.clim.common.order.50.QC[oxar,],
                             combined.diss.clim.common.order.50.QC[pima,],
                             combined.diss.clim.common.order.50.QC[pipa2,],
                             combined.diss.clim.common.order.50.QC[piru,],
                             combined.diss.clim.common.order.50.QC[pist,],
                             combined.diss.clim.common.order.50.QC[pita,],
                             combined.diss.clim.common.order.50.QC[pogr4,],
                             combined.diss.clim.common.order.50.QC[potr5,],
                             combined.diss.clim.common.order.50.QC[prse2,],
                             combined.diss.clim.common.order.50.QC[quco2,],
                             combined.diss.clim.common.order.50.QC[qual,],
                             combined.diss.clim.common.order.50.QC[qula2,],
                             combined.diss.clim.common.order.50.QC[qumo4,],
                             combined.diss.clim.common.order.50.QC[qumu,],
                             combined.diss.clim.common.order.50.QC[quni,],
                             combined.diss.clim.common.order.50.QC[quru,],
                             combined.diss.clim.common.order.50.QC[quve,],
                             combined.diss.clim.common.order.50.QC[thoc2,],
                             combined.diss.clim.common.order.50.QC[tsca,],
                             combined.diss.clim.common.order.50.QC[ulam,])

#### reformat for only cores with full 50yrs worth of data ###
ids.rep.new.diss.common.order.50.QC <- data.frame(matrix(NA,nrow=1,ncol=103))
colnames(ids.rep.new.diss.common.order.50.QC) <- colnames(growth.50yr.QC.final[1:103])
for(i in 1:nrow(growth.50yr.QC.final)){
  ids.rep.diss.common.order.50.QC <- growth.50yr.QC.final[rep(i,times=50),1:103]
  ids.rep.new.diss.common.order.50.QC <- rbind(ids.rep.new.diss.common.order.50.QC,ids.rep.diss.common.order.50.QC)
}
#remove row of NAs
combined.ids.diss.common.order.50.QC <- ids.rep.new.diss.common.order.50.QC[2:nrow(ids.rep.new.diss.common.order.50.QC),]

#transpose and concatenate increments for all trees
growth.50yr.QC.inc.new <- vector("numeric",length=0)
for(i in 1:nrow(growth.50yr.QC.final)){
  inc.diss.common.order.50.QC <- as.matrix(growth.50yr.QC.final[i,108:157])
  growth.50yr.QC.inc.new <- as.numeric(c(growth.50yr.QC.inc.new,inc.diss.common.order.50.QC))
}

#add ring increments
growth.50yr.QC.increment <- cbind(combined.ids.diss.common.order.50.QC,growth.50yr.QC.inc.new)

#rename inc variable
setnames(growth.50yr.QC.increment,old='growth.50yr.QC.inc.new',new='INCREMENT')

YEAR <- seq(1961,2010,1)
YEAR <- rep(YEAR,1179)

#final version with 50yrs complete growth record
growth.50yr.QC.increment.final <- cbind(growth.50yr.QC.increment,YEAR)
#record to use with average growth figures: growth.50yr.QC.final

```
You can also embed plots, for example:

```{r}
###Figures###
###################################### Using full 50 yr data #############################################
#similar to NSC figure, show mean growth rate by species and color by PFT#
#just growth years 1961 - 2010
growth.only <- growth.50yr.QC.final[,108:157]
mean.growth.50yr.QC <- rowMeans(growth.only)
mean.growth.fig.data.50yr.QC <- cbind(growth.50yr.QC.final, mean.growth.50yr.QC)

#Relevel Factors, PFT
mean.growth.fig.data.50yr.QC$PFT <- factor(mean.growth.fig.data.50yr.QC$PFT, 
                                    levels = c("Early.Conifer","Late.Conifer","Early.Hardwood",
                                               "Mid.Hardwood","Late.Hardwood"
                                               ), ordered = TRUE)

#Relevel Factors, Wood Anatomy
mean.growth.fig.data.50yr.QC$WOOD <- factor(mean.growth.fig.data.50yr.QC$WOOD, 
                                     levels = c("large.resin","small.resin", 
                                                "no.resin","ring.porous",
                                                "semiring.porous","diffuse.porous"), ordered = TRUE)

#relevel species to match phylogenetic tree
#tree: http://itol.embl.de/tree/21316591127300121492568435
mean.growth.fig.data.50yr.QC$GenusSpecies <- factor(mean.growth.fig.data.50yr.QC$GenusSpecies, 
                  levels = c("Thuja occidentalis", "Juniperus virginiana", "Tsuga canadensis", "Abies balsamea", "Picea rubens", "Picea mariana", "Pinus strobus", "Pinus taeda", "Pinus palustris", "Liriodendron tulipifera", "Oxydendrum arboreum", "Fraxinus nigra", "Fraxinus americana", "Acer saccharum", "Acer rubrum", "Prunus serotina", "Ulmus americana", "Populus tremuloides", "Populus grandidentata", "Carya glabra", "Carya tomentosa", "Betula papyrifera", "Betula lenta", "Betula alleghaniensis", "Fagus grandifolia", "Quercus muehlenbergii", "Quercus rubra", "Quercus velutina", "Quercus laevis", "Quercus montana", "Quercus alba"), ordered = TRUE)

####ordering factors for increment data, not just average####
#Relevel Factors, PFT
growth.50yr.QC.increment.final$PFT <- factor(growth.50yr.QC.increment.final$PFT, 
                                    levels = c("Early.Conifer","Late.Conifer","Early.Hardwood",
                                               "Mid.Hardwood","Late.Hardwood"
                                               ), ordered = TRUE)

#Relevel Factors, Wood Anatomy
growth.50yr.QC.increment.final$WOOD <- factor(growth.50yr.QC.increment.final$WOOD, 
                                     levels = c("large.resin","small.resin", 
                                                "no.resin","ring.porous",
                                                "semiring.porous","diffuse.porous"), ordered = TRUE)

#relevel species to match phylogenetic tree
#tree: http://itol.embl.de/tree/21316591127300121492568435
growth.50yr.QC.increment.final$GenusSpecies <- factor(growth.50yr.QC.increment.final$GenusSpecies, 
                  levels = c("Thuja occidentalis", "Juniperus virginiana", "Tsuga canadensis", "Abies balsamea", "Picea rubens", "Picea mariana", "Pinus strobus", "Pinus taeda", "Pinus palustris", "Liriodendron tulipifera", "Oxydendrum arboreum", "Fraxinus nigra", "Fraxinus americana", "Acer saccharum", "Acer rubrum", "Prunus serotina", "Ulmus americana", "Populus tremuloides", "Populus grandidentata", "Carya glabra", "Carya tomentosa", "Betula papyrifera", "Betula lenta", "Betula alleghaniensis", "Fagus grandifolia", "Quercus muehlenbergii", "Quercus rubra", "Quercus velutina", "Quercus laevis", "Quercus montana", "Quercus alba"), ordered = TRUE)

growth.50yr.QC.increment.final$SITE <- factor(growth.50yr.QC.increment.final$SITE, levels = c("W","B","H","V","S","C","M","D","T","F"), ordered = TRUE)

growth.50yr.QC.increment.final$CANOPY15 <- as.character( growth.50yr.QC.increment.final$CANOPY15)
growth.50yr.QC.increment.final$CANOPY15[ growth.50yr.QC.increment.final$CANOPY15 == "0"] <- "Understory"
growth.50yr.QC.increment.final$CANOPY15[ growth.50yr.QC.increment.final$CANOPY15 == "1"] <- "CoDominant"
growth.50yr.QC.increment.final$CANOPY15[ growth.50yr.QC.increment.final$CANOPY15 == "2"] <- "Dominant"
# growth.50yr.QC.increment.final$CANOPY15[is.na( growth.50yr.QC.increment.final$CANOPY15)] <- "CoDominant"

growth.50yr.QC.increment.final$CANOPY15 <- 
factor(growth.50yr.QC.increment.final$CANOPY15, levels = c("Understory","CoDominant","Dominant"), ordered = TRUE)

##### Removing One tree from Coweeta #####
no.coweeta.inc <- which(growth.50yr.QC.increment.final$SITE != "C")
no.coweeta.mean <- which(mean.growth.fig.data.50yr.QC$SITE != "C")

growth.50yr.QC.increment.final <- growth.50yr.QC.increment.final[no.coweeta.inc,]

mean.growth.fig.data.50yr.QC <- mean.growth.fig.data.50yr.QC[no.coweeta.mean,]

mean.growth.fig.data.50yr.QC$PLOT <- factor(mean.growth.fig.data.50yr.QC$PLOT, ordered = FALSE)

growth.50yr.QC.increment.final$PLOT <- factor(growth.50yr.QC.increment.final$PLOT, ordered = FALSE)

growth.50yr.QC.increment.final$SUB <- factor(growth.50yr.QC.increment.final$SUB, ordered = FALSE)


######## Final datasets used: mean.growth.fig.data.50yr.QC and growth.50yr.QC.increment.final
######## fixing temp and precip data in both datasets #########
#fix mean dataset
  w.m <- which(mean.growth.fig.data.50yr.QC$Site == "W")
  b.m <- which(mean.growth.fig.data.50yr.QC$Site == "B")
  h.m <- which(mean.growth.fig.data.50yr.QC$Site == "H")
  v.m <- which(mean.growth.fig.data.50yr.QC$Site == "V")
  s.m <- which(mean.growth.fig.data.50yr.QC$Site == "S")
  m.m <- which(mean.growth.fig.data.50yr.QC$Site == "M")
  t.m <- which(mean.growth.fig.data.50yr.QC$Site == "T")
  f.m <- which(mean.growth.fig.data.50yr.QC$Site == "F")
  c.m <- which(mean.growth.fig.data.50yr.QC$Site == "C")
  d.m <- which(mean.growth.fig.data.50yr.QC$Site == "D")
  
  #########Correct temperature and precip data for sites used############
  mean.growth.fig.data.50yr.QC$TEMP_C[w.m] <- 4.08
  mean.growth.fig.data.50yr.QC$TEMP_C[b.m] <- 4.85
  mean.growth.fig.data.50yr.QC$TEMP_C[h.m] <- 7.05
  mean.growth.fig.data.50yr.QC$TEMP_C[v.m] <- 10.99
  mean.growth.fig.data.50yr.QC$TEMP_C[s.m] <- 12.25
  mean.growth.fig.data.50yr.QC$TEMP_C[m.m] <- 12.62
  mean.growth.fig.data.50yr.QC$TEMP_C[t.m] <- 14.11
  mean.growth.fig.data.50yr.QC$TEMP_C[f.m] <- 20.81
  mean.growth.fig.data.50yr.QC$TEMP_C[c.m] <- 11.22
  mean.growth.fig.data.50yr.QC$TEMP_C[d.m] <- 14.88

  mean.growth.fig.data.50yr.QC$PRECIP[w.m] <- 804
  mean.growth.fig.data.50yr.QC$PRECIP[b.m] <- 1378
  mean.growth.fig.data.50yr.QC$PRECIP[h.m] <- 1135
  mean.growth.fig.data.50yr.QC$PRECIP[v.m] <- 985
  mean.growth.fig.data.50yr.QC$PRECIP[s.m] <- 970
  mean.growth.fig.data.50yr.QC$PRECIP[m.m] <- 1037
  mean.growth.fig.data.50yr.QC$PRECIP[t.m] <- 1366
  mean.growth.fig.data.50yr.QC$PRECIP[f.m] <- 1298
  mean.growth.fig.data.50yr.QC$PRECIP[c.m] <- 2193
  mean.growth.fig.data.50yr.QC$PRECIP[d.m] <- 1165

#Fix increment dataset
  w.i <- which(growth.50yr.QC.increment.final$Site == "W")
  b.i <- which(growth.50yr.QC.increment.final$Site == "B")
  h.i <- which(growth.50yr.QC.increment.final$Site == "H")
  v.i <- which(growth.50yr.QC.increment.final$Site == "V")
  s.i <- which(growth.50yr.QC.increment.final$Site == "S")
  m.i <- which(growth.50yr.QC.increment.final$Site == "M")
  t.i <- which(growth.50yr.QC.increment.final$Site == "T")
  f.i <- which(growth.50yr.QC.increment.final$Site == "F")
  c.i <- which(growth.50yr.QC.increment.final$Site == "C")
  d.i <- which(growth.50yr.QC.increment.final$Site == "D")
  
  #########Correct temperature and precip data for sites used############
  growth.50yr.QC.increment.final$TEMP_C[w.i] <- 4.08
  growth.50yr.QC.increment.final$TEMP_C[b.i] <- 4.85
  growth.50yr.QC.increment.final$TEMP_C[h.i] <- 7.05
  growth.50yr.QC.increment.final$TEMP_C[v.i] <- 10.99
  growth.50yr.QC.increment.final$TEMP_C[s.i] <- 12.25
  growth.50yr.QC.increment.final$TEMP_C[m.i] <- 12.62
  growth.50yr.QC.increment.final$TEMP_C[t.i] <- 14.11
  growth.50yr.QC.increment.final$TEMP_C[f.i] <- 20.81
  growth.50yr.QC.increment.final$TEMP_C[c.i] <- 11.22
  growth.50yr.QC.increment.final$TEMP_C[d.i] <- 14.88

  growth.50yr.QC.increment.final$PRECIP[w.i] <- 804
  growth.50yr.QC.increment.final$PRECIP[b.i] <- 1378
  growth.50yr.QC.increment.final$PRECIP[h.i] <- 1135
  growth.50yr.QC.increment.final$PRECIP[v.i] <- 985
  growth.50yr.QC.increment.final$PRECIP[s.i] <- 970
  growth.50yr.QC.increment.final$PRECIP[m.i] <- 1037
  growth.50yr.QC.increment.final$PRECIP[t.i] <- 1366
  growth.50yr.QC.increment.final$PRECIP[f.i] <- 1298
  growth.50yr.QC.increment.final$PRECIP[c.i] <- 2193
  growth.50yr.QC.increment.final$PRECIP[d.i] <- 1165
  
#boxplot
growth.spp.plot <- ggplot(mean.growth.fig.data.50yr.QC, aes(x = GenusSpecies, y = mean.growth.50yr.QC, fill = PFT)) + 
  geom_boxplot() + theme(axis.text.x = element_text(angle=90,hjust=1,vjust=.5,size=10)) +
  theme(axis.text.y = element_text(size=12)) +
  #theme(axis.title.x = element_text(size=16)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(legend.text = element_text(size=10)) + 
  theme(legend.title = element_text(size = 14)) +
  theme(legend.key.size = unit(.4, "cm")) +
  labs(fill = "PFT") +
  stat_summary(fun.data = give.n, geom= "text", size = 2.5, aes(y= 5)) + 
  ylab(expression(paste("Mean Ring Width mm yr"^"-1"))) + xlab("") + #ggtitle("All Species") +
  #ylim(0,4) +
  scale_fill_manual(values=rev(cbPalette), labels = c("Early.Conifer","Late.Conifer","Early.Hardwood",
  "Mid.Hardwood","Late.Hardwood"))

#Associated Phylogenetic Tree is phylogeny.png
ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH1_Treerings//Figures/Growth.AllCommonSpp.50yr.png", plot = growth.spp.plot, dpi = 600, width = 10, height = 4.75, units = "in")



################ANOVAs for full 50yr cores###############

#not reliable estimates of variance explained
#estimated effects are unbalanced and many effects not estimable
mean.space.aov <- aov(mean.growth.50yr.QC ~ SITE/PLOT/SUB, 
                 data = mean.growth.fig.data.50yr.QC)
var.space.50 <- anova(mean.space.aov)[,2]
var.space.50.prop <- var.space.50/sum(var.space.50)

#not reliable estimates of variance explained
#estimated effects are unbalanced and many effects not estimable
space.aov <- aov(INCREMENT ~ SITE/PLOT/SUB/TAG, data = growth.50yr.QC.increment.final)
var.space.50.inc <- anova(space.aov)[,2]
var.space.50.inc.prop <- var.space.50.inc/sum(var.space.50.inc)

lm.space.inc <- lm(INCREMENT ~ SITE/PLOT/SUB, data = growth.50yr.QC.increment.final)
anova(lm.space.inc)
summary(lm.space.inc)

lm.space.avg <- lm(mean.growth.50yr.QC ~ SITE/PLOT/SUB, data = mean.growth.fig.data.50yr.QC)
anova(lm.space.avg)
summary(lm.space.avg)

growth.50yr.QC.increment.final$YEAR <- factor(growth.50yr.QC.increment.final$YEAR, ordered = FALSE)
#year
lm.year <- lm(INCREMENT ~ YEAR, data = growth.50yr.QC.increment.final)
anova(lm.year)
summary(lm.year)

#Tukey's HSD year
summary(aov.year <- aov(lm.year))
tukey.year.gr <- TukeyHSD(aov.year, "YEAR", ordered = FALSE)
plot(tukey.year.gr)
year.levels.gr <- tukey.year.gr[["YEAR"]][,4]
year.labels.gr <- multcompLetters(year.levels.gr)['Letters']
year.plot.labels <- names(year.labels.gr[['Letters']])


boxplot(INCREMENT ~ YEAR, data = growth.50yr.QC.increment.final)

##growth by year - mean with sd
year.growth.sd <- ggplot(growth.50yr.QC.increment.final, aes(x = as.factor(YEAR), y = INCREMENT)) +
  stat_summary(fun.y = "mean", 
               fun.ymin = function(x) mean(x) - sd(x),
               fun.ymax = function(x) mean(x) + sd(x),
               geom = "pointrange", colour = "black") +
  theme(axis.text.x = element_text(angle=90,hjust=1,size=8)) +
  ylab(expression(paste("Ring Width mm yr"^"-1"))) + xlab("Year")
  
ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH1_Treerings//Figures/annual.growth.sd.png", plot = year.growth.sd, dpi = 600, width = 6, height = 3.5, units = "in")

###take year into account first
###then do mixed effect model with a fixed year effect
lmer.space <- lmer(INCREMENT ~ YEAR + (1|SITE/PLOT/SUB/TAG), data = growth.50yr.QC.increment.final)
summary(lmer.space)

space.vars <- as.data.frame(VarCorr(lmer.space, order = "cov.last"))
#calculating partial variances for random effects
var.space.vars = space.vars$vcov/sum(space.vars$vcov)
space.part.vars <- cbind(space.vars$grp,var.space.vars)
#test
sum(as.numeric(space.part.vars[,2]))
#now have proportions of variance explained by each effect
#Environment
#1,2,7
site.partvar <- sum(as.numeric(part.vars[1,2]),as.numeric(part.vars[2,2]),as.numeric(part.vars[7,2])) #sub, plot, site 11.88 %

#space
lm.space.simp <- lm(INCREMENT ~ SITE/PLOT/SUB/TAG, data = growth.50yr.QC.increment.final)
summary(lm.space.simp)

#wood
lm.wood.simp <- lm(INCREMENT ~ WOOD, data = growth.50yr.QC.increment.final)
summary(lm.wood.simp)

#TukeyHSD WOOD
summary(aov.wood <- aov(lm.wood.simp))
tukey.wood.gr <- TukeyHSD(aov.wood, "WOOD", ordered = FALSE)
plot(tukey.wood.gr)
wood.levels.gr <- tukey.wood.gr[["WOOD"]][,4]
wood.labels.gr <- multcompLetters(wood.levels.gr)['Letters']
wood.plot.labels <- names(wood.labels.gr[['Letters']])

wood.n <- table(growth.50yr.QC.increment.final$WOOD)/50

wood.growth.violin <- ggplot(growth.50yr.QC.increment.final, aes(x = WOOD, y = INCREMENT, fill = NULL))+
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=16)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(axis.text.x = element_text(size = 12)) +
  theme(legend.text = element_blank()) +
  theme(legend.position = "none") +
  annotate("text", x = .8, y = 5.2, label = wood.n[1], size = 3.5) +
  annotate("text", x = 1.8, y = 5.2, label = wood.n[2], size = 3.5) +
  annotate("text", x = 2.8, y = 5.2, label = wood.n[3], size = 3.5) +
  annotate("text", x = 3.8, y = 5.2, label = wood.n[4], size = 3.5) +
  annotate("text", x = 4.8, y = 5.2, label = wood.n[5], size = 3.5) +
  annotate("text", x = 5.8, y = 5.2, label = wood.n[6], size = 3.5) +
  # stat_summary_bin(fun.data = function(x){give.n(x)/50}, geom= "text", size = 3.5, aes(y= 15.75)) +
  stat_summary(fun.y="median", geom="point") +
  ylab(expression(paste("Ring Width mm yr"^"-1"))) + xlab("Wood Anatomy") + #ggtitle("All Wood Types") +
  scale_x_discrete(labels = c("Large Resin", "Small Resin", "No Resin", "Ring Porous", "Semi-ring Porous", "Diffuse Porous")) +
  scale_fill_manual(values=rev(cbPalette)) +
  ylim(0,5.2) +
  annotate("text", x = 1.1:6.1, y = c(5, 4.7, 5, 5, 5, 5), label = c("e","a","c","c","b","d"))

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH1_Treerings//Figures/growth.wood.anat.png", plot = wood.growth.violin, dpi = 600, width = 5, height = 3.5, units = "in")

#canopy
lm.canopy.simp <- lm(INCREMENT ~ CANOPY15, data = growth.50yr.QC.increment.final)
summary(lm.canopy.simp)

#TukeyHSD canopy
summary(aov.canopy <- aov(lm.canopy.simp))
tukey.canopy.gr <- TukeyHSD(aov.canopy, "CANOPY15", ordered = FALSE)
plot(tukey.canopy.gr)
canopy.levels.gr <- tukey.canopy.gr[["CANOPY15"]][,4]
canopy.labels.gr <- multcompLetters(canopy.levels.gr)['Letters']
canopy.plot.labels <- names(canopy.labels.gr[['Letters']])

canopy.n <- table(growth.50yr.QC.increment.final$CANOPY15)/50

canopy.growth.violin <- ggplot(growth.50yr.QC.increment.final, aes(x = as.factor(CANOPY15), y = INCREMENT, fill = NULL))+
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=16)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(axis.text.x = element_text(size = 12)) +
  theme(legend.text = element_blank()) +
  theme(legend.position = "none") +
  annotate("text", x = .85, y = 5.2, label = canopy.n[1], size = 3.5) +
  annotate("text", x = 1.85, y = 5.2, label = canopy.n[2], size = 3.5) +
  annotate("text", x = 2.85, y = 5.2, label = canopy.n[3], size = 3.5) +
  #stat_summary(fun.data = give.n, geom= "text", size = 3.5, aes(y= 13)) + 
  stat_summary(fun.y="median", geom="point") +
  ylab(expression(paste("Ring Width mm yr"^"-1"))) + xlab("Canopy Status") + #ggtitle("All Wood Types") +
  ylim(0,5.2) +
  scale_x_discrete(labels = c("Understory", "Co-Dominant", "Dominant")) +
  scale_fill_manual(values=rev(cbPalette)) +
  annotate("text", x = 1.1:3.1, y = c(5, 5, 5), label = c("a","b","c"))

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH1_Treerings/Figures/canopy.growth.violin.png", plot = canopy.growth.violin, dpi = 600, width = 5, height = 3.5, units = "in")

#pft
lm.pft.simp <- lm(INCREMENT ~ as.character(PFT), data = growth.50yr.QC.increment.final)
summary(lm.pft.simp)

summary(aov.pft <- aov(lm.pft.simp))
tukey.pft.gr <- TukeyHSD(aov.pft, "PFT", ordered = FALSE)
plot(tukey.pft.gr)
pft.levels.gr <- tukey.pft.gr[["PFT"]][,4]
pft.labels.gr <- multcompLetters(pft.levels.gr)['Letters']
pft.plot.labels <- names(pft.labels.gr[['Letters']])

pft.n <- table(growth.50yr.QC.increment.final$PFT)/50

pft.growth.violin <- ggplot(growth.50yr.QC.increment.final, aes(x = PFT, y = INCREMENT, fill = PFT)) +
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=16)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(axis.text.x = element_text(size = 12)) +
  theme(legend.text = element_blank()) +
  theme(legend.position = "none") +
  annotate("text", x = .8, y = 5.2, label = pft.n[1], size = 3.5) +
  annotate("text", x = 1.8, y = 5.2, label = pft.n[2], size = 3.5) +
  annotate("text", x = 2.8, y = 5.2, label = pft.n[3], size = 3.5) +
  annotate("text", x = 3.8, y = 5.2, label = pft.n[4], size = 3.5) +
  annotate("text", x = 4.8, y = 5.2, label = pft.n[5], size = 3.5) +
  #stat_summary(fun.data = give.n, geom= "text", size = 3.5, aes(y= 13)) + 
  stat_summary(fun.y="mean", geom="point") +
  ylim(0,5.2) +
  ylab(expression(paste("Ring Width mm yr"^"-1"))) + xlab("Plant Functional Type") +
  scale_x_discrete(labels = c("Early.Conifer","Late.Conifer","Early.Hardwood",                            "Mid.Hardwood","Late.Hardwood")) +
  scale_fill_manual(values=rev(cbPalette)) +
  annotate("text", x = 1.1:5.1, y = c(5, 5, 5, 5, 5), label = c("e","a","d","c","b"))

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH1_Treerings/Figures/pft.growth.violin.png", plot = pft.growth.violin, dpi = 600, width = 7, height = 3.5, units = "in")

#DBH
lm.size.simp15 <- lm(INCREMENT ~ DBH15, data = growth.50yr.QC.increment.final)
summary(lm.size.simp15)

####Test with all years dbh to report R2####
lm.size.simp14 <- lm(INCREMENT ~ DBH14, data = growth.50yr.QC.increment.final)
summary(lm.size.simp14)

lm.size.simp13 <- lm(INCREMENT ~ DBH13, data = growth.50yr.QC.increment.final)
summary(lm.size.simp13)

lm.size.simp12 <- lm(INCREMENT ~ DBH12, data = growth.50yr.QC.increment.final)
summary(lm.size.simp12)

lm.size.simp11 <- lm(INCREMENT ~ DBH11, data = growth.50yr.QC.increment.final)
summary(lm.size.simp11)

dbh.growth.plot <- ggplot(growth.50yr.QC.increment.final, aes(x = DBH15, y = INCREMENT)) +
  geom_point(alpha = .1) +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1, aes(color = "blue")) + # GAM model with smooth
  geom_smooth(method = "lm", aes(color = "yellow")) +
  theme(axis.title.y = element_text(size = 14)) +
  theme(axis.title.x = element_text(size = 14)) +
  annotate("text",x=1,y=13.5,label = "a") +
  scale_color_manual(name = "Fit", values = "yellow", labels = "linear") + 
  theme(legend.position = "none") +
  ylab(expression(paste("Ring Width mm yr"^"-1"))) + xlab("DBH (cm)")

# ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH1_Treerings//Figures/DBH.growth.png", plot = dbh.growth.plot, dpi = 600, width = 5, height = 3.5, units = "in")

#avg growth and DBH
lm.size.avg <- lm(mean.growth.50yr.QC ~ DBH15, data = mean.growth.fig.data.50yr.QC)
summary(lm.size.avg)

plot(mean.growth.50yr.QC ~ DBH15, data = mean.growth.fig.data.50yr.QC)
abline(lm.size.avg)

dbh.growth.plot.avg <- ggplot(mean.growth.fig.data.50yr.QC, aes(x = DBH15, y = mean.growth.50yr.QC)) +
  geom_point(alpha = .3) +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1, aes(color = "blue")) + # GAM model with smooth
  geom_smooth(method = "lm", aes(color = "yellow")) +
  theme(axis.title.y = element_text(size = 14)) +
  theme(axis.title.x = element_text(size = 14)) +
  annotate("text",x=1,y=4.5,label = "b") +
  scale_color_manual(name = "Fit", values = "yellow", labels = "linear") + 
  theme(legend.position = "none") +
  ylab(expression(paste("Mean Ring Width mm yr"^"-1"))) + xlab("DBH (cm)")

dbh.components <- grid.arrange(dbh.growth.plot, dbh.growth.plot.avg, ncol = 1)

# ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH1_Treerings//Figures/DBH.growth.avg.png", plot = dbh.growth.plot.avg, dpi = 600, width = 5, height = 3.5, units = "in")

#used for chapter
ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH1_Treerings//Figures/DBH.growth.avg.v2.png", plot = dbh.components, dpi = 600, width = 5, height = 7, units = "in")

#species
lm.spp.simp <- lm(INCREMENT ~ GenusSpecies, data = growth.50yr.QC.increment.final)
summary(lm.spp.simp)

#genus
lm.genus.simp <- lm(INCREMENT ~ genus, data = growth.50yr.QC.increment.final)
summary(lm.genus.simp)

#genus/species
lm.genus.spp.simp <- lm(INCREMENT ~ genus/GenusSpecies, data = growth.50yr.QC.increment.final)
summary(lm.genus.spp.simp)

#taxonomy
#crashes R don't use
# lm.tax.simp <- lm(INCREMENT ~ subclass/order/family/genus/GenusSpecies, data = growth.50yr.QC.increment.final)
# summary(lm.tax.simp)

#Won't run. R crashes
# lm.phylo.simp <- lm(INCREMENT ~ subclass/order/family/genus/GenusSpecies, data = growth.50yr.QC.increment.final)
# summary(lm.phylo.simp)

#site
lm.site.simp <- lm(INCREMENT ~ as.character(SITE), data = growth.50yr.QC.increment.final)
summary(lm.site.simp)

summary(aov.site <- aov(lm.site.simp))
tukey.site.gr <- TukeyHSD(aov.site, "SITE", ordered = FALSE)
plot(tukey.site.gr)
site.levels.gr <- tukey.site.gr[["SITE"]][,4]
site.labels.gr <- multcompLetters(site.levels.gr)['Letters']
site.plot.labels <- names(site.labels.gr[['Letters']])

site.n <- table(growth.50yr.QC.increment.final$SITE)/50

#Site plot ordered from low to high temperature
site.growth.violin <- ggplot(growth.50yr.QC.increment.final, aes(x = SITE, y = INCREMENT))+
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=16)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(axis.text.x = element_text(size = 12)) +
  theme(legend.text = element_blank()) +
  theme(legend.position = "none") +
  annotate("text", x = .75, y = 5.2, label = site.n[1], size = 3.5) +
  annotate("text", x = 1.75, y = 5.2, label = site.n[2], size = 3.5) +
  annotate("text", x = 2.75, y = 5.2, label = site.n[3], size = 3.5) +
  annotate("text", x = 3.75, y = 5.2, label = site.n[4], size = 3.5) +
  annotate("text", x = 4.75, y = 5.2, label = site.n[5], size = 3.5) +
  # annotate("text", x = 6, y = 14.8, label = site.n[6], size = 3.5) +
  annotate("text", x = 5.75, y = 5.2, label = site.n[7], size = 3.5) +
  annotate("text", x = 6.75, y = 5.2, label = site.n[8], size = 3.5) +
  annotate("text", x = 7.75, y = 5.2, label = site.n[9], size = 3.5) +
  annotate("text", x = 8.75, y = 5.2, label = site.n[10], size = 3.5) +
  #stat_summary(fun.data = give.n, geom= "text", size = 3.5, aes(y= 13)) + 
  stat_summary(fun.y="median", geom="point") +
  ylim(0,5.2) +
  ylab(expression(paste("Ring Width mm yr"^"-1"))) + xlab("Site") +
  scale_x_discrete(labels = c("W","B","H","V","S","M","D","T","F")) +
  scale_fill_manual(values=rev(cbPalette)) +
  annotate("text", x = c(1.1,2.1,3.1,4.1,5.1,6.1,7.25,8.2,9.25), y = c(5, 5, 5, 5, 5, 5, 5, 5, 5), label = c("a","a","e","d","c","b","cde","ce","cde"))

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH1_Treerings/Figures/site.growth.violin.png", plot = site.growth.violin, dpi = 600, width = 7.5, height = 3.5, units = "in")

#temperature
lm.temp.simp <- lm(INCREMENT ~ as.factor(TEMP_C), data = growth.50yr.QC.increment.final)
summary(lm.temp.simp)

lm.temp.num <- lm(INCREMENT ~ TEMP_C, data = growth.50yr.QC.increment.final)
summary(lm.temp.num)

#precipitation
lm.precip.simp <- lm(INCREMENT ~ as.factor(PRECIP), data = growth.50yr.QC.increment.final)
summary(lm.precip.simp)

lm.precip.num <- lm(INCREMENT ~ PRECIP, data = growth.50yr.QC.increment.final)
summary(lm.precip.num)

#PFT * temp interaction
lm.pft.tmp.interact <- lm(INCREMENT ~ PFT*TEMP_C, data = growth.50yr.QC.increment.final)
summary(lm.pft.tmp.interact)

lm.spp.tmp.interact <- lm(INCREMENT ~ SPP*TEMP_C, data = growth.50yr.QC.increment.final)
summary(lm.spp.tmp.interact)

lm.dbh.tmp.interact <- lm(INCREMENT ~ DBH15*TEMP_C,data = growth.50yr.QC.increment.final)
summary(lm.dbh.tmp.interact)

#Multi-variable linear models
#space only, fixed effect for year
lmer.space <- lmer(INCREMENT ~ YEAR + (1|SITE/PLOT/SUB/TAG), data = growth.50yr.QC.increment.final)
summary(lmer.space)

#DBH15 fixed, year and space random
lmer.space.year <- lmer(INCREMENT ~ DBH15 + (1|YEAR) + (1|SITE/PLOT/SUB/TAG), data = growth.50yr.QC.increment.final)
summary(lmer.space.year)

#Phylogeny only
lmer.phylo <- lmer(INCREMENT ~ YEAR + (1|subclass/order/family/genus/GenusSpecies), data = growth.50yr.QC.increment.final)
summary(lmer.phylo)

#size random effect
lmer.size <- lmer(INCREMENT ~ YEAR + (1|DBH14), data = growth.50yr.QC.increment.final)
summary(lmer.size)

lmer.size.space <- lmer(INCREMENT ~ YEAR + (1|DBH14) + (1|SITE/PLOT/SUB/TAG), data = growth.50yr.QC.increment.final)
summary(lmer.size.space)

#year random effect
lmer.year <- lmer(INCREMENT ~ DBH14 + (1|YEAR) + (1|SITE:YEAR) + (1|SITE/PLOT/SUB/TAG), data = growth.50yr.QC.increment.final)
summary(lmer.year)

#quadratic size
lm.pft.size <- lm(INCREMENT ~ PFT + DBH14 +I(DBH14^2), data = growth.50yr.QC.increment.final)
summary(lm.pft.size)

#Crashes R, don't use
# lm.phylo <- lm(INCREMENT ~ family/genus/GenusSpecies, data = growth.50yr.QC.increment.final)
# summary(lm.phylo)

# lm.trait <- lm(INCREMENT ~ WOOD + PFT, data = growth.50yr.QC.increment.final)
# summary(lm.trait)

#space only, size fixed effect, random year effect
lm.space.year <- lmer(INCREMENT ~ DBH14 + (1|YEAR) + (1|SITE/PLOT/SUB/TAG), data = growth.50yr.QC.increment.final)
summary(lm.space.year)

#space, size and canopy fixed, random year
lm.space.year.f <- lmer(INCREMENT ~ DBH14 + CANOPY15 + (1|YEAR) + (1|SITE:YEAR) + (1|SITE/PLOT/SUB/TAG), data = growth.50yr.QC.increment.final)
summary(lm.space.year.f)

lm.space.year.sy <- lmer(INCREMENT ~ DBH14 + CANOPY15 + YEAR + (1|SITE:YEAR) + (1|SITE/PLOT/SUB/TAG), data = growth.50yr.QC.increment.final)
summary(lm.space.year.sy)

#space and regional climate
####highlight this one - reasoning for not using annually resolved met####
lmer.clim <- lmer(INCREMENT ~ YEAR + (1|SITE:YEAR) + (1|SITE/PLOT/SUB/TAG) + (1|TEMP_C) + (1|PRECIP) , data = growth.50yr.QC.increment.final)
summary(lmer.clim)

space.clim.vars <- as.data.frame(VarCorr(lmer.clim, order = "cov.last"))
#calculating partial variances for random effects
var.space.clim.vars = space.clim.vars$vcov/sum(space.clim.vars$vcov)
space.clim.part.vars <- cbind(space.clim.vars$grp,var.space.clim.vars)
#test
sum(as.numeric(space.clim.part.vars[,2]))
#now have proportions of variance explained by each effect
#Environment
#1,2,7
site.clim.partvar <- sum(as.numeric(space.clim.part.vars[1,2]),as.numeric(space.clim.part.vars[2,2]),as.numeric(space.clim.part.vars[7,2])) #sub, plot, site 11.88 %

#space, climate, species, pft, wood, size, canopy position
lmer.all.nointeract <- lmer(INCREMENT ~ YEAR + (1|SITE:YEAR) + (1|SITE/PLOT/SUB/TAG) + (1|TEMP_C) + (1|PRECIP) + (1|GenusSpecies) + (1|PFT) + (1|WOOD) + (1|DBH15) + (1|CANOPY15) , data = growth.50yr.QC.increment.final)
summary(lmer.all.nointeract)

#space, size and canopy
lmer.space.clim.size <- lmer(INCREMENT ~ YEAR + (1|SITE:YEAR) + (1|SITE/PLOT/SUB/TAG) + (1|DBH15) + (1|CANOPY15) , data = growth.50yr.QC.increment.final)
summary(lmer.space.clim.size)

#space, phylogeny, anatomy
lmer.space.anat <- lmer(INCREMENT ~ YEAR + (1|SITE:YEAR) + (1|SITE/PLOT/SUB/TAG) + (1|GenusSpecies) + (1|PFT) + (1|WOOD) , data = growth.50yr.QC.increment.final)
summary(lmer.space.anat)

#space, size, canopy, phylogeny, anatomy
lmer.all.noclim <- lmer(INCREMENT ~ YEAR + (1|SITE:YEAR) + (1|SITE/PLOT/SUB/TAG) + (1|GenusSpecies) + (1|PFT) + (1|WOOD) + (1|DBH15) + (1|CANOPY15) , data = growth.50yr.QC.increment.final)
summary(lmer.all.noclim)

all.noclim.vars <- as.data.frame(VarCorr(lmer.all.noclim, order = "cov.last"))
#calculating partial variances for random effects
var.all.noclim.vars = all.noclim.vars$vcov/sum(all.noclim.vars$vcov)
all.noclim.part.vars <- cbind(all.noclim.vars$grp,var.all.noclim.vars)
#test
sum(as.numeric(all.noclim.part.vars[,2]))
#now have proportions of variance explained by each effect
#Environment
#1,2,7
site.clim.partvar <- sum(as.numeric(space.clim.part.vars[1,2]),as.numeric(space.clim.part.vars[2,2]),as.numeric(space.clim.part.vars[7,2])) #sub, plot, site 11.88 %

#space, climate, and species
lm.clim.spp <- lmer(INCREMENT ~ YEAR + (1|SITE/PLOT/SUB/TAG) + (1|TEMP_C) + (1|PRECIP) + (1|GenusSpecies), data = growth.50yr.QC.increment.final)
summary(lm.clim.spp)

#space and species
lm.spp <- lmer(INCREMENT ~ YEAR + (1|SITE/PLOT/SUB/TAG) +  (1|GenusSpecies), data = growth.50yr.QC.increment.final)
summary(lm.spp)

#space, climate, species, and species:site interaction
lm.clim.spp.int <- lmer(INCREMENT ~ YEAR + (1|SITE/PLOT/SUB/TAG) + (1|TEMP_C) + (1|PRECIP) + (1|GenusSpecies) + (1|GenusSpecies:SITE) , data = growth.50yr.QC.increment.final)
summary(lm.clim.spp.int)

#space, climate, traits, and phylogeny
lm.clim.trait.spp <- lmer(INCREMENT ~ YEAR + (1|SITE/PLOT/SUB/TAG) + (1|TEMP_C) +(1|PRECIP) + (1|GenusSpecies) + (1|GenusSpecies:SITE) + (1|PFT) + (1|WOOD), data = growth.50yr.QC.increment.final)
summary(lm.clim.trait.spp)

#space, climte, traits, DBH and phylogeny
lm.kitchen <- lmer(INCREMENT ~ YEAR + (1|SITE/PLOT/SUB/TAG) + (1|TEMP_C) +(1|PRECIP) + (1|GenusSpecies) + (1|GenusSpecies:SITE) + (1|PFT) + (1|WOOD) + DBH14, data = growth.50yr.QC.increment.final)
summary(lm.kitchen)
#################### last hypothesis ##########################
#Use - shows that the interactions matter
lmer.spp.int <- lmer(INCREMENT ~ YEAR + (1|SITE:YEAR) + (1|SITE/PLOT/SUB/TAG) + (1|GenusSpecies) + (1|GenusSpecies:SITE) + (1|PFT) + (1|PFT:SITE) + (1|DBH15) + (1|CANOPY15) , data = growth.50yr.QC.increment.final)
summary(lmer.spp.int)

spp.int.vars <- as.data.frame(VarCorr(lmer.spp.int, order = "cov.last"))
#calculating partial variances for random effects
var.spp.int.vars = spp.int.vars$vcov/sum(spp.int.vars$vcov)
spp.int.part.vars <- cbind(spp.int.vars$grp,var.spp.int.vars)
#test
sum(as.numeric(spp.int.part.vars[,2]))

#Use first, justification for breaking into temp and precip
lm.pft.site.interact <- lm(INCREMENT ~ PFT*SITE,data = growth.50yr.QC.increment.final)
summary(lm.pft.site.interact)

lm.pft.tmp.interact <- lm(INCREMENT ~ PFT*TEMP_C,data = growth.50yr.QC.increment.final)
summary(lm.pft.tmp.interact)

### regressions that match the plots now ###
early.con <- which(growth.50yr.QC.increment.final$PFT == "Early.Conifer")
late.con <- which(growth.50yr.QC.increment.final$PFT == "Late.Conifer")
early.hard <- which(growth.50yr.QC.increment.final$PFT == "Early.Hardwood")
mid.hard <- which(growth.50yr.QC.increment.final$PFT == "Mid.Hardwood")
late.hard <- which(growth.50yr.QC.increment.final$PFT == "Late.Hardwood")

### Temperature ###
lm.pft.tmp.early.con <- lm(INCREMENT[early.con] ~ TEMP_C[early.con], data = growth.50yr.QC.increment.final)
summary(lm.pft.tmp.early.con)

lm.pft.tmp.late.con <- lm(INCREMENT[late.con] ~ TEMP_C[late.con], data = growth.50yr.QC.increment.final)
summary(lm.pft.tmp.late.con)

lm.pft.tmp.early.hard <- lm(INCREMENT[early.hard] ~ TEMP_C[early.hard], data = growth.50yr.QC.increment.final)
summary(lm.pft.tmp.early.hard)

lm.pft.tmp.mid.hard <- lm(INCREMENT[mid.hard] ~ TEMP_C[mid.hard], data = growth.50yr.QC.increment.final)
summary(lm.pft.tmp.mid.hard)

lm.pft.tmp.late.hard <- lm(INCREMENT[late.hard] ~ TEMP_C[late.hard], data = growth.50yr.QC.increment.final)
summary(lm.pft.tmp.late.hard)

### Precipitation ###
lm.pft.precip.early.con <- lm(INCREMENT[early.con] ~ PRECIP[early.con], data = growth.50yr.QC.increment.final)
summary(lm.pft.precip.early.con)

lm.pft.precip.late.con <- lm(INCREMENT[late.con] ~ PRECIP[late.con], data = growth.50yr.QC.increment.final)
summary(lm.pft.precip.late.con)

lm.pft.precip.early.hard <- lm(INCREMENT[early.hard] ~ PRECIP[early.hard], data = growth.50yr.QC.increment.final)
summary(lm.pft.precip.early.hard)

lm.pft.precip.mid.hard <- lm(INCREMENT[mid.hard] ~ PRECIP[mid.hard], data = growth.50yr.QC.increment.final)
summary(lm.pft.precip.mid.hard)

lm.pft.precip.late.hard <- lm(INCREMENT[late.hard] ~ PRECIP[late.hard], data = growth.50yr.QC.increment.final)
summary(lm.pft.precip.late.hard)

###ggplot graph of each pft
growth.temp.plot <- ggplot(growth.50yr.QC.increment.final, aes(x = TEMP_C, y = INCREMENT)) +
  geom_point(alpha = .1) +
  ylim(0,5.2) +
  ylab(expression(paste("Ring Width mm yr"^"-1"))) + xlab("Temperature (C)") +
  geom_smooth(method = "lm") + facet_wrap(~ PFT)
  theme(axis.title.y = element_text(size = 14)) +
  theme(axis.title.x = element_text(size = 14)) 

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH1_Treerings//Figures/growth.temp.plot.png", plot = growth.temp.plot, dpi = 600, width = 5, height = 3.5, units = "in")

lm.pft.precip.interact <- lm(INCREMENT ~ PFT*PRECIP,data = growth.50yr.QC.increment.final)
summary(lm.pft.precip.interact)

###ggplot graph of each pft and precipitation
growth.precip.plot <- ggplot(growth.50yr.QC.increment.final, aes(x = PRECIP, y = INCREMENT)) +
  ylim(0,5.2) +
  ylab(expression(paste("Ring Width mm yr"^"-1"))) + xlab(expression(paste("Precipitation mm yr"^"-1"))) +
  geom_point(alpha = .1) +
  geom_smooth(method = "lm") + facet_wrap(~ PFT) +
  theme(axis.title.y = element_text(size = 14)) +
  theme(axis.title.x = element_text(size = 14))
  
#temp.precip.components <- grid.arrange(growth.temp.plot, growth.precip.plot, ncol = 1)

#used for chapter
ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH1_Treerings//Figures/growth.precip.plot.png", plot = growth.precip.plot, dpi = 600, width = 5, height = 3.5, units = "in")


###Interactions not signifant for any
lm.spp.site.interact <- lm(INCREMENT ~ GenusSpecies*SITE,data = growth.50yr.QC.increment.final)
summary(lm.spp.site.interact)

lm.spp.temp.interact <- lm(INCREMENT ~ GenusSpecies*TEMP_C,data = growth.50yr.QC.increment.final)
summary(lm.spp.temp.interact)

lm.spp.precip.interact <- lm(INCREMENT ~ GenusSpecies*PRECIP,data = growth.50yr.QC.increment.final)
summary(lm.spp.precip.interact)

#don't use, DBH x site not meaningful
lmer.spp.size.int <- lmer(INCREMENT ~ YEAR + (1|SITE:YEAR) + (1|SITE/PLOT/SUB/TAG) + (1|GenusSpecies) + (1|GenusSpecies:SITE) + (1|PFT) + (1|PFT:SITE) + (1|DBH15) + (1|DBH15:SITE) + (1|CANOPY15) , data = growth.50yr.QC.increment.final)
summary(lmer.spp.size.int)
```



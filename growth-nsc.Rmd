---
title: "growth-nsc"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(ggplot2)
library(zoo)
library(scatterplot3d)
library(multcompView)
library(pwr)
library(plyr)


#helper functions
#function to find last value of vector
last <- function(x) { return( x[length(x)] ) }

#give sample size on scatterplot for ggplot
give.n <- function(x){
  return(c(y = mean(x), label = length(x)))
}

#color-blind-friendly palettes
cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

####make datatable with combined growth-NSC data####
#read NSC data
NSC_data <- read.csv(file = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Data/nsc.adult.total.mass.alive.common.csv")

Treering_data <- read.csv("/Users/josh/Dropbox/Dissertation/CH3_Growth_NSC/treering_growth_forgrowthnsc_qc.csv")

colnames(Treering_data)[70] <- "Core_ID14"

#dataset of trees cored for NSC and analyzed for growth with tree rings
growth_nsc_data <- merge(NSC_data, Treering_data, by = "Core_ID14")
```

```{r}
move.avg.growth <- rollapply(growth_nsc_data[,267:287], width = 10, by.column = TRUE, FUN = mean, align = "left")

#include mean growth windows
growth.2014.2010 <- growth_nsc_data[,283:287]
mean.2014.2010 <- rowMeans(growth.2014.2010)
growth_nsc_data.1 <- cbind(growth_nsc_data, mean.2014.2010)
#2014-2010
plot(mean.2014.2010, growth_nsc_data$total.nsc)
summary(lm(mean.2014.2010 ~ growth_nsc_data$total.nsc))

growth.2013.2009 <- growth_nsc_data[,282:286]
mean.2013.2009 <- rowMeans(growth.2013.2009)
growth_nsc_data.2 <- cbind(growth_nsc_data, mean.2013.2009)
#2013-2009
plot(mean.2013.2009, growth_nsc_data$total.nsc)
summary(lm(mean.2013.2009 ~ growth_nsc_data$total.nsc))

growth.2012.2008 <- growth_nsc_data[,281:285]
mean.2012.2008 <- rowMeans(growth.2012.2008)
growth_nsc_data.3 <- cbind(growth_nsc_data, mean.2012.2008)
#2013-2009
plot(mean.2012.2008, growth_nsc_data$total.nsc)
summary(lm(mean.2012.2008 ~ growth_nsc_data$total.nsc))

####data window used for growth of rest of analysis####
growth.2010.2001 <- growth_nsc_data[,274:283]
mean.2010.2001 <- rowMeans(growth.2010.2001)
growth_nsc_data.10yr <- cbind(growth_nsc_data, mean.2010.2001)
#2010-2001
plot(growth_nsc_data.10yr$mean.2010.2001, growth_nsc_data.10yr$total.nsc)

#growth NSC relationship alone
lm.growth.nsc <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr)
anova(lm.growth.nsc)
summary(lm.growth.nsc) #significant but very weak alone

#set factor levels for PFT
growth_nsc_data.10yr$PFT.y <- factor(growth_nsc_data.10yr$PFT.y, 
                              levels = c("Early.Hardwood","Early.Conifer","Mid.Hardwood","Late.Hardwood","Late.Conifer"), ordered = FALSE)


#PFT lm
pft.int.lm <- lm(total.nsc ~ mean.2010.2001 + mean.2010.2001*PFT.y, data = growth_nsc_data.10yr)
plot(pft.int.lm)
anova(pft.int.lm)
summary(pft.int.lm) #significant, very predictive R^2 = .45

#Wood type categories: Hardwood, Conifer
growth_nsc_data.10yr$PFT.y <- as.character(growth_nsc_data.10yr$PFT.y)

  hardwood <- which(growth_nsc_data.10yr$PFT.y == "Early.Hardwood")
  hardwood2 <- which(growth_nsc_data.10yr$PFT.y == "Mid.Hardwood")
  hardwood3 <- which(growth_nsc_data.10yr$PFT.y == "Late.Hardwood")
                      
  conifer <- which(growth_nsc_data.10yr$PFT.y == "Early.Conifer")
  conifer2 <- which(growth_nsc_data.10yr$PFT.y == "Late.Conifer")
  
  growth_nsc_data.10yr$woodgroup <- NA
  growth_nsc_data.10yr$woodgroup[hardwood] <- "Hardwood"
  growth_nsc_data.10yr$woodgroup[hardwood2] <- "Hardwood"
  growth_nsc_data.10yr$woodgroup[hardwood3] <- "Hardwood"
  growth_nsc_data.10yr$woodgroup[conifer] <- "Conifer"
  growth_nsc_data.10yr$woodgroup[conifer2] <- "Conifer"
  
    #Hardwood as reference
growth_nsc_data.10yr$woodgroup <- factor(growth_nsc_data.10yr$woodgroup, 
                                    levels = c("Hardwood","Conifer"),
                                    ordered = FALSE)

  #Set succession
  growth_nsc_data.10yr$succession <- NA
  growth_nsc_data.10yr$succession[hardwood] <- "Early"
  growth_nsc_data.10yr$succession[conifer] <- "Early"
  growth_nsc_data.10yr$succession[hardwood2] <- "Mid"
  growth_nsc_data.10yr$succession[hardwood3] <- "Late"
  growth_nsc_data.10yr$succession[conifer2] <- "Late"
  
  #Early as reference
growth_nsc_data.10yr$succession <- factor(growth_nsc_data.10yr$succession, 
                            levels = c("Early","Mid","Late"),
                            ordered = FALSE)

#create dataframe from labeling the outlier on mid hardwood
ann.txt <- data.frame(mean.2010.2001 = 5.9, total.nsc = 72, lab = "*",
                      succession = factor("Mid", levels = c("Early","Mid","Late")))


#PFT differences
growth.nsc.pft.plot <- ggplot(growth_nsc_data.10yr, aes(x = mean.2010.2001, y = total.nsc)) +
  geom_point(alpha = .1) +
  coord_cartesian(ylim = c(0,150), xlim = c(0,6.1)) +
  #ylim(0,150) +
  #xlim(0,6.1) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab(expression(paste("2010-2001 Mean Ring Width mm yr"^"-1"))) +
  geom_smooth(method = "lm") + facet_grid(woodgroup ~ succession) +
  theme(axis.title.y = element_text(size = 10)) +
  geom_text(data = ann.txt, label = "*") +
  theme(axis.title.x = element_text(size = 10))
  
ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH3_Growth_NSC/Growth_NSC_PFT.png", plot = growth.nsc.pft.plot, dpi = 600, width = 5, height = 3.5, units = "in")


#Full model with three-way interaction
pft.full.lm <- lm(total.nsc ~ mean.2010.2001 + succession + woodgroup + woodgroup*succession + mean.2010.2001*woodgroup + mean.2010.2001*succession + mean.2010.2001*woodgroup*succession, data = growth_nsc_data.10yr)
plot(pft.full.lm)
anova(pft.full.lm)
summary(pft.full.lm)
#None of the 3-way interactions were significant

#Full model with three-way interaction controlling for
#canopy position and DBH
pft.full.part.cont.lm <- lm(total.nsc ~ mean.2010.2001 + succession + woodgroup +   woodgroup*succession + mean.2010.2001*woodgroup + mean.2010.2001*succession + mean.2010.2001*woodgroup*succession + DBH14.x + CANOPY15, data = growth_nsc_data.10yr)
plot(pft.full.part.cont.lm)
anov.full <- anova(pft.full.part.cont.lm)
summary(pft.full.part.cont.lm)

#variances
full.ss <- anov.full$`Sum Sq`/sum(anov.full$`Sum Sq`)
part.vars <- cbind(rownames(anov.full), anov.full$Df, anov.full$`F value`, anov.full$`Pr(>F)`, full.ss)

#Full model with three-way interaction and controlling for
#canopy position, DBH, and site
pft.full.cont.lm <- lm(total.nsc ~ mean.2010.2001 + succession + woodgroup + woodgroup*succession + mean.2010.2001*woodgroup + mean.2010.2001*succession + mean.2010.2001*woodgroup*succession + DBH14.x + CANOPY15 + Site + mean.2010.2001*Site + PFT.y*Site, data = growth_nsc_data.10yr)
plot(pft.full.cont.lm)
anova(pft.full.cont.lm)
summary(pft.full.cont.lm)
  
growth.nsc.spp.plot <- ggplot(growth_nsc_data.10yr, aes(x = mean.2010.2001, y = total.nsc)) +
  geom_point(alpha = .1) +
  ylim(0,125) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab(expression(paste("2010-2001 Mean Ring Width mm yr"^"-1"))) +
  geom_smooth(method = "lm") + facet_wrap(~ GenusSpecies.x) + #,scales = "free"
  theme(axis.title.y = element_text(size = 10)) +
  theme(axis.title.x = element_text(size = 10)) +
  theme(strip.text.x = element_text(size=7))
  
  ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH3_Growth_NSC/Growth_NSC_Spp.png", plot = growth.nsc.spp.plot, dpi = 600, width = 7, height = 9, units = "in")
  
  #nsc-growth relationship with species
  growth.nsc.spp.lm <- lm(total.nsc ~ mean.2010.2001*GenusSpecies.x, data = growth_nsc_data.10yr)
  plot(growth.nsc.spp.lm)
  anova.spp <- anova(growth.nsc.spp.lm)
  summary(growth.nsc.spp.lm)
  
  #species variances
  spp.ss <- anova.spp$`Sum Sq`/sum(anova.spp$`Sum Sq`)
spp.part.vars <- cbind(rownames(anova.spp), anova.spp$Df, anova.spp$`F value`, anova.spp$`Pr(>F)`, spp.ss)
  
  #### nsc-growth relationships by species
  #### noting significant +, -, 0 because meaningful, 0 because low power
  abba <- which(growth_nsc_data.10yr$GenusSpecies.x == "Abies balsamea")
  lm.abba <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[abba,])
  summary(lm.abba) #marginal
  
  acru <- which(growth_nsc_data.10yr$GenusSpecies.x == "Acer rubrum")
  lm.acru <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[acru,])
  summary(lm.acru)   #significant
  
  # #correct slope for mean growth rate
  #   acru.dat <- growth_nsc_data.10yr[acru,]
  #   acru.mean.correct <- acru.dat$mean.2010.2001 - mean(acru.dat$mean.2010.2001,na.rm = TRUE)
  #   acru.dat$mean.2010.2001.corrected <-NA
  #   acru.dat$mean.2010.2001.corrected <- acru.mean.correct
  #   plot(acru.dat$mean.2010.2001.corrected, acru.dat$total.nsc)
  #   acru.correct.lm <- lm(total.nsc ~ mean.2010.2001.corrected, dat = acru.dat)
  #   summary(acru.correct.lm)
  
  acsa <- which(growth_nsc_data.10yr$GenusSpecies.x == "Acer saccharum")
  lm.acsa <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[acsa,])
  summary(lm.acsa) #marginal
  
  beal <- which(growth_nsc_data.10yr$GenusSpecies.x == "Betula alleghaniensis")
  lm.beal <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[beal,])
  summary(lm.beal)
  
  bele <- which(growth_nsc_data.10yr$GenusSpecies.x == "Betula lenta")
  lm.bele <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[bele,])
  summary(lm.bele)   #significant
  
  bepa <- which(growth_nsc_data.10yr$GenusSpecies.x == "Betula papyrifera")
  lm.bepa <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[bepa,])
  summary(lm.bepa)
  
  cagl <- which(growth_nsc_data.10yr$GenusSpecies.x == "Carya glabra")
  lm.cagl <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[cagl,])
  summary(lm.cagl)
  
  cato <- which(growth_nsc_data.10yr$GenusSpecies.x == "Carya tomentosa")
  lm.cato <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[cato,])
  summary(lm.cato)
  
  fagr <- which(growth_nsc_data.10yr$GenusSpecies.x == "Fagus grandifolia")
  lm.fagr <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[fagr,])
  summary(lm.fagr)   #significant
  
  fram <- which(growth_nsc_data.10yr$GenusSpecies.x == "Fraxinus americana")
  lm.fram <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[fram,])
  summary(lm.fram)   #significant
  
  frni <- which(growth_nsc_data.10yr$GenusSpecies.x == "Fraxinus nigra")
  lm.frni <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[frni,])
  summary(lm.frni)
  
  juvi <- which(growth_nsc_data.10yr$GenusSpecies.x == "Juniperus virginiana")
  lm.juvi <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[juvi,])
  summary(lm.juvi)
  
    litu <- which(growth_nsc_data.10yr$GenusSpecies.x == "Liriodendron tulipifera")
  lm.litu <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[litu,])
  summary(lm.litu)
  
  mavi <- which(growth_nsc_data.10yr$GenusSpecies.x == "Magnolia virginiana")
  lm.mavi <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[mavi,])
  summary(lm.mavi)
  
  ##need to remove, only 2 points##
  nysy <- which(growth_nsc_data.10yr$GenusSpecies.x == "Nyssa sylvatica")
  lm.nysy <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[nysy,])
  summary(lm.nysy)
  
  oxar <- which(growth_nsc_data.10yr$GenusSpecies.x == "Oxydendrum arboreum")
  lm.oxar <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[oxar,])
  summary(lm.oxar)
  
  pima <- which(growth_nsc_data.10yr$GenusSpecies.x == "Picea mariana")
  lm.pima <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[pima,])
  summary(lm.pima)
  
  piru <- which(growth_nsc_data.10yr$GenusSpecies.x == "Picea rubens")
  lm.piru <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[piru,])
  summary(lm.piru)
  
  pipa <- which(growth_nsc_data.10yr$GenusSpecies.x == "Pinus palustris")
  lm.pipa <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[pipa,])
  summary(lm.pipa)
  
  pist <- which(growth_nsc_data.10yr$GenusSpecies.x == "Pinus strobus")
  lm.pist <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[pist,])
  summary(lm.pist)   #significant
  
  pita <- which(growth_nsc_data.10yr$GenusSpecies.x == "Pinus taeda")
  lm.pita <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[pita,])
  summary(lm.pita)
  
  pogr <- which(growth_nsc_data.10yr$GenusSpecies.x == "Populus grandidentata")
  lm.pogr <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[pogr,])
  summary(lm.pogr)
  
  potr <- which(growth_nsc_data.10yr$GenusSpecies.x == "Populus tremuloides")
  lm.potr <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[potr,])
  summary(lm.potr)   #significant
  
  prse <- which(growth_nsc_data.10yr$GenusSpecies.x == "Prunus serotina")
  lm.prse <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[prse,])
  summary(lm.prse)
  
  qual <- which(growth_nsc_data.10yr$GenusSpecies.x == "Quercus alba")
  lm.qual <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[qual,])
  summary(lm.qual)   #significant
  
  qula <- which(growth_nsc_data.10yr$GenusSpecies.x == "Quercus laevis")
  lm.qula <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[qula,])
  summary(lm.qula)
  
  qulau <- which(growth_nsc_data.10yr$GenusSpecies.x == "Quercus laurifolia")
  lm.qulau <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[qulau,])
  summary(lm.qulau)
  
    qumo <- which(growth_nsc_data.10yr$GenusSpecies.x == "Quercus montana")
  lm.qumo <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[qumo,])
  summary(lm.qumo)
  
 qumu <- which(growth_nsc_data.10yr$GenusSpecies.x == "Quercus muehlenbergii")
  lm.qumu <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[qumu,])
  summary(lm.qumu)
  
   quni <- which(growth_nsc_data.10yr$GenusSpecies.x == "Quercus nigra")
  lm.quni <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[quni,])
  summary(lm.quni)
  
  quru <- which(growth_nsc_data.10yr$GenusSpecies.x == "Quercus rubra")
  lm.quru <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[quru,])
  summary(lm.quru)   #significant
  
  quve <- which(growth_nsc_data.10yr$GenusSpecies.x == "Quercus velutina")
  lm.quve <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[quve,])
  summary(lm.quve)  #marginal
  
  saal <- which(growth_nsc_data.10yr$GenusSpecies.x == "Sassafras albidum")
  lm.saal <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[saal,])
  summary(lm.saal) 
  
  thoc <- which(growth_nsc_data.10yr$GenusSpecies.x == "Thuja occidentalis")
  lm.thoc <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[thoc,])
  summary(lm.thoc) #significant
  
  tsca <- which(growth_nsc_data.10yr$GenusSpecies.x == "Tsuga canadensis")
  lm.tsca <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[tsca,])
  summary(lm.tsca) #significant
  
  ulam <- which(growth_nsc_data.10yr$GenusSpecies.x == "Ulmus americana")
  lm.ulam <- lm(total.nsc ~ mean.2010.2001, data = growth_nsc_data.10yr[ulam,])
  summary(lm.ulam) 
  
  #9 significant and 3 marginal species relationships
  #power analysis to determine why not significant
  #pwr.r.test(n = , r = , sig.level = , power = )
  #average r
  mean(0.1238,0.172,0.1127,0.2262,0.1233,0.106,0.2648,0.4815,0.02989)
  #0.1238
  
  pwr.f2.test(u = 1, v = 104, f = (.03/.97), sig.level = .05)
  
  pwr.r.test(r = 0.12, sig.level = 0.05, power = 0.9)

n = 3:300
pow = rep(NA,length(n))
for(i in n){
  pow[i-2] <- pwr.f2.test(1,i-2,(.10/.9),0.05)$power
}
thres.fig <- plot(n,pow,type = "l", lty = 2,col=2, ylab = "Power", xlab = "sample size", las = 1)
abline(h=0.9)
thresh=n[which(pow>0.9)[1]]
abline(v=thresh)
thresh

dev.copy(png,'/Users/josh/Dropbox/Dissertation/CH3_Growth_NSC/threshold.png')
dev.off()

####Spp plot for only significant species - to be included in Chapter. Larger Figure in Appendix
  #spp to include
  sig.spp.dat <- rbind(growth_nsc_data.10yr[acru,],
                       growth_nsc_data.10yr[acsa,],
                       growth_nsc_data.10yr[bele,],
                       growth_nsc_data.10yr[fagr,],
                       growth_nsc_data.10yr[fram,],
                       growth_nsc_data.10yr[pist,],
                       growth_nsc_data.10yr[potr,],
                       growth_nsc_data.10yr[potr,],
                       growth_nsc_data.10yr[qual,],
                       growth_nsc_data.10yr[quru,],
                       growth_nsc_data.10yr[thoc,],
                       growth_nsc_data.10yr[tsca,])
  
  sig.spp.dat.ordered <- sig.spp.dat
  sig.spp.dat.ordered$GenusSpecies.x <- factor(sig.spp.dat.ordered$GenusSpecies.x, levels = c("Thuja occidentalis", "Quercus alba","Quercus rubra", "Betula lenta", "Populus tremuloides","Pinus strobus","Acer saccharum", "Acer rubrum", "Tsuga canadensis", "Fraxinus americana", "Fagus grandifolia"))
  
  #make data frame to denote acsa is not significant
  ann.spp.txt <- data.frame(mean.2010.2001 = 4.5, total.nsc = 125, lab = "ns",
                      GenusSpecies.x = factor("Acer saccharum", levels = c("Thuja occidentalis", "Quercus alba","Quercus rubra", "Betula lenta", "Populus tremuloides","Pinus strobus","Acer saccharum", "Acer rubrum", "Tsuga canadensis", "Fraxinus americana", "Fagus grandifolia")))

#not working  
 library("nlme")
coef(lmList(total.nsc ~ mean.2010.2001|GenusSpecies.x , data = sig.spp.dat.ordered)) 
  
#trying to figure out why graph doesn't match lm
  fagr2 <- which(sig.spp.dat.ordered$GenusSpecies.x == "Fagus grandifolia")
  lm.fagr2 <- lm(total.nsc ~ mean.2010.2001, data = sig.spp.dat.ordered[fagr2,])
  summary(lm.fagr2)   #significant
  
  fram2 <- which(sig.spp.dat.ordered$GenusSpecies.x == "Fraxinus americana")
  lm.fram2 <- lm(total.nsc ~ mean.2010.2001, data = sig.spp.dat.ordered[fram2,])
  summary(lm.fram2)   #significant
  
 growth.nsc.sig.spp.plot <- ggplot(sig.spp.dat.ordered, aes(x = mean.2010.2001, y = total.nsc)) +
  geom_point(alpha = .1) +
  coord_cartesian(ylim = c(0,150), xlim = c(0,5)) +
  # ylim(0,150) +
  # xlim(0,5.3) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab(expression(paste("2010-2001 Mean Ring Width mm yr"^"-1"))) +
  geom_smooth(method = "lm", na.rm = FALSE) + facet_wrap(~ GenusSpecies.x) +#,scales = "free"
  theme(axis.title.y = element_text(size = 10)) +
  theme(axis.title.x = element_text(size = 10)) +
  geom_text(data = ann.spp.txt, label = "ns") +
  theme(strip.text.x = element_text(size=8))
  
  ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH3_Growth_NSC/Growth_NSC_Spp.Sig.png", plot = growth.nsc.sig.spp.plot, dpi = 600, width = 5, height = 5, units = "in")
  

  #rename and relevel canopy factors  
growth_nsc_data.10yr$CANOPY15[growth_nsc_data.10yr$CANOPY15 == "0"] <- "Understory"
growth_nsc_data.10yr$CANOPY15[growth_nsc_data.10yr$CANOPY15 == "1"] <- "CoDominant"
growth_nsc_data.10yr$CANOPY15[growth_nsc_data.10yr$CANOPY15 == "2"] <- "Dominant"
#growth_nsc_data.10yr$CANOPY15[is.na(growth_nsc_data.10yr$CANOPY15)] <- "CoDominant"

  growth_nsc_data.10yr$CANOPY15 <- factor(growth_nsc_data.10yr$CANOPY15, levels = c("Understory","CoDominant","Dominant"), ordered = FALSE)

  #Canopy lm
  canopy.lm <- lm(total.nsc ~ mean.2010.2001 + mean.2010.2001*CANOPY15, data = growth_nsc_data.10yr)
  anova.can <- anova(canopy.lm)
  summary(canopy.lm)
  
  # Canopy variances
can.ss <- anova.can$`Sum Sq`/sum(anova.can$`Sum Sq`)
can.part.vars <- cbind(rownames(anova.can), anova.can$Df, anova.can$`F value`, anova.can$`Pr(>F)`, can.ss)
  
  #lm for each canopy position
  under <- which(growth_nsc_data.10yr$CANOPY15 == "Understory")
  lm.under <- lm(total.nsc ~ mean.2010.2001, 
                data = growth_nsc_data.10yr[under,])
  summary(lm.under)   #not significant
  
  codominant <- which(growth_nsc_data.10yr$CANOPY15 == "CoDominant")
  lm.codominant <- lm(total.nsc ~ mean.2010.2001, 
                data = growth_nsc_data.10yr[codominant,])
  summary(lm.codominant)   #significant
  
  dom <- which(growth_nsc_data.10yr$CANOPY15 == "Dominant")
  lm.dom <- lm(total.nsc ~ mean.2010.2001, 
                data = growth_nsc_data.10yr[dom,])
  summary(lm.dom) #not significant
  
  #Canopy Plot
  growth.nsc.canopy.plot <- ggplot(growth_nsc_data.10yr, aes(x = mean.2010.2001, y = total.nsc)) +
  geom_point(alpha = .1) +
  coord_cartesian(xlim = c(0,6)) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + 
  xlab(expression(paste("2010-2001 Mean Ring Width mm yr"^"-1"))) +
  geom_smooth(method = "lm") + 
  facet_wrap(~ CANOPY15) +
  theme(axis.title.y = element_text(size = 12)) +
  theme(axis.title.x = element_text(size = 12))
  
  ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH3_Growth_NSC/Growth_NSC_Canopy.png", plot = growth.nsc.canopy.plot, dpi = 600, width = 6, height = 3, units = "in")
  
  ###Subset data for only co-dominant canopy position trees
  ###to tease out effects
  #co.dom <- which(growth_nsc_data.10yr$CANOPY15 == "Co-Dominant")
  co.dom.dat <- growth_nsc_data.10yr[codominant,]
  
  #controlling for DBH, only looking within codominant trees
  co.dom.full.lm <- lm(total.nsc ~ mean.2010.2001 + succession + woodgroup + woodgroup*succession + mean.2010.2001*woodgroup + mean.2010.2001*succession + mean.2010.2001*woodgroup*succession + DBH14.x, data = co.dom.dat)
co.dom.anova <- anova(co.dom.full.lm)
summary(co.dom.full.lm)

  #codominant variances
co.dom.ss <- co.dom.anova$`Sum Sq`/sum(co.dom.anova$`Sum Sq`)
co.dom.part.vars <- cbind(rownames(co.dom.anova), co.dom.anova$Df, co.dom.anova$`F value`, co.dom.anova$`Pr(>F)`, co.dom.ss)

  #still controlling for DBH and Site
  co.dom.full.lm2 <- lm(total.nsc ~ mean.2010.2001 + succession + woodgroup + woodgroup*succession + mean.2010.2001*woodgroup + mean.2010.2001*succession + mean.2010.2001*woodgroup*succession + DBH14.x + Site + mean.2010.2001*Site, data = co.dom.dat)
anova(co.dom.full.lm2)
summary(co.dom.full.lm2) ##All of the same terms as the full data set are significant
  
  #Site Differences
  #organizing by temperature as with other chapters
  growth_nsc_data.10yr$SITE <- factor(growth_nsc_data.10yr$SITE, levels = c("W","B","H","V","S","M","D","T","F"), ordered = TRUE)
  
  #Remove Duke because only 2 growth-nsc relationships
  w <- which(growth_nsc_data.10yr$Site == "W")
  b <- which(growth_nsc_data.10yr$Site == "B")
  h <- which(growth_nsc_data.10yr$Site == "H")
  v <- which(growth_nsc_data.10yr$Site == "V")
  s <- which(growth_nsc_data.10yr$Site == "S")
  m <- which(growth_nsc_data.10yr$Site == "M")
  t <- which(growth_nsc_data.10yr$Site == "T")
  f <- which(growth_nsc_data.10yr$Site == "F")
  
  #new dataframe for use with site analysis and full model
  full.site.dat <-rbind(growth_nsc_data.10yr[w,],
                       growth_nsc_data.10yr[b,],
                       growth_nsc_data.10yr[h,],
                       growth_nsc_data.10yr[v,],
                       growth_nsc_data.10yr[s,],
                       growth_nsc_data.10yr[m,],
                       growth_nsc_data.10yr[t,],
                       growth_nsc_data.10yr[f,])
  
  
  #site lm
  #smithsonian as reference group
      full.site.dat$Site <- factor(full.site.dat$SITE, levels = c("S","W","B","V","S","M","F","H"), ordered = FALSE)
  site.lm <- lm(total.nsc ~ mean.2010.2001 + Site*mean.2010.2001, data = full.site.dat)
  anova.site <- anova(site.lm)
  summary(site.lm)
  
  #Site lm with temp and precip explicit
  site.t.p.lm <- lm(total.nsc ~ mean.2010.2001 + TEMP_C*mean.2010.2001 + PRECIP*mean.2010.2001 + Site*mean.2010.2001, data = full.site.dat) #Site*mean.2010.2001 +
  anova(site.t.p.lm)
  summary(site.t.p.lm)
  
  #site variances
site.ss <- anova.site$`Sum Sq`/sum(anova.site$`Sum Sq`)
site.part.vars <- cbind(rownames(anova.site), anova.site$Df, anova.site$`F value`, anova.site$`Pr(>F)`, site.ss)

  #W site lm
  w.dat <- growth_nsc_data.10yr[w,]
  w.lm <- lm(total.nsc ~ mean.2010.2001, data = w.dat)
  anova(w.lm)
  summary(w.lm)
  
  #Bartlett Site lm
  b.dat <- growth_nsc_data.10yr[b,]
  b.lm <- lm(total.nsc ~ mean.2010.2001, data = b.dat)
  anova(b.lm)
  summary(b.lm)
  
  #Harvard Site lm
  h.dat <- growth_nsc_data.10yr[h,]
  site.h.lm <- lm(total.nsc ~ mean.2010.2001, data = h.dat)
  plot(site.h.lm)
  anova(site.h.lm)
  summary(site.h.lm)
  
  #vro site lm
  v.dat <- growth_nsc_data.10yr[v,]
  site.v.lm <- lm(total.nsc ~ mean.2010.2001, data = v.dat)
  #plot(site.v.lm)
  anova(site.v.lm)
  summary(site.v.lm)
  
  #smithsonian site lm
  s.dat <- growth_nsc_data.10yr[s,]
  site.s.lm <- lm(total.nsc ~ mean.2010.2001, data = s.dat)
  #plot(site.s.lm)
  anova(site.s.lm)
  summary(site.s.lm)
  
  #MO Site lm
  mo.dat <- growth_nsc_data.10yr[m,]
  site.mo.lm <- lm(total.nsc ~ mean.2010.2001, data = mo.dat)
  #plot(site.mo.lm)
  anova(site.mo.lm)
  summary(site.mo.lm)
  
  #Walker branch Site lm
  t.dat <- growth_nsc_data.10yr[t,]
  site.t.lm <- lm(total.nsc ~ mean.2010.2001, data = t.dat)
  #plot(site.t.lm)
  anova(site.t.lm)
  summary(site.t.lm)
  
  #Ordway Site lm
  f.dat <- growth_nsc_data.10yr[f,]
  site.f.lm <- lm(total.nsc ~ mean.2010.2001, data = f.dat)
  #plot(site.f.lm)
  anova(site.f.lm)
  summary(site.f.lm)

  #Site & Site x PFT lm
  site.pft.lm <- lm(total.nsc ~ mean.2010.2001 + Site*mean.2010.2001 + PFT.y*Site, data = full.site.dat)
  anova(site.pft.lm)
  summary(site.pft.lm)
  
  #ordering Site by temperature
    full.site.dat$Site <- factor(full.site.dat$SITE, levels = c("W","B","H","V","S","M","T","F"), ordered = FALSE)
    
  #ordering Site by precipitation
      full.site.dat$Site <- factor(full.site.dat$SITE, levels = c("W","M","H","S","B","V","F","T"), ordered = FALSE)
    
  growth.nsc.site.plot <- ggplot(full.site.dat, aes(x = mean.2010.2001, y = total.nsc)) +
    geom_point(alpha = .1) +
    coord_cartesian(xlim = c(0,6), ylim = c(0,150)) +
    ylab(expression(paste("Total NSC mg g"^"-1"))) + 
    xlab(expression(paste("2010-2001 Mean Ring Width mm yr"^"-1"))) +
    geom_smooth(method = "lm") + facet_wrap(~ Site) +
    theme(axis.title.y = element_text(size = 12)) +
    theme(axis.title.x = element_text(size = 12))
  
  ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH3_Growth_NSC/Growth_NSC_Site_plot.png", plot = growth.nsc.site.plot, dpi = 600, width = 5, height = 5, units = "in")
  
  #3d scatterplot with DBH
  scatterplot3d(x = growth_nsc_data.10yr$mean.2010.2001, y = growth_nsc_data.10yr$total.nsc, z = growth_nsc_data.10yr$DBH14.x, pch = ".")
  
  hist(growth_nsc_data.10yr$DBH15.x,breaks=35)

  #DBH indicator variables for bins of small, medium, large trees
  #roughly balanced - report numbers
  small.dbh <- which(growth_nsc_data.10yr$DBH15.x <= 20)
  med.dbh <- which(growth_nsc_data.10yr$DBH15.x > 20 & growth_nsc_data.10yr$DBH15.x <= 30)
  large.dbh <- which(growth_nsc_data.10yr$DBH15.x > 30)
  DBH.s <- mean(growth_nsc_data.10yr$DBH15.x[small.dbh],na.rm = TRUE)
  DBH.m <- mean(growth_nsc_data.10yr$DBH15.x[med.dbh],na.rm = TRUE)
  DBH.l <- mean(growth_nsc_data.10yr$DBH15.x[large.dbh],na.rm = TRUE)
  
  growth_nsc_data.10yr$dbh.group <- NA
  growth_nsc_data.10yr$dbh.group[small.dbh] <- "small"
  growth_nsc_data.10yr$dbh.group[med.dbh] <- "medium"
  growth_nsc_data.10yr$dbh.group[large.dbh] <- "large"
  
  growth.nsc.dbh.group.plot <- ggplot(growth_nsc_data.10yr[!is.na(growth_nsc_data.10yr$dbh.group),], aes(x = mean.2010.2001, y = total.nsc), na.rm = TRUE) +
  geom_point(alpha = .1) +
  ylim(0,125) +
  #xlim(0,6) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab(expression(paste("2010-2001 Mean Ring Width mm yr"^"-1"))) +
  geom_smooth(method = "lm") + facet_wrap(~ dbh.group)
  theme(axis.title.y = element_text(size = 12)) +
  theme(axis.title.x = element_text(size = 12))
  
    ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH3_Growth_NSC/Growth_NSC_DBH.png", plot = growth.nsc.dbh.group.plot, dpi = 600, width = 6, height = 3.5, units = "in")
    
    #DBH lm
    dbh.lm <- lm(total.nsc ~ mean.2010.2001 + mean.2010.2001*DBH14.y, data = growth_nsc_data.10yr)
    plot(dbh.lm)
    anova.dbh <- anova(dbh.lm)
    summary(dbh.lm)
    
    # DBH variances
dbh.ss <- anova.dbh$`Sum Sq`/sum(anova.dbh$`Sum Sq`)
dbh.part.vars <- cbind(rownames(anova.dbh), anova.dbh$Df, anova.dbh$`F value`, anova.dbh$`Pr(>F)`, dbh.ss)
    
    pred.lo.dbh <- data.frame(mean.2010.2001 = seq(0,6,length=30),DBH14.y = DBH.s)
    p.lo <- predict(dbh.lm,newdata=pred.lo.dbh)
    pred.med.dbh <- data.frame(mean.2010.2001 = seq(0,6,length=30),DBH14.y = DBH.m)
    p.med <- predict(dbh.lm,newdata=pred.med.dbh)
    pred.hi.dbh <- data.frame(mean.2010.2001 = seq(0,6,length=30),DBH14.y = DBH.l)
    p.hi <- predict(dbh.lm,newdata=pred.hi.dbh)
    plot(total.nsc ~ mean.2010.2001 , data = growth_nsc_data.10yr)
    lines(pred.lo.dbh$mean.2010.2001,p.lo,col=2)
    lines(pred.med.dbh$mean.2010.2001,p.med,col=3)          
    lines(pred.hi.dbh$mean.2010.2001,p.hi,col=4)
    
    #dataframe for geom_line() small, med, large DBH
    pred.lo.dat <- cbind(pred.lo.dbh, p.lo)
    names(pred.lo.dat)[names(pred.lo.dat) == "p.lo"] <- "total.nsc" 
    
    pred.med.dat <- cbind(pred.med.dbh, p.med)
    names(pred.med.dat)[names(pred.med.dat) == "p.med"] <- "total.nsc"
    
    pred.hi.dat <- cbind(pred.hi.dbh, p.hi)
    names(pred.hi.dat)[names(pred.hi.dat) == "p.hi"] <- "total.nsc"
    
    #DBH binned lm with interaction included
    #not correct, not binning for analysis, only visualization
    # dbh.bin.int.lm <- lm(total.nsc ~ mean.2010.2001 + dbh.group + mean.2010.2001*dbh.group, data = growth_nsc_data.10yr)
    # anova(dbh.bin.int.lm)
    # summary(dbh.bin.int.lm)
    #predict(dbh.bin.int.lm)
    
    #plot of different intercepts for DBH categories
    #doesn't include 1 point with ring width around 8
    #need to get point and either put on graph and/or in legend
    dbh.int.ggplot <- ggplot(data=growth_nsc_data.10yr, mapping = aes(x = mean.2010.2001, y = total.nsc, color = dbh.group)) + 
      geom_point() + 
      xlim(0,6) + 
      scale_color_manual(values=cbPalette) + 
      geom_line(data = pred.lo.dat, col = "#56B4E9") +
      geom_line(data = pred.med.dat, col = "#E69F00") +
      geom_line(data = pred.hi.dat, col = "#999999") +
      ylab(expression(paste("Total NSC mg g"^"-1"))) +
       annotate("text", x = 6, y = 72, label = "*") +
      xlab(expression(paste("2010-2001 Mean Ring Width mm yr"^"-1"))) +
      labs(color = "DBH")
 
        ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH3_Growth_NSC/Growth_DBH_int.png", plot = dbh.int.ggplot, dpi = 600, width = 5, height = 3.5, units = "in")   

  
```
## Including Plots

```{r}
###Mortality Analysis
mort.dat <- read.csv(file = "/Users/josh/Dropbox/Dissertation/CH3_Growth_NSC/nsc.mortality.data.csv")

###These cores are only Alive or Stressed, need to use
###NSC_Analysis.Rmd for Mortality analysis
mort.dat$Mortality14 <- factor(mort.dat$Mortality14, 
                                    levels = c("A","IBS","D"),
                                    ordered = TRUE)

#remove NAs
  mort.not.na <- which(mort.dat$Mortality14 != "NA")
  mort.dat.fin <- mort.dat[mort.not.na,]

#mortality lm
lm.mortality <- lm(total.nsc ~ Mortality14, data = mort.dat.fin)
plot(lm.mortality)
anova(lm.mortality)
summary(lm.mortality)

#Mortality Tukey HSD
summary(aov.mort <- aov(lm.mortality))
tukey.mort <- TukeyHSD(aov.mort, "Mortality14", ordered = FALSE)
plot(tukey.mort)
mort.levels <- tukey.mort[["Mortality14"]][,4]
mort.labels <- multcompLetters(mort.levels)['Letters']
mort.plot.labels <- names(mort.labels[['Letters']])

mortality.plot <- ggplot(mort.dat.fin, aes(x = Mortality14, y = total.nsc)) +
   geom_violin() + 
  #theme(axis.text.x = element_text(angle=0,hjust=.5,size=16)) +
  theme(axis.text.y = element_text(size=10)) +
  theme(axis.title.x = element_text(size=12)) +
  theme(axis.title.y = element_text(size=12)) +
  theme(legend.text = element_text(size=10)) +
  ylim(0,150) +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 150)) +
  stat_summary(fun.y="median", geom="point") +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Mortality Status") +
  scale_x_discrete(labels = c("Alive", "Stressed", "Dead")) +
  annotate("text", x = 1.05:3.05, y = c(140, 122, 70), label = c("a","b","c"))

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH3_Growth_NSC/nsc.mort.png", plot = mortality.plot, dpi = 600, width = 5, height = 3.5, units = "in")


# Spp distribution of dead for appendix
#sort dead
mort.total.sort<-which(mort.dat.fin$Mortality14 == "D")
count.mort <- count(mort.dat.fin$Spp[mort.total.sort])

    #assigning species

    balsamea <- which(count.mort$x == "ABBA")
    pensylvanicum <- which(count.mort$x == "ACPE")
    rubrum <- which(count.mort$x == "ACRU")
    saccharum <- which(count.mort$x == "ACSA3")
    alleghaniensis <- which(count.mort$x == "BEAL2")
    lenta <- which(count.mort$x == "BELE")
    papyrifera <- which(count.mort$x == "BEPA")
    cordiformis <- which(count.mort$x == "CACO15")
    glabra <- which(count.mort$x == "CAGL8")
    laciniosa <- which(count.mort$x == "CALA21")
    tomentosa <- which(count.mort$x == "CATO6")
    grandifolia <- which(count.mort$x == "FAGR")
    virginiana <- c(which(count.mort$x == "QUVI"),
                    which(count.mort$x == "JUVI"),
		                which(count.mort$x == "PIVI"))
    tulipifera <- which(count.mort$x == "LITU")
    mariana <- which(count.mort$x == "PIMA")
    rigida <- which(count.mort$x == "PIRI")
    rubens <- which(count.mort$x == "PIRU")
    strobus <- which(count.mort$x == "PIST")
    tremuloides <- which(count.mort$x == "POTR5")
    serotina <- which(count.mort$x == "PRSE2")
    alba <- which(count.mort$x == "QUAL")
    coccinea <- which(count.mort$x == "QUCO2")
    laevis <- which(count.mort$x == "QULA2")
    laurifolia <- which(count.mort$x == "QULA3")
    nigra <- which(count.mort$x == "QUNI")
    rubra <- which(count.mort$x == "QURU")
    velutina <- which(count.mort$x == "QUVE")
    albidum <- which(count.mort$x == "SAAL5")
    canadensis <- which(count.mort$x == "TSCA")
    americana <- which(count.mort$x == "ULAM")

    #Set total data frame for species
    count.mort$species <- NA
    count.mort$species[balsamea] <- "balsamea"
    count.mort$species[pensylvanicum] <- "pensylvanicum"
    count.mort$species[rubrum] <- "rubrum"
    count.mort$species[saccharum] <- "saccharum"
    count.mort$species[alleghaniensis] <- "alleghaniensis"
    count.mort$species[lenta] <- "lenta"
    count.mort$species[papyrifera] <- "papyrifera"
    count.mort$species[cordiformis] <- "cordiformis"
    count.mort$species[glabra] <- "glabra"
    count.mort$species[laciniosa] <- "laciniosa"
    count.mort$species[tomentosa] <- "tomentosa"
    count.mort$species[grandifolia] <- "grandifolia"
    count.mort$species[virginiana] <- "virginiana"
    count.mort$species[tulipifera] <- "tulipifera"
    count.mort$species[mariana] <- "mariana"
    count.mort$species[rubens] <- "rubens"
    count.mort$species[rigida] <- "rigida"
    count.mort$species[strobus] <- "strobus"
    count.mort$species[tremuloides] <- "tremuloides"
    count.mort$species[serotina] <- "serotina"
    count.mort$species[alba] <- "alba"
    count.mort$species[coccinea] <- "coccinea"
    count.mort$species[laevis] <- "laevis"
    count.mort$species[laurifolia] <- "laurifolia"
    count.mort$species[nigra] <- "nigra"
    count.mort$species[rubra] <- "rubra"
    count.mort$species[velutina] <- "velutina"
    count.mort$species[albidum] <- "albidum"
    count.mort$species[canadensis] <- "canadensis"
    count.mort$species[americana] <- "americana"


    #Adding genus. contains extra genera but that doesn’t matter
Quercus <- c(                
                which(count.mort$x == "QUAL"),
                which(count.mort$x == "QUCO2"),
                which(count.mort$x == "QUERC"),
                which(count.mort$x == "QUIM"),
                which(count.mort$x == "QULA2"),
                which(count.mort$x == "QULA3"),
                which(count.mort$x == "QUMO4"),
                which(count.mort$x == "QUMU"),
                which(count.mort$x == "QUNI"),
                which(count.mort$x == "QUPH"),
                which(count.mort$x == "QURU"),
                which(count.mort$x == "QUST"),
                which(count.mort$x == "QUVE"),
                which(count.mort$x == "QUVI")
                )
    
   Fraxinus <- c(
                which(count.mort$x == "FRAM2"),
                which(count.mort$x == "FRNI"),
                which(count.mort$x == "FRQU")
                )
   
  Ailanthus <- c(
                which(count.mort$x == "AIAL")
                )
   
    Robinia <- c(
                which(count.mort$x == "ROPS")
                )
    
  Sassafras <- c(
                which(count.mort$x == "SAAL5")
                )
  
      Acer <- c(
                which(count.mort$x == "ACNE2"),
                which(count.mort$x == "ACPE"),
                which(count.mort$x == "ACRU"),
                which(count.mort$x == "ACSA3")
                )
      
  Aesculus <- c(
                which(count.mort$x == "AEGL")
                )
  
    Betula <- c(
                which(count.mort$x == "BEAL2"),
                which(count.mort$x == "BELE"),
                which(count.mort$x == "BEPA"),
                which(count.mort$x == "BETUL")
                )
    
  Carpinus <- c(
                which(count.mort$x == "CACA18")
                )
    
    Cornus <- c(
                which(count.mort$x == "COFL2")
                )
    
Liquidambar <- c(
                which(count.mort$x == "LIST2")
                )

Liriodendron <- c(
                which(count.mort$x == "LITU")
                )

    Magnolia <- c(
                which(count.mort$x == "MAAC"),
                which(count.mort$x == "MAFR"),
                which(count.mort$x == "MAVI2"),
                which(count.mort$x == "MAGR4")
                )
    
    Platanus <- c(
                which(count.mort$x == "PLOC")
                )
    
       Fagus <- c(
                which(count.mort$x == "FAGR")
                )
       
       Nyssa <- c(
                which(count.mort$x == "NYSY")
                )
       
       Oxydendrum <- c(
                which(count.mort$x == "OXAR")
                )
       
       Tilia <- c(
                which(count.mort$x == "TIAM")
                )
    
     Populus <- c(
                which(count.mort$x == "POGR4"),
                which(count.mort$x == "POTR5")
                )
       
     Prunus <- c(
                which(count.mort$x == "PRSE2")
                )

       Carya <- c(
                which(count.mort$x == "CACO15"),
                which(count.mort$x == "CAGL8"),
                which(count.mort$x == "CALA21"),
                which(count.mort$x == "CAOV2"),
                which(count.mort$x == "CATO6")
                )
       
     Cercis <- c(
                which(count.mort$x == "CECA4")
                )
     
  Diospyros <- c(
                which(count.mort$x == "DIVI5")
                )
  
    Juglans <- c(
                which(count.mort$x == "JUCI"),
                which(count.mort$x == "JUNI")
                )
    
      Ulmus <- c(
                which(count.mort$x == "ULAM")
                )

  ### Conifers
      Pinus <- c(
                which(count.mort$x == "PIPA2"),
                which(count.mort$x == "PIST"),
                which(count.mort$x == "PIVI"),
                which(count.mort$x == "PIRE"),
                which(count.mort$x == "PIRI"),
                which(count.mort$x == "PITA")
                )
      
      Larix <- c(
                which(count.mort$x == "LALA")
                )
      
      Picea <- c(
                which(count.mort$x == "PIGL"),
                which(count.mort$x == "PIMA"),
                which(count.mort$x == "PIRU")
                )

      Abies <- c(
              which(count.mort$x == "ABBA")
              )
      
Juniperus <- c(
              which(count.mort$x == "JUVI")
              )

    Thuja <- c(
              which(count.mort$x == "THOC2")
              )
    
    Tsuga <- c(
              which(count.mort$x == "TSCA")
              )
    
    
    
    ### Set total dataframe for Genus
    
    count.mort$genus <- NA
    count.mort$genus[Pinus] <- "Pinus"
    count.mort$genus[Larix] <- "Larix"
    count.mort$genus[Picea] <- "Picea"
    count.mort$genus[Abies] <- "Abies"
    count.mort$genus[Thuja] <- "Thuja"
    count.mort$genus[Tsuga] <- "Tsuga"
    count.mort$genus[Juniperus] <- "Juniperus"
    count.mort$genus[Quercus] <- "Quercus"
    count.mort$genus[Fraxinus] <- "Fraxinus"
    count.mort$genus[Ailanthus] <- "Ailanthus"
    count.mort$genus[Robinia] <- "Robinia"
    count.mort$genus[Sassafras] <- "Sassafras"
    count.mort$genus[Acer] <- "Acer"
    count.mort$genus[Aesculus] <- "Aesculus"
    count.mort$genus[Betula] <- "Betula"
    count.mort$genus[Carpinus] <- "Carpinus"
    count.mort$genus[Cornus] <- "Cornus"
    count.mort$genus[Liquidambar] <- "Liquidambar"
    count.mort$genus[Liriodendron] <- "Liriodendron"
    count.mort$genus[Magnolia] <- "Magnolia"
    count.mort$genus[Platanus] <- "Platanus"
    count.mort$genus[Fagus] <- "Fagus"
    count.mort$genus[Nyssa] <- "Nyssa"
    count.mort$genus[Oxydendrum] <- "Oxydendrum"
    count.mort$genus[Tilia] <- "Tilia"
    count.mort$genus[Populus] <- "Populus"
    count.mort$genus[Prunus] <- "Prunus"
    count.mort$genus[Carya] <- "Carya"
    count.mort$genus[Cercis] <- "Cercis"
    count.mort$genus[Diospyros] <- "Diospyros"
    count.mort$genus[Juglans] <- "Juglans"
    count.mort$genus[Ulmus] <- "Ulmus"


 #Make single genus-species column
    count.mort$GenusSpecies <- NA
    count.mort$GenusSpecies <- with(count.mort, paste(genus, species))
    count.mort$GenusSpecies <- as.character(count.mort$GenusSpecies)
    
# barplot(count.mort[,2],names.arg=count.mort[,5],las=2, ylab = "Number of Dead Trees", main = "Number of Dead Trees by Species")
# 
# dev.copy(png,'/Users/josh/Dropbox/Dissertation/CH3_Growth_NSC/species_dead.png')
# dev.off()

mort.barplot <- ggplot(data = count.mort, aes(x = GenusSpecies, y = freq)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle=60,hjust=1,vjust=1,size=10)) +
  ylab("Number of Trees") + xlab("Species")

  ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH3_Growth_NSC/Figures/mort.barplot.png", plot = mort.barplot, dpi = 600, width = 6, height = 5, units = "in")


```
You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

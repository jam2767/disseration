Eastern US NSC Analysis
========================================================

This is the analysis for chapter 2 of my dissertation and for the first paper on nonstructural carbohydrates in eastern US forests.



```{r}
#load libraries
library(lme4)
library(ggplot2)

#helper functions
#function to find last value of vector
last <- function(x) { return( x[length(x)] ) }

#give sample size on boxplot for ggplot
give.n <- function(x){
  return(c(y = mean(x), label = length(x)))
}

#color-blind-friendly palettes
cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
```

```{r}
#Directories for census and NSC data
#read data
#read Adult Census Data
adult <- read.csv("/Users/Josh/Dropbox/Dietze_Lab_Undergrads/JAM - Xsite/Field Data Entry/Data Sheets/Adult_Field_Data_JAM_MCD.csv")

#read NSC tracking data - contains sample mass used for assays
mass <- read.csv("/Users/Josh/Dropbox/NSC_Runs/All/Tracking/NSC_Mass_All_8172016.csv")

#all files starch files in one directory
data.dir.starch = "/Users/Josh/Dropbox/NSC_Runs/All/Starch"
data.dir.sugar = "/Users/Josh/Dropbox/NSC_Runs/All/Sugar"
```

```{r}
### Process STARCH data files ###

#starch files
files.starch <- dir(data.dir.starch,"Xsite")
baseline.files.starch <- files.starch[grep(pattern = "Baseline",files.starch)]
HK.files.starch <- files.starch[grep(pattern = "HK",files.starch)]

baseline.starch = NULL
for(i in seq_along(baseline.files.starch)){
  tmp <- read.csv(file.path(data.dir.starch,baseline.files.starch[i]),sep="",colClasses="character")
  baseline.starch = rbind(baseline.starch,tmp)
}
#mean.baseline.starch <- tapply(X = as.numeric(baseline.starch$Meas.), INDEX = baseline.starch$Sample, FUN = mean) #using mean of baseline - used for analysis through 9/1/2016, switching to last for future analysis. Last represents most accurate starting point for subtracting from sample after Hexokinase (HK) added.
last.baseline.starch <- tapply(X = as.numeric(baseline.starch$Meas.), INDEX = baseline.starch$Sample, FUN = last)
baseline.starch.id <- unique(baseline.starch$Sample)

#these files contain a run after HK is added
#measures starch content via breakdown of glucose & production of NADPH
HK.starch = NULL
for(i in seq_along(HK.files.starch)){
  tmp.HK.starch <- read.csv(file.path(data.dir.starch,HK.files.starch[i]),sep="",colClasses="character")
  HK.starch = rbind(HK.starch,tmp.HK.starch)
}
max.HK.starch <- tapply(X = as.numeric(HK.starch$Meas.), INDEX = HK.starch$Sample, FUN = max)
HK.starch.id <- unique(HK.starch$Sample)

# Check that samples finished converting all Starch. If not, flag for reanalysis
dif.HK.starch <- tapply(X = as.numeric(HK.starch$Meas.), INDEX = HK.starch$Sample, FUN = diff)
IDs.starch <- as.vector(attr(dif.HK.starch,"dimnames"))
IDs.starch <- unlist(IDs)

starch.nofinish <- list()
for(i in 1:length(dif.HK.starch)){
if ('0' %in% dif.HK.starch[[i]]) { #simplest check: time when absorbance not increasing?
  print("Sample Finished")
  } else {
  starch.nofinish[[i]] <- IDs.starch[[i]] #ID of sample that didn't finish
  }
}

starch.nofinish.ids <- unlist(starch.nofinish) #remove null values
write.csv(starch.nofinish.ids, file = "unfinished_starch.csv") #save file to identify repeats

#### right now still using values for samples that didn't finish

#difference between baseline and HK
#total.starch <- max.HK.starch-mean.baseline.starch #old method using mean baseline value before 9/1/2016
total.starch <- max.HK.starch-last.baseline.starch #new method using last baseline value


##TODO use each standard curve for each individual plate
##currently only using one standard curve
#create standard curve equation

standard.abs.starch <- c(mean(total.starch[3:4]),mean(total.starch[1:2]),
                         mean(total.starch[5:6]),mean(total.starch[7:8]))
#standard.conc.starch <- c(0,0.5,1.0,1.5) #standard glucose concentrations in mmol for plate 2
standard.conc.starch <- c(0,20,40,60) #standard concentrations * 40 uL
standard.lm.starch <- lm(standard.abs.starch ~ standard.conc.starch)
summary(standard.lm.starch) #slope, intercept, R^2

#visualize standard curve
plot(standard.conc.starch,standard.abs.starch)
abline(standard.lm.starch)

#standard curve equation - calculate mmol glucose equivalents of samples
sample.conc.starch <- (total.starch - standard.lm.starch$coefficients[1])/standard.lm.starch$coefficients[2]
sample.conc.starch <- as.matrix(sample.conc.starch)
sample.ids.starch <- strsplit(row.names(sample.conc.starch),"_")

###create ID to match Core_ID in adult census data
core.id.starch <- array()
for(i in 1:length(sample.conc.starch)){
  core.id.starch[i] <- paste0(sample.ids.starch[[i]][1],
                              sample.ids.starch[[i]][2],
                              sample.ids.starch[[i]][3])
}

##bind core.id to sample matrix
sample.starch <- data.frame(core.id.starch,sample.conc.starch)
sample.agg.starch <- aggregate(sample.conc.starch~core.id.starch,sample.starch,mean)
matches.starch <- match(as.character(sample.agg.starch$core.id),as.character(adult$Core_ID14))
row.names(sample.agg.starch) <- NULL
nsc.adult.dat.starch <- data.frame(sample.agg.starch,adult[matches.starch,])

#match sample masses to absorbance
matches.mass.starch <- match(as.character(nsc.adult.dat.starch$Core_ID14),as.character(mass$Core_ID))
nsc.adult.starch.mass <- data.frame(nsc.adult.dat.starch,mass[matches.mass.starch,])

#mass column is Mass_mg
#calculate concentrations based on mass of sample used
nsc.adult.starch.mass$ug.sample <- nsc.adult.starch.mass$sample.conc.starch / 40 * 840 #micrograms/sample 40 ul drawn from 840 ul total volume of Starch Extraction

##TODO subsample for files that contain samples with different volume than 840 ul because they needed their ph fixed##
nsc.adult.starch.mass$Starch.mg.g <- nsc.adult.starch.mass$ug.sample / nsc.adult.starch.mass$Mass_mg #mg/gram of sample

### END Process STARCH data files ###
```

```{r}
### Process SUGAR data files ###

#Sugar Files
files.sugar <- dir(data.dir.sugar,"Xsite")
baseline.files.sugar <- files.sugar[grep(pattern = "Baseline", files.sugar)]
glucose.files.sugar <- files.sugar[grep(pattern = "Glucose", files.sugar)]
fructose.files.sugar <- files.sugar[grep(pattern = "Fructose", files.sugar)]
sucrose.files.sugar <- files.sugar[grep(pattern = "Sucrose", files.sugar)]

baseline.sugar = NULL
for(i in seq_along(baseline.files.sugar)){
  tmp <- read.csv(file.path(data.dir.sugar,baseline.files.sugar[i]),sep="",colClasses="character")
  baseline.sugar = rbind(baseline.sugar,tmp)
}
# mean.baseline.sugar <- tapply(X = as.numeric(baseline.sugar$Meas.), INDEX = baseline.sugar$Sample, FUN = mean) #using mean of baseline - used for analysis through 9/1/2016, switching to last for future analysis. Last represents most accurate starting point for subtracting from sample after HK added.
last.baseline.sugar <- tapply(X = as.numeric(baseline.sugar$Meas.), INDEX = baseline.sugar$Sample, FUN = last)
baseline.sugar.id <- unique(baseline.sugar$Sample)

#these files contain a run after Hexokinase is added
#measures sugar content via breakdown of glucose & production of NADPH
glucose.sugar = NULL
for(i in seq_along(glucose.files.sugar)){
  tmp.glucose <- read.csv(file.path(data.dir.sugar,glucose.files.sugar[i]),sep="",colClasses="character")
  glucose.sugar = rbind(glucose.sugar,tmp.glucose)
}
max.glucose.sugar <- tapply(X = as.numeric(glucose.sugar$Meas.), INDEX = glucose.sugar$Sample, FUN = max)
glucose.sugar.id <- unique(glucose.sugar$Sample)

# Check that samples finished converting all glucose. If not, flag for reanalysis
dif.HK.sugar <- tapply(X = as.numeric(glucose.sugar$Meas.), INDEX = glucose.sugar$Sample, FUN = diff)
IDs.gluc <- as.vector(attr(dif.HK.sugar,"dimnames"))
IDs.gluc <- unlist(IDs.gluc)

gluc.nofinish <- list()
for(i in 1:length(dif.HK.sugar)){
if ('0' %in% dif.HK.sugar[[i]]) { #simplest check: time when absorbance not increasing?
  print("Sample Finished")
  } else {
  gluc.nofinish[[i]] <- IDs.gluc[[i]] #ID of sample that didn't finish
  }
}

gluc.nofinish.ids <- unlist(gluc.nofinish) #remove null values
write.csv(gluc.nofinish.ids, file = "unfinished_glucose.csv") #save file to identify repeats


#difference between baseline and HK (glucose content)
total.glucose <- max.glucose.sugar-last.baseline.sugar #old method used mean.baseline.sugar

#these files contain  a run after hexokinase and PGI have been added
#measures sugar content via breakdown of fructose & production of NADPH
fructose.sugar = NULL
for(i in seq_along(fructose.files.sugar)){
  tmp.fructose <- read.csv(file.path(data.dir.sugar,fructose.files.sugar[i]),sep="",colClasses="character")
  fructose.sugar = rbind(fructose.sugar,tmp.fructose)
}
max.fructose.sugar <- tapply(X = as.numeric(fructose.sugar$Meas.), INDEX = fructose.sugar$Sample, FUN = max)
fructose.sugar.id <- unique(fructose.sugar$Sample)

#difference between HK and PGI (Fructose content)
last.glucose.sugar <- tapply(X = as.numeric(glucose.sugar$Meas.), INDEX = glucose.sugar$Sample, FUN = last)

# Check that samples finished converting all fructose. If not, flag for reanalysis
dif.PGI.sugar <- tapply(X = as.numeric(fructose.sugar$Meas.), INDEX = fructose.sugar$Sample, FUN = diff)
IDs.fruc <- as.vector(attr(dif.PGI.sugar,"dimnames"))
IDs.fruc <- unlist(IDs.fruc)

fruc.nofinish <- list()
for(i in 1:length(dif.PGI.sugar)){
if ('0' %in% dif.PGI.sugar[[i]]) { #simplest check: time when absorbance not increasing?
  print("Sample Finished")
  } else {
  fruc.nofinish[[i]] <- IDs.fruc[[i]] #ID of sample that didn't finish
  }
}

fruc.nofinish.ids <- unlist(fruc.nofinish) #remove null values
write.csv(fruc.nofinish.ids, file = "unfinished_fructose.csv") #save file to identify repeats


total.fructose <- max.fructose.sugar-last.glucose.sugar

#these files contain  a run after hexokinase, PGI and Invertase have been added
#measures sugar content via breakdown of sucrose & production of NADPH
sucrose.sugar = NULL
for(i in seq_along(sucrose.files.sugar)){
  tmp.sucrose <- read.csv(file.path(data.dir.sugar,sucrose.files.sugar[i]),sep="",colClasses="character")
  sucrose.sugar = rbind(sucrose.sugar,tmp.sucrose)
}
max.sucrose.sugar <- tapply(X = as.numeric(sucrose.sugar$Meas.), INDEX = sucrose.sugar$Sample, FUN = max)
sucrose.sugar.id <- unique(sucrose.sugar$Sample)

# Check that samples finished converting all sucrose. If not, flag for reanalysis
dif.INV.sugar <- tapply(X = as.numeric(sucrose.sugar$Meas.), INDEX = sucrose.sugar$Sample, FUN = diff)
IDs.sucr <- as.vector(attr(dif.INV.sugar,"dimnames"))
IDs.sucr <- unlist(IDs.sucr)

sucr.nofinish <- list()
for(i in 1:length(dif.INV.sugar)){
if ('0' %in% dif.INV.sugar[[i]]) { #simplest check: time when absorbance not increasing?
  print("Sample Finished")
  } else {
  sucr.nofinish[[i]] <- IDs.sucr[[i]] #ID of sample that didn't finish
  }
}

sucr.nofinish.ids <- unlist(sucr.nofinish) #remove null values
write.csv(sucr.nofinish.ids, file = "unfinished_sucrose.csv") #save file to identify repeats


#difference between HK and PGI (Fructose content)
last.fructose.sugar <- tapply(X = as.numeric(fructose.sugar$Meas.), INDEX = fructose.sugar$Sample, FUN = last)
total.sucrose <- max.sucrose.sugar-last.fructose.sugar

##TODO use each standard curve for each individual plate
##currenlty only using one standard curve
#create standard curve equation

standard.abs.sugar <- c(mean(total.glucose[3:4]),mean(total.glucose[1:2]),
                         mean(total.glucose[5:6]),mean(total.glucose[7:8]))
#standard.conc.starch <- c(0,0.5,1.0,1.5) #standard glucose concentrations in mmol for plate 2
standard.conc.sugar <- c(0,20,40,60) #standard concentrations * 40 uL
standard.lm.sugar <- lm(standard.abs.sugar ~ standard.conc.sugar)
summary(standard.lm.sugar) #slope, intercept, R^2

#visualize standard curve
plot(standard.conc.sugar,standard.abs.sugar)
abline(standard.lm.sugar)

#standard curve equation - calculate mmol glucose equivalents of samples
sample.conc.glucose <- ((total.glucose) - standard.lm.sugar$coefficients[1])/standard.lm.sugar$coefficients[2] #only 20ul of sample was used, compared to 40ul of standard
sample.conc.glucose <- as.matrix(sample.conc.glucose)
sample.ids.glucose <- strsplit(row.names(sample.conc.glucose),"_")

sample.conc.fructose <- ((total.fructose) - standard.lm.sugar$coefficients[1])/standard.lm.sugar$coefficients[2] #only 20ul of sample was used, compared to 40ul of standard
sample.conc.fructose <- as.matrix(sample.conc.fructose)
sample.ids.fructose <- strsplit(row.names(sample.conc.fructose),"_")

sample.conc.sucrose <- ((total.sucrose) - standard.lm.sugar$coefficients[1])/standard.lm.sugar$coefficients[2] #only 20ul of sample was used, compared to 40ul of standard
sample.conc.sucrose <- as.matrix(sample.conc.sucrose)
sample.ids.sucrose <- strsplit(row.names(sample.conc.sucrose),"_")

###create ID to match Core_ID in adult census data
core.id.sugar <- array()
for(i in 1:length(sample.conc.glucose)){
  core.id.sugar[i] <- paste0(sample.ids.glucose[[i]][1],
                              sample.ids.glucose[[i]][2],
                              sample.ids.glucose[[i]][3])
}

##bind core.id to sample matrix
sample.sugar <- data.frame(core.id.sugar,sample.conc.glucose,sample.conc.fructose,sample.conc.sucrose)
sample.agg.glucose <- aggregate(sample.conc.glucose ~ core.id.sugar, sample.sugar, mean)
sample.agg.fructose <- aggregate(sample.conc.fructose ~ core.id.sugar, sample.sugar, mean)
sample.agg.sucrose <- aggregate(sample.conc.sucrose ~ core.id.sugar, sample.sugar, mean)
sample.agg.sugar <- data.frame(sample.agg.glucose$core.id.sugar, sample.agg.glucose$sample.conc.glucose,
                               sample.agg.fructose$sample.conc.fructose, sample.agg.sucrose$sample.conc.sucrose)

matches.sugar <- match(as.character(sample.agg.sugar$sample.agg.glucose.core.id),as.character(adult$Core_ID14))
row.names(sample.agg.sugar) <- NULL
nsc.adult.dat.sugar <- data.frame(sample.agg.sugar,adult[matches.sugar,])

#match sample masses to absorbance
matches.mass.sugar <- match(as.character(nsc.adult.dat.sugar$Core_ID14),as.character(mass$Core_ID))
nsc.adult.sugar.mass <- data.frame(nsc.adult.dat.sugar,mass[matches.mass.sugar,])

#mass column is Mass_mg
#calculate concentrations of glucose based on mass of sample used
nsc.adult.sugar.mass$ug.glucose <- nsc.adult.sugar.mass$sample.agg.glucose.sample.conc.glucose / 20 * 845 #micrograms/sample 20 ul drawn from 845 ul total volume of Sugar Extraction
nsc.adult.sugar.mass$glucose.mg.g <- nsc.adult.sugar.mass$ug.glucose / nsc.adult.sugar.mass$Mass_mg #mg/gram of sample

#calculate concentrations of fructose based on mass of sample used
nsc.adult.sugar.mass$ug.fructose <- nsc.adult.sugar.mass$sample.agg.fructose.sample.conc.fructose / 20 * 845 #micrograms/sample 20 ul drawn from 845 ul total volume of Sugar Extraction
nsc.adult.sugar.mass$fructose.mg.g <- nsc.adult.sugar.mass$ug.fructose / nsc.adult.sugar.mass$Mass_mg #mg/gram of sample

#calculate concentrations of fructose based on mass of sample used
nsc.adult.sugar.mass$ug.sucrose <- nsc.adult.sugar.mass$sample.agg.sucrose.sample.conc.sucrose / 20 * 845 #micrograms/sample 20 ul drawn from 845 ul total volume of Sugar Extraction
nsc.adult.sugar.mass$sucrose.mg.g <- nsc.adult.sugar.mass$ug.sucrose / nsc.adult.sugar.mass$Mass_mg #mg/gram of sample

### END process SUGAR files ###
```

Combining data from sugar and starch runs into one dataframe

```{r}
### Combine Sugar and Starch for total NSC ###
starch.only <- data.frame(nsc.adult.starch.mass$core.id.starch,nsc.adult.starch.mass$Starch.mg.g)
matches.sugar.starch <- match(as.character(nsc.adult.sugar.mass$sample.agg.glucose.core.id.sugar),as.character(starch.only$nsc.adult.starch.mass.core.id.starch))
row.names(nsc.adult.sugar.mass) <- NULL
row.names(starch.only) <- NULL
nsc.adult.total.mass <- data.frame(nsc.adult.sugar.mass,starch.only[matches.sugar.starch,])
nsc.adult.total.mass$total.nsc <- mapply(nsc.adult.total.mass$nsc.adult.starch.mass.Starch.mg.g,
                                      nsc.adult.total.mass$glucose.mg.g,
                                      nsc.adult.total.mass$fructose.mg.g,
                                      nsc.adult.total.mass$sucrose.mg.g, FUN=sum, na.rm=FALSE)                                      
#rename starch column
colnames(nsc.adult.total.mass)[115] <- "core.id.starch"
colnames(nsc.adult.total.mass)[116] <- "starch.mg.g"

#csv to identify missing starch or sugar samples
write.csv(nsc.adult.total.mass, file = "nsc.adult.total.mass.missingincluded.csv")

#remove NAs for total.nsc
nsc.adult.total.mass <- nsc.adult.total.mass[which(nsc.adult.total.mass$total.nsc != "NA"),]

### END combine sugar and starch ###
```

Adding Plant Functional Type (PFT) and Wood Anatomy as covariates for analysis. USDA PLANTS database and USFS Silvics of North America manual used for PFT determination.

```{r}
### Adding PFT and Wood Anatomy covariates ###

##adding PFTs
###Reference: http://plants.usda.gov/java/
### Also USFS silvics manual: https://www.na.fs.fed.us/spfo/pubs/silvics_manual/table_of_contents.htm

# Hardwoods
Early.Hardwood <- c(
                    which(nsc.adult.total.mass$Spp == "ACPE"),#
                    which(nsc.adult.total.mass$Spp == "AIAL"),#
                    which(nsc.adult.total.mass$Spp == "BEAL2"),#
                    which(nsc.adult.total.mass$Spp == "BELE"),#
                    which(nsc.adult.total.mass$Spp == "BEPA"),#
                    which(nsc.adult.total.mass$Spp == "BETUL"),#
                    which(nsc.adult.total.mass$Spp == "COFL2"),#
                    which(nsc.adult.total.mass$Spp == "JUCI"),#
                    which(nsc.adult.total.mass$Spp == "JUNI"),#
                    which(nsc.adult.total.mass$Spp == "LIST2"),#
                    which(nsc.adult.total.mass$Spp == "LITU"),#
                    which(nsc.adult.total.mass$Spp == "POGR4"),#
                    which(nsc.adult.total.mass$Spp == "POTR5"),#
                    which(nsc.adult.total.mass$Spp == "PRSE2"),#
                    which(nsc.adult.total.mass$Spp == "ROPS"),#
                    which(nsc.adult.total.mass$Spp == "SAAL5")#
                    ) #16 Spp

Mid.Hardwood <- c(
                  which(nsc.adult.total.mass$Spp == "FRAM2"),#
                  which(nsc.adult.total.mass$Spp == "FRNI"),#
                  which(nsc.adult.total.mass$Spp == "FRQU"),#
                  which(nsc.adult.total.mass$Spp == "ACNE2"),#
                  which(nsc.adult.total.mass$Spp == "ACRU"),#
                  which(nsc.adult.total.mass$Spp == "CACA18"),#
                  which(nsc.adult.total.mass$Spp == "CACO15"),#
                  which(nsc.adult.total.mass$Spp == "CAGL8"),#
                  which(nsc.adult.total.mass$Spp == "CALA21"),#
                  which(nsc.adult.total.mass$Spp == "CAOV2"),#
                  which(nsc.adult.total.mass$Spp == "CATO6"),#
                  which(nsc.adult.total.mass$Spp == "CECA4"),#
                  which(nsc.adult.total.mass$Spp == "MAAC"),#
                  which(nsc.adult.total.mass$Spp == "MAFR"),#
                  which(nsc.adult.total.mass$Spp == "MAVI2"),#
                  which(nsc.adult.total.mass$Spp == "PLOC"),#
                  which(nsc.adult.total.mass$Spp == "QUAL"),#
                  which(nsc.adult.total.mass$Spp == "QUCO2"),#
                  which(nsc.adult.total.mass$Spp == "QUERC"),#
                  which(nsc.adult.total.mass$Spp == "QUIM"),#
                  which(nsc.adult.total.mass$Spp == "QULA2"),#
                  which(nsc.adult.total.mass$Spp == "QULA3"),#
                  which(nsc.adult.total.mass$Spp == "QUMO4"),#
                  which(nsc.adult.total.mass$Spp == "QUMU"),#
                  which(nsc.adult.total.mass$Spp == "QUNI"),#
                  which(nsc.adult.total.mass$Spp == "QUPH"),#
                  which(nsc.adult.total.mass$Spp == "QURU"),#
                  which(nsc.adult.total.mass$Spp == "QUST"),#
                  which(nsc.adult.total.mass$Spp == "QUVE"),#
                  which(nsc.adult.total.mass$Spp == "QUVI"),#
                  which(nsc.adult.total.mass$Spp == "ULAM")#
                  ) #31 Spp

Late.Hardwood <- c(
                  which(nsc.adult.total.mass$Spp == "ACFL"),#
                  which(nsc.adult.total.mass$Spp == "ACSA3"),#
                  which(nsc.adult.total.mass$Spp == "AEGL"),#
                  which(nsc.adult.total.mass$Spp == "DIVI5"),#
                  which(nsc.adult.total.mass$Spp == "FAGR"),#
                  which(nsc.adult.total.mass$Spp == "MAGR4"),#
                  which(nsc.adult.total.mass$Spp == "NYSY"),#
                  which(nsc.adult.total.mass$Spp == "OXAR"),#
                  which(nsc.adult.total.mass$Spp == "TIAM")#
                  ) #9 Spp

# set PFTs
nsc.adult.total.mass$PFT <- NA
nsc.adult.total.mass$PFT[Early.Hardwood] <- "Early.Hardwood"
nsc.adult.total.mass$PFT[Mid.Hardwood] <- "Mid.Hardwood"
nsc.adult.total.mass$PFT[Late.Hardwood] <- "Late.Hardwood"

# Conifers
Early.Conifer <- c(
                  which(nsc.adult.total.mass$Spp == "ABBA"),#
                  which(nsc.adult.total.mass$Spp == "JUVI"),#
                  which(nsc.adult.total.mass$Spp == "PIPA2"),#
                  which(nsc.adult.total.mass$Spp == "PIST"),#
                  which(nsc.adult.total.mass$Spp == "PIVI2"),#
                  which(nsc.adult.total.mass$Spp == "PIRE"),#
                  which(nsc.adult.total.mass$Spp == "PIRI"),#
                  which(nsc.adult.total.mass$Spp == "PITA")#
                  ) #8 Spp

Late.Conifer <- c(
                  which(nsc.adult.total.mass$Spp == "LALA"),#
                  which(nsc.adult.total.mass$Spp == "PIGL"),#
                  which(nsc.adult.total.mass$Spp == "PIMA"),#
                  which(nsc.adult.total.mass$Spp == "PIRU"),#
                  which(nsc.adult.total.mass$Spp == "THOC2"),#
                  which(nsc.adult.total.mass$Spp == "TSCA")#
                  ) #6 Spp

nsc.adult.total.mass$PFT[Early.Conifer] <- "Early.Conifer"
nsc.adult.total.mass$PFT[Late.Conifer] <- "Late.Conifer"

# adding wood anatomy
###Reference http://www.wood-database.com/
###Disagree with reference for hickory classification - put all as semi-ring porous. conferred with Christy

large.resin <- c(
                which(nsc.adult.total.mass$Spp == "PIPA2"),
                which(nsc.adult.total.mass$Spp == "PIST"),
                which(nsc.adult.total.mass$Spp == "PIVI2"),
                which(nsc.adult.total.mass$Spp == "PIRE"),
                which(nsc.adult.total.mass$Spp == "PIRI"),
                which(nsc.adult.total.mass$Spp == "PITA")
                )

small.resin <- c(
                which(nsc.adult.total.mass$Spp == "LALA"),
                which(nsc.adult.total.mass$Spp == "PIGL"),
                which(nsc.adult.total.mass$Spp == "PIMA"),
                which(nsc.adult.total.mass$Spp == "PIRU")
                )

no.resin <- c(
              which(nsc.adult.total.mass$Spp == "ABBA"),
              which(nsc.adult.total.mass$Spp == "JUVI"),
              which(nsc.adult.total.mass$Spp == "THOC2"),
              which(nsc.adult.total.mass$Spp == "TSCA")
              )

ring.porous <- c(
                which(nsc.adult.total.mass$Spp == "AIAL"),              
                which(nsc.adult.total.mass$Spp == "FRAM2"),
                which(nsc.adult.total.mass$Spp == "FRNI"),
                which(nsc.adult.total.mass$Spp == "FRQU"),
                which(nsc.adult.total.mass$Spp == "QUAL"),
                which(nsc.adult.total.mass$Spp == "QUCO2"),
                which(nsc.adult.total.mass$Spp == "QUERC"),
                which(nsc.adult.total.mass$Spp == "QUIM"),
                which(nsc.adult.total.mass$Spp == "QULA2"),
                which(nsc.adult.total.mass$Spp == "QULA3"),
                which(nsc.adult.total.mass$Spp == "QUMO4"),
                which(nsc.adult.total.mass$Spp == "QUMU"),
                which(nsc.adult.total.mass$Spp == "QUNI"),
                which(nsc.adult.total.mass$Spp == "QUPH"),
                which(nsc.adult.total.mass$Spp == "QURU"),
                which(nsc.adult.total.mass$Spp == "QUST"),
                which(nsc.adult.total.mass$Spp == "QUVE"),
                which(nsc.adult.total.mass$Spp == "QUVI"),
                which(nsc.adult.total.mass$Spp == "ROPS"),
                which(nsc.adult.total.mass$Spp == "SAAL5")
                )

diffuse.porous <- c(
                    which(nsc.adult.total.mass$Spp == "ACNE2"),
                    which(nsc.adult.total.mass$Spp == "ACPE"),
                    which(nsc.adult.total.mass$Spp == "ACRU"),
                    which(nsc.adult.total.mass$Spp == "ACSA3"),
                    which(nsc.adult.total.mass$Spp == "AEGL"),
                    which(nsc.adult.total.mass$Spp == "BEAL2"),
                    which(nsc.adult.total.mass$Spp == "BELE"),
                    which(nsc.adult.total.mass$Spp == "BEPA"),
                    which(nsc.adult.total.mass$Spp == "BETUL"),
                    which(nsc.adult.total.mass$Spp == "CACA18"),
                    which(nsc.adult.total.mass$Spp == "COFL2"),
                    which(nsc.adult.total.mass$Spp == "LIST2"),
                    which(nsc.adult.total.mass$Spp == "LITU"),
                    which(nsc.adult.total.mass$Spp == "MAAC"),
                    which(nsc.adult.total.mass$Spp == "MAFR"),
                    which(nsc.adult.total.mass$Spp == "MAVI2"),                  
                    which(nsc.adult.total.mass$Spp == "PLOC"),
                    which(nsc.adult.total.mass$Spp == "FAGR"),
                    which(nsc.adult.total.mass$Spp == "MAGR4"),
                    which(nsc.adult.total.mass$Spp == "NYSY"),
                    which(nsc.adult.total.mass$Spp == "OXAR"),
                    which(nsc.adult.total.mass$Spp == "TIAM"),
                    which(nsc.adult.total.mass$Spp == "POGR4"),
                    which(nsc.adult.total.mass$Spp == "POTR5"),
                    which(nsc.adult.total.mass$Spp == "PRSE2")               
                    )

semiring.porous <- c(
                    which(nsc.adult.total.mass$Spp == "CACO15"),
                    which(nsc.adult.total.mass$Spp == "CAGL8"),
                    which(nsc.adult.total.mass$Spp == "CALA21"),
                    which(nsc.adult.total.mass$Spp == "CAOV2"),
                    which(nsc.adult.total.mass$Spp == "CATO6"),
                    which(nsc.adult.total.mass$Spp == "CECA4"),
                    which(nsc.adult.total.mass$Spp == "DIVI5"), #bordering diffuse porous
                    which(nsc.adult.total.mass$Spp == "JUCI"),
                    which(nsc.adult.total.mass$Spp == "JUNI"),
                    which(nsc.adult.total.mass$Spp == "ULAM")                                   
                    )

#set anatomy
nsc.adult.total.mass$wood <- NA
nsc.adult.total.mass$wood[large.resin] <- "large.resin"
nsc.adult.total.mass$wood[small.resin] <- "small.resin"
nsc.adult.total.mass$wood[no.resin] <- "no.resin"
nsc.adult.total.mass$wood[ring.porous] <- "ring.porous"
nsc.adult.total.mass$wood[diffuse.porous] <- "diffuse.porous"
nsc.adult.total.mass$wood[semiring.porous] <- "semiring.porous"

#Relevel Factors
nsc.adult.total.mass$wood <- factor(nsc.adult.total.mass$wood, 
                                    levels = c("large.resin","small.resin","no.resin",
                                               "ring.porous","semiring.porous",
                                               "diffuse.porous"), ordered = TRUE)


# adding genus and family
###Reference: http://plants.usda.gov/java/

  ### Hardwoods

    Quercus <- c(                
                which(nsc.adult.total.mass$Spp == "QUAL"),
                which(nsc.adult.total.mass$Spp == "QUCO2"),
                which(nsc.adult.total.mass$Spp == "QUERC"),
                which(nsc.adult.total.mass$Spp == "QUIM"),
                which(nsc.adult.total.mass$Spp == "QULA2"),
                which(nsc.adult.total.mass$Spp == "QULA3"),
                which(nsc.adult.total.mass$Spp == "QUMO4"),
                which(nsc.adult.total.mass$Spp == "QUMU"),
                which(nsc.adult.total.mass$Spp == "QUNI"),
                which(nsc.adult.total.mass$Spp == "QUPH"),
                which(nsc.adult.total.mass$Spp == "QURU"),
                which(nsc.adult.total.mass$Spp == "QUST"),
                which(nsc.adult.total.mass$Spp == "QUVE"),
                which(nsc.adult.total.mass$Spp == "QUVI")
                )
    
   Fraxinus <- c(
                which(nsc.adult.total.mass$Spp == "FRAM2"),
                which(nsc.adult.total.mass$Spp == "FRNI"),
                which(nsc.adult.total.mass$Spp == "FRQU")
                )
   
  Ailanthus <- c(
                which(nsc.adult.total.mass$Spp == "AIAL")
                )
   
    Robinia <- c(
                which(nsc.adult.total.mass$Spp == "ROPS")
                )
    
  Sassafras <- c(
                which(nsc.adult.total.mass$Spp == "SAAL5")
                )
  
      Acer <- c(
                which(nsc.adult.total.mass$Spp == "ACNE2"),
                which(nsc.adult.total.mass$Spp == "ACPE"),
                which(nsc.adult.total.mass$Spp == "ACRU"),
                which(nsc.adult.total.mass$Spp == "ACSA3")
                )
      
  Aesculus <- c(
                which(nsc.adult.total.mass$Spp == "AEGL")
                )
  
    Betula <- c(
                which(nsc.adult.total.mass$Spp == "BEAL2"),
                which(nsc.adult.total.mass$Spp == "BELE"),
                which(nsc.adult.total.mass$Spp == "BEPA"),
                which(nsc.adult.total.mass$Spp == "BETUL")
                )
    
  Carpinus <- c(
                which(nsc.adult.total.mass$Spp == "CACA18")
                )
    
    Cornus <- c(
                which(nsc.adult.total.mass$Spp == "COFL2")
                )
    
Liquidambar <- c(
                which(nsc.adult.total.mass$Spp == "LIST2")
                )

Liriodendron <- c(
                which(nsc.adult.total.mass$Spp == "LITU")
                )

    Magnolia <- c(
                which(nsc.adult.total.mass$Spp == "MAAC"),
                which(nsc.adult.total.mass$Spp == "MAFR"),
                which(nsc.adult.total.mass$Spp == "MAVI2"),
                which(nsc.adult.total.mass$Spp == "MAGR4")
                )
    
    Platanus <- c(
                which(nsc.adult.total.mass$Spp == "PLOC")
                )
    
       Fagus <- c(
                which(nsc.adult.total.mass$Spp == "FAGR")
                )
       
       Nyssa <- c(
                which(nsc.adult.total.mass$Spp == "NYSY")
                )
       
       Oxydendrum <- c(
                which(nsc.adult.total.mass$Spp == "OXAR")
                )
       
       Tilia <- c(
                which(nsc.adult.total.mass$Spp == "TIAM")
                )
    
     Populus <- c(
                which(nsc.adult.total.mass$Spp == "POGR4"),
                which(nsc.adult.total.mass$Spp == "POTR5")
                )
       
     Prunus <- c(
                which(nsc.adult.total.mass$Spp == "PRSE2")
                )

       Carya <- c(
                which(nsc.adult.total.mass$Spp == "CACO15"),
                which(nsc.adult.total.mass$Spp == "CAGL8"),
                which(nsc.adult.total.mass$Spp == "CALA21"),
                which(nsc.adult.total.mass$Spp == "CAOV2"),
                which(nsc.adult.total.mass$Spp == "CATO6")
                )
       
     Cercis <- c(
                which(nsc.adult.total.mass$Spp == "CECA4")
                )
     
  Diospyros <- c(
                which(nsc.adult.total.mass$Spp == "DIVI5")
                )
  
    Juglans <- c(
                which(nsc.adult.total.mass$Spp == "JUCI"),
                which(nsc.adult.total.mass$Spp == "JUNI")
                )
    
      Ulmus <- c(
                which(nsc.adult.total.mass$Spp == "ULAM")
                )

  ### Conifers
      Pinus <- c(
                which(nsc.adult.total.mass$Genus == "PIPA2"),
                which(nsc.adult.total.mass$Genus == "PIST"),
                which(nsc.adult.total.mass$Genus == "PIVI2"),
                which(nsc.adult.total.mass$Genus == "PIRE"),
                which(nsc.adult.total.mass$Genus == "PIRI"),
                which(nsc.adult.total.mass$Genus == "PITA")
                )
      
      Larix <- c(
                which(nsc.adult.total.mass$Spp == "LALA")
                )
      
      Picea <- c(
                which(nsc.adult.total.mass$Spp == "PIGL"),
                which(nsc.adult.total.mass$Spp == "PIMA"),
                which(nsc.adult.total.mass$Spp == "PIRU")
                )

      Abies <- c(
              which(nsc.adult.total.mass$Spp == "ABBA")
              )
      
Juniperus <- c(
              which(nsc.adult.total.mass$Spp == "JUVI")
              )

    Thuja <- c(
              which(nsc.adult.total.mass$Spp == "THOC2")
              )
    
    Tsuga <- c(
              which(nsc.adult.total.mass$Spp == "TSCA")
              )
    
    
    
    ### Set total dataframe for Genus
    
    nsc.adult.total.mass$genus <- NA
    nsc.adult.total.mass$genus[Pinus] <- "Pinus"
    nsc.adult.total.mass$genus[Larix] <- "Larix"
    nsc.adult.total.mass$genus[Picea] <- "Picea"
    nsc.adult.total.mass$genus[Abies] <- "Abies"
    nsc.adult.total.mass$genus[Thuja] <- "Thuja"
    nsc.adult.total.mass$genus[Tsuga] <- "Tsuga"
    nsc.adult.total.mass$genus[Juniperus] <- "Juniperus"
    nsc.adult.total.mass$genus[Quercus] <- "Quercus"
    nsc.adult.total.mass$genus[Fraxinus] <- "Fraxinus"
    nsc.adult.total.mass$genus[Ailanthus] <- "Ailanthus"
    nsc.adult.total.mass$genus[Robinia] <- "Robinia"
    nsc.adult.total.mass$genus[Acer] <- "Acer"
    nsc.adult.total.mass$genus[Aesculus] <- "Aesculus"
    nsc.adult.total.mass$genus[Betula] <- "Betula"
    nsc.adult.total.mass$genus[Carpinus] <- "Carpinus"
    nsc.adult.total.mass$genus[Cornus] <- "Cornus"
    nsc.adult.total.mass$genus[Liquidambar] <- "Liquidambar"
    nsc.adult.total.mass$genus[Liriodendron] <- "Liriodendron"
    nsc.adult.total.mass$genus[Magnolia] <- "Magnolia"
    nsc.adult.total.mass$genus[Platanus] <- "Platanus"
    nsc.adult.total.mass$genus[Fagus] <- "Fagus"
    nsc.adult.total.mass$genus[Nyssa] <- "Nyssa"
    nsc.adult.total.mass$genus[Oxydendrum] <- "Oxydendrum"
    nsc.adult.total.mass$genus[Tilia] <- "Tilia"
    nsc.adult.total.mass$genus[Populus] <- "Populus"
    nsc.adult.total.mass$genus[Prunus] <- "Prunus"
    nsc.adult.total.mass$genus[Carya] <- "Carya"
    nsc.adult.total.mass$genus[Cercis] <- "Cercis"
    nsc.adult.total.mass$genus[Diospyros] <- "Diospyros"
    nsc.adult.total.mass$genus[Juglans] <- "Juglans"
    nsc.adult.total.mass$genus[Ulmus] <- "Ulmus"
    
  ###Add Family
  Aceraceae <- c(
              which(nsc.adult.total.mass$genus == "Acer")
              )
  
  Betulaceae <- c(
                which(nsc.adult.total.mass$genus == "Betula"),
                which(nsc.adult.total.mass$genus == "Carpinus")
                )
  
  Cornaceae <- c(which(nsc.adult.total.mass$genus == "Cornus"),
                 which(nsc.adult.total.mass$genus == "Nyssa"))
  
  Cupressaceae <- c(which(nsc.adult.total.mass$genus == "Thuja"),
                    which(nsc.adult.total.mass$genus == "Juniperus"))
  
  Ebenaceae <- c(which(nsc.adult.total.mass$genus == "Diospyros"))
  
  Ericaceae <- c(which(nsc.adult.total.mass$genus == "Oxydendrum"))
  
  Fabaceae <- c(which(nsc.adult.total.mass$genus == "Robinia"),
                    which(nsc.adult.total.mass$genus == "Cercis"))
  
  Fagaceae <- c(which(nsc.adult.total.mass$genus == "Quercus"),
                which(nsc.adult.total.mass$genus == "Fagus"))
  
  Hamamelidaceae <- c(which(nsc.adult.total.mass$genus == "Liquidambar"))
  
  Hippocastanaceae <- c(which(nsc.adult.total.mass$genus == "Aesculus"))
  
  Juglandaceae <- c(which(nsc.adult.total.mass$genus == "Carya"),
                    which(nsc.adult.total.mass$genus == "Juglans"))
  
  Magnoliaceae <- c(which(nsc.adult.total.mass$genus == "Liriodendron"),
                    which(nsc.adult.total.mass$genus == "Magnolia"))
  
  Oleaceae <- c(which(nsc.adult.total.mass$genus == "Fraxinus"))
  
  Pinaceae <- c(which(nsc.adult.total.mass$genus == "Pinus"),
                which(nsc.adult.total.mass$genus == "Larix"),
                which(nsc.adult.total.mass$genus == "Picea"),
                which(nsc.adult.total.mass$genus == "Abies"),
                which(nsc.adult.total.mass$genus == "Tsuga")
                )
  
  Platanaceae <- c(which(nsc.adult.total.mass$genus == "Platanus"))
  
  Rosaceae <- c(which(nsc.adult.total.mass$genus == "Prunus"))
  
  Salicaceae <- c(which(nsc.adult.total.mass$genus == "Populus"))
  
  Simaroubaceae <- c(which(nsc.adult.total.mass$genus == "Ailanthus"))
  
  Tiliaceae <- c(which(nsc.adult.total.mass$genus == "Tilia"))
  
  Ulmaceae <- c(which(nsc.adult.total.mass$genus == "Ulmus"))
  
  #Set total dataframe for Family
  nsc.adult.total.mass$family <- NA
    nsc.adult.total.mass$family[Aceraceae] <- "Aceraceae"
    nsc.adult.total.mass$family[Betulaceae] <- "Betulaceae"       
    nsc.adult.total.mass$family[Cornaceae] <- "Cornaceae"
    nsc.adult.total.mass$family[Cupressaceae] <- "Cupressaceae"
    nsc.adult.total.mass$family[Ebenaceae] <- "Ebenaceae"
    nsc.adult.total.mass$family[Ericaceae] <- "Ericaceae"
    nsc.adult.total.mass$family[Fabaceae] <- "Fabaceae"
    nsc.adult.total.mass$family[Fagaceae] <- "Fagaceae"
    nsc.adult.total.mass$family[Hamamelidaceae] <- "Hamamelidaceae"
    nsc.adult.total.mass$family[Hippocastanaceae] <- "Hippocastanaceae"
    nsc.adult.total.mass$family[Juglandaceae] <- "Juglandaceae"
    nsc.adult.total.mass$family[Magnoliaceae] <- "Magnoliaceae"
    nsc.adult.total.mass$family[Oleaceae] <- "Oleaceae"   
    nsc.adult.total.mass$family[Pinaceae] <- "Pinaceae"
    nsc.adult.total.mass$family[Platanaceae] <- "Platanaceae"
    nsc.adult.total.mass$family[Rosaceae] <- "Rosaceae"
    nsc.adult.total.mass$family[Salicaceae] <- "Salicaceae"
    nsc.adult.total.mass$family[Simaroubaceae] <- "Simaroubaceae"
    nsc.adult.total.mass$family[Tiliaceae] <- "Tiliaceae"
    nsc.adult.total.mass$family[Ulmaceae] <- "Ulmaceae"


#only hardwood dataframe
early.h <- which(nsc.adult.total.mass$PFT == "Early.Hardwood")
mid.h <- which(nsc.adult.total.mass$PFT == "Mid.Hardwood")
late.h <- which(nsc.adult.total.mass$PFT == "Late.Hardwood")

nsc.adult.total.mass.hard <- rbind(
                             nsc.adult.total.mass[early.h,],
                             nsc.adult.total.mass[mid.h,],
                             nsc.adult.total.mass[late.h,]
                             )
#drop unused hardwood factor levels
# nsc.adult.total.mass.hard$Spp <- droplevels(nsc.adult.total.mass.hard$Spp)
# nsc.adult.total.mass.hard$PFT <- droplevels(nsc.adult.total.mass.hard$PFT)

nsc.adult.total.mass.hard$Spp <- as.character(nsc.adult.total.mass.hard$Spp)

nsc.adult.total.mass.hard$Spp <- factor(nsc.adult.total.mass.hard$Spp, 
                  levels = c("ACPE","AIAL","BEAL2","BELE",
                  "BEPA","BETUL","JUCI","JUNI","LIST2","LITU","POGR4","POTR5",
                  "PRSE2","ROPS","SAAL5","FRAM2","FRNI","FRQU","ACNE2",
                  "ACRU","CACA18","CACO15","CAGL8","CALA21","CAOV2",
                  "CATO6","CECA4","MAAC","MAFR","QUAL","QUCO2","QUIM",
                  "QUMO4","QUMU","QUPH","QURU","QUVE","QUVI","ULAM","ACFL",
                  "ACSA3","AEGL","FAGR","NYSY","OXAR","TIAM"), ordered = TRUE)

#levels(nsc.adult.total.mass.hard$Spp)
#levels(nsc.adult.total.mass.hard$PFT) <- c("Early.Hardwood","Mid.Hardwood","Late.Hardwood")
#levels(nsc.adult.total.mass.hard$PFT)

#nsc.adult.total.mass.hard <- nsc.adult.total.mass.hard[order(nsc.adult.total.mass.hard$Spp),]
#nsc.adult.total.mass.hard <- nsc.adult.total.mass.hard[order(nsc.adult.total.mass.hard$PFT),]

#only conifer dataframe
early.c <- which(nsc.adult.total.mass$PFT == "Early.Conifer")
late.c <- which(nsc.adult.total.mass$PFT == "Late.Conifer")

nsc.adult.total.mass.conif <- rbind(
  nsc.adult.total.mass[early.c,],
  nsc.adult.total.mass[late.c,]
)

#drop unused conifer factors
# nsc.adult.total.mass.conif$Spp <- droplevels(nsc.adult.total.mass.conif$Spp)
# nsc.adult.total.mass.conif$PFT <- droplevels(nsc.adult.total.mass.conif$PFT)

nsc.adult.total.mass.conif$Spp <- as.character(nsc.adult.total.mass.conif$Spp)

#relevel factors
nsc.adult.total.mass.conif$Spp <- factor(nsc.adult.total.mass.conif$Spp, 
                              levels = c("ABBA","JUVI","PIPA2","PIST","PIVI2","PIRE",
                                         "PIRI","PITA","LALA","PIGL","PIMA","PIRU",
                                         "THOC2","TSCA"), ordered = TRUE)
```

Phylogenetics Exploratory Analyses - ANOVA based

```{r}
#Species Anova
lm.species.total <- lm(total.nsc ~ Spp, data = nsc.adult.total.mass)
anova(lm.species.total)
summary(lm.species.total) #R^2 = .5322

#Genus anova
lm.genus.total <- lm(total.nsc ~ genus, data = nsc.adult.total.mass)
anova(lm.genus.total)
summary(lm.genus.total) #R^2 = .4867

#Family anova
lm.family.total <- lm(total.nsc ~ family, data = nsc.adult.total.mass)
anova(lm.family.total)
summary(lm.family.total) #R^2 = .4685

#PFT anova
lm.pft.total <- lm(total.nsc ~ PFT, data = nsc.adult.total.mass)
anova(lm.pft.total)
summary(lm.pft.total) #R^2 = .3336

#wood anatomy anova
lm.wood.total <- lm(total.nsc ~ wood, data = nsc.adult.total.mass)
anova(lm.wood.total)
summary(lm.wood.total) #R^2 = .3789
```

You can also embed plots, for example:

```{r fig.width=7, fig.height=6}
plot(cars)
```


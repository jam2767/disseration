Eastern US NSC Analysis
========================================================

This is the analysis for chapter 2 of my dissertation and for the first paper on nonstructural carbohydrates in eastern US forests.



```{r}
#load libraries
library(lme4)
library(ggplot2)
library(plyr)
#library(ape) not compiling right now
library(gridExtra)
library(multcompView)
library(grid)
library(MuMIn)

#helper functions
#function to find last value of vector
last <- function(x) { return( x[length(x)] ) }

#give sample size on boxplot for ggplot
give.n <- function(x){
  return(c(y = mean(x), label = length(x)))
}

#color-blind-friendly palettes
cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
```

```{r}
#Directories for census and NSC data
#read data
#read Adult Census Data
#adult <- read.csv("/Users/Josh/Dropbox/Dietze_Lab_Undergrads/JAM - Xsite/Field Data Entry/Data Sheets/Adult_Field_Data_JAM_MCD.csv")

adult <- read.csv("/Users/josh/Dropbox/Dissertation/CH1_Treerings/Data/Adult_Field_Data_JAM_MCD.csv")

#read NSC tracking data - contains sample mass used for assays
mass <- read.csv("/Users/Josh/Dropbox/NSC_Runs/All/Tracking/NSC_Mass_All_8172016.csv")

#all files starch files in one directory
data.dir.starch = "/Users/Josh/Dropbox/NSC_Runs/All/Starch"
data.dir.sugar = "/Users/Josh/Dropbox/NSC_Runs/All/Sugar"
```

```{r}
### Process STARCH data files ###

#starch files
files.starch <- dir(data.dir.starch,"Xsite")
baseline.files.starch <- files.starch[grep(pattern = "Baseline",files.starch)]
HK.files.starch <- files.starch[grep(pattern = "HK",files.starch)]

baseline.starch = NULL
for(i in seq_along(baseline.files.starch)){
  tmp <- read.csv(file.path(data.dir.starch,baseline.files.starch[i]),sep="",colClasses="character")
  baseline.starch = rbind(baseline.starch,tmp)
}
#mean.baseline.starch <- tapply(X = as.numeric(baseline.starch$Meas.), INDEX = baseline.starch$Sample, FUN = mean) #using mean of baseline - used for analysis through 9/1/2016, switching to last for future analysis. Last represents most accurate starting point for subtracting from sample after Hexokinase (HK) added.
last.baseline.starch <- tapply(X = as.numeric(baseline.starch$Meas.), INDEX = baseline.starch$Sample, FUN = last)
baseline.starch.id <- unique(baseline.starch$Sample)

#these files contain a run after HK is added
#measures starch content via breakdown of glucose & production of NADPH
HK.starch = NULL
for(i in seq_along(HK.files.starch)){
  tmp.HK.starch <- read.csv(file.path(data.dir.starch,HK.files.starch[i]),sep="",colClasses="character")
  HK.starch = rbind(HK.starch,tmp.HK.starch)
}
max.HK.starch <- tapply(X = as.numeric(HK.starch$Meas.), INDEX = HK.starch$Sample, FUN = max)
HK.starch.id <- unique(HK.starch$Sample)

# Check that samples finished converting all Starch. If not, flag for reanalysis
dif.HK.starch <- tapply(X = as.numeric(HK.starch$Meas.), INDEX = HK.starch$Sample, FUN = diff)
IDs.starch <- as.vector(attr(dif.HK.starch,"dimnames"))
IDs.starch <- unlist(IDs)

starch.nofinish <- list()
for(i in 1:length(dif.HK.starch)){
if ('0' %in% dif.HK.starch[[i]]) { #simplest check: time when absorbance not increasing?
  print("Sample Finished")
  } else {
  starch.nofinish[[i]] <- IDs.starch[[i]] #ID of sample that didn't finish
  }
}

starch.nofinish.ids <- unlist(starch.nofinish) #remove null values
#write.csv(starch.nofinish.ids, file = "unfinished_starch.csv") #save file to identify repeats

#### right now still using values for samples that didn't finish

#difference between baseline and HK
#total.starch <- max.HK.starch-mean.baseline.starch #old method using mean baseline value before 9/1/2016
total.starch <- max.HK.starch-last.baseline.starch #new method using last baseline value


##TODO use each standard curve for each individual plate
##currently only using one standard curve
#create standard curve equation

standard.abs.starch <- c(mean(total.starch[3:4]),mean(total.starch[1:2]),
                         mean(total.starch[5:6]),mean(total.starch[7:8]))
#standard.conc.starch <- c(0,0.5,1.0,1.5) #standard glucose concentrations in mmol for plate 2
standard.conc.starch <- c(0,20,40,60) #standard concentrations * 40 uL
standard.lm.starch <- lm(standard.abs.starch ~ standard.conc.starch)
summary(standard.lm.starch) #slope, intercept, R^2

#visualize standard curve
plot(standard.conc.starch,standard.abs.starch)
abline(standard.lm.starch)

#standard curve equation - calculate mmol glucose equivalents of samples
sample.conc.starch <- (total.starch - standard.lm.starch$coefficients[1])/standard.lm.starch$coefficients[2]
sample.conc.starch <- as.matrix(sample.conc.starch)
sample.ids.starch <- strsplit(row.names(sample.conc.starch),"_")

###create ID to match Core_ID in adult census data
core.id.starch <- array()
for(i in 1:length(sample.conc.starch)){
  core.id.starch[i] <- paste0(sample.ids.starch[[i]][1],
                              sample.ids.starch[[i]][2],
                              sample.ids.starch[[i]][3])
}

##bind core.id to sample matrix
sample.starch <- data.frame(core.id.starch,sample.conc.starch)
sample.agg.starch <- aggregate(sample.conc.starch~core.id.starch,sample.starch,mean)
matches.starch <- match(as.character(sample.agg.starch$core.id),as.character(adult$Core_ID14))
row.names(sample.agg.starch) <- NULL
nsc.adult.dat.starch <- data.frame(sample.agg.starch,adult[matches.starch,])

#match sample masses to absorbance
matches.mass.starch <- match(as.character(nsc.adult.dat.starch$Core_ID14),as.character(mass$Core_ID))
nsc.adult.starch.mass <- data.frame(nsc.adult.dat.starch,mass[matches.mass.starch,])

#mass column is Mass_mg
#calculate concentrations based on mass of sample used
nsc.adult.starch.mass$ug.sample <- nsc.adult.starch.mass$sample.conc.starch / 40 * 840 #micrograms/sample 40 ul drawn from 840 ul total volume of Starch Extraction

##TODO subsample for files that contain samples with different volume than 840 ul because they needed their ph fixed##
nsc.adult.starch.mass$Starch.mg.g <- nsc.adult.starch.mass$ug.sample / nsc.adult.starch.mass$Mass_mg #mg/gram of sample

### END Process STARCH data files ###
```

```{r}
### Process SUGAR data files ###

#Sugar Files
files.sugar <- dir(data.dir.sugar,"Xsite")
baseline.files.sugar <- files.sugar[grep(pattern = "Baseline", files.sugar)]
glucose.files.sugar <- files.sugar[grep(pattern = "Glucose", files.sugar)]
fructose.files.sugar <- files.sugar[grep(pattern = "Fructose", files.sugar)]
sucrose.files.sugar <- files.sugar[grep(pattern = "Sucrose", files.sugar)]

baseline.sugar = NULL
for(i in seq_along(baseline.files.sugar)){
  tmp <- read.csv(file.path(data.dir.sugar,baseline.files.sugar[i]),sep="",colClasses="character")
  baseline.sugar = rbind(baseline.sugar,tmp)
}
# mean.baseline.sugar <- tapply(X = as.numeric(baseline.sugar$Meas.), INDEX = baseline.sugar$Sample, FUN = mean) #using mean of baseline - used for analysis through 9/1/2016, switching to last for future analysis. Last represents most accurate starting point for subtracting from sample after HK added.
last.baseline.sugar <- tapply(X = as.numeric(baseline.sugar$Meas.), INDEX = baseline.sugar$Sample, FUN = last)
baseline.sugar.id <- unique(baseline.sugar$Sample)

#these files contain a run after Hexokinase is added
#measures sugar content via breakdown of glucose & production of NADPH
glucose.sugar = NULL
for(i in seq_along(glucose.files.sugar)){
  tmp.glucose <- read.csv(file.path(data.dir.sugar,glucose.files.sugar[i]),sep="",colClasses="character")
  glucose.sugar = rbind(glucose.sugar,tmp.glucose)
}
max.glucose.sugar <- tapply(X = as.numeric(glucose.sugar$Meas.), INDEX = glucose.sugar$Sample, FUN = max)
glucose.sugar.id <- unique(glucose.sugar$Sample)

# Check that samples finished converting all glucose. If not, flag for reanalysis
dif.HK.sugar <- tapply(X = as.numeric(glucose.sugar$Meas.), INDEX = glucose.sugar$Sample, FUN = diff)
IDs.gluc <- as.vector(attr(dif.HK.sugar,"dimnames"))
IDs.gluc <- unlist(IDs.gluc)

gluc.nofinish <- list()
for(i in 1:length(dif.HK.sugar)){
if ('0' %in% dif.HK.sugar[[i]]) { #simplest check: time when absorbance not increasing?
  print("Sample Finished")
  } else {
  gluc.nofinish[[i]] <- IDs.gluc[[i]] #ID of sample that didn't finish
  }
}

gluc.nofinish.ids <- unlist(gluc.nofinish) #remove null values
#write.csv(gluc.nofinish.ids, file = "unfinished_glucose.csv") #save file to identify repeats


#difference between baseline and HK (glucose content)
total.glucose <- max.glucose.sugar-last.baseline.sugar #old method used mean.baseline.sugar

#these files contain  a run after hexokinase and PGI have been added
#measures sugar content via breakdown of fructose & production of NADPH
fructose.sugar = NULL
for(i in seq_along(fructose.files.sugar)){
  tmp.fructose <- read.csv(file.path(data.dir.sugar,fructose.files.sugar[i]),sep="",colClasses="character")
  fructose.sugar = rbind(fructose.sugar,tmp.fructose)
}
max.fructose.sugar <- tapply(X = as.numeric(fructose.sugar$Meas.), INDEX = fructose.sugar$Sample, FUN = max)
fructose.sugar.id <- unique(fructose.sugar$Sample)

#difference between HK and PGI (Fructose content)
last.glucose.sugar <- tapply(X = as.numeric(glucose.sugar$Meas.), INDEX = glucose.sugar$Sample, FUN = last)

# Check that samples finished converting all fructose. If not, flag for reanalysis
dif.PGI.sugar <- tapply(X = as.numeric(fructose.sugar$Meas.), INDEX = fructose.sugar$Sample, FUN = diff)
IDs.fruc <- as.vector(attr(dif.PGI.sugar,"dimnames"))
IDs.fruc <- unlist(IDs.fruc)

fruc.nofinish <- list()
for(i in 1:length(dif.PGI.sugar)){
if ('0' %in% dif.PGI.sugar[[i]]) { #simplest check: time when absorbance not increasing?
  print("Sample Finished")
  } else {
  fruc.nofinish[[i]] <- IDs.fruc[[i]] #ID of sample that didn't finish
  }
}

fruc.nofinish.ids <- unlist(fruc.nofinish) #remove null values
#write.csv(fruc.nofinish.ids, file = "unfinished_fructose.csv") #save file to identify repeats


total.fructose <- max.fructose.sugar-last.glucose.sugar

#these files contain  a run after hexokinase, PGI and Invertase have been added
#measures sugar content via breakdown of sucrose & production of NADPH
sucrose.sugar = NULL
for(i in seq_along(sucrose.files.sugar)){
  tmp.sucrose <- read.csv(file.path(data.dir.sugar,sucrose.files.sugar[i]),sep="",colClasses="character")
  sucrose.sugar = rbind(sucrose.sugar,tmp.sucrose)
}
max.sucrose.sugar <- tapply(X = as.numeric(sucrose.sugar$Meas.), INDEX = sucrose.sugar$Sample, FUN = max)
sucrose.sugar.id <- unique(sucrose.sugar$Sample)

# Check that samples finished converting all sucrose. If not, flag for reanalysis
dif.INV.sugar <- tapply(X = as.numeric(sucrose.sugar$Meas.), INDEX = sucrose.sugar$Sample, FUN = diff)
IDs.sucr <- as.vector(attr(dif.INV.sugar,"dimnames"))
IDs.sucr <- unlist(IDs.sucr)

sucr.nofinish <- list()
for(i in 1:length(dif.INV.sugar)){
if ('0' %in% dif.INV.sugar[[i]]) { #simplest check: time when absorbance not increasing?
  print("Sample Finished")
  } else {
  sucr.nofinish[[i]] <- IDs.sucr[[i]] #ID of sample that didn't finish
  }
}

sucr.nofinish.ids <- unlist(sucr.nofinish) #remove null values
#write.csv(sucr.nofinish.ids, file = "unfinished_sucrose.csv") #save file to identify repeats


#difference between HK and PGI (Fructose content)
last.fructose.sugar <- tapply(X = as.numeric(fructose.sugar$Meas.), INDEX = fructose.sugar$Sample, FUN = last)
total.sucrose <- max.sucrose.sugar-last.fructose.sugar

##TODO use each standard curve for each individual plate
##currenlty only using one standard curve
#create standard curve equation

standard.abs.sugar <- c(mean(total.glucose[3:4]),mean(total.glucose[1:2]),
                         mean(total.glucose[5:6]),mean(total.glucose[7:8]))
#standard.conc.starch <- c(0,0.5,1.0,1.5) #standard glucose concentrations in mmol for plate 2
standard.conc.sugar <- c(0,20,40,60) #standard concentrations * 40 uL
standard.lm.sugar <- lm(standard.abs.sugar ~ standard.conc.sugar)
summary(standard.lm.sugar) #slope, intercept, R^2

#visualize standard curve
plot(standard.conc.sugar,standard.abs.sugar)
abline(standard.lm.sugar)

#standard curve equation - calculate mmol glucose equivalents of samples
sample.conc.glucose <- ((total.glucose) - standard.lm.sugar$coefficients[1])/standard.lm.sugar$coefficients[2] #only 20ul of sample was used, compared to 40ul of standard
sample.conc.glucose <- as.matrix(sample.conc.glucose)
sample.ids.glucose <- strsplit(row.names(sample.conc.glucose),"_")

sample.conc.fructose <- ((total.fructose) - standard.lm.sugar$coefficients[1])/standard.lm.sugar$coefficients[2] #only 20ul of sample was used, compared to 40ul of standard
sample.conc.fructose <- as.matrix(sample.conc.fructose)
sample.ids.fructose <- strsplit(row.names(sample.conc.fructose),"_")

sample.conc.sucrose <- ((total.sucrose) - standard.lm.sugar$coefficients[1])/standard.lm.sugar$coefficients[2] #only 20ul of sample was used, compared to 40ul of standard
sample.conc.sucrose <- as.matrix(sample.conc.sucrose)
sample.ids.sucrose <- strsplit(row.names(sample.conc.sucrose),"_")

###create ID to match Core_ID in adult census data
core.id.sugar <- array()
for(i in 1:length(sample.conc.glucose)){
  core.id.sugar[i] <- paste0(sample.ids.glucose[[i]][1],
                              sample.ids.glucose[[i]][2],
                              sample.ids.glucose[[i]][3])
}

##bind core.id to sample matrix
sample.sugar <- data.frame(core.id.sugar,sample.conc.glucose,sample.conc.fructose,sample.conc.sucrose)
sample.agg.glucose <- aggregate(sample.conc.glucose ~ core.id.sugar, sample.sugar, mean)
sample.agg.fructose <- aggregate(sample.conc.fructose ~ core.id.sugar, sample.sugar, mean)
sample.agg.sucrose <- aggregate(sample.conc.sucrose ~ core.id.sugar, sample.sugar, mean)
sample.agg.sugar <- data.frame(sample.agg.glucose$core.id.sugar, sample.agg.glucose$sample.conc.glucose,
                               sample.agg.fructose$sample.conc.fructose, sample.agg.sucrose$sample.conc.sucrose)

matches.sugar <- match(as.character(sample.agg.sugar$sample.agg.glucose.core.id),as.character(adult$Core_ID14))
row.names(sample.agg.sugar) <- NULL
nsc.adult.dat.sugar <- data.frame(sample.agg.sugar,adult[matches.sugar,])

#match sample masses to absorbance
matches.mass.sugar <- match(as.character(nsc.adult.dat.sugar$Core_ID14),as.character(mass$Core_ID))
nsc.adult.sugar.mass <- data.frame(nsc.adult.dat.sugar,mass[matches.mass.sugar,])

#mass column is Mass_mg
#calculate concentrations of glucose based on mass of sample used
nsc.adult.sugar.mass$ug.glucose <- nsc.adult.sugar.mass$sample.agg.glucose.sample.conc.glucose / 20 * 845 #micrograms/sample 20 ul drawn from 845 ul total volume of Sugar Extraction
nsc.adult.sugar.mass$glucose.mg.g <- nsc.adult.sugar.mass$ug.glucose / nsc.adult.sugar.mass$Mass_mg #mg/gram of sample

#calculate concentrations of fructose based on mass of sample used
nsc.adult.sugar.mass$ug.fructose <- nsc.adult.sugar.mass$sample.agg.fructose.sample.conc.fructose / 20 * 845 #micrograms/sample 20 ul drawn from 845 ul total volume of Sugar Extraction
nsc.adult.sugar.mass$fructose.mg.g <- nsc.adult.sugar.mass$ug.fructose / nsc.adult.sugar.mass$Mass_mg #mg/gram of sample

#calculate concentrations of fructose based on mass of sample used
nsc.adult.sugar.mass$ug.sucrose <- nsc.adult.sugar.mass$sample.agg.sucrose.sample.conc.sucrose / 20 * 845 #micrograms/sample 20 ul drawn from 845 ul total volume of Sugar Extraction
nsc.adult.sugar.mass$sucrose.mg.g <- nsc.adult.sugar.mass$ug.sucrose / nsc.adult.sugar.mass$Mass_mg #mg/gram of sample

### END process SUGAR files ###
```

Combining data from sugar and starch runs into one dataframe

```{r}
### Combine Sugar and Starch for total NSC ###
starch.only <- data.frame(nsc.adult.starch.mass$core.id.starch,nsc.adult.starch.mass$Starch.mg.g)
matches.sugar.starch <- match(as.character(nsc.adult.sugar.mass$sample.agg.glucose.core.id.sugar),as.character(starch.only$nsc.adult.starch.mass.core.id.starch))
row.names(nsc.adult.sugar.mass) <- NULL
row.names(starch.only) <- NULL
nsc.adult.total.mass <- data.frame(nsc.adult.sugar.mass,starch.only[matches.sugar.starch,])
nsc.adult.total.mass$total.nsc <- mapply(nsc.adult.total.mass$nsc.adult.starch.mass.Starch.mg.g,
                                      nsc.adult.total.mass$glucose.mg.g,
                                      nsc.adult.total.mass$fructose.mg.g,
                                      nsc.adult.total.mass$sucrose.mg.g, FUN=sum, na.rm=FALSE)                                   
#rename starch column
colnames(nsc.adult.total.mass)[115] <- "core.id.starch"
colnames(nsc.adult.total.mass)[116] <- "starch.mg.g"

#csv to identify missing starch or sugar samples
#write.csv(nsc.adult.total.mass, file = "nsc.adult.total.mass.missingincluded.csv")

#remove NAs for total.nsc
nsc.adult.total.mass <- nsc.adult.total.mass[which(nsc.adult.total.mass$total.nsc != "NA"),]

nsc.adult.total.mass$sugar.mg.g <- mapply(nsc.adult.total.mass$glucose.mg.g,
                                          nsc.adult.total.mass$fructose.mg.g,
                                          nsc.adult.total.mass$sucrose.mg.g, FUN=sum, na.rm=FALSE)

### END combine sugar and starch ###
```

Adding Plant Functional Type (PFT) and Wood Anatomy as covariates for analysis. USDA PLANTS database and USFS Silvics of North America manual used for PFT determination.

```{r}
### Adding PFT and Wood Anatomy covariates ###

##adding PFTs
###Reference: http://plants.usda.gov/java/
### Also USFS silvics manual: https://www.na.fs.fed.us/spfo/pubs/silvics_manual/table_of_contents.htm

# Hardwoods
Early.Hardwood <- c(
                    which(nsc.adult.total.mass$Spp == "ACPE"),#
                    which(nsc.adult.total.mass$Spp == "AIAL"),#
                    which(nsc.adult.total.mass$Spp == "BEAL2"),#
                    which(nsc.adult.total.mass$Spp == "BELE"),#
                    which(nsc.adult.total.mass$Spp == "BEPA"),#
                    which(nsc.adult.total.mass$Spp == "BETUL"),#
                    which(nsc.adult.total.mass$Spp == "COFL2"),#
                    which(nsc.adult.total.mass$Spp == "JUCI"),#
                    which(nsc.adult.total.mass$Spp == "JUNI"),#
                    which(nsc.adult.total.mass$Spp == "LIST2"),#
                    which(nsc.adult.total.mass$Spp == "LITU"),#
                    which(nsc.adult.total.mass$Spp == "POGR4"),#
                    which(nsc.adult.total.mass$Spp == "POTR5"),#
                    which(nsc.adult.total.mass$Spp == "PRSE2"),#
                    which(nsc.adult.total.mass$Spp == "ROPS"),#
                    which(nsc.adult.total.mass$Spp == "SAAL5")#
                    ) #16 Spp

Mid.Hardwood <- c(
                  which(nsc.adult.total.mass$Spp == "FRAM2"),#
                  which(nsc.adult.total.mass$Spp == "FRNI"),#
                  which(nsc.adult.total.mass$Spp == "FRQU"),#
                  which(nsc.adult.total.mass$Spp == "ACNE2"),#
                  which(nsc.adult.total.mass$Spp == "ACRU"),#
                  which(nsc.adult.total.mass$Spp == "CACA18"),#
                  which(nsc.adult.total.mass$Spp == "CACO15"),#
                  which(nsc.adult.total.mass$Spp == "CAGL8"),#
                  which(nsc.adult.total.mass$Spp == "CALA21"),#
                  which(nsc.adult.total.mass$Spp == "CAOV2"),#
                  which(nsc.adult.total.mass$Spp == "CATO6"),#
                  which(nsc.adult.total.mass$Spp == "CECA4"),#
                  which(nsc.adult.total.mass$Spp == "MAAC"),#
                  which(nsc.adult.total.mass$Spp == "MAFR"),#
                  which(nsc.adult.total.mass$Spp == "MAVI2"),#
                  which(nsc.adult.total.mass$Spp == "PLOC"),#
                  which(nsc.adult.total.mass$Spp == "QUAL"),#
                  which(nsc.adult.total.mass$Spp == "QUCO2"),#
                  which(nsc.adult.total.mass$Spp == "QUERC"),#
                  which(nsc.adult.total.mass$Spp == "QUIM"),#
                  which(nsc.adult.total.mass$Spp == "QULA2"),#
                  which(nsc.adult.total.mass$Spp == "QULA3"),#
                  which(nsc.adult.total.mass$Spp == "QUMO4"),#
                  which(nsc.adult.total.mass$Spp == "QUMU"),#
                  which(nsc.adult.total.mass$Spp == "QUNI"),#
                  which(nsc.adult.total.mass$Spp == "QUPH"),#
                  which(nsc.adult.total.mass$Spp == "QURU"),#
                  which(nsc.adult.total.mass$Spp == "QUST"),#
                  which(nsc.adult.total.mass$Spp == "QUVE"),#
                  which(nsc.adult.total.mass$Spp == "QUVI"),#
                  which(nsc.adult.total.mass$Spp == "ULAM")#
                  ) #31 Spp

Late.Hardwood <- c(
                  which(nsc.adult.total.mass$Spp == "ACFL"),#
                  which(nsc.adult.total.mass$Spp == "ACSA3"),#
                  which(nsc.adult.total.mass$Spp == "AEGL"),#
                  which(nsc.adult.total.mass$Spp == "DIVI5"),#
                  which(nsc.adult.total.mass$Spp == "FAGR"),#
                  which(nsc.adult.total.mass$Spp == "MAGR4"),#
                  which(nsc.adult.total.mass$Spp == "NYSY"),#
                  which(nsc.adult.total.mass$Spp == "OXAR"),#
                  which(nsc.adult.total.mass$Spp == "TIAM")#
                  ) #9 Spp

# set PFTs
nsc.adult.total.mass$PFT <- NA
nsc.adult.total.mass$PFT[Early.Hardwood] <- "Early.Hardwood"
nsc.adult.total.mass$PFT[Mid.Hardwood] <- "Mid.Hardwood"
nsc.adult.total.mass$PFT[Late.Hardwood] <- "Late.Hardwood"

# Conifers
Early.Conifer <- c(
                  which(nsc.adult.total.mass$Spp == "ABBA"),#
                  which(nsc.adult.total.mass$Spp == "JUVI"),#
                  which(nsc.adult.total.mass$Spp == "PIPA2"),#
                  which(nsc.adult.total.mass$Spp == "PIST"),#
                  which(nsc.adult.total.mass$Spp == "PIVI2"),#
                  which(nsc.adult.total.mass$Spp == "PIRE"),#
                  which(nsc.adult.total.mass$Spp == "PIRI"),#
                  which(nsc.adult.total.mass$Spp == "PITA")#
                  ) #8 Spp

Late.Conifer <- c(
                  which(nsc.adult.total.mass$Spp == "LALA"),#
                  which(nsc.adult.total.mass$Spp == "PIGL"),#
                  which(nsc.adult.total.mass$Spp == "PIMA"),#
                  which(nsc.adult.total.mass$Spp == "PIRU"),#
                  which(nsc.adult.total.mass$Spp == "THOC2"),#
                  which(nsc.adult.total.mass$Spp == "TSCA")#
                  ) #6 Spp

nsc.adult.total.mass$PFT[Early.Conifer] <- "Early.Conifer"
nsc.adult.total.mass$PFT[Late.Conifer] <- "Late.Conifer"

# adding wood anatomy
###Reference http://www.wood-database.com/
###Disagree with reference for hickory classification - put all as semi-ring porous. conferred with Christy

large.resin <- c(
                which(nsc.adult.total.mass$Spp == "PIPA2"),
                which(nsc.adult.total.mass$Spp == "PIST"),
                which(nsc.adult.total.mass$Spp == "PIVI2"),
                which(nsc.adult.total.mass$Spp == "PIRE"),
                which(nsc.adult.total.mass$Spp == "PIRI"),
                which(nsc.adult.total.mass$Spp == "PITA")
                )

small.resin <- c(
                which(nsc.adult.total.mass$Spp == "LALA"),
                which(nsc.adult.total.mass$Spp == "PIGL"),
                which(nsc.adult.total.mass$Spp == "PIMA"),
                which(nsc.adult.total.mass$Spp == "PIRU")
                )

no.resin <- c(
              which(nsc.adult.total.mass$Spp == "ABBA"),
              which(nsc.adult.total.mass$Spp == "JUVI"),
              which(nsc.adult.total.mass$Spp == "THOC2"),
              which(nsc.adult.total.mass$Spp == "TSCA")
              )

ring.porous <- c(
                which(nsc.adult.total.mass$Spp == "AIAL"),              
                which(nsc.adult.total.mass$Spp == "FRAM2"),
                which(nsc.adult.total.mass$Spp == "FRNI"),
                which(nsc.adult.total.mass$Spp == "FRQU"),
                which(nsc.adult.total.mass$Spp == "QUAL"),
                which(nsc.adult.total.mass$Spp == "QUCO2"),
                which(nsc.adult.total.mass$Spp == "QUERC"),
                which(nsc.adult.total.mass$Spp == "QUIM"),
                which(nsc.adult.total.mass$Spp == "QULA2"),
                which(nsc.adult.total.mass$Spp == "QULA3"),
                which(nsc.adult.total.mass$Spp == "QUMO4"),
                which(nsc.adult.total.mass$Spp == "QUMU"),
                which(nsc.adult.total.mass$Spp == "QUNI"),
                which(nsc.adult.total.mass$Spp == "QUPH"),
                which(nsc.adult.total.mass$Spp == "QURU"),
                which(nsc.adult.total.mass$Spp == "QUST"),
                which(nsc.adult.total.mass$Spp == "QUVE"),
                which(nsc.adult.total.mass$Spp == "QUVI"),
                which(nsc.adult.total.mass$Spp == "ROPS"),
                which(nsc.adult.total.mass$Spp == "SAAL5")
                )

diffuse.porous <- c(
                    which(nsc.adult.total.mass$Spp == "ACNE2"),
                    which(nsc.adult.total.mass$Spp == "ACPE"),
                    which(nsc.adult.total.mass$Spp == "ACRU"),
                    which(nsc.adult.total.mass$Spp == "ACSA3"),
                    which(nsc.adult.total.mass$Spp == "AEGL"),
                    which(nsc.adult.total.mass$Spp == "BEAL2"),
                    which(nsc.adult.total.mass$Spp == "BELE"),
                    which(nsc.adult.total.mass$Spp == "BEPA"),
                    which(nsc.adult.total.mass$Spp == "BETUL"),
                    which(nsc.adult.total.mass$Spp == "CACA18"),
                    which(nsc.adult.total.mass$Spp == "COFL2"),
                    which(nsc.adult.total.mass$Spp == "LIST2"),
                    which(nsc.adult.total.mass$Spp == "LITU"),
                    which(nsc.adult.total.mass$Spp == "MAAC"),
                    which(nsc.adult.total.mass$Spp == "MAFR"),
                    which(nsc.adult.total.mass$Spp == "MAVI2"),                  
                    which(nsc.adult.total.mass$Spp == "PLOC"),
                    which(nsc.adult.total.mass$Spp == "FAGR"),
                    which(nsc.adult.total.mass$Spp == "MAGR4"),
                    which(nsc.adult.total.mass$Spp == "NYSY"),
                    which(nsc.adult.total.mass$Spp == "OXAR"),
                    which(nsc.adult.total.mass$Spp == "TIAM"),
                    which(nsc.adult.total.mass$Spp == "POGR4"),
                    which(nsc.adult.total.mass$Spp == "POTR5"),
                    which(nsc.adult.total.mass$Spp == "PRSE2")               
                    )

semiring.porous <- c(
                    which(nsc.adult.total.mass$Spp == "CACO15"),
                    which(nsc.adult.total.mass$Spp == "CAGL8"),
                    which(nsc.adult.total.mass$Spp == "CALA21"),
                    which(nsc.adult.total.mass$Spp == "CAOV2"),
                    which(nsc.adult.total.mass$Spp == "CATO6"),
                    which(nsc.adult.total.mass$Spp == "CECA4"),
                    which(nsc.adult.total.mass$Spp == "DIVI5"), #bordering diffuse porous
                    which(nsc.adult.total.mass$Spp == "JUCI"),
                    which(nsc.adult.total.mass$Spp == "JUNI"),
                    which(nsc.adult.total.mass$Spp == "ULAM")                                   
                    )

#set anatomy
nsc.adult.total.mass$wood <- NA
nsc.adult.total.mass$wood[large.resin] <- "large.resin"
nsc.adult.total.mass$wood[small.resin] <- "small.resin"
nsc.adult.total.mass$wood[no.resin] <- "no.resin"
nsc.adult.total.mass$wood[ring.porous] <- "ring.porous"
nsc.adult.total.mass$wood[diffuse.porous] <- "diffuse.porous"
nsc.adult.total.mass$wood[semiring.porous] <- "semiring.porous"

#Relevel Factors
nsc.adult.total.mass$wood <- factor(nsc.adult.total.mass$wood, 
                                    levels = c("large.resin","small.resin","no.resin",
                                               "ring.porous","semiring.porous",
                                               "diffuse.porous"))



###Reference: http://plants.usda.gov/java/
# adding species string
    alba <- which(nsc.adult.total.mass$Spp == "QUAL")
    coccinea <- which(nsc.adult.total.mass$Spp == "QUCO2")
    none <- c(which(nsc.adult.total.mass$Spp == "QUERC"),
              which(nsc.adult.total.mass$Spp == "BETUL"))
    imbricaria <- which(nsc.adult.total.mass$Spp == "QUIM")
    laevis <- which(nsc.adult.total.mass$Spp == "QULA2")
    laurifolia <- which(nsc.adult.total.mass$Spp == "QULA3")
    montana <- which(nsc.adult.total.mass$Spp == "QUMO4")
    muehlenbergii <- which(nsc.adult.total.mass$Spp == "QUMU")
    nigra <- c(which(nsc.adult.total.mass$Spp == "QUNI"),
               which(nsc.adult.total.mass$Spp == "FRNI"),
               which(nsc.adult.total.mass$Spp == "JUNI"))
    phellos <- which(nsc.adult.total.mass$Spp == "QUPH")
    rubra <- which(nsc.adult.total.mass$Spp == "QURU")
    stellata <- which(nsc.adult.total.mass$Spp == "QUST")
    velutina <- which(nsc.adult.total.mass$Spp == "QUVE")
    virginiana <- c(which(nsc.adult.total.mass$Spp == "QUVI"),
                  which(nsc.adult.total.mass$Spp == "MAVI2"),
                  which(nsc.adult.total.mass$Spp == "DIVI5"),
                  which(nsc.adult.total.mass$Spp == "PIVI2"),
                  which(nsc.adult.total.mass$Spp == "JUVI"))
    americana <- c(which(nsc.adult.total.mass$Spp == "FRAM2"),
                   which(nsc.adult.total.mass$Spp == "TIAM"),
                   which(nsc.adult.total.mass$Spp == "ULAM"))
    quadrangulata <- which(nsc.adult.total.mass$Spp == "FRQU")
    altissima <- which(nsc.adult.total.mass$Spp == "AIAL")
    pseudoacacia <- which(nsc.adult.total.mass$Spp == "ROPS")
    albidum <- which(nsc.adult.total.mass$Spp == "SAAL5")
    negundo <- which(nsc.adult.total.mass$Spp == "ACNE2")
    pensylvanicum <- which(nsc.adult.total.mass$Spp == "ACPE")
    rubrum <- which(nsc.adult.total.mass$Spp == "ACRU")
    saccharum <- which(nsc.adult.total.mass$Spp == "ACSA3")
    glabra <- c(which(nsc.adult.total.mass$Spp == "AEGL"),
                which(nsc.adult.total.mass$Spp == "CAGL8"))
    alleghaniensis <- which(nsc.adult.total.mass$Spp == "BEAL2")
    lenta <- which(nsc.adult.total.mass$Spp == "BELE")
    papyrifera <- which(nsc.adult.total.mass$Spp == "BEPA")
    caroliniana <- which(nsc.adult.total.mass$Spp == "CACA18")
    florida <- which(nsc.adult.total.mass$Spp == "COFL2")
    styraciflua <- which(nsc.adult.total.mass$Spp == "LIST2")
    tulipifera <- which(nsc.adult.total.mass$Spp == "LITU")
    acuminata <- which(nsc.adult.total.mass$Spp == "MAAC")
    fraseri <- which(nsc.adult.total.mass$Spp == "MAFR")
    grandiflora <- which(nsc.adult.total.mass$Spp == "MAGR4")
    occidentalis <- which(nsc.adult.total.mass$Spp == "PLOC")
    grandifolia <- which(nsc.adult.total.mass$Spp == "FAGR")
    sylvatica <- which(nsc.adult.total.mass$Spp == "NYSY")
    arboreum <- which(nsc.adult.total.mass$Spp == "OXAR")
    grandidentata <- which(nsc.adult.total.mass$Spp == "POGR4")
    tremuloides <- which(nsc.adult.total.mass$Spp == "POTR5")
    serotina <- which(nsc.adult.total.mass$Spp == "PRSE2")
    cordiformis <- which(nsc.adult.total.mass$Spp == "CACO15")
    laciniosa <- which(nsc.adult.total.mass$Spp == "CALA21")
    ovata <- which(nsc.adult.total.mass$Spp == "CAOV2")
    tomentosa <- which(nsc.adult.total.mass$Spp == "CATO6")
    canadensis <- c(which(nsc.adult.total.mass$Spp == "CECA4"),
                    which(nsc.adult.total.mass$Spp == "TSCA"))
    cinerea <- which(nsc.adult.total.mass$Spp == "JUCI")
    palustris <- which(nsc.adult.total.mass$Spp == "PIPA2")
    strobus <- which(nsc.adult.total.mass$Spp == "PIST")
    resinosa <- which(nsc.adult.total.mass$Spp == "PIRE")
    rigida <- which(nsc.adult.total.mass$Spp == "PIRI")
    taeda <- which(nsc.adult.total.mass$Spp == "PITA")
    laricina <- which(nsc.adult.total.mass$Spp == "LALA")
    glauca <- which(nsc.adult.total.mass$Spp == "PIGL")
    mariana <- which(nsc.adult.total.mass$Spp == "PIMA")
    rubens <- which(nsc.adult.total.mass$Spp == "PIRU")
    balsamea <- which(nsc.adult.total.mass$Spp == "ABBA")
    occidentalis <- which(nsc.adult.total.mass$Spp == "THOC2")
    
    ### Set total dataframe for species
    
    nsc.adult.total.mass$species <- NA
    nsc.adult.total.mass$species[alba] <- "alba"
    nsc.adult.total.mass$species[coccinea] <- "coccinea"
    nsc.adult.total.mass$species[none] <- "none"
    nsc.adult.total.mass$species[imbricaria] <- "imbricaria"
    nsc.adult.total.mass$species[laevis] <- "laevis"
    nsc.adult.total.mass$species[laurifolia] <- "laurifolia"
    nsc.adult.total.mass$species[montana] <- "montana"
    nsc.adult.total.mass$species[muehlenbergii] <- "muehlenbergii"
    nsc.adult.total.mass$species[nigra] <- "nigra"
    nsc.adult.total.mass$species[phellos] <- "phellos"
    nsc.adult.total.mass$species[rubra] <- "rubra"
    nsc.adult.total.mass$species[stellata] <- "stellata"
    nsc.adult.total.mass$species[velutina] <- "velutina"
    nsc.adult.total.mass$species[virginiana] <- "virginiana"
    nsc.adult.total.mass$species[americana] <- "americana"
    nsc.adult.total.mass$species[quadrangulata] <- "quadrangulata"
    nsc.adult.total.mass$species[altissima] <- "altissima"
    nsc.adult.total.mass$species[pseudoacacia] <- "pseudoacacia"
    nsc.adult.total.mass$species[albidum] <- "albidum"
    nsc.adult.total.mass$species[negundo] <- "negundo"
    nsc.adult.total.mass$species[pensylvanicum] <- "pensylvanicum"
    nsc.adult.total.mass$species[rubrum] <- "rubrum"
    nsc.adult.total.mass$species[saccharum] <- "saccharum"
    nsc.adult.total.mass$species[glabra] <- "glabra"
    nsc.adult.total.mass$species[alleghaniensis] <- "alleghaniensis"
    nsc.adult.total.mass$species[lenta] <- "lenta"
    nsc.adult.total.mass$species[papyrifera] <- "papyrifera"
    nsc.adult.total.mass$species[caroliniana] <- "caroliniana"
    nsc.adult.total.mass$species[florida] <- "florida"
    nsc.adult.total.mass$species[styraciflua] <- "styraciflua"
    nsc.adult.total.mass$species[tulipifera] <- "tulipifera"
    nsc.adult.total.mass$species[acuminata] <- "acuminata"
    nsc.adult.total.mass$species[fraseri] <- "fraseri"
    nsc.adult.total.mass$species[grandiflora] <- "grandiflora"
    nsc.adult.total.mass$species[occidentalis] <- "occidentalis"
    nsc.adult.total.mass$species[grandifolia] <- "grandifolia"
    nsc.adult.total.mass$species[sylvatica] <- "sylvatica"
    nsc.adult.total.mass$species[arboreum] <- "arboreum"
    nsc.adult.total.mass$species[grandidentata] <- "grandidentata"
    nsc.adult.total.mass$species[tremuloides] <- "tremuloides"
    nsc.adult.total.mass$species[serotina] <- "serotina"
    nsc.adult.total.mass$species[cordiformis] <- "cordiformis"
    nsc.adult.total.mass$species[laciniosa] <- "laciniosa"
    nsc.adult.total.mass$species[ovata] <- "ovata"
    nsc.adult.total.mass$species[tomentosa] <- "tomentosa"
    nsc.adult.total.mass$species[canadensis] <- "canadensis"
    nsc.adult.total.mass$species[cinerea] <- "cinerea"
    nsc.adult.total.mass$species[palustris] <- "palustris"
    nsc.adult.total.mass$species[strobus] <- "strobus"
    nsc.adult.total.mass$species[resinosa] <- "resinosa"
    nsc.adult.total.mass$species[rigida] <- "rigida"
    nsc.adult.total.mass$species[taeda] <- "taeda"
    nsc.adult.total.mass$species[laricina] <- "laricina"
    nsc.adult.total.mass$species[glauca] <- "glauca"
    nsc.adult.total.mass$species[mariana] <- "mariana"
    nsc.adult.total.mass$species[rubens] <- "rubens"
    nsc.adult.total.mass$species[balsamea] <- "balsamea"
    nsc.adult.total.mass$species[occidentalis] <- "occidentalis"

# adding genus and family
  ### Hardwoods

    Quercus <- c(                
                which(nsc.adult.total.mass$Spp == "QUAL"),
                which(nsc.adult.total.mass$Spp == "QUCO2"),
                which(nsc.adult.total.mass$Spp == "QUERC"),
                which(nsc.adult.total.mass$Spp == "QUIM"),
                which(nsc.adult.total.mass$Spp == "QULA2"),
                which(nsc.adult.total.mass$Spp == "QULA3"),
                which(nsc.adult.total.mass$Spp == "QUMO4"),
                which(nsc.adult.total.mass$Spp == "QUMU"),
                which(nsc.adult.total.mass$Spp == "QUNI"),
                which(nsc.adult.total.mass$Spp == "QUPH"),
                which(nsc.adult.total.mass$Spp == "QURU"),
                which(nsc.adult.total.mass$Spp == "QUST"),
                which(nsc.adult.total.mass$Spp == "QUVE"),
                which(nsc.adult.total.mass$Spp == "QUVI")
                )
    
   Fraxinus <- c(
                which(nsc.adult.total.mass$Spp == "FRAM2"),
                which(nsc.adult.total.mass$Spp == "FRNI"),
                which(nsc.adult.total.mass$Spp == "FRQU")
                )
   
  Ailanthus <- c(
                which(nsc.adult.total.mass$Spp == "AIAL")
                )
   
    Robinia <- c(
                which(nsc.adult.total.mass$Spp == "ROPS")
                )
    
  Sassafras <- c(
                which(nsc.adult.total.mass$Spp == "SAAL5")
                )
  
      Acer <- c(
                which(nsc.adult.total.mass$Spp == "ACNE2"),
                which(nsc.adult.total.mass$Spp == "ACPE"),
                which(nsc.adult.total.mass$Spp == "ACRU"),
                which(nsc.adult.total.mass$Spp == "ACSA3")
                )
      
  Aesculus <- c(
                which(nsc.adult.total.mass$Spp == "AEGL")
                )
  
    Betula <- c(
                which(nsc.adult.total.mass$Spp == "BEAL2"),
                which(nsc.adult.total.mass$Spp == "BELE"),
                which(nsc.adult.total.mass$Spp == "BEPA"),
                which(nsc.adult.total.mass$Spp == "BETUL")
                )
    
  Carpinus <- c(
                which(nsc.adult.total.mass$Spp == "CACA18")
                )
    
    Cornus <- c(
                which(nsc.adult.total.mass$Spp == "COFL2")
                )
    
Liquidambar <- c(
                which(nsc.adult.total.mass$Spp == "LIST2")
                )

Liriodendron <- c(
                which(nsc.adult.total.mass$Spp == "LITU")
                )

    Magnolia <- c(
                which(nsc.adult.total.mass$Spp == "MAAC"),
                which(nsc.adult.total.mass$Spp == "MAFR"),
                which(nsc.adult.total.mass$Spp == "MAVI2"),
                which(nsc.adult.total.mass$Spp == "MAGR4")
                )
    
    Platanus <- c(
                which(nsc.adult.total.mass$Spp == "PLOC")
                )
    
       Fagus <- c(
                which(nsc.adult.total.mass$Spp == "FAGR")
                )
       
       Nyssa <- c(
                which(nsc.adult.total.mass$Spp == "NYSY")
                )
       
       Oxydendrum <- c(
                which(nsc.adult.total.mass$Spp == "OXAR")
                )
       
       Tilia <- c(
                which(nsc.adult.total.mass$Spp == "TIAM")
                )
    
     Populus <- c(
                which(nsc.adult.total.mass$Spp == "POGR4"),
                which(nsc.adult.total.mass$Spp == "POTR5")
                )
       
     Prunus <- c(
                which(nsc.adult.total.mass$Spp == "PRSE2")
                )

       Carya <- c(
                which(nsc.adult.total.mass$Spp == "CACO15"),
                which(nsc.adult.total.mass$Spp == "CAGL8"),
                which(nsc.adult.total.mass$Spp == "CALA21"),
                which(nsc.adult.total.mass$Spp == "CAOV2"),
                which(nsc.adult.total.mass$Spp == "CATO6")
                )
       
     Cercis <- c(
                which(nsc.adult.total.mass$Spp == "CECA4")
                )
     
  Diospyros <- c(
                which(nsc.adult.total.mass$Spp == "DIVI5")
                )
  
    Juglans <- c(
                which(nsc.adult.total.mass$Spp == "JUCI"),
                which(nsc.adult.total.mass$Spp == "JUNI")
                )
    
      Ulmus <- c(
                which(nsc.adult.total.mass$Spp == "ULAM")
                )

  ### Conifers
      Pinus <- c(
                which(nsc.adult.total.mass$Spp == "PIPA2"),
                which(nsc.adult.total.mass$Spp == "PIST"),
                which(nsc.adult.total.mass$Spp == "PIVI2"),
                which(nsc.adult.total.mass$Spp == "PIRE"),
                which(nsc.adult.total.mass$Spp == "PIRI"),
                which(nsc.adult.total.mass$Spp == "PITA")
                )
      
      Larix <- c(
                which(nsc.adult.total.mass$Spp == "LALA")
                )
      
      Picea <- c(
                which(nsc.adult.total.mass$Spp == "PIGL"),
                which(nsc.adult.total.mass$Spp == "PIMA"),
                which(nsc.adult.total.mass$Spp == "PIRU")
                )

      Abies <- c(
              which(nsc.adult.total.mass$Spp == "ABBA")
              )
      
Juniperus <- c(
              which(nsc.adult.total.mass$Spp == "JUVI")
              )

    Thuja <- c(
              which(nsc.adult.total.mass$Spp == "THOC2")
              )
    
    Tsuga <- c(
              which(nsc.adult.total.mass$Spp == "TSCA")
              )
    
    
    
    ### Set total dataframe for Genus
    
    nsc.adult.total.mass$genus <- NA
    nsc.adult.total.mass$genus[Pinus] <- "Pinus"
    nsc.adult.total.mass$genus[Larix] <- "Larix"
    nsc.adult.total.mass$genus[Picea] <- "Picea"
    nsc.adult.total.mass$genus[Abies] <- "Abies"
    nsc.adult.total.mass$genus[Thuja] <- "Thuja"
    nsc.adult.total.mass$genus[Tsuga] <- "Tsuga"
    nsc.adult.total.mass$genus[Juniperus] <- "Juniperus"
    nsc.adult.total.mass$genus[Quercus] <- "Quercus"
    nsc.adult.total.mass$genus[Fraxinus] <- "Fraxinus"
    nsc.adult.total.mass$genus[Ailanthus] <- "Ailanthus"
    nsc.adult.total.mass$genus[Robinia] <- "Robinia"
    nsc.adult.total.mass$genus[Sassafras] <- "Sassafras"
    nsc.adult.total.mass$genus[Acer] <- "Acer"
    nsc.adult.total.mass$genus[Aesculus] <- "Aesculus"
    nsc.adult.total.mass$genus[Betula] <- "Betula"
    nsc.adult.total.mass$genus[Carpinus] <- "Carpinus"
    nsc.adult.total.mass$genus[Cornus] <- "Cornus"
    nsc.adult.total.mass$genus[Liquidambar] <- "Liquidambar"
    nsc.adult.total.mass$genus[Liriodendron] <- "Liriodendron"
    nsc.adult.total.mass$genus[Magnolia] <- "Magnolia"
    nsc.adult.total.mass$genus[Platanus] <- "Platanus"
    nsc.adult.total.mass$genus[Fagus] <- "Fagus"
    nsc.adult.total.mass$genus[Nyssa] <- "Nyssa"
    nsc.adult.total.mass$genus[Oxydendrum] <- "Oxydendrum"
    nsc.adult.total.mass$genus[Tilia] <- "Tilia"
    nsc.adult.total.mass$genus[Populus] <- "Populus"
    nsc.adult.total.mass$genus[Prunus] <- "Prunus"
    nsc.adult.total.mass$genus[Carya] <- "Carya"
    nsc.adult.total.mass$genus[Cercis] <- "Cercis"
    nsc.adult.total.mass$genus[Diospyros] <- "Diospyros"
    nsc.adult.total.mass$genus[Juglans] <- "Juglans"
    nsc.adult.total.mass$genus[Ulmus] <- "Ulmus"
    
  ###Add Family
  Aceraceae <- c(
              which(nsc.adult.total.mass$genus == "Acer")
              )
  
  Betulaceae <- c(
                which(nsc.adult.total.mass$genus == "Betula"),
                which(nsc.adult.total.mass$genus == "Carpinus")
                )
  
  Cornaceae <- c(which(nsc.adult.total.mass$genus == "Cornus"),
                 which(nsc.adult.total.mass$genus == "Nyssa"))
  
  Cupressaceae <- c(which(nsc.adult.total.mass$genus == "Thuja"),
                    which(nsc.adult.total.mass$genus == "Juniperus"))
  
  Ebenaceae <- c(which(nsc.adult.total.mass$genus == "Diospyros"))
  
  Ericaceae <- c(which(nsc.adult.total.mass$genus == "Oxydendrum"))
  
  Fabaceae <- c(which(nsc.adult.total.mass$genus == "Robinia"),
                    which(nsc.adult.total.mass$genus == "Cercis"))
  
  Fagaceae <- c(which(nsc.adult.total.mass$genus == "Quercus"),
                which(nsc.adult.total.mass$genus == "Fagus"))
  
  Hamamelidaceae <- c(which(nsc.adult.total.mass$genus == "Liquidambar"))
  
  Hippocastanaceae <- c(which(nsc.adult.total.mass$genus == "Aesculus"))
  
  Juglandaceae <- c(which(nsc.adult.total.mass$genus == "Carya"),
                    which(nsc.adult.total.mass$genus == "Juglans"))
  
  Lauraceae <- c(which(nsc.adult.total.mass$genus == "Sassafras"))
  
  Magnoliaceae <- c(which(nsc.adult.total.mass$genus == "Liriodendron"),
                    which(nsc.adult.total.mass$genus == "Magnolia"))
  
  Oleaceae <- c(which(nsc.adult.total.mass$genus == "Fraxinus"))
  
  Pinaceae <- c(which(nsc.adult.total.mass$genus == "Pinus"),
                which(nsc.adult.total.mass$genus == "Larix"),
                which(nsc.adult.total.mass$genus == "Picea"),
                which(nsc.adult.total.mass$genus == "Abies"),
                which(nsc.adult.total.mass$genus == "Tsuga")
                )
  
  Platanaceae <- c(which(nsc.adult.total.mass$genus == "Platanus"))
  
  Rosaceae <- c(which(nsc.adult.total.mass$genus == "Prunus"))
  
  Salicaceae <- c(which(nsc.adult.total.mass$genus == "Populus"))
  
  Simaroubaceae <- c(which(nsc.adult.total.mass$genus == "Ailanthus"))
  
  Tiliaceae <- c(which(nsc.adult.total.mass$genus == "Tilia"))
  
  Ulmaceae <- c(which(nsc.adult.total.mass$genus == "Ulmus"))
  
  #Make single genus-species column
    nsc.adult.total.mass$GenusSpecies <- NA
    nsc.adult.total.mass$GenusSpecies <- with(nsc.adult.total.mass, paste(genus, species))
  
  #Set total dataframe for Family
  nsc.adult.total.mass$family <- NA
    nsc.adult.total.mass$family[Aceraceae] <- "Aceraceae"
    nsc.adult.total.mass$family[Betulaceae] <- "Betulaceae"       
    nsc.adult.total.mass$family[Cornaceae] <- "Cornaceae"
    nsc.adult.total.mass$family[Cupressaceae] <- "Cupressaceae"
    nsc.adult.total.mass$family[Ebenaceae] <- "Ebenaceae"
    nsc.adult.total.mass$family[Ericaceae] <- "Ericaceae"
    nsc.adult.total.mass$family[Fabaceae] <- "Fabaceae"
    nsc.adult.total.mass$family[Fagaceae] <- "Fagaceae"
    nsc.adult.total.mass$family[Hamamelidaceae] <- "Hamamelidaceae"
    nsc.adult.total.mass$family[Hippocastanaceae] <- "Hippocastanaceae"
    nsc.adult.total.mass$family[Juglandaceae] <- "Juglandaceae"
    nsc.adult.total.mass$family[Sassafras] <- "Lauraceae"
    nsc.adult.total.mass$family[Magnoliaceae] <- "Magnoliaceae"
    nsc.adult.total.mass$family[Oleaceae] <- "Oleaceae"   
    nsc.adult.total.mass$family[Pinaceae] <- "Pinaceae"
    nsc.adult.total.mass$family[Platanaceae] <- "Platanaceae"
    nsc.adult.total.mass$family[Rosaceae] <- "Rosaceae"
    nsc.adult.total.mass$family[Salicaceae] <- "Salicaceae"
    nsc.adult.total.mass$family[Simaroubaceae] <- "Simaroubaceae"
    nsc.adult.total.mass$family[Tiliaceae] <- "Tiliaceae"
    nsc.adult.total.mass$family[Ulmaceae] <- "Ulmaceae"

    #Order
    Sapindales <- c(which(nsc.adult.total.mass$family == "Aceraceae"),
                    which(nsc.adult.total.mass$family == "Hippocastanaceae"),
                    which(nsc.adult.total.mass$family == "Simaroubaceae"))
    
    Fagales <- c(which(nsc.adult.total.mass$family == "Betulaceae"),
                 which(nsc.adult.total.mass$family == "Fagaceae"))
    
    Cornales <- c(which(nsc.adult.total.mass$family == "Cornaceae"))
    
    Pinales <- c(which(nsc.adult.total.mass$family == "Cupressaceae"),
                 which(nsc.adult.total.mass$family == "Pinaceae"))
    
    Ebenales <- c(which(nsc.adult.total.mass$family == "Ebenaceae"))
    Ericales <- c(which(nsc.adult.total.mass$family == "Ericaceae"))
    Fabales <- c(which(nsc.adult.total.mass$family == "Fabaceae"))
    
    Hamamelidales <- c(which(nsc.adult.total.mass$family == "Hamamelidaceae"),
                       which(nsc.adult.total.mass$family == "Platanaceae"))
    
    Juglandales <- c(which(nsc.adult.total.mass$family == "Juglandaceae"))
    Laurales <- c(which(nsc.adult.total.mass$family == "Lauraceae"))
    Magnoliales <- c(which(nsc.adult.total.mass$family == "Magnoliaceae"))
    Scrophulariales <- c(which(nsc.adult.total.mass$family == "Oleaceae"))
    Rosales <- c(which(nsc.adult.total.mass$family == "Rosaceae"))
    Salicales <- c(which(nsc.adult.total.mass$family == "Salicaceae"))
    Malvales <- c(which(nsc.adult.total.mass$family == "Tiliaceae"))
    Urticales <- c(which(nsc.adult.total.mass$family == "Ulmaceae"))
    
    #Set total dataframe for order
    nsc.adult.total.mass$order <- NA
    nsc.adult.total.mass$order[Sapindales] <- "Sapindales"
    nsc.adult.total.mass$order[Fagales] <- "Fagales"       
    nsc.adult.total.mass$order[Cornales] <- "Cornales"
    nsc.adult.total.mass$order[Pinales] <- "Pinales"
    nsc.adult.total.mass$order[Ebenales] <- "Ebenales"
    nsc.adult.total.mass$order[Ericales] <- "Ericales"
    nsc.adult.total.mass$order[Fabales] <- "Fabales"
    nsc.adult.total.mass$order[Hamamelidales] <- "Hamamelidales"
    nsc.adult.total.mass$order[Juglandales] <- "Juglandales"
    nsc.adult.total.mass$order[Laurales] <- "Laurales"
    nsc.adult.total.mass$order[Magnoliales] <- "Magnoliales"
    nsc.adult.total.mass$order[Scrophulariales] <- "Scrophulariales"
    nsc.adult.total.mass$order[Rosales] <- "Rosales"
    nsc.adult.total.mass$order[Salicales] <- "Salicales"   
    nsc.adult.total.mass$order[Malvales] <- "Malvales"
    nsc.adult.total.mass$order[Urticales] <- "Urticales"

    #Subclass
    Rosidae <- c(which(nsc.adult.total.mass$order == "Sapindales"),
                 which(nsc.adult.total.mass$order == "Cornales"),
                 which(nsc.adult.total.mass$order == "Fabales"),
                 which(nsc.adult.total.mass$order == "Rosales"))
    
    Hamamelididae <- c(which(nsc.adult.total.mass$order == "Fagales"),
                       which(nsc.adult.total.mass$order == "Hamamelidales"),
                       which(nsc.adult.total.mass$order == "Juglandales"),
                       which(nsc.adult.total.mass$order == "Urticales"))
    
    Pinopsida <- c(which(nsc.adult.total.mass$order == "Pinales"))
    
    Dilleniidae <- c(which(nsc.adult.total.mass$order == "Ebenales"),
                     which(nsc.adult.total.mass$order == "Ericales"),
                     which(nsc.adult.total.mass$order == "Salicales"),
                     which(nsc.adult.total.mass$order == "Malvales"))
    
    Magnoliidae <- c(which(nsc.adult.total.mass$order == "Magnoliales"),
                     which(nsc.adult.total.mass$order == "Laurales"))
    
    Asteridae <- c(which(nsc.adult.total.mass$order == "Scrophulariales"))
    
        #Set total dataframe for Subclass
    nsc.adult.total.mass$subclass <- NA
    nsc.adult.total.mass$subclass[Rosidae] <- "Rosidae"
    nsc.adult.total.mass$subclass[Hamamelididae] <- "Hamamelididae"       
    nsc.adult.total.mass$subclass[Pinopsida] <- "Pinopsida"
    nsc.adult.total.mass$subclass[Dilleniidae] <- "Dilleniidae"
    nsc.adult.total.mass$subclass[Magnoliidae] <- "Magnoliidae"
    nsc.adult.total.mass$subclass[Asteridae] <- "Asteridae"

    
#only hardwood dataframe
early.h <- which(nsc.adult.total.mass$PFT == "Early.Hardwood")
mid.h <- which(nsc.adult.total.mass$PFT == "Mid.Hardwood")
late.h <- which(nsc.adult.total.mass$PFT == "Late.Hardwood")

nsc.adult.total.mass.hard <- rbind(
                             nsc.adult.total.mass[early.h,],
                             nsc.adult.total.mass[mid.h,],
                             nsc.adult.total.mass[late.h,]
                             )
#drop unused hardwood factor levels
# nsc.adult.total.mass.hard$Spp <- droplevels(nsc.adult.total.mass.hard$Spp)
# nsc.adult.total.mass.hard$PFT <- droplevels(nsc.adult.total.mass.hard$PFT)

nsc.adult.total.mass.hard$Spp <- as.character(nsc.adult.total.mass.hard$Spp)

nsc.adult.total.mass.hard$Spp <- factor(nsc.adult.total.mass.hard$Spp, 
                  levels = c("ACPE","AIAL","BEAL2","BELE",
                  "BEPA","BETUL","JUCI","JUNI","LIST2","LITU","POGR4","POTR5",
                  "PRSE2","ROPS","SAAL5","FRAM2","FRNI","FRQU","ACNE2",
                  "ACRU","CACA18","CACO15","CAGL8","CALA21","CAOV2",
                  "CATO6","CECA4","MAAC","MAFR","QUAL","QUCO2","QUIM",
                  "QUMO4","QUMU","QUPH","QURU","QUVE","QUVI","ULAM","ACFL",
                  "ACSA3","AEGL","FAGR","NYSY","OXAR","TIAM"), ordered = TRUE)

#levels(nsc.adult.total.mass.hard$Spp)
#levels(nsc.adult.total.mass.hard$PFT) <- c("Early.Hardwood","Mid.Hardwood","Late.Hardwood")
#levels(nsc.adult.total.mass.hard$PFT)

#nsc.adult.total.mass.hard <- nsc.adult.total.mass.hard[order(nsc.adult.total.mass.hard$Spp),]
#nsc.adult.total.mass.hard <- nsc.adult.total.mass.hard[order(nsc.adult.total.mass.hard$PFT),]

#only conifer dataframe
early.c <- which(nsc.adult.total.mass$PFT == "Early.Conifer")
late.c <- which(nsc.adult.total.mass$PFT == "Late.Conifer")

nsc.adult.total.mass.conif <- rbind(
  nsc.adult.total.mass[early.c,],
  nsc.adult.total.mass[late.c,]
)

#drop unused conifer factors
# nsc.adult.total.mass.conif$Spp <- droplevels(nsc.adult.total.mass.conif$Spp)
# nsc.adult.total.mass.conif$PFT <- droplevels(nsc.adult.total.mass.conif$PFT)

nsc.adult.total.mass.conif$Spp <- as.character(nsc.adult.total.mass.conif$Spp)

#relevel factors
nsc.adult.total.mass.conif$Spp <- factor(nsc.adult.total.mass.conif$Spp, 
                              levels = c("ABBA","JUVI","PIPA2","PIST","PIVI2","PIRE",
                                         "PIRI","PITA","LALA","PIGL","PIMA","PIRU",
                                         "THOC2","TSCA"), ordered = TRUE)

#Include only alive and IBS individuals, no dead trees
alive.total <- which(nsc.adult.total.mass$Mortality14 == "A")
stress.total <- which(nsc.adult.total.mass$Mortality14 == "IBS")

nsc.adult.total.mass.alive <- rbind(
                             nsc.adult.total.mass[alive.total,],
                             nsc.adult.total.mass[stress.total,]
                             )

count(nsc.adult.total.mass.alive$Spp)
#remove spp with very low sample size, setting cutoff below 5 because
#of an arbitrary reason, need to do an actual power analysis

abba <- which(nsc.adult.total.mass.alive$Spp == "ABBA")
acne2 <- which(nsc.adult.total.mass.alive$Spp == "ACNE2")
acru <- which(nsc.adult.total.mass.alive$Spp == "ACRU")
acsa3 <- which(nsc.adult.total.mass.alive$Spp == "ACSA3")
beal2 <- which(nsc.adult.total.mass.alive$Spp == "BEAL2")
bele <- which(nsc.adult.total.mass.alive$Spp == "BELE")
bepa <- which(nsc.adult.total.mass.alive$Spp == "BEPA")
caco15 <- which(nsc.adult.total.mass.alive$Spp == "CACO15")
cagl8 <- which(nsc.adult.total.mass.alive$Spp == "CAGL8")
caov2 <- which(nsc.adult.total.mass.alive$Spp == "CAOV2")
cato6 <- which(nsc.adult.total.mass.alive$Spp == "CATO6")
fagr <- which(nsc.adult.total.mass.alive$Spp == "FAGR")
fram2 <- which(nsc.adult.total.mass.alive$Spp == "FRAM2")
frni <- which(nsc.adult.total.mass.alive$Spp == "FRNI")
juni <- which(nsc.adult.total.mass.alive$Spp == "JUNI")
juvi <- which(nsc.adult.total.mass.alive$Spp == "JUVI")
list2 <- which(nsc.adult.total.mass.alive$Spp == "LIST2")
litu <- which(nsc.adult.total.mass.alive$Spp == "LITU")
mavi2 <- which(nsc.adult.total.mass.alive$Spp == "MAVI2")
nysy <- which(nsc.adult.total.mass.alive$Spp == "NYSY")
oxar <- which(nsc.adult.total.mass.alive$Spp == "OXAR")
pima <- which(nsc.adult.total.mass.alive$Spp == "PIMA")
pipa2 <- which(nsc.adult.total.mass.alive$Spp == "PIPA2")
piri <- which(nsc.adult.total.mass.alive$Spp == "PIRI")
piru <- which(nsc.adult.total.mass.alive$Spp == "PIRU")
pist <- which(nsc.adult.total.mass.alive$Spp == "PIST")
pita <- which(nsc.adult.total.mass.alive$Spp == "PITA")
pogr4 <- which(nsc.adult.total.mass.alive$Spp == "POGR4")
potr5 <- which(nsc.adult.total.mass.alive$Spp == "POTR5")
prse2 <- which(nsc.adult.total.mass.alive$Spp == "PRSE2")
qual <- which(nsc.adult.total.mass.alive$Spp == "QUAL")
qula2 <- which(nsc.adult.total.mass.alive$Spp == "QULA2")
qula3 <- which(nsc.adult.total.mass.alive$Spp == "QULA3")
qumo4 <- which(nsc.adult.total.mass.alive$Spp == "QUMO4")
qumu <- which(nsc.adult.total.mass.alive$Spp == "QUMU")
quni <- which(nsc.adult.total.mass.alive$Spp == "QUNI")
quph <- which(nsc.adult.total.mass.alive$Spp == "QUPH")
quru <- which(nsc.adult.total.mass.alive$Spp == "QURU")
quve <- which(nsc.adult.total.mass.alive$Spp == "QUVE")
quvi <- which(nsc.adult.total.mass.alive$Spp == "QUVI")
saal5 <- which(nsc.adult.total.mass.alive$Spp == "SAAL5")
thoc2 <- which(nsc.adult.total.mass.alive$Spp == "THOC2")
tiam <- which(nsc.adult.total.mass.alive$Spp == "TIAM")
tsca <- which(nsc.adult.total.mass.alive$Spp == "TSCA")
ulam <- which(nsc.adult.total.mass.alive$Spp == "ULAM")

nsc.adult.total.mass.alive.common <- rbind(
                             nsc.adult.total.mass.alive[abba,],
                             nsc.adult.total.mass.alive[acne2,],
                             nsc.adult.total.mass.alive[acru,],
                             nsc.adult.total.mass.alive[acsa3,],
                             nsc.adult.total.mass.alive[beal2,],
                             nsc.adult.total.mass.alive[bele,],
                             nsc.adult.total.mass.alive[bepa,],
                             nsc.adult.total.mass.alive[caco15,],
                             nsc.adult.total.mass.alive[cagl8,],
                             nsc.adult.total.mass.alive[caov2,],
                             nsc.adult.total.mass.alive[cato6,],
                             nsc.adult.total.mass.alive[fagr,],
                             nsc.adult.total.mass.alive[fram2,],
                             nsc.adult.total.mass.alive[frni,],
                             nsc.adult.total.mass.alive[juni,],
                             nsc.adult.total.mass.alive[juvi,],
                             nsc.adult.total.mass.alive[list2,],
                             nsc.adult.total.mass.alive[litu,],
                             nsc.adult.total.mass.alive[mavi2,],
                             nsc.adult.total.mass.alive[nysy,],
                             nsc.adult.total.mass.alive[oxar,],
                             nsc.adult.total.mass.alive[pima,],
                             nsc.adult.total.mass.alive[pipa2,],
                             nsc.adult.total.mass.alive[piri,],
                             nsc.adult.total.mass.alive[piru,],
                             nsc.adult.total.mass.alive[pist,],
                             nsc.adult.total.mass.alive[pita,],
                             nsc.adult.total.mass.alive[pogr4,],
                             nsc.adult.total.mass.alive[potr5,],
                             nsc.adult.total.mass.alive[prse2,],
                             nsc.adult.total.mass.alive[qual,],
                             nsc.adult.total.mass.alive[qula2,],
                             nsc.adult.total.mass.alive[qula3,],
                             nsc.adult.total.mass.alive[qumo4,],
                             nsc.adult.total.mass.alive[qumu,],
                             nsc.adult.total.mass.alive[quni,],
                             nsc.adult.total.mass.alive[quph,],
                             nsc.adult.total.mass.alive[quru,],
                             nsc.adult.total.mass.alive[quve,],
                             nsc.adult.total.mass.alive[quvi,],
                             nsc.adult.total.mass.alive[saal5,],
                             nsc.adult.total.mass.alive[thoc2,],
                             nsc.adult.total.mass.alive[tiam,],
                             nsc.adult.total.mass.alive[tsca,],
                             nsc.adult.total.mass.alive[ulam,])

#Add temperature and precipitation data
#fix mean dataset
  W <- which(nsc.adult.total.mass.alive.common$Site == "W")
  B <- which(nsc.adult.total.mass.alive.common$Site == "B")
  H <- which(nsc.adult.total.mass.alive.common$Site == "H")
  V <- which(nsc.adult.total.mass.alive.common$Site == "V")
  S <- which(nsc.adult.total.mass.alive.common$Site == "S")
  M <- which(nsc.adult.total.mass.alive.common$Site == "M")
  Tr <- which(nsc.adult.total.mass.alive.common$Site == "T")
  Fa <- which(nsc.adult.total.mass.alive.common$Site == "F")
  C <- which(nsc.adult.total.mass.alive.common$Site == "C")
  D <- which(nsc.adult.total.mass.alive.common$Site == "D")
  
  #########Correct temperature and precip data for sites used############
  nsc.adult.total.mass.alive.common$TEMP_C <- NA
  nsc.adult.total.mass.alive.common$TEMP_C[W] <- 4.08
  nsc.adult.total.mass.alive.common$TEMP_C[B] <- 4.85
  nsc.adult.total.mass.alive.common$TEMP_C[H] <- 7.05
  nsc.adult.total.mass.alive.common$TEMP_C[V] <- 10.99
  nsc.adult.total.mass.alive.common$TEMP_C[S] <- 12.25
  nsc.adult.total.mass.alive.common$TEMP_C[M] <- 12.62
  nsc.adult.total.mass.alive.common$TEMP_C[Tr] <- 14.11
  nsc.adult.total.mass.alive.common$TEMP_C[Fa] <- 20.81
  nsc.adult.total.mass.alive.common$TEMP_C[C] <- 11.22
  nsc.adult.total.mass.alive.common$TEMP_C[D] <- 14.88

  nsc.adult.total.mass.alive.common$PRECIP <- NA
  nsc.adult.total.mass.alive.common$PRECIP[W] <- 804
  nsc.adult.total.mass.alive.common$PRECIP[B] <- 1378
  nsc.adult.total.mass.alive.common$PRECIP[H] <- 1135
  nsc.adult.total.mass.alive.common$PRECIP[V] <- 985
  nsc.adult.total.mass.alive.common$PRECIP[S] <- 970
  nsc.adult.total.mass.alive.common$PRECIP[M] <- 1037
  nsc.adult.total.mass.alive.common$PRECIP[Tr] <- 1366
  nsc.adult.total.mass.alive.common$PRECIP[Fa] <- 1298
  nsc.adult.total.mass.alive.common$PRECIP[C] <- 2193
  nsc.adult.total.mass.alive.common$PRECIP[D] <- 1165


write.csv(x = nsc.adult.total.mass.alive.common, file = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Data/nsc.adult.total.mass.alive.common.DissertationDraftFinal.csv")

nsc.adult.total.mass.alive.common$GenusSpecies <- factor(nsc.adult.total.mass.alive.common$GenusSpecies, 
                  levels = c("Juniperus virginiana","Thuja occidentalis","Abies balsamea","Tsuga canadensis","Picea mariana", "Picea rubens","Pinus strobus","Pinus palustris","Pinus taeda","Pinus rigida","Sassafras albidum","Magnolia virginiana","Liriodendron tulipifera","Liquidambar styraciflua","Oxydendrum arboreum","Nyssa sylvatica","Fraxinus americana","Fraxinus nigra","Tilia americana","Acer rubrum","Acer saccharum","Acer negundo","Populus grandidentata","Populus tremuloides","Prunus serotina","Ulmus americana","Betula lenta","Betula papyrifera","Betula alleghaniensis","Juglans nigra","Carya glabra","Carya cordiformis","Carya ovata","Carya tomentosa","Fagus grandifolia","Quercus laurifolia","Quercus alba","Quercus velutina","Quercus nigra","Quercus laevis","Quercus montana","Quercus rubra","Quercus virginiana","Quercus muehlenbergii","Quercus phellos"))

nsc.adult.total.mass.alive.common$wood <- factor(nsc.adult.total.mass.alive.common$wood, levels = c("large.resin","small.resin", "no.resin","ring.porous","semiring.porous","diffuse.porous"))

nsc.adult.total.mass.alive.common$PFT <- factor(nsc.adult.total.mass.alive.common$PFT, levels = c("Early.Conifer","Late.Conifer","Early.Hardwood","Mid.Hardwood","Late.Hardwood"))

# read.nexus(file = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Data/NSCnexus.txt")
# read.newick(file = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Data/NSCnewick.txt")
# read.tree(text = phylotree)
# collapse.singles(phylotree)
# read.tree(file = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Data/kpFZcV9XjpZp8D4oS-HXxQ_newick.txt")

```

Everything before this is preprocessing of data.
Phylogenetics Exploratory Analyses - ANOVA based

```{r}
#Species Anova
lm.species.total <- lm(total.nsc ~ GenusSpecies, data = nsc.adult.total.mass.alive.common)
anova(lm.species.total)
summary(lm.species.total) #R^2 = .5877

lm.species.starch <- lm(starch.mg.g ~ GenusSpecies, data = nsc.adult.total.mass.alive.common)
anova(lm.species.starch)
summary(lm.species.starch) #R^2 = 0.5368

lm.species.sugar <- lm(sugar.mg.g ~ GenusSpecies, data = nsc.adult.total.mass.alive.common)
anova(lm.species.sugar)
summary(lm.species.sugar) #R^2 = 0.4987

lm.species.glucose <- lm(glucose.mg.g ~ GenusSpecies, data = nsc.adult.total.mass.alive.common)
anova(lm.species.glucose)
summary(lm.species.glucose) #R^2 = 0.3569

lm.species.fructose <- lm(fructose.mg.g ~ GenusSpecies, data = nsc.adult.total.mass.alive.common)
anova(lm.species.fructose)
summary(lm.species.fructose) #R^2 = 0.4379

lm.species.sucrose <- lm(sucrose.mg.g ~ GenusSpecies, data = nsc.adult.total.mass.alive.common)
anova(lm.species.sucrose)
summary(lm.species.sucrose) #R^2 = 0.4098

#TukeyHSD species
#too many groups, not good to visualize
summary(aov.species <- aov(lm.species.total))
tukey.species <- TukeyHSD(aov.species, "GenusSpecies", ordered = FALSE)
plot(tukey.species)
species.levels <- tukey.species[["GenusSpecies"]][,4]
species.labels <- multcompLetters(species.levels)['Letters']
species.plot.labels <- names(species.labels[['Letters']])

#Species boxplots
nsc.species.total <- ggplot(nsc.adult.total.mass.alive.common, aes(x = GenusSpecies, y = total.nsc, fill = wood)) + 
  geom_boxplot() + theme(axis.text.x = element_text(angle=90,hjust=1,vjust=.5,size=10)) +
  theme(axis.text.y = element_text(size=12)) +
  #theme(axis.title.x = element_text(size=16)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(legend.text = element_text(size=10)) + 
  theme(legend.title = element_text(size = 14)) +
  theme(legend.key.size = unit(.4, "cm")) +
  labs(fill = "Wood\nAnatomy") +
  stat_summary(fun.data = give.n, geom= "text", size = 2.5, aes(y= 160)) + 
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("") +
  scale_fill_manual(values=rev(cbPalette), labels = c("Large Resin", "Small Resin", "No Resin", "Ring Porous", "Semi-ring\nPorous", "Diffuse Porous"))

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/TotalNSC.AllCommonSpp.png", plot = nsc.species.total, dpi = 600, width = 10, height = 4.75, units = "in")

nsc.species.starch <- ggplot(nsc.adult.total.mass.alive.common, aes(x = GenusSpecies, y = starch.mg.g, fill = wood)) + 
  geom_boxplot() + theme(axis.text.x = element_text(angle=90,hjust=1,vjust=.5,size=10)) +
  theme(axis.text.y = element_text(size=12)) +
  #theme(axis.title.x = element_text(size=16)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(legend.text = element_text(size=10)) + 
  theme(legend.title = element_text(size = 14)) +
  theme(legend.key.size = unit(.4, "cm")) +
  labs(fill = "Wood\nAnatomy") +
  stat_summary(fun.data = give.n, geom= "text", size = 2.5, aes(y= 101)) + 
  ylab(expression(paste("Starch mg g"^"-1"))) + xlab("") +
  scale_fill_manual(values=rev(cbPalette), labels = c("Large Resin", "Small Resin", "No Resin", "Ring Porous", "Semi-ring\nPorous", "Diffuse Porous"))

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/Starch.AllCommonSpp.png", plot = nsc.species.starch, dpi = 600, width = 10, height = 4.75, units = "in")

nsc.species.sugar <- ggplot(nsc.adult.total.mass.alive.common, aes(x = GenusSpecies, y = sugar.mg.g, fill = wood)) + 
  geom_boxplot() + theme(axis.text.x = element_text(angle=90,hjust=1,vjust=.5,size=10)) +
  theme(axis.text.y = element_text(size=12)) +
  #theme(axis.title.x = element_text(size=16)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(legend.text = element_text(size=10)) + 
  theme(legend.title = element_text(size = 14)) +
  theme(legend.key.size = unit(.4, "cm")) +
  labs(fill = "Wood\nAnatomy") +
  stat_summary(fun.data = give.n, geom= "text", size = 2.5, aes(y= 80)) + 
  ylab(expression(paste("Total Sugar mg g"^"-1"))) + xlab("") +
  scale_fill_manual(values=rev(cbPalette), labels = c("Large Resin", "Small Resin", "No Resin", "Ring Porous", "Semi-ring\nPorous", "Diffuse Porous"))

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/Sugar.AllCommonSpp.png", plot = nsc.species.sugar, dpi = 600, width = 10, height = 4.75, units = "in")

nsc.species.glucose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = GenusSpecies, y = glucose.mg.g, fill = wood)) + 
  geom_boxplot() + theme(axis.text.x = element_text(angle=90,hjust=1,vjust=.5,size=10)) +
  theme(axis.text.y = element_text(size=12)) +
  #theme(axis.title.x = element_text(size=16)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(legend.text = element_text(size=10)) + 
  theme(legend.title = element_text(size = 14)) +
  theme(legend.key.size = unit(.4, "cm")) +
  labs(fill = "Wood\nAnatomy") +
  stat_summary(fun.data = give.n, geom= "text", size = 2.5, aes(y= 40)) + 
  ylab(expression(paste("Glucose mg g"^"-1"))) + xlab("") +
  scale_fill_manual(values=rev(cbPalette), labels = c("Large Resin", "Small Resin", "No Resin", "Ring Porous", "Semi-ring\nPorous", "Diffuse Porous"))

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/Glucose.AllCommonSpp.png", plot = nsc.species.glucose, dpi = 600, width = 10, height = 4.75, units = "in")

nsc.species.fructose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = GenusSpecies, y = fructose.mg.g, fill = wood)) + 
  geom_boxplot() + theme(axis.text.x = element_text(angle=90,hjust=1,vjust=.5,size=10)) +
  theme(axis.text.y = element_text(size=12)) +
  #theme(axis.title.x = element_text(size=16)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(legend.text = element_text(size=10)) + 
  theme(legend.title = element_text(size = 14)) +
  theme(legend.key.size = unit(.4, "cm")) +
  coord_cartesian(ylim = c(0,34)) +
  labs(fill = "Wood\nAnatomy") +
  stat_summary(fun.data = give.n, geom= "text", size = 2.5, aes(y= 34)) + 
  ylab(expression(paste("Fructose mg g"^"-1"))) + xlab("") +
  scale_fill_manual(values=rev(cbPalette), labels = c("Large Resin", "Small Resin", "No Resin", "Ring Porous", "Semi-ring\nPorous", "Diffuse Porous"))

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/Fructose.AllCommonSpp.png", plot = nsc.species.fructose, dpi = 600, width = 10, height = 4.75, units = "in")

nsc.species.sucrose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = GenusSpecies, y = sucrose.mg.g, fill = wood)) + 
  geom_boxplot() + theme(axis.text.x = element_text(angle=90,hjust=1,vjust=.5,size=10)) +
  theme(axis.text.y = element_text(size=12)) +
  #theme(axis.title.x = element_text(size=16)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(legend.text = element_text(size=10)) + 
  theme(legend.title = element_text(size = 14)) +
  theme(legend.key.size = unit(.4, "cm")) +
  #coord_cartesian(ylim = c(0,34)) +
  labs(fill = "Wood\nAnatomy") +
  stat_summary(fun.data = give.n, geom= "text", size = 2.5, aes(y= 56)) + 
  ylab(expression(paste("Sucrose mg g"^"-1"))) + xlab("") +
  scale_fill_manual(values=rev(cbPalette), labels = c("Large Resin", "Small Resin", "No Resin", "Ring Porous", "Semi-ring\nPorous", "Diffuse Porous"))

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/Sucrose.AllCommonSpp.png", plot = nsc.species.sucrose, dpi = 600, width = 10, height = 4.75, units = "in")

#Genus anova
lm.genus.total <- lm(total.nsc ~ genus, data = nsc.adult.total.mass.alive.common)
anova(lm.genus.total)
summary(lm.genus.total) #R^2 = .5464

#Genus ggplot boxplot
ggplot(nsc.adult.total.mass.alive.common, aes(x = genus, y = total.nsc, fill = wood)) + #not enough colors for genus fill
  geom_boxplot() + theme(axis.text.x = element_text(angle=90,hjust=1,size=12)) +
  theme(axis.text.y = element_text(size=16)) +
  theme(axis.title.x = element_text(size=20)) +
  theme(axis.title.y = element_text(size=20)) +
  theme(legend.text = element_text(size=16)) +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 160)) + 
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Genus") + ggtitle("All Genera") +
#   geom_segment(aes(x=0,y=med.early.conif,xend=7.5,
#                    yend=med.early.conif),linetype="longdash",color="indianred4") +
#   geom_segment(aes(x=7.5,y=med.late.conif,xend=12,
#                    yend=med.late.conif),linetype="longdash",color="darkgreen") +
  scale_fill_manual(values=rev(cbPalette))

#Family anova
lm.family.total <- lm(total.nsc ~ family, data = nsc.adult.total.mass.alive.common)
anova(lm.family.total)
summary(lm.family.total) #R^2 = .523

#Family ggplot boxplot
ggplot(nsc.adult.total.mass.alive.common, aes(x = family, y = total.nsc, fill = "red")) + #need more colors for fill based on family
  geom_boxplot() + theme(axis.text.x = element_text(angle=45,hjust=1,size=12)) +
  theme(axis.text.y = element_text(size=16)) +
  theme(axis.title.x = element_text(size=20)) +
  theme(axis.title.y = element_text(size=20)) +
  theme(legend.text = element_text(size=16)) +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 160)) + 
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Family") + ggtitle("All Families") +
#   geom_segment(aes(x=0,y=med.early.conif,xend=7.5,
#                    yend=med.early.conif),linetype="longdash",color="indianred4") +
#   geom_segment(aes(x=7.5,y=med.late.conif,xend=12,
#                    yend=med.late.conif),linetype="longdash",color="darkgreen") +
  scale_fill_manual(values=rev(cbPalette))

#Order ANOVA
lm.order.total <- lm(total.nsc ~ order, data = nsc.adult.total.mass.alive.common)
anova(lm.order.total)
summary(lm.order.total) #R^2 = .411

#Order ggplot, can also make violin plot
ggplot(nsc.adult.total.mass.alive.common, aes(x = order, y = total.nsc, fill = "red")) + #need more colors for fill based on order
  geom_boxplot() + theme(axis.text.x = element_text(angle=45,hjust=1,size=12)) +
  theme(axis.text.y = element_text(size=16)) +
  theme(axis.title.x = element_text(size=20)) +
  theme(axis.title.y = element_text(size=20)) +
  theme(legend.text = element_text(size=16)) +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 160)) + 
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Order") + ggtitle("All Orders") +
#   geom_segment(aes(x=0,y=med.early.conif,xend=7.5,
#                    yend=med.early.conif),linetype="longdash",color="indianred4") +
#   geom_segment(aes(x=7.5,y=med.late.conif,xend=12,
#                    yend=med.late.conif),linetype="longdash",color="darkgreen") +
  scale_fill_manual(values=rev(cbPalette))

#Subclass ANOVA
lm.subclass.total <- lm(total.nsc ~ subclass, data = nsc.adult.total.mass.alive.common)
anova(lm.subclass.total)
summary(lm.subclass.total) #R^2 = .3771

#Subclass ggplot, can also make violin plot
ggplot(nsc.adult.total.mass.alive.common, aes(x = subclass, y = total.nsc, fill = "red")) + #need more colors for fill based on order
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=12)) +
  theme(axis.text.y = element_text(size=16)) +
  theme(axis.title.x = element_text(size=20)) +
  theme(axis.title.y = element_text(size=20)) +
  theme(legend.text = element_text(size=16)) +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 160)) + 
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Subclass") + ggtitle("All Subclasses") +
#   geom_segment(aes(x=0,y=med.early.conif,xend=7.5,
#                    yend=med.early.conif),linetype="longdash",color="indianred4") +
#   geom_segment(aes(x=7.5,y=med.late.conif,xend=12,
#                    yend=med.late.conif),linetype="longdash",color="darkgreen") +
  scale_fill_manual(values=rev(cbPalette))


#PFT anova total
lm.pft.total <- lm(total.nsc ~ PFT, data = nsc.adult.total.mass.alive.common)
anova(lm.pft.total)
summary(lm.pft.total) #R^2 = .363

#TukeyHSD PFT
summary(aov.pft <- aov(lm.pft.total))
tukey.pft <- TukeyHSD(aov.pft, "PFT", ordered = FALSE)
plot(tukey.pft)
pft.levels <- tukey.pft[["PFT"]][,4]
pft.labels <- multcompLetters(pft.levels)['Letters']
pft.plot.labels <- names(pft.labels[['Letters']])

#PFT ggplot 
pft.violin <- ggplot(nsc.adult.total.mass.alive.common, aes(x = PFT, y = total.nsc)) + #, fill = PFT
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=16)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(axis.text.x = element_text(size=12)) +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 205)) + 
  stat_summary(fun.y="median", geom="point") +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Plant Functional Type") +
  annotate("text", x = 1:5, y = c(110, 95, 165, 185, 135), 
           label = c("b","a","c","e","d"))


ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/TotalNSC.AllCommonPFT.png", plot = pft.violin, dpi = 600, width = 7.5, height = 3.5, units = "in")

#PFT ANOVA Starch
lm.pft.starch <- lm(starch.mg.g ~ PFT, data = nsc.adult.total.mass.alive.common)
anova(lm.pft.starch)
summary(lm.pft.starch) #R^2 = .3612

#TukeyHSD PFT
summary(aov.pft.starch <- aov(lm.pft.starch))
tukey.pft.starch <- TukeyHSD(aov.pft.starch, "PFT", ordered = FALSE)
plot(tukey.pft.starch)
pft.levels.starch <- tukey.pft.starch[["PFT"]][,4]
pft.labels.starch <- multcompLetters(pft.levels.starch)['Letters']
pft.plot.labels.starch <- names(pft.labels.starch[['Letters']])

#PFT ggplot 
pft.violin.starch <- ggplot(nsc.adult.total.mass.alive.common, aes(x = PFT, y = starch.mg.g)) + #, fill = PFT
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=16)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(axis.text.x = element_text(size=12)) +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 115)) + 
  stat_summary(fun.y="median", geom="point") +
  ylab(expression(paste("Starch mg g"^"-1"))) + xlab("Plant Functional Type") +
  annotate("text", x = 1:5, y = c(40, 41, 97, 110, 87), 
           label = c("b","a","c","e","d"))


ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/Starch.AllCommonPFT.png", plot = pft.violin.starch, dpi = 600, width = 7.5, height = 3.5, units = "in")

#PFT ANOVA Sugar
lm.pft.sugar <- lm(sugar.mg.g ~ PFT, data = nsc.adult.total.mass.alive.common)
anova(lm.pft.sugar)
summary(lm.pft.sugar) #R^2 = .2076

#TukeyHSD PFT
summary(aov.pft.sugar <- aov(lm.pft.sugar))
tukey.pft.sugar <- TukeyHSD(aov.pft.sugar, "PFT", ordered = FALSE)
plot(tukey.pft.sugar)
pft.levels.sugar <- tukey.pft.sugar[["PFT"]][,4]
pft.labels.sugar <- multcompLetters(pft.levels.sugar)['Letters']
pft.plot.labels.sugar <- names(pft.labels.sugar[['Letters']])

#PFT ggplot 
pft.violin.sugar <- ggplot(nsc.adult.total.mass.alive.common, aes(x = PFT, y = sugar.mg.g)) + #, fill = PFT
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=16)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(axis.text.x = element_text(size=12)) +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 83)) + 
  stat_summary(fun.y="median", geom="point") +
  ylab(expression(paste("Total Sugar mg g"^"-1"))) + xlab("Plant Functional Type") +
  annotate("text", x = 1:5, y = c(79, 57, 70, 77.5, 65), 
           label = c("b","a","b","c","b"))


ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/Sugar.AllCommonPFT.png", plot = pft.violin.sugar, dpi = 600, width = 7.5, height = 3.5, units = "in")

#PFT ANOVA Glucose
lm.pft.glucose <- lm(glucose.mg.g ~ PFT, data = nsc.adult.total.mass.alive.common)
anova(lm.pft.glucose)
summary(lm.pft.glucose) #R^2 = .04797

#TukeyHSD PFT
summary(aov.pft.glucose <- aov(lm.pft.glucose))
tukey.pft.glucose <- TukeyHSD(aov.pft.glucose, "PFT", ordered = FALSE)
plot(tukey.pft.glucose)
pft.levels.glucose <- tukey.pft.glucose[["PFT"]][,4]
pft.labels.glucose <- multcompLetters(pft.levels.glucose)['Letters']
pft.plot.labels.glucose <- names(pft.labels.glucose[['Letters']])

#PFT ggplot 
pft.violin.glucose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = PFT, y = glucose.mg.g)) + #, fill = PFT
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=16)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(axis.text.x = element_text(size=12)) +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 44)) + 
  stat_summary(fun.y="median", geom="point") +
  ylab(expression(paste("Glucose mg g"^"-1"))) + xlab("Plant Functional Type") +
  annotate("text", x = 1:5, y = c(30, 23, 40.5, 39, 23), 
           label = c("b","a","b","b","a"))


ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/Glucose.AllCommonPFT.png", plot = pft.violin.glucose, dpi = 600, width = 7.5, height = 3.5, units = "in")

#PFT ANOVA Fructose
lm.pft.fructose <- lm(fructose.mg.g ~ PFT, data = nsc.adult.total.mass.alive.common)
anova(lm.pft.fructose)
summary(lm.pft.fructose) #R^2 = .05495

#TukeyHSD PFT
summary(aov.pft.fructose <- aov(lm.pft.fructose))
tukey.pft.fructose <- TukeyHSD(aov.pft.fructose, "PFT", ordered = FALSE)
plot(tukey.pft.fructose)
pft.levels.fructose <- tukey.pft.fructose[["PFT"]][,4]
pft.labels.fructose <- multcompLetters(pft.levels.fructose)['Letters']
pft.plot.labels.fructose <- names(pft.labels.fructose[['Letters']])

#PFT ggplot 
pft.violin.fructose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = PFT, y = fructose.mg.g)) + #, fill = PFT
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=16)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(axis.text.x = element_text(size=12)) +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 36)) + 
  stat_summary(fun.y="median", geom="point") +
  ylab(expression(paste("Fructose mg g"^"-1"))) + xlab("Plant Functional Type") +
  annotate("text", x = 1:5, y = c(29, 18, 24.5, 34, 16.5), 
           label = c("c","ab","a","c","b"))


ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/Fructose.AllCommonPFT.png", plot = pft.violin.fructose, dpi = 600, width = 7.5, height = 3.5, units = "in")

#PFT ANOVA Sucrose
lm.pft.sucrose <- lm(sucrose.mg.g ~ PFT, data = nsc.adult.total.mass.alive.common)
anova(lm.pft.sucrose)
summary(lm.pft.sucrose) #R^2 = .2222

#TukeyHSD PFT
summary(aov.pft.sucrose <- aov(lm.pft.sucrose))
tukey.pft.sucrose <- TukeyHSD(aov.pft.sucrose, "PFT", ordered = FALSE)
plot(tukey.pft.sucrose)
pft.levels.sucrose <- tukey.pft.sucrose[["PFT"]][,4]
pft.labels.sucrose <- multcompLetters(pft.levels.sucrose)['Letters']
pft.plot.labels.sucrose <- names(pft.labels.sucrose[['Letters']])

#PFT ggplot 
pft.violin.sucrose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = PFT, y = sucrose.mg.g)) + #, fill = PFT
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=16)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(axis.text.x = element_text(size=12)) +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 60)) + 
  stat_summary(fun.y="median", geom="point") +
  ylab(expression(paste("Sucrose mg g"^"-1"))) + xlab("Plant Functional Type") +
  annotate("text", x = 1:5, y = c(36.25, 31.75, 37, 56.5, 43), 
           label = c("b","a","b","d","c"))


ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/Sucrose.AllCommonPFT.png", plot = pft.violin.sucrose, dpi = 600, width = 7.5, height = 3.5, units = "in")


#wood anatomy anova
lm.wood.total <- lm(total.nsc ~ wood, data = nsc.adult.total.mass.alive.common)
anova(lm.wood.total)
summary(lm.wood.total) #R^2 = .4266

#TukeyHSD wood anatomy
summary(aov.wood <- aov(lm.wood.total))
tukey.wood <- TukeyHSD(aov.wood, "wood", ordered = FALSE)
plot(tukey.wood)
wood.levels <- tukey.wood[["wood"]][,4]
wood.labels <- multcompLetters(wood.levels)['Letters']
wood.plot.labels <- names(wood.labels[['Letters']])

#Wood anatomy ggplot boxplot
wood.anatomy.nsc <- ggplot(nsc.adult.total.mass.alive.common, aes(x = wood, y = total.nsc, fill = wood)) +
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=16)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(axis.text.x = element_text(size = 12)) +
  theme(legend.text = element_blank()) +
  theme(legend.position = "none") +
  stat_summary(fun.data = give.n, geom= "text", size = 3.5, aes(y= 190)) + 
  stat_summary(fun.y="median", geom="point") +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Wood Anatomy") + 
  scale_x_discrete(labels = c("Large Resin", "Small Resin", "No Resin", "Ring Porous", "Semi-ring Porous", "Diffuse Porous")) +
  scale_fill_manual(values=rev(cbPalette)) +
  annotate("text", x = 1:6, y = c(106, 88, 66, 161, 180, 130), label = c("b","ab","a","d","d","c"))

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/TotalNSC.AllCommonWoodAnat.png", plot = wood.anatomy.nsc, dpi = 600, width = 7.5, height = 3.5, units = "in")


#wood anatomy anova
lm.wood.starch <- lm(starch.mg.g ~ wood, data = nsc.adult.total.mass.alive.common)
anova(lm.wood.starch)
summary(lm.wood.starch) #R^2 = .3634

#TukeyHSD wood anatomy
summary(aov.wood.starch <- aov(lm.wood.starch))
tukey.wood.starch <- TukeyHSD(aov.wood.starch, "wood", ordered = FALSE)
plot(tukey.wood.starch)
wood.levels.starch <- tukey.wood.starch[["wood"]][,4]
wood.labels.starch <- multcompLetters(wood.levels.starch)['Letters']
wood.plot.labels.starch <- names(wood.labels.starch[['Letters']])

#Wood anatomy ggplot boxplot
wood.anatomy.starch <- ggplot(nsc.adult.total.mass.alive.common, aes(x = wood, y = starch.mg.g, fill = wood)) +
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=16)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(axis.text.x = element_text(size = 12)) +
  theme(legend.text = element_blank()) +
  theme(legend.position = "none") +
  stat_summary(fun.data = give.n, geom= "text", size = 3.5, aes(y= 118)) + 
  stat_summary(fun.y="median", geom="point") +
  ylab(expression(paste("Starch mg g"^"-1"))) + xlab("Wood Anatomy") + 
  scale_x_discrete(labels = c("Large Resin", "Small Resin", "No Resin", "Ring Porous", "Semi-ring Porous", "Diffuse Porous")) +
  scale_fill_manual(values=rev(cbPalette)) +
  annotate("text", x = 1:6, y = c(40, 40, 39, 104, 110, 88), label = c("b","ab","a","d","d","c"))

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/Starch.AllCommonWoodAnat.png", plot = wood.anatomy.starch, dpi = 600, width = 7.5, height = 3.5, units = "in")

#wood anatomy anova
lm.wood.sugar <- lm(sugar.mg.g ~ wood, data = nsc.adult.total.mass.alive.common)
anova(lm.wood.sugar)
summary(lm.wood.sugar) #R^2 = .3539

#TukeyHSD wood anatomy
summary(aov.wood.sugar <- aov(lm.wood.sugar))
tukey.wood.sugar <- TukeyHSD(aov.wood.sugar, "wood", ordered = FALSE)
plot(tukey.wood.sugar)
wood.levels.sugar <- tukey.wood.sugar[["wood"]][,4]
wood.labels.sugar <- multcompLetters(wood.levels.sugar)['Letters']
wood.plot.labels.sugar <- names(wood.labels.sugar[['Letters']])

#Wood anatomy ggplot boxplot
wood.anatomy.sugar <- ggplot(nsc.adult.total.mass.alive.common, aes(x = wood, y = sugar.mg.g, fill = wood)) +
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=16)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(axis.text.x = element_text(size = 12)) +
  theme(legend.text = element_blank()) +
  theme(legend.position = "none") +
  stat_summary(fun.data = give.n, geom= "text", size = 3.5, aes(y= 83)) + 
  stat_summary(fun.y="median", geom="point") +
  ylab(expression(paste("Total Sugar mg g"^"-1"))) + xlab("Wood Anatomy") + 
  scale_x_discrete(labels = c("Large Resin", "Small Resin", "No Resin", "Ring Porous", "Semi-ring Porous", "Diffuse Porous")) +
  scale_fill_manual(values=rev(cbPalette)) +
  annotate("text", x = 1:6, y = c(79, 56, 56.5, 77, 72, 71), label = c("c","ab","a","d","d","b"))

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/Sugar.AllCommonWoodAnat.png", plot = wood.anatomy.sugar, dpi = 600, width = 7.5, height = 3.5, units = "in")

#wood anatomy anova
lm.wood.glucose <- lm(glucose.mg.g ~ wood, data = nsc.adult.total.mass.alive.common)
anova(lm.wood.glucose)
summary(lm.wood.glucose) #R^2 = .1595

#TukeyHSD wood anatomy
summary(aov.wood.glucose <- aov(lm.wood.glucose))
tukey.wood.glucose <- TukeyHSD(aov.wood.glucose, "wood", ordered = FALSE)
plot(tukey.wood.glucose)
wood.levels.glucose <- tukey.wood.glucose[["wood"]][,4]
wood.labels.glucose <- multcompLetters(wood.levels.glucose)['Letters']
wood.plot.labels.glucose <- names(wood.labels.glucose[['Letters']])

#Wood anatomy ggplot boxplot
wood.anatomy.glucose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = wood, y = glucose.mg.g, fill = wood)) +
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=16)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(axis.text.x = element_text(size = 12)) +
  theme(legend.text = element_blank()) +
  theme(legend.position = "none") +
  stat_summary(fun.data = give.n, geom= "text", size = 3.5, aes(y= 44)) + 
  stat_summary(fun.y="median", geom="point") +
  ylab(expression(paste("Glucose mg g"^"-1"))) + xlab("Wood Anatomy") + 
  scale_x_discrete(labels = c("Large Resin", "Small Resin", "No Resin", "Ring Porous", "Semi-ring Porous", "Diffuse Porous")) +
  scale_fill_manual(values=rev(cbPalette)) +
  annotate("text", x = 1:6, y = c(30, 18, 23, 39, 27, 40.5), label = c("c","ab","ab","c","a","b"))

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/Glucose.AllCommonWoodAnat.png", plot = wood.anatomy.glucose, dpi = 600, width = 7.5, height = 3.5, units = "in")

#wood anatomy anova
lm.wood.fructose <- lm(fructose.mg.g ~ wood, data = nsc.adult.total.mass.alive.common)
anova(lm.wood.fructose)
summary(lm.wood.fructose) #R^2 = .1794

#TukeyHSD wood anatomy
summary(aov.wood.fructose <- aov(lm.wood.fructose))
tukey.wood.fructose <- TukeyHSD(aov.wood.fructose, "wood", ordered = FALSE)
plot(tukey.wood.fructose)
wood.levels.fructose <- tukey.wood.fructose[["wood"]][,4]
wood.labels.fructose <- multcompLetters(wood.levels.fructose)['Letters']
wood.plot.labels.fructose <- names(wood.labels.fructose[['Letters']])

#Wood anatomy ggplot boxplot
wood.anatomy.fructose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = wood, y = fructose.mg.g, fill = wood)) +
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=16)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(axis.text.x = element_text(size = 12)) +
  theme(legend.text = element_blank()) +
  theme(legend.position = "none") +
  stat_summary(fun.data = give.n, geom= "text", size = 3.5, aes(y= 36)) + 
  stat_summary(fun.y="median", geom="point") +
  ylab(expression(paste("Fructose mg g"^"-1"))) + xlab("Wood Anatomy") + 
  scale_x_discrete(labels = c("Large Resin", "Small Resin", "No Resin", "Ring Porous", "Semi-ring Porous", "Diffuse Porous")) +
  scale_fill_manual(values=rev(cbPalette)) +
  annotate("text", x = 1:6, y = c(29.5, 16.5, 18, 34, 20.5, 25), label = c("c","ab","a","c","b","a"))

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/Fructose.AllCommonWoodAnat.png", plot = wood.anatomy.fructose, dpi = 600, width = 7.5, height = 3.5, units = "in")

#wood anatomy anova
lm.wood.sucrose <- lm(sucrose.mg.g ~ wood, data = nsc.adult.total.mass.alive.common)
anova(lm.wood.sucrose)
summary(lm.wood.sucrose) #R^2 = .226

#TukeyHSD wood anatomy
summary(aov.wood.sucrose <- aov(lm.wood.sucrose))
tukey.wood.sucrose <- TukeyHSD(aov.wood.sucrose, "wood", ordered = FALSE)
plot(tukey.wood.sucrose)
wood.levels.sucrose <- tukey.wood.sucrose[["wood"]][,4]
wood.labels.sucrose <- multcompLetters(wood.levels.sucrose)['Letters']
wood.plot.labels.sucrose <- names(wood.labels.sucrose[['Letters']])

#Wood anatomy ggplot boxplot
wood.anatomy.sucrose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = wood, y = sucrose.mg.g, fill = wood)) +
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=16)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(axis.text.x = element_text(size = 12)) +
  theme(legend.text = element_blank()) +
  theme(legend.position = "none") +
  stat_summary(fun.data = give.n, geom= "text", size = 3.5, aes(y= 61)) + 
  stat_summary(fun.y="median", geom="point") +
  ylab(expression(paste("Sucrose mg g"^"-1"))) + xlab("Wood Anatomy") + 
  scale_x_discrete(labels = c("Large Resin", "Small Resin", "No Resin", "Ring Porous", "Semi-ring Porous", "Diffuse Porous")) +
  scale_fill_manual(values=rev(cbPalette)) +
  annotate("text", x = 1:6, y = c(36.5, 30, 32, 56, 57, 47), label = c("a","ab","a","c","d","b"))

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/Sucrose.AllCommonWoodAnat.png", plot = wood.anatomy.sucrose, dpi = 600, width = 7.5, height = 3.5, units = "in")

#########Use for first ANOVA of spatial effects before individual tests - think about putting all in table ########
###Anovas for hierarchical and individual effects
###total R2 = .229
fit.total.nsc.space = lm(total.nsc ~ Site/Plot/Sub, 
                 data = nsc.adult.total.mass.alive.common)
summary(fit.total.nsc.space)
var.total.nsc.space = anova(fit.total.nsc.space)[,2]
prop.var.total.nsc.space = var.total.nsc.space/sum(var.total.nsc.space)

###starch R2 = .1739
fit.starch.space = lm(starch.mg.g ~ Site/Plot/Sub, 
                 data = nsc.adult.total.mass.alive.common)
summary(fit.starch.space)
var.starch.space = anova(fit.starch.space)[,2]
prop.var.starch.space = var.starch.space/sum(var.starch.space)

###sugar R2 = .2669
fit.sugar.space = lm(sugar.mg.g ~ Site/Plot/Sub, 
                 data = nsc.adult.total.mass.alive.common)
summary(fit.sugar.space)
var.sugar.space = anova(fit.sugar.space)[,2]
prop.var.sugar.space = var.sugar.space/sum(var.sugar.space)

###glucose R2 = .2301
fit.glucose.space = lm(glucose.mg.g ~ Site/Plot/Sub, 
                 data = nsc.adult.total.mass.alive.common)
summary(fit.glucose.space)
var.glucose.space = anova(fit.glucose.space)[,2]
prop.var.glucose.space = var.glucose.space/sum(var.glucose.space)

###fructose R2 = .2375
fit.fructose.space = lm(fructose.mg.g ~ Site/Plot/Sub, 
                 data = nsc.adult.total.mass.alive.common)
summary(fit.fructose.space)
var.fructose.space = anova(fit.fructose.space)[,2]
prop.var.fructose.space = var.fructose.space/sum(var.fructose.space)

###sucrose R2 = .2043
fit.sucrose.space = lm(sucrose.mg.g ~ Site/Plot/Sub, 
                 data = nsc.adult.total.mass.alive.common)
summary(fit.sucrose.space)
var.sucrose.space = anova(fit.sucrose.space)[,2]
prop.var.sucrose.space = var.sucrose.space/sum(var.sucrose.space)

nsc.adult.total.mass.alive.common$Canopy15 <- as.character(nsc.adult.total.mass.alive.common$Canopy15)
nsc.adult.total.mass.alive.common$Canopy15[nsc.adult.total.mass.alive.common$Canopy15 == "0"] <- "Understory"
nsc.adult.total.mass.alive.common$Canopy15[nsc.adult.total.mass.alive.common$Canopy15 == "1"] <- "CoDominant"
nsc.adult.total.mass.alive.common$Canopy15[nsc.adult.total.mass.alive.common$Canopy15 == "2"] <- "Dominant"

nsc.adult.total.mass.alive.common$Canopy15 <- factor(nsc.adult.total.mass.alive.common$Canopy15, levels = c("Understory","CoDominant","Dominant"))

#Kitchen sink: phylogenetics fit independently
nsc.kitchen.lm <- lmer(total.nsc ~ DBH14 + Canopy15 + (1|Site) + (1|Site:GenusSpecies) + (1|GenusSpecies) + (1|genus) + (1|family) + (1|order) + (1|subclass) + (1|PFT) + (1|wood), nsc.adult.total.mass.alive.common)
summary(nsc.kitchen.lm)
plot((nsc.kitchen.lm))

#phylo emphasis
nsc.phylo.lm <- lmer(total.nsc ~ DBH14 + Canopy15 + (1|Site/Plot/Sub) + (1|subclass/order/family/genus/GenusSpecies) + (1|PFT) + (1|wood), nsc.adult.total.mass.alive.common)
summary(nsc.phylo.lm)
#str(nsc.phylo.lm)
plot((nsc.phylo.lm))

#variances
#vcov = variances of random effects
phylo.vars <- as.data.frame(VarCorr(nsc.phylo.lm, order = "cov.last"))
#calculating partial variances for random effects
var.phylo.vars = phylo.vars$vcov/sum(phylo.vars$vcov)
part.vars <- cbind(phylo.vars$grp,var.phylo.vars)
#test
sum(as.numeric(part.vars[,2]))
#now have proportions of variance explained by each effect
#Environment
#1,2,7
site.partvar <- sum(as.numeric(part.vars[1,2]),as.numeric(part.vars[2,2]),as.numeric(part.vars[7,2])) #sub, plot, site 11.88 %


################ Final Models #############
#old
#include site x spp interaction
# nsc.phylo.int.lm <- lmer(total.nsc ~ DBH14 + Canopy15 + (1|Site/Plot/Sub) + (1|subclass/order/family/genus/GenusSpecies) + (1|PFT) + (1|wood) + (1|GenusSpecies:Site), nsc.adult.total.mass.alive.common)
# summary(nsc.phylo.int.lm)
# plot((nsc.phylo.int.lm))

#Full model with effects specified correctly - used in final dissertation draft! total.NSC
nsc.full.lm <- lmer(total.nsc ~ DBH14 + Canopy15 + wood + PFT  + (1|Site/Plot/Sub) + (1|TEMP_C) + (1|GenusSpecies:Site) + (1|subclass/order/family/genus/GenusSpecies), nsc.adult.total.mass.alive.common)
summary(nsc.full.lm)
anova(nsc.full.lm)
# plot((nsc.full.lm))

#put fixed effects in order of explanatory power when isolated
nsc.full.lm2 <- lmer(total.nsc ~ wood + PFT + DBH14 + Canopy15 + (1|Site/Plot/Sub) + (1|subclass/order/family/genus/GenusSpecies) + (1|GenusSpecies:Site) + (1|TEMP_C), nsc.adult.total.mass.alive.common)
summary(nsc.full.lm2)
anova.nsc.full.lm2 <- anova(nsc.full.lm2)
# plot((nsc.full.lm2)) #looking at residuals

#Gives me the R2 for fixed effects (R2m - marginal) and fixed + random effects (R2c - conditional) 0.3500509 0.7281469 
nsc.full.R2 <- r.squaredGLMM(nsc.full.lm2)
total.fix <- nsc.full.R2[1] #.35
total.rand <- nsc.full.R2[2] - nsc.full.R2[1] #.37

#proportion of variance for fixed effects from Sum Sq of ANOVA table
nsc.full.fix.ss <- anova.nsc.full.lm2$`Sum Sq`/sum(anova.nsc.full.lm2$`Sum Sq`)
nsc.full.fix.vars.table <- cbind(rownames(anova.nsc.full.lm2), anova.nsc.full.lm2$Df, anova.nsc.full.lm2$`F value`, anova.nsc.full.lm2$`Pr(>F)`, nsc.full.fix.ss)
total.nsc.proportion.fix <- total.fix * as.numeric(nsc.full.fix.vars.table[,4]) #proportion of fixed effect explained by each variable - highly dependent on order - don't trust relative importance.
total.fix.table <- cbind(rownames(anova.nsc.full.lm2),total.nsc.proportion.fix) #final table fixed effects
#random vars
nsc.full.rand.vars <- as.data.frame(VarCorr(nsc.full.lm2, order = "cov.last")) #random effect variances
prop.nsc.full.rand.vars = nsc.full.rand.vars$vcov[1:10]/sum(nsc.full.rand.vars$vcov[1:10])
#percent.full.rand.vars <- prop.nsc.full.rand.vars*100
total.nsc.proportion.rand <- total.rand * prop.nsc.full.rand.vars #proportion of variance explained by each random effect
total.rand.table <- cbind(nsc.full.rand.vars$grp[1:10], total.nsc.proportion.rand) #final table random effects
total.residual <- 1 - nsc.full.R2[2] #residual
sum(total.nsc.proportion.rand) #check sums
sum(total.nsc.proportion.fix) #check sums


###Starch Full model###
# nsc.full.lm <- lmer(total.nsc ~ DBH14 + Canopy15 + wood + PFT  + (1|Site/Plot/Sub) + (1|TEMP_C) + (1|GenusSpecies:Site) + (1|subclass/order/family/genus/GenusSpecies), nsc.adult.total.mass.alive.common)
# summary(nsc.full.lm)
# anova(nsc.full.lm)
# # plot((nsc.full.lm))

#put fixed effects in order of explanatory power when isolated
starch.full.lm2 <- lmer(starch.mg.g ~ wood + PFT + DBH14 + Canopy15 + (1|Site/Plot/Sub) + (1|subclass/order/family/genus/GenusSpecies) + (1|GenusSpecies:Site) + (1|TEMP_C), nsc.adult.total.mass.alive.common)
summary(starch.full.lm2)
anova.starch.full.lm2 <- anova(starch.full.lm2)
# plot((nsc.full.lm2)) #looking at residuals

#Gives me the R2 for fixed effects (R2m - marginal) and fixed + random effects (R2c - conditional) 0.3500509 0.7281469 
starch.full.R2 <- r.squaredGLMM(starch.full.lm2)
starch.fix <- starch.full.R2[1] #.27
starch.rand <- starch.full.R2[2] - starch.full.R2[1] #.42

#proportion of variance for fixed effects from Sum Sq of ANOVA table
starch.full.fix.ss <- anova.starch.full.lm2$`Sum Sq`/sum(anova.starch.full.lm2$`Sum Sq`)
starch.full.fix.vars.table <- cbind(rownames(anova.starch.full.lm2), anova.starch.full.lm2$Df, anova.starch.full.lm2$`F value`, anova.starch.full.lm2$`Pr(>F)`, starch.full.fix.ss)
starch.proportion.fix <- starch.fix * as.numeric(starch.full.fix.vars.table[,4]) #proportion of fixed effect explained by each variable - highly dependent on order - don't trust relative importance.
starch.fix.table <- cbind(rownames(anova.starch.full.lm2),starch.proportion.fix) #final table fixed effects
#random vars
starch.full.rand.vars <- as.data.frame(VarCorr(starch.full.lm2, order = "cov.last")) #random effect variances
prop.starch.full.rand.vars = starch.full.rand.vars$vcov[1:10]/sum(starch.full.rand.vars$vcov[1:10])
#percent.full.rand.vars <- prop.nsc.full.rand.vars*100
starch.proportion.rand <- starch.rand * prop.starch.full.rand.vars #proportion of variance explained by each random effect
starch.rand.table <- cbind(starch.full.rand.vars$grp[1:10], starch.proportion.rand) #final table random effects
starch.residual <- 1 - starch.full.R2[2] #residual
sum(starch.proportion.rand) #check sums
sum(starch.proportion.fix) #check sums

###Sugar Full model###
# nsc.full.lm <- lmer(total.nsc ~ DBH14 + Canopy15 + wood + PFT  + (1|Site/Plot/Sub) + (1|TEMP_C) + (1|GenusSpecies:Site) + (1|subclass/order/family/genus/GenusSpecies), nsc.adult.total.mass.alive.common)
# summary(nsc.full.lm)
# anova(nsc.full.lm)
# # plot((nsc.full.lm))

#put fixed effects in order of explanatory power when isolated
sugar.full.lm2 <- lmer(sugar.mg.g ~ wood + PFT + DBH14 + Canopy15 + (1|Site/Plot/Sub) + (1|subclass/order/family/genus/GenusSpecies) + (1|GenusSpecies:Site) + (1|TEMP_C), nsc.adult.total.mass.alive.common)
summary(sugar.full.lm2)
anova.sugar.full.lm2 <- anova(sugar.full.lm2)
# plot((nsc.full.lm2)) #looking at residuals

#Gives me the R2 for fixed effects (R2m - marginal) and fixed + random effects (R2c - conditional) 0.3500509 0.7281469 
sugar.full.R2 <- r.squaredGLMM(sugar.full.lm2)
sugar.fix <- sugar.full.R2[1] #.27
sugar.rand <- sugar.full.R2[2] - sugar.full.R2[1] #.42

#proportion of variance for fixed effects from Sum Sq of ANOVA table
sugar.full.fix.ss <- anova.sugar.full.lm2$`Sum Sq`/sum(anova.sugar.full.lm2$`Sum Sq`)
sugar.full.fix.vars.table <- cbind(rownames(anova.sugar.full.lm2), anova.sugar.full.lm2$Df, anova.sugar.full.lm2$`F value`, anova.sugar.full.lm2$`Pr(>F)`, sugar.full.fix.ss)
sugar.proportion.fix <- sugar.fix * as.numeric(sugar.full.fix.vars.table[,4]) #proportion of fixed effect explained by each variable - highly dependent on order - don't trust relative importance.
sugar.fix.table <- cbind(rownames(anova.sugar.full.lm2),sugar.proportion.fix) #final table fixed effects
#random vars
sugar.full.rand.vars <- as.data.frame(VarCorr(sugar.full.lm2, order = "cov.last")) #random effect variances
prop.sugar.full.rand.vars = sugar.full.rand.vars$vcov[1:10]/sum(sugar.full.rand.vars$vcov[1:10])
#percent.full.rand.vars <- prop.nsc.full.rand.vars*100
sugar.proportion.rand <- sugar.rand * prop.sugar.full.rand.vars #proportion of variance explained by each random effect
sugar.rand.table <- cbind(sugar.full.rand.vars$grp[1:10], sugar.proportion.rand) #final table random effects
sugar.residual <- 1 - sugar.full.R2[2] #residual
sum(sugar.proportion.rand) #check sums
sum(sugar.proportion.fix) #check sums


###Glucose Full model###
# nsc.full.lm <- lmer(total.nsc ~ DBH14 + Canopy15 + wood + PFT  + (1|Site/Plot/Sub) + (1|TEMP_C) + (1|GenusSpecies:Site) + (1|subclass/order/family/genus/GenusSpecies), nsc.adult.total.mass.alive.common)
# summary(nsc.full.lm)
# anova(nsc.full.lm)
# # plot((nsc.full.lm))

#put fixed effects in order of explanatory power when isolated
glucose.full.lm2 <- lmer(glucose.mg.g ~ wood + PFT + DBH14 + Canopy15 + (1|Site/Plot/Sub) + (1|subclass/order/family/genus/GenusSpecies) + (1|GenusSpecies:Site) + (1|TEMP_C), nsc.adult.total.mass.alive.common)
summary(glucose.full.lm2)
anova.glucose.full.lm2 <- anova(glucose.full.lm2)
# plot((nsc.full.lm2)) #looking at residuals

#Gives me the R2 for fixed effects (R2m - marginal) and fixed + random effects (R2c - conditional) 0.3500509 0.7281469 
glucose.full.R2 <- r.squaredGLMM(glucose.full.lm2)
glucose.fix <- glucose.full.R2[1] #.27
glucose.rand <- glucose.full.R2[2] - glucose.full.R2[1] #.42

#proportion of variance for fixed effects from Sum Sq of ANOVA table
glucose.full.fix.ss <- anova.glucose.full.lm2$`Sum Sq`/sum(anova.glucose.full.lm2$`Sum Sq`)
glucose.full.fix.vars.table <- cbind(rownames(anova.glucose.full.lm2), anova.glucose.full.lm2$Df, anova.glucose.full.lm2$`F value`, anova.glucose.full.lm2$`Pr(>F)`, glucose.full.fix.ss)
glucose.proportion.fix <- glucose.fix * as.numeric(glucose.full.fix.vars.table[,4]) #proportion of fixed effect explained by each variable - highly dependent on order - don't trust relative importance.
glucose.fix.table <- cbind(rownames(anova.glucose.full.lm2),glucose.proportion.fix) #final table fixed effects
#random vars
glucose.full.rand.vars <- as.data.frame(VarCorr(glucose.full.lm2, order = "cov.last")) #random effect variances
prop.glucose.full.rand.vars = glucose.full.rand.vars$vcov[1:10]/sum(glucose.full.rand.vars$vcov[1:10])
#percent.full.rand.vars <- prop.nsc.full.rand.vars*100
glucose.proportion.rand <- glucose.rand * prop.glucose.full.rand.vars #proportion of variance explained by each random effect
glucose.rand.table <- cbind(glucose.full.rand.vars$grp[1:10], glucose.proportion.rand) #final table random effects
glucose.residual <- 1 - glucose.full.R2[2] #residual
sum(glucose.proportion.rand) #check sums
sum(glucose.proportion.fix) #check sums


###Fructose Full model###
# nsc.full.lm <- lmer(total.nsc ~ DBH14 + Canopy15 + wood + PFT  + (1|Site/Plot/Sub) + (1|TEMP_C) + (1|GenusSpecies:Site) + (1|subclass/order/family/genus/GenusSpecies), nsc.adult.total.mass.alive.common)
# summary(nsc.full.lm)
# anova(nsc.full.lm)
# # plot((nsc.full.lm))

#put fixed effects in order of explanatory power when isolated
fructose.full.lm2 <- lmer(fructose.mg.g ~ wood + PFT + DBH14 + Canopy15 + (1|Site/Plot/Sub) + (1|subclass/order/family/genus/GenusSpecies) + (1|GenusSpecies:Site) + (1|TEMP_C), nsc.adult.total.mass.alive.common)
summary(fructose.full.lm2)
anova.fructose.full.lm2 <- anova(fructose.full.lm2)
# plot((nsc.full.lm2)) #looking at residuals

#Gives me the R2 for fixed effects (R2m - marginal) and fixed + random effects (R2c - conditional) 0.3500509 0.7281469 
fructose.full.R2 <- r.squaredGLMM(fructose.full.lm2)
fructose.fix <- fructose.full.R2[1] #.27
fructose.rand <- fructose.full.R2[2] - fructose.full.R2[1] #.42

#proportion of variance for fixed effects from Sum Sq of ANOVA table
fructose.full.fix.ss <- anova.fructose.full.lm2$`Sum Sq`/sum(anova.fructose.full.lm2$`Sum Sq`)
fructose.full.fix.vars.table <- cbind(rownames(anova.fructose.full.lm2), anova.fructose.full.lm2$Df, anova.fructose.full.lm2$`F value`, anova.fructose.full.lm2$`Pr(>F)`, fructose.full.fix.ss)
fructose.proportion.fix <- fructose.fix * as.numeric(fructose.full.fix.vars.table[,4]) #proportion of fixed effect explained by each variable - highly dependent on order - don't trust relative importance.
fructose.fix.table <- cbind(rownames(anova.fructose.full.lm2),fructose.proportion.fix) #final table fixed effects
#random vars
fructose.full.rand.vars <- as.data.frame(VarCorr(fructose.full.lm2, order = "cov.last")) #random effect variances
prop.fructose.full.rand.vars = fructose.full.rand.vars$vcov[1:10]/sum(fructose.full.rand.vars$vcov[1:10])
#percent.full.rand.vars <- prop.nsc.full.rand.vars*100
fructose.proportion.rand <- fructose.rand * prop.fructose.full.rand.vars #proportion of variance explained by each random effect
fructose.rand.table <- cbind(fructose.full.rand.vars$grp[1:10], fructose.proportion.rand) #final table random effects
fructose.residual <- 1 - fructose.full.R2[2] #residual
sum(fructose.proportion.rand) #check sums
sum(fructose.proportion.fix) #check sums


###Sucrose Full model###
# nsc.full.lm <- lmer(total.nsc ~ DBH14 + Canopy15 + wood + PFT  + (1|Site/Plot/Sub) + (1|TEMP_C) + (1|GenusSpecies:Site) + (1|subclass/order/family/genus/GenusSpecies), nsc.adult.total.mass.alive.common)
# summary(nsc.full.lm)
# anova(nsc.full.lm)
# # plot((nsc.full.lm))

#put fixed effects in order of explanatory power when isolated
sucrose.full.lm2 <- lmer(sucrose.mg.g ~ wood + PFT + DBH14 + Canopy15 + (1|Site/Plot/Sub) + (1|subclass/order/family/genus/GenusSpecies) + (1|GenusSpecies:Site) + (1|TEMP_C), nsc.adult.total.mass.alive.common)
summary(sucrose.full.lm2)
anova.sucrose.full.lm2 <- anova(sucrose.full.lm2)
# plot((nsc.full.lm2)) #looking at residuals

#Gives me the R2 for fixed effects (R2m - marginal) and fixed + random effects (R2c - conditional) 0.3500509 0.7281469 
sucrose.full.R2 <- r.squaredGLMM(sucrose.full.lm2)
sucrose.fix <- sucrose.full.R2[1] #.27
sucrose.rand <- sucrose.full.R2[2] - sucrose.full.R2[1] #.42

#proportion of variance for fixed effects from Sum Sq of ANOVA table
sucrose.full.fix.ss <- anova.sucrose.full.lm2$`Sum Sq`/sum(anova.sucrose.full.lm2$`Sum Sq`)
sucrose.full.fix.vars.table <- cbind(rownames(anova.sucrose.full.lm2), anova.sucrose.full.lm2$Df, anova.sucrose.full.lm2$`F value`, anova.sucrose.full.lm2$`Pr(>F)`, sucrose.full.fix.ss)
sucrose.proportion.fix <- sucrose.fix * as.numeric(sucrose.full.fix.vars.table[,4]) #proportion of fixed effect explained by each variable - highly dependent on order - don't trust relative importance.
sucrose.fix.table <- cbind(rownames(anova.sucrose.full.lm2),sucrose.proportion.fix) #final table fixed effects
#random vars
sucrose.full.rand.vars <- as.data.frame(VarCorr(sucrose.full.lm2, order = "cov.last")) #random effect variances
prop.sucrose.full.rand.vars = sucrose.full.rand.vars$vcov[1:10]/sum(sucrose.full.rand.vars$vcov[1:10])
#percent.full.rand.vars <- prop.nsc.full.rand.vars*100
sucrose.proportion.rand <- sucrose.rand * prop.sucrose.full.rand.vars #proportion of variance explained by each random effect
sucrose.rand.table <- cbind(sucrose.full.rand.vars$grp[1:10], sucrose.proportion.rand) #final table random effects
sucrose.residual <- 1 - sucrose.full.R2[2] #residual
sum(sucrose.proportion.rand) #check sums
sum(sucrose.proportion.fix) #check sums


#commented out stuff is old version of calculating variance partitioning - it is incorrect!
# #fixed effect variances
# #Proportion of variance for fixed effects
# fixed.nsc.full.lm2 <- lm(total.nsc ~ DBH14 + Canopy15 + PFT + wood, data = nsc.adult.total.mass.alive.common)
# anova.fixed.nsc.full.lm2 <- anova(fixed.nsc.full.lm2)
# summary(anova.fixed.nsc.full.lm2)
# 
# full.nsc.ss <- anova.fixed.nsc.full.lm2$`Sum Sq`/sum(anova.fixed.nsc.full.lm2$`Sum Sq`)
# full.nsc.part.vars <- cbind(rownames(anova.fixed.nsc.full.lm2), anova.fixed.nsc.full.lm2$Df, anova.fixed.nsc.full.lm2$`F value`, anova.fixed.nsc.full.lm2$`Pr(>F)`, full.nsc.ss)
# #check
# var(predict(lm(total.nsc ~ DBH14 + Canopy15 + PFT + wood, data = nsc.adult.total.mass.alive.common)))
# var(predict(lm(total.nsc ~ DBH14, data = nsc.adult.total.mass.alive.common)))
# var(predict(lm(total.nsc ~ Canopy15, data = nsc.adult.total.mass.alive.common)))
# var(predict(lm(total.nsc ~ PFT, data = nsc.adult.total.mass.alive.common)))
# var(predict(lm(total.nsc ~ wood, data = nsc.adult.total.mass.alive.common)))
# 
# 
# 
# 
# #variances for random effects & fixed effects
# full.rand.vars <- as.data.frame(VarCorr(lmer.full.annual, order = "cov.last")) #random effect variances
# var.full.rand.vars = full.rand.vars$vcov/sum(full.rand.vars$vcov)
# percent.full.rand.vars <- var.full.rand.vars*100
# 
# fix.part.vars <- full.fix.part.vars[1:3,5]
# random.part.vars <- full.vars$vcov
# full.total.part.vars <- c(fix.part.vars,random.part.vars)
# names.fix <- full.fix.part.vars[1:3,1]
# names.rand <- full.vars$grp
# names.total <- c(names.fix, names.rand)
# full.part.vars.table <- cbind(names.total,full.total.part.vars)
# fullmodel.part.vars <- as.numeric(full.part.vars.table[,2])/sum(as.numeric(full.part.vars.table[,2]))
# percent.fullmodel.part.vars <- fullmodel.part.vars*100 ### This is proportion of variance for random and fixed effects
# final.annual.table <- cbind(full.part.vars.table,percent.fullmodel.part.vars)
# 
# #variances
# #vcov = variances of random effects
# phylo.vars.int <- as.data.frame(VarCorr(nsc.phylo.int.lm, order = "cov.last"))
# #calculating partial variances for random effects
# var.phylo.vars.int = phylo.vars.int$vcov/sum(phylo.vars.int$vcov)
# part.vars.int <- cbind(phylo.vars.int$grp,var.phylo.vars.int)
# 
# #file for table of mixed effects model partial variances
# write.csv(x = part.vars.int, file = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/part.variances.csv")
# #test
# sum(as.numeric(part.vars.int[,2]))
# #now have proportions of variance explained by each effect
# #Environment
# #1,2,7
# site.partvar.int <- sum(as.numeric(part.vars.int[1,2]),as.numeric(part.vars.int[3,2]),as.numeric(part.vars.int[8,2])) #sub, plot, site 11.875%
# 
# trait.partvar.int <- sum(as.numeric(part.vars.int[9,2]),as.numeric(part.vars.int[11,2])) #pft & wood .5%
# 
# Phylo.partvar.int <- sum(as.numeric(part.vars.int[4,2]),as.numeric(part.vars.int[5,2]),as.numeric(part.vars.int[6,2]),as.numeric(part.vars.int[7,2]),as.numeric(part.vars.int[10,2])) #species, genus, family, order, subclass, 45.08%, family & order alone: 38.3
# 
# #Species * Site interaction: 6.2%
# 
# #Everything - residual
# all.partvar.int <- sum(as.numeric(part.vars.int[,2])) - as.numeric(part.vars.int[12,2])
# #63.6%
# 
# 
# 
# 
# # total.var <- sum(52.68, 93.72, 207.88, 67.34, 36.01, 282.80)
# # phylo.vars <- sum(52.68, 93.72, 207.88,36.01)
# # phylo <- phylo.vars/total.var
# 
# # total.var <- sum(57.37, 3.002, 167.924, 169.875, 70.315, 10.25, 282.812)
# # phylo.var <- sum(57.37, 3.002, 167.924, 169.875, 10.25)
# # phylo.tot <- phylo.var/total.var
#  
#  # (Intercept)  57.370   7.574  
#  # (Intercept)   3.002   1.733  
#  # (Intercept) 167.924  12.959  
#  # (Intercept) 169.875  13.034  
#  # (Intercept)  70.315   8.385  
#  # (Intercept)  10.250   3.201  
#  #             282.812  16.817  
# 
# nsc.trait.lm <- lmer(total.nsc ~ DBH14 + Canopy15 + (1|Site) + (1|PFT) + (1|wood), nsc.adult.total.mass.alive.common)
# summary(nsc.trait.lm)
# plot((nsc.trait.lm))


```

Canopy Status and Mortality

```{r}
#Canopy Status
nsc.adult.total.mass.alive.common$Canopy15 <- as.factor(nsc.adult.total.mass.alive.common$Canopy15)

lm.canopy.total <- lm(total.nsc ~ Canopy15, data = nsc.adult.total.mass.alive.common)
anova(lm.canopy.total)
summary(lm.canopy.total)

#Canopy Tukey HSD
summary(aov.canopy <- aov(lm.canopy.total))
tukey.canopy <- TukeyHSD(aov.canopy, "Canopy15", ordered = FALSE)
plot(tukey.canopy)
canopy.levels <- tukey.canopy[["Canopy15"]][,4]
canopy.labels <- multcompLetters(canopy.levels)['Letters']
canopy.plot.labels <- names(canopy.labels[['Letters']])

canopy.nsc <- ggplot(nsc.adult.total.mass.alive.common[!is.na(nsc.adult.total.mass.alive.common$Canopy15),], aes(x = Canopy15, y = total.nsc)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 198)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:3, y = c(136, 155, 180), label = c("c","a","b")) +
  ggtitle("All Species")

# ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/TotalNSC.AllCommonCanopy.png", plot = canopy.nsc, dpi = 600, width = 6.5, height = 3, units = "in")

#Canopy Starch
lm.canopy.starch <- lm(starch.mg.g ~ Canopy15, data = nsc.adult.total.mass.alive.common)
anova(lm.canopy.starch)
summary(lm.canopy.starch)

#Canopy Tukey HSD
summary(aov.canopy.starch <- aov(lm.canopy.starch))
tukey.canopy.starch <- TukeyHSD(aov.canopy.starch, "Canopy15", ordered = FALSE)
plot(tukey.canopy.starch)
canopy.levels.starch <- tukey.canopy.starch[["Canopy15"]][,4]
canopy.labels.starch <- multcompLetters(canopy.levels.starch)['Letters']
canopy.plot.labels.starch <- names(canopy.labels.starch[['Letters']])

canopy.nsc.starch <- ggplot(nsc.adult.total.mass.alive.common[!is.na(nsc.adult.total.mass.alive.common$Canopy15),], aes(x = Canopy15, y = starch.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 115)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Starch mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:3, y = c(80, 100, 109), label = c("a","b","b")) +
  ggtitle("All Species")

# ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/TotalNSC.AllCommonCanopy.png", plot = canopy.nsc, dpi = 600, width = 6.5, height = 3, units = "in")

#Canopy Sugar
lm.canopy.sugar <- lm(sugar.mg.g ~ Canopy15, data = nsc.adult.total.mass.alive.common)
anova(lm.canopy.sugar)
summary(lm.canopy.sugar)

#Canopy Tukey HSD
summary(aov.canopy.sugar <- aov(lm.canopy.sugar))
tukey.canopy.sugar <- TukeyHSD(aov.canopy.sugar, "Canopy15", ordered = FALSE)
plot(tukey.canopy.sugar)
canopy.levels.sugar <- tukey.canopy.sugar[["Canopy15"]][,4]
canopy.labels.sugar <- multcompLetters(canopy.levels.sugar)['Letters']
canopy.plot.labels.sugar <- names(canopy.labels.sugar[['Letters']])

canopy.nsc.sugar <- ggplot(nsc.adult.total.mass.alive.common[!is.na(nsc.adult.total.mass.alive.common$Canopy15),], aes(x = Canopy15, y = sugar.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 83)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Total Sugar mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:3, y = c(73, 77, 79), label = c("a","b","c")) +
  ggtitle("All Species")

#Canopy Sugar
lm.canopy.glucose <- lm(glucose.mg.g ~ Canopy15, data = nsc.adult.total.mass.alive.common)
anova(lm.canopy.glucose)
summary(lm.canopy.glucose)

#Canopy Tukey HSD
summary(aov.canopy.glucose <- aov(lm.canopy.glucose))
tukey.canopy.glucose <- TukeyHSD(aov.canopy.glucose, "Canopy15", ordered = FALSE)
plot(tukey.canopy.glucose)
canopy.levels.glucose <- tukey.canopy.glucose[["Canopy15"]][,4]
canopy.labels.glucose <- multcompLetters(canopy.levels.glucose)['Letters']
canopy.plot.labels.glucose <- names(canopy.labels.glucose[['Letters']])

canopy.nsc.glucose <- ggplot(nsc.adult.total.mass.alive.common[!is.na(nsc.adult.total.mass.alive.common$Canopy15),], aes(x = Canopy15, y = glucose.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 42)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Glucose mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:3, y = c(27, 40, 37), label = c("a","a","b")) +
  ggtitle("All Species")

#Canopy Fructose
lm.canopy.fructose <- lm(fructose.mg.g ~ Canopy15, data = nsc.adult.total.mass.alive.common)
anova(lm.canopy.fructose)
summary(lm.canopy.fructose)

#Canopy Tukey HSD
summary(aov.canopy.fructose <- aov(lm.canopy.fructose))
tukey.canopy.fructose <- TukeyHSD(aov.canopy.fructose, "Canopy15", ordered = FALSE)
plot(tukey.canopy.fructose)
canopy.levels.fructose <- tukey.canopy.fructose[["Canopy15"]][,4]
canopy.labels.fructose <- multcompLetters(canopy.levels.fructose)['Letters']
canopy.plot.labels.fructose <- names(canopy.labels.fructose[['Letters']])

canopy.nsc.fructose <- ggplot(nsc.adult.total.mass.alive.common[!is.na(nsc.adult.total.mass.alive.common$Canopy15),], aes(x = Canopy15, y = fructose.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 36)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Fructose mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:3, y = c(23, 34, 29), label = c("a","a","b")) +
  ggtitle("All Species")

#Canopy Sucrose
lm.canopy.sucrose <- lm(sucrose.mg.g ~ Canopy15, data = nsc.adult.total.mass.alive.common)
anova(lm.canopy.sucrose)
summary(lm.canopy.sucrose)

#Canopy Tukey HSD
summary(aov.canopy.sucrose <- aov(lm.canopy.sucrose))
tukey.canopy.sucrose <- TukeyHSD(aov.canopy.sucrose, "Canopy15", ordered = FALSE)
plot(tukey.canopy.sucrose)
canopy.levels.sucrose <- tukey.canopy.sucrose[["Canopy15"]][,4]
canopy.labels.sucrose <- multcompLetters(canopy.levels.sucrose)['Letters']
canopy.plot.labels.sucrose <- names(canopy.labels.sucrose[['Letters']])

canopy.nsc.sucrose <- ggplot(nsc.adult.total.mass.alive.common[!is.na(nsc.adult.total.mass.alive.common$Canopy15),], aes(x = Canopy15, y = sucrose.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 59)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Sucrose mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:3, y = c(56, 54.5, 56), label = c("a","b","c")) +
  ggtitle("All Species")

#DBH total
lm.dbh.total <- lm(total.nsc ~ DBH14, data = nsc.adult.total.mass.alive.common)
anova(lm.dbh.total)
summary(lm.dbh.total)

#DBH scatterplot Total
dbh.nsc.total <- ggplot(nsc.adult.total.mass.alive.common, aes(x = DBH14, y = total.nsc)) +
  geom_point(alpha = .3) +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1, aes(color = "blue")) + # GAM model with smooth
  geom_smooth(method = "lm", aes(color = "yellow")) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  scale_color_manual(name = "Fit", values = "yellow") + 
  theme(legend.position = "none") +
  ggtitle("All Species")

# ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/TotalNSC.AllCommon.DBH.png", plot = dbh.nsc, dpi = 600, width = 5, height = 3.5, units = "in")

#DBH starch
lm.dbh.starch <- lm(starch.mg.g ~ DBH14, data = nsc.adult.total.mass.alive.common)
anova(lm.dbh.starch)
summary(lm.dbh.starch)

#DBH scatterplot starch
dbh.nsc.starch <- ggplot(nsc.adult.total.mass.alive.common, aes(x = DBH14, y = starch.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1, aes(color = "blue")) + # GAM model with smooth
  geom_smooth(method = "lm", aes(color = "yellow")) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  scale_color_manual(name = "Fit", values = "yellow") + 
  theme(legend.position = "none") +
  ggtitle("All Species")

#DBH sugar
lm.dbh.sugar <- lm(sugar.mg.g ~ DBH14, data = nsc.adult.total.mass.alive.common)
anova(lm.dbh.sugar)
summary(lm.dbh.sugar)

#DBH scatterplot sugar
dbh.nsc.sugar <- ggplot(nsc.adult.total.mass.alive.common, aes(x = DBH14, y = sugar.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1, aes(color = "blue")) + # GAM model with smooth
  geom_smooth(method = "lm", aes(color = "yellow")) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  scale_color_manual(name = "Fit", values = "yellow") + 
  theme(legend.position = "none") +
  ggtitle("All Species")

#DBH glucose
lm.dbh.glucose <- lm(glucose.mg.g ~ DBH14, data = nsc.adult.total.mass.alive.common)
anova(lm.dbh.glucose)
summary(lm.dbh.glucose)

#DBH scatterplot glucose
dbh.nsc.glucose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = DBH14, y = glucose.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1, aes(color = "blue")) + # GAM model with smooth
  geom_smooth(method = "lm", aes(color = "yellow")) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  scale_color_manual(name = "Fit", values = "yellow") + 
  theme(legend.position = "none") +
  ggtitle("All Species")

#DBH fructose
lm.dbh.fructose <- lm(fructose.mg.g ~ DBH14, data = nsc.adult.total.mass.alive.common)
anova(lm.dbh.fructose)
summary(lm.dbh.fructose)

#DBH scatterplot fructose
dbh.nsc.fructose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = DBH14, y = fructose.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1, aes(color = "blue")) + # GAM model with smooth
  geom_smooth(method = "lm", aes(color = "yellow")) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  scale_color_manual(name = "Fit", values = "yellow") + 
  theme(legend.position = "none") +
  ggtitle("All Species")

#DBH sucrose
lm.dbh.sucrose <- lm(sucrose.mg.g ~ DBH14, data = nsc.adult.total.mass.alive.common)
anova(lm.dbh.sucrose)
summary(lm.dbh.sucrose)

#DBH scatterplot sucrose
dbh.nsc.sucrose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = DBH14, y = sucrose.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1, aes(color = "blue")) + # GAM model with smooth
  geom_smooth(method = "lm", aes(color = "yellow")) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  scale_color_manual(name = "Fit", values = "yellow") + 
  theme(legend.position = "none") +
  ggtitle("All Species")

###DBH and Canopy Analysis for most common species
#Quercus dataframe
quercus.sort <- which(nsc.adult.total.mass.alive.common$genus == "Quercus")
nsc.adult.quercus <- nsc.adult.total.mass.alive.common[quercus.sort,]

#DBH quercus total NSC
dbh.nsc.quercus <- ggplot(nsc.adult.quercus, aes(x = DBH14, y = total.nsc)) +
  geom_point(alpha = .3) +
  #geom_smooth() + #loess
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  ggtitle("Quercus")

#lm for Quercus DBH:NSC
lm.dbh.querc <- lm(total.nsc ~ DBH14, data = nsc.adult.quercus)
anova(lm.dbh.querc)
summary(lm.dbh.querc)

#DBH quercus Starch
dbh.nsc.quercus.starch <- ggplot(nsc.adult.quercus, aes(x = DBH14, y = starch.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth() + #loess
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  ggtitle("Quercus")

#lm for Quercus DBH:NSC
lm.dbh.querc.starch <- lm(starch.mg.g ~ DBH14, data = nsc.adult.quercus)
anova(lm.dbh.querc.starch)
summary(lm.dbh.querc.starch)

#DBH quercus Sugar
dbh.nsc.quercus.sugar <- ggplot(nsc.adult.quercus, aes(x = DBH14, y = sugar.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth() + #loess
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  ggtitle("Quercus")

#lm for Quercus DBH:NSC
lm.dbh.querc.sugar <- lm(sugar.mg.g ~ DBH14, data = nsc.adult.quercus)
anova(lm.dbh.querc.sugar)
summary(lm.dbh.querc.sugar)

#DBH quercus glucose
dbh.nsc.quercus.glucose <- ggplot(nsc.adult.quercus, aes(x = DBH14, y = glucose.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth() + #loess
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  ggtitle("Quercus")

#lm for Quercus DBH:NSC
lm.dbh.querc.glucose <- lm(glucose.mg.g ~ DBH14, data = nsc.adult.quercus)
anova(lm.dbh.querc.glucose)
summary(lm.dbh.querc.glucose)

#DBH quercus fructose
dbh.nsc.quercus.fructose <- ggplot(nsc.adult.quercus, aes(x = DBH14, y = fructose.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth() + #loess
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  ggtitle("Quercus")

#lm for Quercus DBH:NSC
lm.dbh.querc.fructose <- lm(fructose.mg.g ~ DBH14, data = nsc.adult.quercus)
anova(lm.dbh.querc.fructose)
summary(lm.dbh.querc.fructose)

#DBH quercus sucrose
dbh.nsc.quercus.sucrose <- ggplot(nsc.adult.quercus, aes(x = DBH14, y = sucrose.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth() + #loess
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  ggtitle("Quercus")

#lm for Quercus DBH:NSC
lm.dbh.querc.sucrose <- lm(sucrose.mg.g ~ DBH14, data = nsc.adult.quercus)
anova(lm.dbh.querc.sucrose)
summary(lm.dbh.querc.sucrose)

#lm for Canopy:NSC total
lm.can.querc <- lm(total.nsc ~ Canopy15, data = nsc.adult.quercus)
anova(lm.can.querc)
summary(lm.can.querc)

#TukeyHSD
summary(aov.can.querc <- aov(lm.can.querc))
tukey.can.querc <- TukeyHSD(aov.can.querc, "Canopy15", ordered = FALSE)
plot(tukey.can.querc)
canopy.levels.querc <- tukey.can.querc[["Canopy15"]][,4]
canopy.labels.querc <- multcompLetters(canopy.levels.querc)['Letters']
canopy.plot.labels.querc <- names(canopy.labels.querc[['Letters']])

#Canopy quercus
canopy.nsc.quercus <- ggplot(nsc.adult.quercus[!is.na(nsc.adult.quercus$Canopy15),], aes(x = as.factor(Canopy15), y = total.nsc)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 170)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:3, y = c(136, 155, 151), label = c("c","a","b")) +
  ggtitle("Quercus")

#lm for Canopy:NSC Starch
lm.can.querc.starch <- lm(starch.mg.g ~ Canopy15, data = nsc.adult.quercus)
anova(lm.can.querc.starch)
summary(lm.can.querc.starch)

#TukeyHSD
summary(aov.can.querc.starch <- aov(lm.can.querc.starch))
tukey.can.querc.starch <- TukeyHSD(aov.can.querc.starch, "Canopy15", ordered = FALSE)
plot(tukey.can.querc.starch)
canopy.levels.querc.starch <- tukey.can.querc.starch[["Canopy15"]][,4]
canopy.labels.querc.starch <- multcompLetters(canopy.levels.querc.starch)['Letters']
canopy.plot.labels.querc.starch <- names(canopy.labels.querc.starch[['Letters']])

#Canopy quercus
canopy.nsc.quercus.starch <- ggplot(nsc.adult.quercus[!is.na(nsc.adult.quercus$Canopy15),], aes(x = as.factor(Canopy15), y = starch.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 108)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:3, y = c(75.5, 99, 102), label = c("a","b","b")) +
  ggtitle("Quercus")

#lm for Canopy:NSC Sugar
lm.can.querc.sugar <- lm(sugar.mg.g ~ Canopy15, data = nsc.adult.quercus)
anova(lm.can.querc.sugar)
summary(lm.can.querc.sugar)

#TukeyHSD
summary(aov.can.querc.sugar <- aov(lm.can.querc.sugar))
tukey.can.querc.sugar <- TukeyHSD(aov.can.querc.sugar, "Canopy15", ordered = FALSE)
plot(tukey.can.querc.sugar)
canopy.levels.querc.sugar <- tukey.can.querc.sugar[["Canopy15"]][,4]
canopy.labels.querc.sugar <- multcompLetters(canopy.levels.querc.sugar)['Letters']
canopy.plot.labels.querc.sugar <- names(canopy.labels.querc.sugar[['Letters']])

#Canopy quercus
canopy.nsc.quercus.sugar <- ggplot(nsc.adult.quercus[!is.na(nsc.adult.quercus$Canopy15),], aes(x = as.factor(Canopy15), y = sugar.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 80)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:3, y = c(69, 76, 76), label = c("a","a","b")) +
  ggtitle("Quercus")

#lm for Canopy:NSC Glucose
lm.can.querc.glucose <- lm(glucose.mg.g ~ Canopy15, data = nsc.adult.quercus)
anova(lm.can.querc.glucose)
summary(lm.can.querc.glucose)

#TukeyHSD
summary(aov.can.querc.glucose <- aov(lm.can.querc.glucose))
tukey.can.querc.glucose <- TukeyHSD(aov.can.querc.glucose, "Canopy15", ordered = FALSE)
plot(tukey.can.querc.glucose)
canopy.levels.querc.glucose <- tukey.can.querc.glucose[["Canopy15"]][,4]
canopy.labels.querc.glucose <- multcompLetters(canopy.levels.querc.glucose)['Letters']
canopy.plot.labels.querc.glucose <- names(canopy.labels.querc.glucose[['Letters']])

#Canopy quercus
canopy.nsc.quercus.glucose <- ggplot(nsc.adult.quercus[!is.na(nsc.adult.quercus$Canopy15),], aes(x = as.factor(Canopy15), y = glucose.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 41)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:3, y = c(26.5, 39, 37), label = c("a","a","a")) +
  ggtitle("Quercus")

#lm for Canopy:NSC Fructose
lm.can.querc.fructose <- lm(fructose.mg.g ~ Canopy15, data = nsc.adult.quercus)
anova(lm.can.querc.fructose)
summary(lm.can.querc.fructose)

#TukeyHSD
summary(aov.can.querc.fructose <- aov(lm.can.querc.fructose))
tukey.can.querc.fructose <- TukeyHSD(aov.can.querc.fructose, "Canopy15", ordered = FALSE)
plot(tukey.can.querc.fructose)
canopy.levels.querc.fructose <- tukey.can.querc.fructose[["Canopy15"]][,4]
canopy.labels.querc.fructose <- multcompLetters(canopy.levels.querc.fructose)['Letters']
canopy.plot.labels.querc.fructose <- names(canopy.labels.querc.fructose[['Letters']])

#Canopy quercus
canopy.nsc.quercus.fructose <- ggplot(nsc.adult.quercus[!is.na(nsc.adult.quercus$Canopy15),], aes(x = as.factor(Canopy15), y = fructose.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 36)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:3, y = c(23, 34, 28), label = c("a","a","a")) +
  ggtitle("Quercus")

#lm for Canopy:NSC Sucrose
lm.can.querc.sucrose <- lm(sucrose.mg.g ~ Canopy15, data = nsc.adult.quercus)
anova(lm.can.querc.sucrose)
summary(lm.can.querc.sucrose)

#TukeyHSD
summary(aov.can.querc.sucrose <- aov(lm.can.querc.sucrose))
tukey.can.querc.sucrose <- TukeyHSD(aov.can.querc.sucrose, "Canopy15", ordered = FALSE)
plot(tukey.can.querc.sucrose)
canopy.levels.querc.sucrose <- tukey.can.querc.sucrose[["Canopy15"]][,4]
canopy.labels.querc.sucrose <- multcompLetters(canopy.levels.querc.sucrose)['Letters']
canopy.plot.labels.querc.sucrose <- names(canopy.labels.querc.sucrose[['Letters']])

#Canopy quercus
canopy.nsc.quercus.sucrose <- ggplot(nsc.adult.quercus[!is.na(nsc.adult.quercus$Canopy15),], aes(x = as.factor(Canopy15), y = sucrose.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 58)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:3, y = c(47, 54, 55), label = c("a","a","b")) +
  ggtitle("Quercus")

#FAGR dataframe
fagus.sort <- which(nsc.adult.total.mass.alive.common$genus == "Fagus")
nsc.adult.fagus <- nsc.adult.total.mass.alive.common[fagus.sort,]

#DBH fagus
dbh.nsc.fagus <- ggplot(nsc.adult.fagus, aes(x = DBH14, y = total.nsc)) +
  geom_point(alpha = .3) +
  #geom_smooth() +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  ggtitle("Fagus grandifolia")

lm.dbh.fagus <- lm(total.nsc ~ DBH14, data = nsc.adult.fagus)
anova(lm.dbh.fagus)
summary(lm.dbh.fagus)

#DBH fagus Starch
dbh.nsc.fagus.starch <- ggplot(nsc.adult.fagus, aes(x = DBH14, y = starch.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth() +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  ggtitle("Fagus grandifolia")

lm.dbh.fagus.starch <- lm(starch.mg.g ~ DBH14, data = nsc.adult.fagus)
anova(lm.dbh.fagus.starch)
summary(lm.dbh.fagus.starch)

#DBH fagus Sugar
dbh.nsc.fagus.sugar <- ggplot(nsc.adult.fagus, aes(x = DBH14, y = sugar.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth() +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  ggtitle("Fagus grandifolia")

lm.dbh.fagus.sugar <- lm(sugar.mg.g ~ DBH14, data = nsc.adult.fagus)
anova(lm.dbh.fagus.sugar)
summary(lm.dbh.fagus.sugar)

#DBH fagus Glucose
dbh.nsc.fagus.glucose <- ggplot(nsc.adult.fagus, aes(x = DBH14, y = glucose.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth() +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  ggtitle("Fagus grandifolia")

lm.dbh.fagus.glucose <- lm(glucose.mg.g ~ DBH14, data = nsc.adult.fagus)
anova(lm.dbh.fagus.glucose)
summary(lm.dbh.fagus.glucose)

#DBH fagus Fructose
dbh.nsc.fagus.fructose <- ggplot(nsc.adult.fagus, aes(x = DBH14, y = fructose.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth() +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  ggtitle("Fagus grandifolia")

lm.dbh.fagus.fructose <- lm(fructose.mg.g ~ DBH14, data = nsc.adult.fagus)
anova(lm.dbh.fagus.fructose)
summary(lm.dbh.fagus.fructose)

#DBH fagus Sucrose
dbh.nsc.fagus.sucrose <- ggplot(nsc.adult.fagus, aes(x = DBH14, y = sucrose.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth() +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  ggtitle("Fagus grandifolia")

lm.dbh.fagus.sucrose <- lm(sucrose.mg.g ~ DBH14, data = nsc.adult.fagus)
anova(lm.dbh.fagus.sucrose)
summary(lm.dbh.fagus.sucrose)

#lm for Canopy:NSC
lm.can.fagus <- lm(total.nsc ~ Canopy15, data = nsc.adult.fagus)
anova(lm.can.fagus)
summary(lm.can.fagus)

summary(aov.can.fagus <- aov(lm.can.fagus))
tukey.can.fagus <- TukeyHSD(aov.can.fagus, "Canopy15", ordered = FALSE)
plot(tukey.can.fagus)
canopy.levels.fagus <- tukey.can.fagus[["Canopy15"]][,4]
canopy.labels.fagus <- multcompLetters(canopy.levels.fagus)['Letters']
canopy.plot.labels.fagus <- names(canopy.labels.fagus[['Letters']])

#Canopy Fagus
canopy.nsc.fagus <- ggplot(nsc.adult.fagus[!is.na(nsc.adult.fagus$Canopy15),], aes(x = as.factor(Canopy15), y = total.nsc)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 131)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Canopy Status") +
    annotate("text", x = 1:3, y = c(120, 124, 91), label = c("a","a","a")) +
  ggtitle("Fagus grandifolia")

#lm for Canopy:NSC Starch
lm.can.fagus.starch <- lm(starch.mg.g ~ Canopy15, data = nsc.adult.fagus)
anova(lm.can.fagus.starch)
summary(lm.can.fagus.starch)

summary(lm.can.fagus.starch <- aov(lm.can.fagus.starch))
tukey.can.fagus.starch <- TukeyHSD(lm.can.fagus.starch, "Canopy15", ordered = FALSE)
plot(tukey.can.fagus.starch)
canopy.levels.fagus.starch <- tukey.can.fagus.starch[["Canopy15"]][,4]
canopy.labels.fagus.starch <- multcompLetters(canopy.levels.fagus.starch)['Letters']
canopy.plot.labels.fagus.starch <- names(canopy.labels.fagus.starch[['Letters']])

#Canopy Fagus
canopy.nsc.fagus.starch <- ggplot(nsc.adult.fagus[!is.na(nsc.adult.fagus$Canopy15),], aes(x = as.factor(Canopy15), y = starch.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 82)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Canopy Status") +
    annotate("text", x = 1:3, y = c(78, 77, 51), label = c("b","a","ab")) +
  ggtitle("Fagus grandifolia")

#lm for Canopy:NSC Sugar
lm.can.fagus.sugar <- lm(sugar.mg.g ~ Canopy15, data = nsc.adult.fagus)
anova(lm.can.fagus.sugar)
summary(lm.can.fagus.sugar)

summary(lm.can.fagus.sugar <- aov(lm.can.fagus.sugar))
tukey.can.fagus.sugar <- TukeyHSD(lm.can.fagus.sugar, "Canopy15", ordered = FALSE)
plot(tukey.can.fagus.sugar)
canopy.levels.fagus.sugar <- tukey.can.fagus.sugar[["Canopy15"]][,4]
canopy.labels.fagus.sugar <- multcompLetters(canopy.levels.fagus.sugar)['Letters']
canopy.plot.labels.fagus.sugar <- names(canopy.labels.fagus.sugar[['Letters']])

#Canopy Fagus
canopy.nsc.fagus.sugar <- ggplot(nsc.adult.fagus[!is.na(nsc.adult.fagus$Canopy15),], aes(x = as.factor(Canopy15), y = sugar.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 48)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Canopy Status") +
    annotate("text", x = 1:3, y = c(40, 46, 45), label = c("a","a","a")) +
  ggtitle("Fagus grandifolia")

#lm for Canopy:NSC glucose
lm.can.fagus.glucose <- lm(glucose.mg.g ~ Canopy15, data = nsc.adult.fagus)
anova(lm.can.fagus.glucose)
summary(lm.can.fagus.glucose)

summary(lm.can.fagus.glucose <- aov(lm.can.fagus.glucose))
tukey.can.fagus.glucose <- TukeyHSD(lm.can.fagus.glucose, "Canopy15", ordered = FALSE)
plot(tukey.can.fagus.glucose)
canopy.levels.fagus.glucose <- tukey.can.fagus.glucose[["Canopy15"]][,4]
canopy.labels.fagus.glucose <- multcompLetters(canopy.levels.fagus.glucose)['Letters']
canopy.plot.labels.fagus.glucose <- names(canopy.labels.fagus.glucose[['Letters']])

#Canopy Fagus
canopy.nsc.fagus.glucose <- ggplot(nsc.adult.fagus[!is.na(nsc.adult.fagus$Canopy15),], aes(x = as.factor(Canopy15), y = glucose.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 16.8)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Canopy Status") +
    annotate("text", x = 1:3, y = c(12.5, 16.1, 10.4), label = c("a","a","a")) +
  ggtitle("Fagus grandifolia")

#lm for Canopy:NSC fructose
lm.can.fagus.fructose <- lm(fructose.mg.g ~ Canopy15, data = nsc.adult.fagus)
anova(lm.can.fagus.fructose)
summary(lm.can.fagus.fructose)

summary(lm.can.fagus.fructose <- aov(lm.can.fagus.fructose))
tukey.can.fagus.fructose <- TukeyHSD(lm.can.fagus.fructose, "Canopy15", ordered = FALSE)
plot(tukey.can.fagus.fructose)
canopy.levels.fagus.fructose <- tukey.can.fagus.fructose[["Canopy15"]][,4]
canopy.labels.fagus.fructose <- multcompLetters(canopy.levels.fagus.fructose)['Letters']
canopy.plot.labels.fagus.fructose <- names(canopy.labels.fagus.fructose[['Letters']])

#Canopy Fagus
canopy.nsc.fagus.fructose <- ggplot(nsc.adult.fagus[!is.na(nsc.adult.fagus$Canopy15),], aes(x = as.factor(Canopy15), y = fructose.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 13)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Canopy Status") +
    annotate("text", x = 1:3, y = c(11.5, 12.4, 10), label = c("a","a","a")) +
  ggtitle("Fagus grandifolia")

#lm for Canopy:NSC sucrose
lm.can.fagus.sucrose <- lm(sucrose.mg.g ~ Canopy15, data = nsc.adult.fagus)
anova(lm.can.fagus.sucrose)
summary(lm.can.fagus.sucrose)

summary(lm.can.fagus.sucrose <- aov(lm.can.fagus.sucrose))
tukey.can.fagus.sucrose <- TukeyHSD(lm.can.fagus.sucrose, "Canopy15", ordered = FALSE)
plot(tukey.can.fagus.sucrose)
canopy.levels.fagus.sucrose <- tukey.can.fagus.sucrose[["Canopy15"]][,4]
canopy.labels.fagus.sucrose <- multcompLetters(canopy.levels.fagus.sucrose)['Letters']
canopy.plot.labels.fagus.sucrose <- names(canopy.labels.fagus.sucrose[['Letters']])

#Canopy Fagus
canopy.nsc.fagus.sucrose <- ggplot(nsc.adult.fagus[!is.na(nsc.adult.fagus$Canopy15),], aes(x = as.factor(Canopy15), y = sucrose.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 33)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Canopy Status") +
    annotate("text", x = 1:3, y = c(25, 30, 31), label = c("a","a","a")) +
  ggtitle("Fagus grandifolia")

#TSCA dataframe
tsuga.sort <- which(nsc.adult.total.mass.alive.common$genus == "Tsuga")
nsc.adult.tsuga <- nsc.adult.total.mass.alive.common[tsuga.sort,]

#TSCA DBH total NSC
dbh.nsc.tsuga <- ggplot(nsc.adult.tsuga, aes(x = DBH14, y = total.nsc)) +
  geom_point(alpha = .3) +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  ggtitle("Tsuga canadensis")

lm.dbh.tsuga <- lm(total.nsc ~ DBH14, data = nsc.adult.tsuga)
anova(lm.dbh.tsuga)
summary(lm.dbh.tsuga)

#TSCA DBH starch
dbh.nsc.tsuga.starch <- ggplot(nsc.adult.tsuga, aes(x = DBH14, y = starch.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  ggtitle("Tsuga canadensis")

lm.dbh.tsuga.starch <- lm(starch.mg.g ~ DBH14, data = nsc.adult.tsuga)
anova(lm.dbh.tsuga.starch)
summary(lm.dbh.tsuga.starch)

#TSCA DBH sugar
dbh.nsc.tsuga.sugar <- ggplot(nsc.adult.tsuga, aes(x = DBH14, y = sugar.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  ggtitle("Tsuga canadensis")

lm.dbh.tsuga.sugar <- lm(sugar.mg.g ~ DBH14, data = nsc.adult.tsuga)
anova(lm.dbh.tsuga.sugar)
summary(lm.dbh.tsuga.sugar)

#TSCA DBH glucose
dbh.nsc.tsuga.glucose <- ggplot(nsc.adult.tsuga, aes(x = DBH14, y = glucose.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  ggtitle("Tsuga canadensis")

lm.dbh.tsuga.glucose <- lm(glucose.mg.g ~ DBH14, data = nsc.adult.tsuga)
anova(lm.dbh.tsuga.glucose)
summary(lm.dbh.tsuga.glucose)

#TSCA DBH fructose
dbh.nsc.tsuga.fructose <- ggplot(nsc.adult.tsuga, aes(x = DBH14, y = fructose.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  ggtitle("Tsuga canadensis")

lm.dbh.tsuga.fructose <- lm(fructose.mg.g ~ DBH14, data = nsc.adult.tsuga)
anova(lm.dbh.tsuga.fructose)
summary(lm.dbh.tsuga.fructose)

#TSCA DBH sucrose
dbh.nsc.tsuga.sucrose <- ggplot(nsc.adult.tsuga, aes(x = DBH14, y = sucrose.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  ggtitle("Tsuga canadensis")

lm.dbh.tsuga.sucrose <- lm(sucrose.mg.g ~ DBH14, data = nsc.adult.tsuga)
anova(lm.dbh.tsuga.sucrose)
summary(lm.dbh.tsuga.sucrose)

#Canopy Tsuga
#lm for Canopy:NSC
lm.can.tsuga <- lm(total.nsc ~ Canopy15, data = nsc.adult.tsuga)
anova(lm.can.tsuga)
summary(lm.can.tsuga)

#only understory and co-dominant. so doing t-test for groups
t.test(total.nsc ~ Canopy15, data = nsc.adult.tsuga)

canopy.nsc.tsuga <- ggplot(nsc.adult.tsuga[!is.na(nsc.adult.tsuga$Canopy15),], aes(x = as.factor(Canopy15), y = total.nsc)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 65)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:2, y = c(59, 47), label = c("a","b")) +
  ggtitle("Tsuga canadensis")

#Canopy Tsuga starch
#lm for Canopy:NSC
lm.can.tsuga.starch <- lm(starch.mg.g ~ Canopy15, data = nsc.adult.tsuga)
anova(lm.can.tsuga.starch)
summary(lm.can.tsuga.starch)

#only understory and co-dominant. so doing t-test for groups
t.test(starch.mg.g ~ Canopy15, data = nsc.adult.tsuga)

canopy.nsc.tsuga.starch <- ggplot(nsc.adult.tsuga[!is.na(nsc.adult.tsuga$Canopy15),], aes(x = as.factor(Canopy15), y = starch.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 37)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Starch mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:2, y = c(34, 12.5), label = c("a","a")) +
  ggtitle("Tsuga canadensis")

#Canopy Tsuga sugar
#lm for Canopy:NSC
lm.can.tsuga.sugar <- lm(sugar.mg.g ~ Canopy15, data = nsc.adult.tsuga)
anova(lm.can.tsuga.sugar)
summary(lm.can.tsuga.sugar)

#only understory and co-dominant. so doing t-test for groups
t.test(sugar.mg.g ~ Canopy15, data = nsc.adult.tsuga)

canopy.nsc.tsuga.sugar <- ggplot(nsc.adult.tsuga[!is.na(nsc.adult.tsuga$Canopy15),], aes(x = as.factor(Canopy15), y = sugar.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 37)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Total Sugar mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:2, y = c(29, 35), label = c("a","b")) +
  ggtitle("Tsuga canadensis")

#Canopy Tsuga glucose
#lm for Canopy:NSC
lm.can.tsuga.glucose <- lm(glucose.mg.g ~ Canopy15, data = nsc.adult.tsuga)
anova(lm.can.tsuga.glucose)
summary(lm.can.tsuga.glucose)

#only understory and co-dominant. so doing t-test for groups
t.test(glucose.mg.g ~ Canopy15, data = nsc.adult.tsuga)

canopy.nsc.tsuga.glucose <- ggplot(nsc.adult.tsuga[!is.na(nsc.adult.tsuga$Canopy15),], aes(x = as.factor(Canopy15), y = glucose.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 16.5)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Glucose mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:2, y = c(13.5, 15.25), label = c("a","b")) +
  ggtitle("Tsuga canadensis")

#Canopy Tsuga fructose
#lm for Canopy:NSC
lm.can.tsuga.fructose <- lm(fructose.mg.g ~ Canopy15, data = nsc.adult.tsuga)
anova(lm.can.tsuga.fructose)
summary(lm.can.tsuga.fructose)

#only understory and co-dominant. so doing t-test for groups
t.test(fructose.mg.g ~ Canopy15, data = nsc.adult.tsuga)

canopy.nsc.tsuga.fructose <- ggplot(nsc.adult.tsuga[!is.na(nsc.adult.tsuga$Canopy15),], aes(x = as.factor(Canopy15), y = fructose.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 11.5)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Fructose mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:2, y = c(8.75, 11), label = c("a","b")) +
  ggtitle("Tsuga canadensis")

#Canopy Tsuga sucrose
#lm for Canopy:NSC
lm.can.tsuga.sucrose <- lm(sucrose.mg.g ~ Canopy15, data = nsc.adult.tsuga)
anova(lm.can.tsuga.sucrose)
summary(lm.can.tsuga.sucrose)

#only understory and co-dominant. so doing t-test for groups
t.test(sucrose.mg.g ~ Canopy15, data = nsc.adult.tsuga)

canopy.nsc.tsuga.sucrose <- ggplot(nsc.adult.tsuga[!is.na(nsc.adult.tsuga$Canopy15),], aes(x = as.factor(Canopy15), y = sucrose.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 16)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Sucrose mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:2, y = c(12, 14.9), label = c("a","b")) +
  ggtitle("Tsuga canadensis")

#DBH Acer total
acer.sort <- which(nsc.adult.total.mass.alive.common$genus == "Acer")
nsc.adult.acer <- nsc.adult.total.mass.alive.common[acer.sort,]

lm.dbh.acer <- lm(total.nsc ~ DBH14, data = nsc.adult.acer)
anova(lm.dbh.acer)
summary(lm.dbh.acer)

dbh.nsc.acer <- ggplot(nsc.adult.acer, aes(x = DBH14, y = total.nsc)) +
  geom_point(alpha = .3) +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  #xlab("DBH") + 
  #theme(axis.text.x = element_text(size = 14)) +
  ggtitle("Acer")

#DBH Acer starch
lm.dbh.acer.starch <- lm(starch.mg.g ~ DBH14, data = nsc.adult.acer)
anova(lm.dbh.acer.starch)
summary(lm.dbh.acer.starch)

dbh.nsc.acer.starch <- ggplot(nsc.adult.acer, aes(x = DBH14, y = starch.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  #xlab("DBH") + 
  #theme(axis.text.x = element_text(size = 14)) +
  ggtitle("Acer")

#DBH Acer sugar
lm.dbh.acer.sugar <- lm(sugar.mg.g ~ DBH14, data = nsc.adult.acer)
anova(lm.dbh.acer.sugar)
summary(lm.dbh.acer.sugar)

dbh.nsc.acer.sugar <- ggplot(nsc.adult.acer, aes(x = DBH14, y = sugar.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  #xlab("DBH") + 
  #theme(axis.text.x = element_text(size = 14)) +
  ggtitle("Acer")

#DBH Acer glucose
lm.dbh.acer.glucose <- lm(glucose.mg.g ~ DBH14, data = nsc.adult.acer)
anova(lm.dbh.acer.glucose)
summary(lm.dbh.acer.glucose)

dbh.nsc.acer.glucose <- ggplot(nsc.adult.acer, aes(x = DBH14, y = glucose.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  #xlab("DBH") + 
  #theme(axis.text.x = element_text(size = 14)) +
  ggtitle("Acer")

#DBH Acer fructose
lm.dbh.acer.fructose <- lm(fructose.mg.g ~ DBH14, data = nsc.adult.acer)
anova(lm.dbh.acer.fructose)
summary(lm.dbh.acer.fructose)

dbh.nsc.acer.fructose <- ggplot(nsc.adult.acer, aes(x = DBH14, y = fructose.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  #xlab("DBH") + 
  #theme(axis.text.x = element_text(size = 14)) +
  ggtitle("Acer")

#DBH Acer sucrose
lm.dbh.acer.sucrose <- lm(sucrose.mg.g ~ DBH14, data = nsc.adult.acer)
anova(lm.dbh.acer.sucrose)
summary(lm.dbh.acer.sucrose)

dbh.nsc.acer.sucrose <- ggplot(nsc.adult.acer, aes(x = DBH14, y = sucrose.mg.g)) +
  geom_point(alpha = .3) +
  #geom_smooth(method = "gam", formula = y ~ s(x), size = 1) + # GAM model with smooth
  geom_smooth(method = "lm", col = "yellow") +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  #xlab("DBH") + 
  #theme(axis.text.x = element_text(size = 14)) +
  ggtitle("Acer")

#Acer canopy
lm.can.acer <- lm(total.nsc ~ Canopy15, data = nsc.adult.acer)
anova(lm.can.acer)
summary(lm.can.acer)

summary(aov.can.acer <- aov(lm.can.acer))
tukey.can.acer <- TukeyHSD(aov.can.acer, "Canopy15", ordered = FALSE)
plot(tukey.can.acer)
canopy.levels.acer <- tukey.can.acer[["Canopy15"]][,4]
canopy.labels.acer <- multcompLetters(canopy.levels.acer)['Letters']
canopy.plot.labels.acer <- names(canopy.labels.acer[['Letters']])

#Acer canopy 
canopy.nsc.acer <- ggplot(nsc.adult.acer[!is.na(nsc.adult.acer$Canopy15),], aes(x = as.factor(Canopy15), y = total.nsc)) +
  geom_violin() + theme(axis.text.x =   element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 140)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:3, y = c(106, 129, 90), label = c("a","a","a")) +
  ggtitle("Acer")

#Acer canopy starch
lm.can.acer.starch <- lm(starch.mg.g ~ Canopy15, data = nsc.adult.acer)
anova(lm.can.acer.starch)
summary(lm.can.acer.starch)

summary(aov.can.acer.starch <- aov(lm.can.acer.starch))
tukey.can.acer.starch <- TukeyHSD(aov.can.acer.starch, "Canopy15", ordered = FALSE)
plot(tukey.can.acer.starch)
canopy.levels.acer.starch <- tukey.can.acer.starch[["Canopy15"]][,4]
canopy.labels.acer.starch <- multcompLetters(canopy.levels.acer.starch)['Letters']
canopy.plot.labels.acer.starch <- names(canopy.labels.acer.starch[['Letters']])

#Acer canopy 
canopy.nsc.acer.starch <- ggplot(nsc.adult.acer[!is.na(nsc.adult.acer$Canopy15),], aes(x = as.factor(Canopy15), y = starch.mg.g)) +
  geom_violin() + theme(axis.text.x =   element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 94)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Starch mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:3, y = c(73, 86, 52), label = c("a","a","a")) +
  ggtitle("Acer")

#Acer canopy sugar
lm.can.acer.sugar <- lm(sugar.mg.g ~ Canopy15, data = nsc.adult.acer)
anova(lm.can.acer.sugar)
summary(lm.can.acer.sugar)

summary(aov.can.acer.sugar <- aov(lm.can.acer.sugar))
tukey.can.acer.sugar <- TukeyHSD(aov.can.acer.sugar, "Canopy15", ordered = FALSE)
plot(tukey.can.acer.sugar)
canopy.levels.acer.sugar <- tukey.can.acer.sugar[["Canopy15"]][,4]
canopy.labels.acer.sugar <- multcompLetters(canopy.levels.acer.sugar)['Letters']
canopy.plot.labels.acer.sugar <- names(canopy.labels.acer.sugar[['Letters']])

#Acer canopy 
canopy.nsc.acer.sugar <- ggplot(nsc.adult.acer[!is.na(nsc.adult.acer$Canopy15),], aes(x = as.factor(Canopy15), y = sugar.mg.g)) +
  geom_violin() + theme(axis.text.x =   element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 74)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Total Sugar mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:3, y = c(54, 70, 39), label = c("a","a","a")) +
  ggtitle("Acer")

#Acer canopy glucose
lm.can.acer.glucose <- lm(glucose.mg.g ~ Canopy15, data = nsc.adult.acer)
anova(lm.can.acer.glucose)
summary(lm.can.acer.glucose)

summary(aov.can.acer.glucose <- aov(lm.can.acer.glucose))
tukey.can.acer.glucose <- TukeyHSD(aov.can.acer.glucose, "Canopy15", ordered = FALSE)
plot(tukey.can.acer.glucose)
canopy.levels.acer.glucose <- tukey.can.acer.glucose[["Canopy15"]][,4]
canopy.labels.acer.glucose <- multcompLetters(canopy.levels.acer.glucose)['Letters']
canopy.plot.labels.acer.glucose <- names(canopy.labels.acer.glucose[['Letters']])

#Acer canopy 
canopy.nsc.acer.glucose <- ggplot(nsc.adult.acer[!is.na(nsc.adult.acer$Canopy15),], aes(x = as.factor(Canopy15), y = glucose.mg.g)) +
  geom_violin() + theme(axis.text.x =   element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 21)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Glucose mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:3, y = c(19.75, 18.35, 10.35), label = c("a","a","a")) +
  ggtitle("Acer")

#Acer canopy fructose
lm.can.acer.fructose <- lm(fructose.mg.g ~ Canopy15, data = nsc.adult.acer)
anova(lm.can.acer.fructose)
summary(lm.can.acer.fructose)

summary(aov.can.acer.fructose <- aov(lm.can.acer.fructose))
tukey.can.acer.fructose <- TukeyHSD(aov.can.acer.fructose, "Canopy15", ordered = FALSE)
plot(tukey.can.acer.fructose)
canopy.levels.acer.fructose <- tukey.can.acer.fructose[["Canopy15"]][,4]
canopy.labels.acer.fructose <- multcompLetters(canopy.levels.acer.fructose)['Letters']
canopy.plot.labels.acer.fructose <- names(canopy.labels.acer.fructose[['Letters']])

#Acer canopy 
canopy.nsc.acer.fructose <- ggplot(nsc.adult.acer[!is.na(nsc.adult.acer$Canopy15),], aes(x = as.factor(Canopy15), y = fructose.mg.g)) +
  geom_violin() + theme(axis.text.x =   element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 22)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Fructose mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:3, y = c(20.25, 15, 11.25), label = c("a","a","a")) +
  ggtitle("Acer")

#Acer canopy sucrose
lm.can.acer.sucrose <- lm(sucrose.mg.g ~ Canopy15, data = nsc.adult.acer)
anova(lm.can.acer.sucrose)
summary(lm.can.acer.sucrose)

summary(aov.can.acer.sucrose <- aov(lm.can.acer.sucrose))
tukey.can.acer.sucrose <- TukeyHSD(aov.can.acer.sucrose, "Canopy15", ordered = FALSE)
plot(tukey.can.acer.sucrose)
canopy.levels.acer.sucrose <- tukey.can.acer.sucrose[["Canopy15"]][,4]
canopy.labels.acer.sucrose <- multcompLetters(canopy.levels.acer.sucrose)['Letters']
canopy.plot.labels.acer.sucrose <- names(canopy.labels.acer.sucrose[['Letters']])

#Acer canopy 
canopy.nsc.acer.sucrose <- ggplot(nsc.adult.acer[!is.na(nsc.adult.acer$Canopy15),], aes(x = as.factor(Canopy15), y = sucrose.mg.g)) +
  geom_violin() + theme(axis.text.x =   element_text(angle=0,hjust=.5,vjust = .5, size=8)) +
  theme(axis.title.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 49)) + 
  scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
  ylab(expression(paste("Sucrose mg g"^"-1"))) + xlab("Canopy Status") +
  annotate("text", x = 1:3, y = c(31, 46, 29), label = c("ab","a","b")) +
  ggtitle("Acer")

# #ACRU dataframe
# acru.sort <- which(nsc.adult.total.mass.alive.common$GenusSpecies == "Acer rubrum")
# nsc.adult.acru <- nsc.adult.total.mass.alive.common[acru.sort,]
# 
# #DBH ACRU
# dbh.nsc.acru <- ggplot(nsc.adult.acru, aes(x = DBH14, y = total.nsc)) +
#   geom_point(alpha = .3) +
#   geom_smooth() + # GAM model
#   xlab("DBH") + ylab(expression(paste("Total NSC (mg g"^"-1",")"))) +
#   theme(axis.text.x = element_text(size = 14))
# 
# canopy.nsc.acru <- ggplot(nsc.adult.acru[!is.na(nsc.adult.acru$Canopy15),], aes(x = as.factor(Canopy15), y = total.nsc)) +
#   geom_boxplot() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=16)) +
#   theme(axis.text.y = element_text(size=12)) +
#   theme(axis.title.x = element_text(size=14)) +
#   theme(axis.title.y = element_text(size=14)) +
#   theme(axis.text.x = element_text(size=12)) +
#   stat_summary(fun.y="median", geom="point") +
#   stat_summary(fun.data = give.n, geom= "text", aes(y= 180)) + 
#   scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
#   ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Canopy Status") # + ggtitle("All Canopy Statuses") +
#   #scale_fill_manual(values=rev(cbPalette))
# 
# #ACSA3 dataframe
# acsa.sort <- which(nsc.adult.total.mass.alive.common$GenusSpecies == "Acer saccharum")
# nsc.adult.acsa <- nsc.adult.total.mass.alive.common[acsa.sort,]
# 
# #DBH ACSA3
# dbh.nsc.acsa <- ggplot(nsc.adult.acsa, aes(x = DBH14, y = total.nsc)) +
#   geom_point(alpha = .3) +
#   geom_smooth() + # GAM model
#   xlab("DBH") + ylab(expression(paste("Total NSC (mg g"^"-1",")"))) +
#   theme(axis.text.x = element_text(size = 14))
# 
# canopy.nsc.acsa <- ggplot(nsc.adult.acsa[!is.na(nsc.adult.acsa$Canopy15),], aes(x = as.factor(Canopy15), y = total.nsc)) +
#   geom_boxplot() + theme(axis.text.x = element_text(angle=0,hjust=.5,vjust = .5, size=16)) +
#   theme(axis.text.y = element_text(size=12)) +
#   theme(axis.title.x = element_text(size=14)) +
#   theme(axis.title.y = element_text(size=14)) +
#   theme(axis.text.x = element_text(size=12)) +
#   stat_summary(fun.y="median", geom="point") +
#   stat_summary(fun.data = give.n, geom= "text", aes(y= 180)) + 
#   scale_x_discrete(labels = c("Understory", "Co-dominant", "Dominant")) +
#   ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Canopy Status") # + ggtitle("All Canopy Statuses") +
#   #scale_fill_manual(values=rev(cbPalette))



#Combining all DBH plots into one figure#
nsc.dbh.common <- grid.arrange(dbh.nsc, dbh.nsc.quercus, dbh.nsc.fagus, dbh.nsc.tsuga, dbh.nsc.acer, ncol = 2, bottom = "DBH", left = textGrob(label = expression(paste("Total NSC mg g"^"-1")), rot = 90))

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/nsc.dbh.commonspp.png", plot = nsc.dbh.common, dpi = 600, width = 4.5, height = 6, units = "in")

#Combining all Canopy plots into one figure
nsc.can.common <- grid.arrange(canopy.nsc, canopy.nsc.quercus, canopy.nsc.fagus, canopy.nsc.tsuga, canopy.nsc.acer, ncol = 2, bottom = "Canopy Status", left = textGrob(label = expression(paste("Total NSC mg g"^"-1")), rot = 90))

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/nsc.can.commonspp.png", plot = nsc.can.common, dpi = 600, width = 5.5, height = 6.5, units = "in")

#Mortality
### some "A " and "A" rows - need to fix
lm.mortality <- lm(total.nsc ~ Mortality14, data = nsc.adult.total.mass)
anova(lm.mortality)
summary(lm.mortality)

ggplot(nsc.adult.total.mass, aes(x = Mortality14, y = total.nsc, fill = Mortality14)) +
  geom_boxplot() + theme(axis.text.x = element_text(angle=45,hjust=1,size=16)) +
  theme(axis.text.y = element_text(size=16)) +
  theme(axis.title.x = element_text(size=20)) +
  theme(axis.title.y = element_text(size=20)) +
  theme(legend.text = element_text(size=16)) +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 160)) + 
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Mortality Status") + ggtitle("All Mortality Statuses") +
#   geom_segment(aes(x=0,y=med.early.conif,xend=7.5,
#                    yend=med.early.conif),linetype="longdash",color="indianred4") +
#   geom_segment(aes(x=7.5,y=med.late.conif,xend=12,
#                    yend=med.late.conif),linetype="longdash",color="darkgreen") +
  scale_fill_manual(values=rev(cbPalette))

```

Region, Landscape, Microsite ANOVA exploratory analysis

```{r}

nsc.adult.total.mass.alive.common$Site <- factor(nsc.adult.total.mass.alive.common$Site, levels = c("W","B","H","V","C","S","M","T","D","F"))

#, control=lmerControl(check.nobs.vs.nlev="ignore")
hierarchy.test <- lmer(total.nsc ~ DBH14 + (1|Site/Plot/Sub) + (1|Spp), data = nsc.adult.total.mass.alive.common)
 summary(hierarchy.test)
 plot((hierarchy.test))
 
#Temperature ANOVA total NSC
lm.temp.total <- lm(total.nsc ~ TEMP_C, data = nsc.adult.total.mass.alive.common)
anova(lm.temp.total)
summary(lm.temp.total) #R^2 = 0.08642

nsc.temp.plot <- ggplot(nsc.adult.total.mass.alive.common, aes(x = TEMP_C, y = total.nsc)) +
  geom_point(alpha = .1) +
  coord_cartesian(ylim = c(0,150)) +
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Temperature (C)") +
  geom_smooth(method = "lm") + #facet_wrap(~ PFT)
  theme(axis.title.y = element_text(size = 14)) +
  theme(axis.title.x = element_text(size = 14)) 

#Temperature ANOVA starch
lm.temp.starch <- lm(starch.mg.g ~ TEMP_C, data = nsc.adult.total.mass.alive.common)
anova(lm.temp.starch)
summary(lm.temp.starch) #R^2 = 0.02923

nsc.temp.plot.starch <- ggplot(nsc.adult.total.mass.alive.common, aes(x = TEMP_C, y = starch.mg.g)) +
  geom_point(alpha = .1) +
  coord_cartesian(ylim = c(0,150)) +
  ylab(expression(paste("Starch mg g"^"-1"))) + xlab("Temperature (C)") +
  geom_smooth(method = "lm") + #facet_wrap(~ PFT)
  theme(axis.title.y = element_text(size = 14)) +
  theme(axis.title.x = element_text(size = 14)) 

#Temperature ANOVA sugar
lm.temp.sugar <- lm(sugar.mg.g ~ TEMP_C, data = nsc.adult.total.mass.alive.common)
anova(lm.temp.sugar)
summary(lm.temp.sugar) #R^2 = 0.1654

nsc.temp.plot.sugar <- ggplot(nsc.adult.total.mass.alive.common, aes(x = TEMP_C, y = sugar.mg.g)) +
  geom_point(alpha = .1) +
  coord_cartesian(ylim = c(0,150)) +
  ylab(expression(paste("Total Sugar mg g"^"-1"))) + xlab("Temperature (C)") +
  geom_smooth(method = "lm") + #facet_wrap(~ PFT)
  theme(axis.title.y = element_text(size = 14)) +
  theme(axis.title.x = element_text(size = 14)) 

#Temperature ANOVA glucose
lm.temp.glucose <- lm(glucose.mg.g ~ TEMP_C, data = nsc.adult.total.mass.alive.common)
anova(lm.temp.glucose)
summary(lm.temp.glucose) #R^2 = 0.09796

nsc.temp.plot.glucose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = TEMP_C, y = glucose.mg.g)) +
  geom_point(alpha = .1) +
  coord_cartesian(ylim = c(0,150)) +
  ylab(expression(paste("Glucose mg g"^"-1"))) + xlab("Temperature (C)") +
  geom_smooth(method = "lm") + #facet_wrap(~ PFT)
  theme(axis.title.y = element_text(size = 14)) +
  theme(axis.title.x = element_text(size = 14)) 

#Temperature ANOVA fructose
lm.temp.fructose <- lm(fructose.mg.g ~ TEMP_C, data = nsc.adult.total.mass.alive.common)
anova(lm.temp.fructose)
summary(lm.temp.fructose) #R^2 = 0.1375

nsc.temp.plot.fructose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = TEMP_C, y = fructose.mg.g)) +
  geom_point(alpha = .1) +
  coord_cartesian(ylim = c(0,150)) +
  ylab(expression(paste("Fructose mg g"^"-1"))) + xlab("Temperature (C)") +
  geom_smooth(method = "lm") + #facet_wrap(~ PFT)
  theme(axis.title.y = element_text(size = 14)) +
  theme(axis.title.x = element_text(size = 14)) 

#Temperature ANOVA sucrose
lm.temp.sucrose <- lm(sucrose.mg.g ~ TEMP_C, data = nsc.adult.total.mass.alive.common)
anova(lm.temp.sucrose)
summary(lm.temp.sucrose) #R^2 = 0.03722

nsc.temp.plot.sucrose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = TEMP_C, y = sucrose.mg.g)) +
  geom_point(alpha = .1) +
  coord_cartesian(ylim = c(0,150)) +
  ylab(expression(paste("Sucrose mg g"^"-1"))) + xlab("Temperature (C)") +
  geom_smooth(method = "lm") + #facet_wrap(~ PFT)
  theme(axis.title.y = element_text(size = 14)) +
  theme(axis.title.x = element_text(size = 14)) 

#Precipitation ANOVA
lm.precip.total <- lm(total.nsc ~ PRECIP, data = nsc.adult.total.mass.alive.common)
anova(lm.precip.total)
summary(lm.precip.total) #R^2 = 0.001123

lm.precip.starch <- lm(starch.mg.g ~ PRECIP, data = nsc.adult.total.mass.alive.common)
anova(lm.precip.starch)
summary(lm.precip.starch) #R^2 = 0.0006729

lm.precip.sugar <- lm(sugar.mg.g ~ PRECIP, data = nsc.adult.total.mass.alive.common)
anova(lm.precip.sugar)
summary(lm.precip.sugar) #R^2 = 0.001239

lm.precip.glucose <- lm(glucose.mg.g ~ PRECIP, data = nsc.adult.total.mass.alive.common)
anova(lm.precip.glucose)
summary(lm.precip.glucose) #R^2 = 0.01006

lm.precip.fructose <- lm(fructose.mg.g ~ PRECIP, data = nsc.adult.total.mass.alive.common)
anova(lm.precip.fructose)
summary(lm.precip.fructose) #R^2 = 0.0003878

lm.precip.sucrose <- lm(sucrose.mg.g ~ PRECIP, data = nsc.adult.total.mass.alive.common)
anova(lm.precip.sucrose)
summary(lm.precip.sucrose) #R^2 = 0.01125


#Site ANOVA
lm.site.total <- lm(total.nsc ~ Site, data = nsc.adult.total.mass.alive.common)
anova(lm.site.total)
summary(lm.site.total) #R^2 = 0.1997

#TukeyHSD site
#TukeyHSD PFT # p = .05
summary(aov.site <- aov(lm.site.total))
tukey.site <- TukeyHSD(aov.site, "Site", ordered = FALSE)
plot(tukey.site)
site.levels <- tukey.site[["Site"]][,4]
site.labels <- multcompLetters(site.levels)['Letters']
site.plot.labels <- names(site.labels[['Letters']])

site.nsc <- ggplot(nsc.adult.total.mass.alive.common, aes(x = Site, y = total.nsc)) +
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=12)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(legend.text = element_text(size=12)) +
  stat_summary(fun.y="mean", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 190), size = 3) + 
  ylab(expression(paste("Total NSC mg g"^"-1"))) + xlab("Site") +
  scale_fill_manual(values=rev(cbPalette)) +
  annotate("text", x = 1:10, y = c(87, 120, 142, 178, 148, 158, 154, 134, 123, 150), 
           label = c("b","ac","ab","f","cd","d","e","d","acd","d"), size = 3.5)

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/TotalNSC.AllCommonSite.png", plot = site.nsc, dpi = 600, width = 7.5, height = 3.5, units = "in")


#Site ANOVA starch
lm.site.starch <- lm(starch.mg.g ~ Site, data = nsc.adult.total.mass.alive.common)
anova(lm.site.starch)
summary(lm.site.starch) #R^2 = 0.1484

#TukeyHSD site
#TukeyHSD PFT # p = .05
summary(aov.site.starch <- aov(lm.site.starch))
tukey.site.starch <- TukeyHSD(aov.site.starch, "Site", ordered = FALSE)
plot(tukey.site.starch)
site.levels.starch <- tukey.site.starch[["Site"]][,4]
site.labels.starch <- multcompLetters(site.levels.starch)['Letters']
site.plot.labels.starch <- names(site.labels.starch[['Letters']])

site.nsc.starch <- ggplot(nsc.adult.total.mass.alive.common, aes(x = Site, y = starch.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=12)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(legend.text = element_text(size=12)) +
  stat_summary(fun.y="mean", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 117), size = 3) + 
  ylab(expression(paste("Starch mg g"^"-1"))) + xlab("Site") +
  scale_fill_manual(values=rev(cbPalette)) +
  annotate("text", x = 1:10, y = c(56, 84, 90, 110, 75, 98, 101, 72, 67, 105), 
           label = c("a","b","b","d","bc","b","c","b","ab","b"), size = 3.5)

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/Starch.AllCommonSite.png", plot = site.nsc.starch, dpi = 600, width = 7.5, height = 3.5, units = "in")

#Site ANOVA sugar
lm.site.sugar <- lm(sugar.mg.g ~ Site, data = nsc.adult.total.mass.alive.common)
anova(lm.site.sugar)
summary(lm.site.sugar) #R^2 = 0.2257

#TukeyHSD site
#TukeyHSD PFT # p = .05
summary(aov.site.sugar <- aov(lm.site.sugar))
tukey.site.sugar <- TukeyHSD(aov.site.sugar, "Site", ordered = FALSE)
plot(tukey.site.sugar)
site.levels.sugar <- tukey.site.sugar[["Site"]][,4]
site.labels.sugar <- multcompLetters(site.levels.sugar)['Letters']
site.plot.labels.sugar <- names(site.labels.sugar[['Letters']])

site.nsc.sugar <- ggplot(nsc.adult.total.mass.alive.common, aes(x = Site, y = sugar.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=12)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(legend.text = element_text(size=12)) +
  stat_summary(fun.y="mean", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 85), size = 3) + 
  ylab(expression(paste("Total Sugar mg g"^"-1"))) + xlab("Site") +
  scale_fill_manual(values=rev(cbPalette)) +
  annotate("text", x = 1:10, y = c(64, 61, 63, 72, 74, 70, 77, 78, 63, 79), 
           label = c("a","a","a","c","b","bc","c","bc","bc","c"), size = 3.5)

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/Sugar.AllCommonSite.png", plot = site.nsc.sugar, dpi = 600, width = 7.5, height = 3.5, units = "in")

#Site ANOVA glucose
lm.site.glucose <- lm(glucose.mg.g ~ Site, data = nsc.adult.total.mass.alive.common)
anova(lm.site.glucose)
summary(lm.site.glucose) #R^2 = 0.1932

#TukeyHSD site
#TukeyHSD PFT # p = .05
summary(aov.site.glucose <- aov(lm.site.glucose))
tukey.site.glucose <- TukeyHSD(aov.site.glucose, "Site", ordered = FALSE)
plot(tukey.site.glucose)
site.levels.glucose <- tukey.site.glucose[["Site"]][,4]
site.labels.glucose <- multcompLetters(site.levels.glucose)['Letters']
site.plot.labels.glucose <- names(site.labels.glucose[['Letters']])

site.nsc.glucose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = Site, y = glucose.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=12)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(legend.text = element_text(size=12)) +
  stat_summary(fun.y="mean", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 45), size = 3) + 
  ylab(expression(paste("Glucose mg g"^"-1"))) + xlab("Site") +
  scale_fill_manual(values=rev(cbPalette)) +
  annotate("text", x = 1:10, y = c(26, 19, 25, 23, 16, 41, 37, 40, 29, 32), 
           label = c("a","a","a","c","b","bc","c","bc","bc","c"), size = 3.5)

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/Glucose.AllCommonSite.png", plot = site.nsc.glucose, dpi = 600, width = 7.5, height = 3.5, units = "in")

#Site ANOVA fructose
lm.site.fructose <- lm(fructose.mg.g ~ Site, data = nsc.adult.total.mass.alive.common)
anova(lm.site.fructose)
summary(lm.site.fructose) #R^2 = 0.196

#TukeyHSD site
#TukeyHSD PFT # p = .05
summary(aov.site.fructose <- aov(lm.site.fructose))
tukey.site.fructose <- TukeyHSD(aov.site.fructose, "Site", ordered = FALSE)
plot(tukey.site.fructose)
site.levels.fructose <- tukey.site.fructose[["Site"]][,4]
site.labels.fructose <- multcompLetters(site.levels.fructose)['Letters']
site.plot.labels.fructose <- names(site.labels.fructose[['Letters']])

site.nsc.fructose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = Site, y = fructose.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=12)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(legend.text = element_text(size=12)) +
  stat_summary(fun.y="mean", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 38), size = 3) + 
  ylab(expression(paste("Fructose mg g"^"-1"))) + xlab("Site") +
  scale_fill_manual(values=rev(cbPalette)) +
  annotate("text", x = 1:10, y = c(23.5, 15, 22, 21, 17, 28, 25, 35, 23.5, 30), 
           label = c("a","a","ab","c","abc","e","d","de","bcd","de"), size = 3.5)

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/Fructose.AllCommonSite.png", plot = site.nsc.fructose, dpi = 600, width = 7.5, height = 3.5, units = "in")

#Site ANOVA sucrose
lm.site.sucrose <- lm(sucrose.mg.g ~ Site, data = nsc.adult.total.mass.alive.common)
anova(lm.site.sucrose)
summary(lm.site.sucrose) #R^2 = 0.1601

#TukeyHSD site
#TukeyHSD PFT # p = .05
summary(aov.site.sucrose <- aov(lm.site.sucrose))
tukey.site.sucrose <- TukeyHSD(aov.site.sucrose, "Site", ordered = FALSE)
plot(tukey.site.sucrose)
site.levels.sucrose <- tukey.site.sucrose[["Site"]][,4]
site.labels.sucrose <- multcompLetters(site.levels.sucrose)['Letters']
site.plot.labels.sucrose <- names(site.labels.sucrose[['Letters']])

site.nsc.sucrose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = Site, y = sucrose.mg.g)) +
  geom_violin() + theme(axis.text.x = element_text(angle=45,hjust=1,size=12)) +
  theme(axis.text.y = element_text(size=12)) +
  theme(axis.title.x = element_text(size=14)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(legend.text = element_text(size=12)) +
  stat_summary(fun.y="mean", geom="point") +
  stat_summary(fun.data = give.n, geom= "text", aes(y= 61), size = 3) + 
  ylab(expression(paste("Sucrose mg g"^"-1"))) + xlab("Site") +
  scale_fill_manual(values=rev(cbPalette)) +
  annotate("text", x = 1:10, y = c(38, 48, 36, 57, 56.5, 35.5, 55, 47, 47, 56), 
           label = c("a","cd","a","f","de","ab","e","bc","cde","de"), size = 3.5)

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/Final/Sucrose.AllCommonSite.png", plot = site.nsc.sucrose, dpi = 600, width = 7.5, height = 3.5, units = "in")

#Site x Plot ANOVA
lm.site.plot.total <- lm(total.nsc ~ Site/Plot, data = nsc.adult.total.mass.alive.common)
anova(lm.site.plot.total)
summary(lm.site.plot.total) #very few site * plot effects
```

Relationships between total, starch and sugars
```{r}
#starch v. total NSC
lm.starch2total <- lm(total.nsc ~ starch.mg.g, data = nsc.adult.total.mass.alive.common)
anova(lm.starch2total)
summary(lm.starch2total)
#strong correlation between starch and total nsc
#plot
plot(nsc.adult.total.mass$starch.mg.g, nsc.adult.total.mass$total.nsc)
abline(lm.starch2total)

#glucose v total NSC
lm.glucose2total <- lm(total.nsc ~ glucose.mg.g, data = nsc.adult.total.mass.alive.common)
anova(lm.glucose2total)
summary(lm.glucose2total)
#Very weak relationship between glucose and total
#Plot
plot(nsc.adult.total.mass$glucose.mg.g, nsc.adult.total.mass$total.nsc)
abline(lm.glucose2total)

#fructose v total NSC
lm.fructose2total <- lm(total.nsc ~ fructose.mg.g, data = nsc.adult.total.mass.alive.common)
anova(lm.fructose2total)
summary(lm.fructose2total)
#weak relationship between fructose and total
#Plot
plot(nsc.adult.total.mass$fructose.mg.g, nsc.adult.total.mass$total.nsc)
abline(lm.fructose2total)

#sucrose v total NSC
lm.sucrose2total <- lm(total.nsc ~ sucrose.mg.g, data = nsc.adult.total.mass.alive.common)
anova(lm.sucrose2total)
summary(lm.sucrose2total)
#Very weak relationship between glucose and total
#Plot
plot(nsc.adult.total.mass$sucrose.mg.g, nsc.adult.total.mass$total.nsc)
abline(lm.sucrose2total)

#Violin plots of componenets of NSCs

violin.glucose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = nrow(nsc.adult.total.mass.alive.common), y = glucose.mg.g)) +
  geom_violin() +
  theme(axis.text.x = element_blank()) +
  theme(axis.ticks.x = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  labs(x = "Glucose", y = expression(paste("Concentration (mg g"^"-1",")"))) +
  ylim(0,172) +
  theme(plot.margin = unit(c(5.5,0,5.5,5.5), "pt"))

violin.fructose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = nrow(nsc.adult.total.mass.alive.common), y = fructose.mg.g)) +
  geom_violin() +
  theme(axis.text.x = element_blank()) +
  theme(axis.ticks.x = element_blank()) +
  theme(axis.ticks.y = element_blank()) +
  theme(axis.text.y = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  labs(x = "Fructose", y = "") +
  ylim(0,172) +
  theme(plot.margin = unit(c(5.5,0,5.5,-5), "pt"))

violin.sucrose <- ggplot(nsc.adult.total.mass.alive.common, aes(x = nrow(nsc.adult.total.mass.alive.common), y = sucrose.mg.g)) +
  geom_violin() +
  theme(axis.text.x = element_blank()) +
  theme(axis.ticks.x = element_blank()) +
  theme(axis.ticks.y = element_blank()) +
  theme(axis.text.y = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  labs(x = "Sucrose", y = "") +
  ylim(0,172) +
  theme(plot.margin = unit(c(5.5,0,5.5,-5), "pt"))

violin.starch <- ggplot(nsc.adult.total.mass.alive.common, aes(x = nrow(nsc.adult.total.mass.alive.common), y = starch.mg.g)) +
  geom_violin() +
  theme(axis.text.x = element_blank()) +
  theme(axis.ticks.x = element_blank()) +
  theme(axis.ticks.y = element_blank()) +
  theme(axis.text.y = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  labs(x = "Starch", y = "") +
  #ylim(0,105) +
  ylim(0,172) +
  theme(plot.margin = unit(c(5.5,5.5,5.5,-5), "pt"))

violin.total <-ggplot(nsc.adult.total.mass.alive.common, aes(x = nrow(nsc.adult.total.mass.alive.common), y = total.nsc)) +
  geom_violin() +
  theme(axis.text.x = element_blank()) +
  theme(axis.ticks.x = element_blank()) +
  theme(axis.ticks.y = element_blank()) +
  theme(axis.text.y = element_blank()) +
  stat_summary(fun.y="median", geom="point") +
  labs(x = "Total NSC", y = "") +
  ylim(0,172) +
  theme(plot.margin = unit(c(5.5,5.5,5.5,-5), "pt"))

#combine component concentration plots
nsc.components <- grid.arrange(violin.glucose, violin.fructose, violin.sucrose, violin.starch, violin.total, ncol = 5)

ggsave(filename = "/Users/josh/Dropbox/Dissertation/CH2_NSC_Empirical/Figures/nsc.components.png", plot = nsc.components, dpi = 600, width = 8, height = 3.5, units = "in")

median(nsc.adult.total.mass.alive.common$glucose.mg.g, na.rm = TRUE) #8.06
median(nsc.adult.total.mass.alive.common$sucrose.mg.g, na.rm = TRUE) #13.6
median(nsc.adult.total.mass.alive.common$fructose.mg.g, na.rm = TRUE) #7.10
median(nsc.adult.total.mass.alive.common$starch.mg.g, na.rm = TRUE) #22.10
median(nsc.adult.total.mass.alive.common$total.nsc, na.rm = TRUE) #53.52


```
You can also embed plots, for example:

```{r fig.width=7, fig.height=6}
plot(cars)
```

